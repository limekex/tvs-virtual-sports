{
  "version": 3,
  "sources": ["../../src/utils/debug.js", "../../src/utils/reactMount.js", "../../src/blocks/route-insights/view.js"],
  "sourcesContent": ["// Debug utilities for TVS app\nexport const DEBUG =\n  new URLSearchParams(location.search).get(\"tvsdebug\") === \"1\" ||\n  window.TVS_DEBUG === true ||\n  localStorage.getItem(\"tvsDev\") === \"1\";\n\nexport function log(...args) {\n  if (DEBUG) console.debug(\"[TVS]\", ...args);\n}\n\nexport function err(...args) {\n  console.error(\"[TVS]\", ...args);\n}\n", "// React mount helper paired to the active renderer\nimport { log, err } from './debug.js';\n\nconst hasWindowReact = !!(window.React && window.ReactDOM);\nconst hasWpElement = !!(window.wp && window.wp.element);\nconst wpEl = hasWpElement ? window.wp.element : {};\nconst React = hasWindowReact ? window.React : (wpEl || {});\nconst ReactDOM = hasWindowReact ? window.ReactDOM : (wpEl || null);\n\n// Track mounted roots to safely unmount/re-mount\nconst tvsRoots = new WeakMap();\nconst hasCreateRoot =\n  (ReactDOM && typeof ReactDOM.createRoot === 'function') ||\n  (wpEl && typeof wpEl.createRoot === 'function');\n\nexport function mountReact(Component, props, node) {\n  try {\n    // Unmount existing root if present\n    const existingRoot = tvsRoots.get(node);\n    if (existingRoot && typeof existingRoot.unmount === 'function') {\n      existingRoot.unmount();\n      tvsRoots.delete(node);\n    }\n\n    // Use createRoot API (React 18+)\n    if (hasCreateRoot) {\n      const createRoot = (ReactDOM && ReactDOM.createRoot) || (wpEl && wpEl.createRoot);\n      const root = createRoot(node);\n      tvsRoots.set(node, root);\n      root.render(React.createElement(Component, props));\n      return;\n    }\n\n    // Fallback to legacy API (React <18) - unmount first if needed\n    if (ReactDOM && typeof ReactDOM.unmountComponentAtNode === 'function') {\n      ReactDOM.unmountComponentAtNode(node);\n    }\n\n    const legacyRender = (ReactDOM && ReactDOM.render) || (wpEl && wpEl.render);\n    if (legacyRender) {\n      legacyRender(React.createElement(Component, props), node);\n      return;\n    }\n    err('Ingen render-funksjon tilgjengelig.');\n  } catch (e) {\n    err('Mount feilet:', e);\n  }\n}\n\nexport { React, ReactDOM, wpEl };\n", "import { mountReact, React } from '../../utils/reactMount.js';\n\nfunction fmtDuration(seconds){\n  const s = Math.max(0, Math.floor(seconds||0));\n  const h = Math.floor(s/3600);\n  const m = Math.floor((s%3600)/60);\n  const r = s%60;\n  if(h>0) return `${h}:${String(m).padStart(2,'0')}:${String(r).padStart(2,'0')}`;\n  return `${m}:${String(r).padStart(2,'0')}`;\n}\n\nfunction ElevationSparkline({ React, routeId }){\n  const { createElement: h, useEffect, useRef, useState } = React;\n  const canvasRef = useRef(null);\n  const [err, setErr] = useState(null);\n  useEffect(() => {\n    if(!routeId) return;\n    let cancelled = false;\n    async function run(){\n      try{\n        // Use REST API to get GPX data (avoids SSL issues with direct file URLs)\n        const root = (window.TVS_SETTINGS && TVS_SETTINGS.restRoot) || '/wp-json/';\n        const url = `${root.replace(/\\/$/,'')}/tvs/v1/routes/${encodeURIComponent(routeId)}/gpx-data`;\n        const res = await fetch(url);\n        if(!res.ok) throw new Error('HTTP '+res.status);\n        const gpxData = await res.json();\n        if(cancelled) return;\n\n        // Extract elevation values from parsed GPX data\n        const vals = (gpxData.points || [])\n          .map(p => p.ele)\n          .filter(v => Number.isFinite(v));\n\n        const c = canvasRef.current; if(!c) return;\n        const ctx = c.getContext('2d');\n        const w = c.width = 260, hgt = c.height = 50;\n        ctx.clearRect(0,0,w,hgt);\n        if(vals.length < 2){\n          setErr('No elevation data');\n          return;\n        }\n        const min = Math.min(...vals), max = Math.max(...vals);\n        const rng = Math.max(1, max - min);\n        ctx.strokeStyle = '#0ea5e9'; ctx.lineWidth = 2; ctx.beginPath();\n        vals.forEach((v, i) => {\n          const x = (i/(vals.length-1)) * (w-4) + 2;\n          const y = (1-((v-min)/rng)) * (hgt-6) + 3;\n          if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);\n        });\n        ctx.stroke();\n      }catch(e){ if(!cancelled) setErr(e.message||'Failed'); }\n    }\n    run();\n    return () => { cancelled = true; };\n  }, [routeId]);\n  return h('div', null,\n    h('canvas', { ref: canvasRef, width: 260, height: 50, style: { maxWidth:'100%', display:'block' }}),\n    err ? h('div', { className: 'tvs-text-muted', style:{fontSize:'.85em'} }, String(err)) : null\n  );\n}\n\nfunction RouteInsights({ React, title, showElevation, showSurface, showEta, showMapsLink, routeId }){\n  const { createElement: h, useEffect, useState } = React;\n  const [data, setData] = useState(null);\n  const [err, setErr] = useState(null);\n  useEffect(() => {\n    let cancelled = false;\n    async function load(){\n      if(!routeId){ setErr('No route selected.'); return; }\n      try{\n        const root = (window.TVS_SETTINGS && TVS_SETTINGS.restRoot) || '/wp-json/';\n        const url = `${root.replace(/\\/$/,'')}/tvs/v1/routes/${encodeURIComponent(routeId)}/insights`;\n        const res = await fetch(url);\n        if(!res.ok) throw new Error('HTTP '+res.status);\n        const json = await res.json();\n        if(!cancelled) setData(json);\n      }catch(e){ if(!cancelled) setErr(e.message||'Failed'); }\n    }\n    load();\n    return () => { cancelled = true; };\n  }, [routeId]);\n\n  const items = [];\n  const meta = (data && data.meta) || {};\n  if(showElevation){\n    const dist = meta.distance_m ? `${(meta.distance_m/1000).toFixed(2)} km` : null;\n    const head = `Distance: ${dist || '\u2014'} \u2022 Elevation: ${meta.elevation_m?Math.round(meta.elevation_m)+' m':'\u2014'}`;\n    items.push(h('div', null, head, routeId ? h(ElevationSparkline, { React, routeId }) : null));\n  }\n  if(showSurface){ items.push(`Surface: ${meta.surface || '\u2014'}`); }\n  if(showEta){\n    const eta = data && data.computed && data.computed.eta_s ? fmtDuration(data.computed.eta_s) : '\u2014';\n    items.push(`Estimated time: ${eta}`);\n  }\n  if(showMapsLink){\n    const href = data && data.maps_url;\n    items.push(href ? h('a', { href, target:'_blank', rel:'noopener noreferrer' }, 'Open in Google Maps (midpoint)') : 'Open in Google Maps (\u2014)');\n  }\n\n  return h('div', { className: 'tvs-panel' },\n    h('h3', { className: 'tvs-activities-title' }, title || 'Route Insights'),\n    (!data && !err) ? h('div', { className: 'tvs-text-muted' }, 'Loading\u2026') : null,\n    err ? h('div', { className: 'tvs-text-danger' }, String(err)) : null,\n    h('ul', { className: 'tvs-list' }, items.map((it,i) => h('li', { key:i }, it)))\n  );\n}\n\nfunction mountAll(){\n  const nodes = document.querySelectorAll('.tvs-route-insights-block');\n  nodes.forEach((node, idx) => {\n    if(node.__tvsMounted) return;\n    const title = node.getAttribute('data-title') || '';\n    const showElevation = node.getAttribute('data-show-elevation') === '1';\n    const showSurface   = node.getAttribute('data-show-surface') === '1';\n    const showEta       = node.getAttribute('data-show-eta') === '1';\n    const showMapsLink  = node.getAttribute('data-show-maps-link') === '1';\n    const routeId = parseInt(node.getAttribute('data-route-id')||'0',10) || 0;\n    mountReact(RouteInsights, { React, title, showElevation, showSurface, showEta, showMapsLink, routeId }, node);\n    node.__tvsMounted = true;\n  });\n}\n\nif(document.readyState === 'loading'){\n  document.addEventListener('DOMContentLoaded', mountAll);\n}else{ mountAll(); }\n"],
  "mappings": "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",
  "names": ["DEBUG", "err", "args", "hasWindowReact", "hasWpElement", "wpEl", "React", "ReactDOM", "tvsRoots", "hasCreateRoot", "mountReact", "Component", "props", "node", "existingRoot", "root", "legacyRender", "err", "e", "fmtDuration", "seconds", "s", "h", "m", "r", "ElevationSparkline", "React", "routeId", "useEffect", "useRef", "useState", "canvasRef", "err", "setErr", "cancelled", "run", "url", "res", "gpxData", "vals", "p", "v", "c", "ctx", "w", "hgt", "min", "max", "rng", "i", "x", "y", "e", "RouteInsights", "title", "showElevation", "showSurface", "showEta", "showMapsLink", "data", "setData", "load", "json", "items", "meta", "head", "eta", "href", "it", "mountAll", "node", "idx", "mountReact"]
}
