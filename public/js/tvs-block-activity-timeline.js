(()=>{var{createElement:t,useState:y,useEffect:S}=window.React;function b({userId:a,limit:e,title:s,showNotes:n,showFilters:o}){let[c,v]=y([]),[r,i]=y(!0),[m,p]=y(null),[d,f]=y("all");S(()=>{g()},[e]);let g=async()=>{i(!0),p(null);try{let l=`${window.TVS_SETTINGS.restRoot}tvs/v1/activities/me?per_page=${e}`,u=await fetch(l,{headers:{"X-WP-Nonce":window.TVS_SETTINGS.nonce}});if(!u.ok)throw new Error("Failed to fetch activities");let k=await u.json();v(k||[])}catch(l){console.error("Error fetching activities:",l),p(l.message)}finally{i(!1)}},w=$(c),N=d==="all"?w:w.map(l=>({...l,activities:l.activities.filter(u=>u.meta.activity_type?.toLowerCase()===d.toLowerCase())})).filter(l=>l.activities.length>0);return r?t("div",{className:"tvs-timeline-loading"},t("div",{className:"tvs-loading-spinner"})):m?t("div",{className:"tvs-timeline-error"},t("p",null,`Error: ${m}`)):c.length===0?t("div",{className:"tvs-timeline-empty"},t("p",null,"No activities found.")):t("div",{className:"tvs-activity-timeline"},t("div",{className:"tvs-timeline-header"},t("h2",{className:"tvs-timeline-title"},s),o&&t("div",{className:"tvs-timeline-filters"},t("select",{className:"tvs-type-filter",value:d,onChange:l=>f(l.target.value)},t("option",{value:"all"},"All Activities"),t("option",{value:"run"},"\u{1F3C3} Run"),t("option",{value:"ride"},"\u{1F6B4} Ride"),t("option",{value:"walk"},"\u{1F6B6} Walk"),t("option",{value:"hike"},"\u26F0\uFE0F Hike"),t("option",{value:"swim"},"\u{1F3CA} Swim"),t("option",{value:"workout"},"\u{1F4AA} Workout")))),t("div",{className:"tvs-timeline-content"},N.map((l,u)=>t(T,{key:u,group:l,showNotes:n}))))}function T({group:a,showNotes:e}){return t("div",{className:"tvs-timeline-group"},t("div",{className:"tvs-timeline-date-marker"},t("span",{className:"tvs-date-label"},a.label),t("div",{className:"tvs-timeline-line"})),t("div",{className:"tvs-timeline-activities"},a.activities.map(s=>t(D,{key:s.id,activity:s,showNotes:e}))))}function D({activity:a,showNotes:e}){let[s,n]=y(!1),o=a.meta||{},c=(o.activity_type||"workout").toLowerCase(),v=o.distance_m?(o.distance_m/1e3).toFixed(2):0,r=E(o.duration_s||0),i=parseInt(o.rating)||0,m=o.notes||"",p=o.source||"manual",d={run:{icon:"\u{1F3C3}",color:"#3b82f6",label:"Run"},ride:{icon:"\u{1F6B4}",color:"#10b981",label:"Ride"},walk:{icon:"\u{1F6B6}",color:"#f59e0b",label:"Walk"},hike:{icon:"\u26F0\uFE0F",color:"#f97316",label:"Hike"},swim:{icon:"\u{1F3CA}",color:"#06b6d4",label:"Swim"},workout:{icon:"\u{1F4AA}",color:"#a855f7",label:"Workout"}},f=d[c]||d.workout,g={manual:"Manual Tracker",virtual:"Virtual Route",video:"Video Mode"};return t("div",{className:"tvs-activity-card",style:{borderLeftColor:f.color}},t("div",{className:"tvs-activity-card-header"},t("div",{className:"tvs-activity-type"},t("span",{className:"tvs-type-icon"},f.icon),t("span",{className:"tvs-type-label"},f.label)),t("span",{className:"tvs-activity-source"},g[p]||p),t("time",{className:"tvs-activity-time"},A(a.date))),t("div",{className:"tvs-activity-card-body"},t("div",{className:"tvs-activity-metrics"},v>0&&t("div",{className:"tvs-metric"},t("span",{className:"tvs-metric-icon"},"\u{1F4CF}"),t("span",{className:"tvs-metric-value"},`${v} km`)),t("div",{className:"tvs-metric"},t("span",{className:"tvs-metric-icon"},"\u23F1\uFE0F"),t("span",{className:"tvs-metric-value"},r))),i>0&&t("div",{className:"tvs-activity-rating"},Array.from({length:10}).map((w,N)=>t("span",{key:N,className:`tvs-star ${N<i?"tvs-star--filled":""}`},"\u2B50")),t("span",{className:"tvs-rating-value"},` ${i}/10`)),e&&m&&t("div",{className:"tvs-activity-notes"},t("div",{className:`tvs-notes-content ${s?"expanded":"collapsed"}`},s?m:m.substring(0,100)+(m.length>100?"...":"")),m.length>100&&t("button",{className:"tvs-notes-toggle",onClick:()=>n(!s)},s?"Show less":"Read more"))),t("a",{href:a.permalink||`?p=${a.id}&post_type=tvs_activity`,className:"tvs-activity-link"},"View Details \u2192"))}function $(a){let e=new Date;e.setHours(0,0,0,0);let s=new Date(e);s.setDate(s.getDate()-1);let n=new Date(e);n.setDate(n.getDate()-e.getDay());let o=new Date(n);o.setDate(o.getDate()-7);let c={};return a.forEach(v=>{let r=new Date(v.date);r.setHours(0,0,0,0);let i;r.getTime()===e.getTime()?i="Today":r.getTime()===s.getTime()?i="Yesterday":r>=n?i="This Week":r>=o?i="Last Week":i=r.toLocaleDateString("no-NO",{year:"numeric",month:"long",day:"numeric"}),c[i]||(c[i]={label:i,activities:[]}),c[i].activities.push(v)}),Object.values(c)}function E(a){let e=Math.floor(a/3600),s=Math.floor(a%3600/60),n=a%60;return e>0?`${e}:${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}`:`${s}:${String(n).padStart(2,"0")}`}function A(a){return new Date(a).toLocaleTimeString("no-NO",{hour:"2-digit",minute:"2-digit"})}function h(){document.querySelectorAll(".tvs-activity-timeline-block").forEach(e=>{let s=parseInt(e.dataset.userId)||0,n=parseInt(e.dataset.limit)||10,o=e.dataset.title||"Activity Timeline",c=e.dataset.showNotes==="1",v=e.dataset.showFilters==="1";window.ReactDOM.createRoot(e).render(t(b,{userId:s,limit:n,title:o,showNotes:c,showFilters:v}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",h):h();})();
//# sourceMappingURL=tvs-block-activity-timeline.js.map
