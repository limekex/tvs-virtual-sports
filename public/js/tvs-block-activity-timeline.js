(()=>{var{createElement:t,useState:w,useEffect:S}=window.React;function A({userId:n,limit:e,title:s,showNotes:l,showFilters:a}){let[i,m]=w([]),[c,r]=w(!0),[f,u]=w(null),[d,y]=w("all");S(()=>{h()},[e]);let h=async()=>{r(!0),u(null);try{let o=`${window.TVS_SETTINGS.restRoot}tvs/v1/activities/me?per_page=${e}`,p=await fetch(o,{headers:{"X-WP-Nonce":window.TVS_SETTINGS.nonce}});if(!p.ok)throw new Error("Failed to fetch activities");let v=await p.json();m(v||[])}catch(o){console.error("Error fetching activities:",o),u(o.message)}finally{r(!1)}},g=D(i),N=d==="all"?g:g.map(o=>({...o,activities:o.activities.filter(p=>{let v=p.meta.activity_type;return Array.isArray(v)&&v.length>0&&(v=v[0]),typeof v!="string"&&(v="workout"),v.toLowerCase()===d.toLowerCase()})})).filter(o=>o.activities.length>0);return c?t("div",{className:"tvs-timeline-loading"},t("div",{className:"tvs-loading-spinner"})):f?t("div",{className:"tvs-timeline-error"},t("p",null,`Error: ${f}`)):i.length===0?t("div",{className:"tvs-timeline-empty"},t("p",null,"No activities found.")):t("div",{className:"tvs-activity-timeline"},t("div",{className:"tvs-timeline-header"},t("h2",{className:"tvs-timeline-title"},s),a&&t("div",{className:"tvs-timeline-filters"},t("select",{className:"tvs-type-filter",value:d,onChange:o=>y(o.target.value)},t("option",{value:"all"},"All Activities"),t("option",{value:"run"},"\u{1F3C3} Run"),t("option",{value:"ride"},"\u{1F6B4} Ride"),t("option",{value:"walk"},"\u{1F6B6} Walk"),t("option",{value:"hike"},"\u26F0\uFE0F Hike"),t("option",{value:"swim"},"\u{1F3CA} Swim"),t("option",{value:"workout"},"\u{1F4AA} Workout")))),t("div",{className:"tvs-timeline-content"},N.map((o,p)=>t(T,{key:p,group:o,showNotes:l}))))}function T({group:n,showNotes:e}){return t("div",{className:"tvs-timeline-group"},t("div",{className:"tvs-timeline-date-marker"},t("span",{className:"tvs-date-label"},n.label),t("div",{className:"tvs-timeline-line"})),t("div",{className:"tvs-timeline-activities"},n.activities.map(s=>t(b,{key:s.id,activity:s,showNotes:e}))))}function b({activity:n,showNotes:e}){let[s,l]=w(!1),a=n.meta||{},i=a.activity_type||"workout";Array.isArray(i)&&i.length>0&&(i=i[0]),typeof i=="object"&&i!==null&&(i="workout");let m=String(i).toLowerCase(),c=a.distance_m?(parseFloat(Array.isArray(a.distance_m)?a.distance_m[0]:a.distance_m)/1e3).toFixed(2):0,r=_(parseInt(Array.isArray(a.duration_s)?a.duration_s[0]:a.duration_s)||0),f=parseInt(Array.isArray(a.rating)?a.rating[0]:a.rating)||0,u=a.notes||"";Array.isArray(u)&&u.length>0&&(u=u[0]);let d=String(u||""),y=a.source||"manual";Array.isArray(y)&&y.length>0&&(y=y[0]);let h=String(y),g={run:{icon:"\u{1F3C3}",color:"#3b82f6",label:"Run"},ride:{icon:"\u{1F6B4}",color:"#10b981",label:"Ride"},walk:{icon:"\u{1F6B6}",color:"#f59e0b",label:"Walk"},hike:{icon:"\u26F0\uFE0F",color:"#f97316",label:"Hike"},swim:{icon:"\u{1F3CA}",color:"#06b6d4",label:"Swim"},workout:{icon:"\u{1F4AA}",color:"#a855f7",label:"Workout"}},N=g[m]||g.workout,o={manual:"Manual Tracker",virtual:"Virtual Route",video:"Video Mode"};return t("div",{className:"tvs-activity-card",style:{borderLeftColor:N.color}},t("div",{className:"tvs-activity-card-header"},t("div",{className:"tvs-activity-type"},t("span",{className:"tvs-type-icon"},N.icon),t("span",{className:"tvs-type-label"},N.label)),t("span",{className:"tvs-activity-source"},o[h]||h),t("time",{className:"tvs-activity-time"},R(n.date))),t("div",{className:"tvs-activity-card-body"},t("div",{className:"tvs-activity-metrics"},c>0&&t("div",{className:"tvs-metric"},t("span",{className:"tvs-metric-icon"},"\u{1F4CF}"),t("span",{className:"tvs-metric-value"},`${c} km`)),t("div",{className:"tvs-metric"},t("span",{className:"tvs-metric-icon"},"\u23F1\uFE0F"),t("span",{className:"tvs-metric-value"},r))),f>0&&t("div",{className:"tvs-activity-rating"},Array.from({length:10}).map((p,v)=>t("span",{key:v,className:`tvs-star ${v<f?"tvs-star--filled":""}`},"\u2B50")),t("span",{className:"tvs-rating-value"},` ${f}/10`)),e&&d&&t("div",{className:"tvs-activity-notes"},t("div",{className:`tvs-notes-content ${s?"expanded":"collapsed"}`},s?d:d.substring(0,100)+(d.length>100?"...":"")),d.length>100&&t("button",{className:"tvs-notes-toggle",onClick:()=>l(!s)},s?"Show less":"Read more"))),t("a",{href:n.permalink||`?p=${n.id}&post_type=tvs_activity`,className:"tvs-activity-link"},"View Details \u2192"))}function D(n){let e=new Date;e.setHours(0,0,0,0);let s=new Date(e);s.setDate(s.getDate()-1);let l=new Date(e);l.setDate(l.getDate()-e.getDay());let a=new Date(l);a.setDate(a.getDate()-7);let i={};return n.forEach(m=>{let c=new Date(m.date);c.setHours(0,0,0,0);let r;c.getTime()===e.getTime()?r="Today":c.getTime()===s.getTime()?r="Yesterday":c>=l?r="This Week":c>=a?r="Last Week":r=c.toLocaleDateString("no-NO",{year:"numeric",month:"long",day:"numeric"}),i[r]||(i[r]={label:r,activities:[]}),i[r].activities.push(m)}),Object.values(i)}function _(n){let e=Math.floor(n/3600),s=Math.floor(n%3600/60),l=n%60;return e>0?`${e}:${String(s).padStart(2,"0")}:${String(l).padStart(2,"0")}`:`${s}:${String(l).padStart(2,"0")}`}function R(n){return new Date(n).toLocaleTimeString("no-NO",{hour:"2-digit",minute:"2-digit"})}function k(){document.querySelectorAll(".tvs-activity-timeline-block").forEach(e=>{let s=parseInt(e.dataset.userId)||0,l=parseInt(e.dataset.limit)||10,a=e.dataset.title||"Activity Timeline",i=e.dataset.showNotes==="1",m=e.dataset.showFilters==="1";window.ReactDOM.createRoot(e).render(t(A,{userId:s,limit:l,title:a,showNotes:i,showFilters:m}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k();})();
//# sourceMappingURL=tvs-block-activity-timeline.js.map
