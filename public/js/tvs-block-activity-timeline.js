(()=>{var{createElement:t,useState:g,useEffect:S}=window.React;function T({userId:i,limit:e,title:a,showNotes:c,showFilters:n}){let[s,m]=g([]),[r,l]=g(!0),[u,d]=g(null),[p,N]=g("all");S(()=>{f()},[e]);let f=async()=>{l(!0),d(null);try{let o=`${window.TVS_SETTINGS.restRoot}tvs/v1/activities/me?per_page=${e}`,y=await fetch(o,{headers:{"X-WP-Nonce":window.TVS_SETTINGS.nonce}});if(!y.ok)throw new Error("Failed to fetch activities");let v=await y.json();m(v||[])}catch(o){console.error("Error fetching activities:",o),d(o.message)}finally{l(!1)}},w=A(s),h=p==="all"?w:w.map(o=>({...o,activities:o.activities.filter(y=>{let v=y.meta.activity_type;return Array.isArray(v)&&v.length>0&&(v=v[0]),typeof v!="string"&&(v="workout"),v.toLowerCase()===p.toLowerCase()})})).filter(o=>o.activities.length>0);return r?t("div",{className:"tvs-timeline-loading"},t("div",{className:"tvs-loading-spinner"})):u?t("div",{className:"tvs-timeline-error"},t("p",null,`Error: ${u}`)):s.length===0?t("div",{className:"tvs-timeline-empty"},t("p",null,"No activities found.")):t("div",{className:"tvs-activity-timeline"},t("div",{className:"tvs-timeline-header"},t("h2",{className:"tvs-timeline-title"},a),n&&t("div",{className:"tvs-timeline-filters"},t("select",{className:"tvs-type-filter",value:p,onChange:o=>N(o.target.value)},t("option",{value:"all"},"All Activities"),t("option",{value:"run"},"\u{1F3C3} Run"),t("option",{value:"ride"},"\u{1F6B4} Ride"),t("option",{value:"walk"},"\u{1F6B6} Walk"),t("option",{value:"hike"},"\u26F0\uFE0F Hike"),t("option",{value:"swim"},"\u{1F3CA} Swim"),t("option",{value:"workout"},"\u{1F4AA} Workout")))),t("div",{className:"tvs-timeline-content"},h.map((o,y)=>t(b,{key:y,group:o,showNotes:c}))))}function b({group:i,showNotes:e}){return t("div",{className:"tvs-timeline-group"},t("div",{className:"tvs-timeline-date-marker"},t("span",{className:"tvs-date-label"},i.label),t("div",{className:"tvs-timeline-line"})),t("div",{className:"tvs-timeline-activities"},i.activities.map(a=>t(D,{key:a.id,activity:a,showNotes:e}))))}function D({activity:i,showNotes:e}){let[a,c]=g(!1),n=i.meta||{},s=n.activity_type||"workout";Array.isArray(s)&&s.length>0&&(s=s[0]),typeof s=="object"&&s!==null&&(s="workout");let m=String(s).toLowerCase(),r=n.distance_m?(n.distance_m/1e3).toFixed(2):0,l=$(n.duration_s||0),u=parseInt(n.rating)||0,d=n.notes||"",p=n.source||"manual",N={run:{icon:"\u{1F3C3}",color:"#3b82f6",label:"Run"},ride:{icon:"\u{1F6B4}",color:"#10b981",label:"Ride"},walk:{icon:"\u{1F6B6}",color:"#f59e0b",label:"Walk"},hike:{icon:"\u26F0\uFE0F",color:"#f97316",label:"Hike"},swim:{icon:"\u{1F3CA}",color:"#06b6d4",label:"Swim"},workout:{icon:"\u{1F4AA}",color:"#a855f7",label:"Workout"}},f=N[m]||N.workout,w={manual:"Manual Tracker",virtual:"Virtual Route",video:"Video Mode"};return t("div",{className:"tvs-activity-card",style:{borderLeftColor:f.color}},t("div",{className:"tvs-activity-card-header"},t("div",{className:"tvs-activity-type"},t("span",{className:"tvs-type-icon"},f.icon),t("span",{className:"tvs-type-label"},f.label)),t("span",{className:"tvs-activity-source"},w[p]||p),t("time",{className:"tvs-activity-time"},E(i.date))),t("div",{className:"tvs-activity-card-body"},t("div",{className:"tvs-activity-metrics"},r>0&&t("div",{className:"tvs-metric"},t("span",{className:"tvs-metric-icon"},"\u{1F4CF}"),t("span",{className:"tvs-metric-value"},`${r} km`)),t("div",{className:"tvs-metric"},t("span",{className:"tvs-metric-icon"},"\u23F1\uFE0F"),t("span",{className:"tvs-metric-value"},l))),u>0&&t("div",{className:"tvs-activity-rating"},Array.from({length:10}).map((h,o)=>t("span",{key:o,className:`tvs-star ${o<u?"tvs-star--filled":""}`},"\u2B50")),t("span",{className:"tvs-rating-value"},` ${u}/10`)),e&&d&&t("div",{className:"tvs-activity-notes"},t("div",{className:`tvs-notes-content ${a?"expanded":"collapsed"}`},a?d:d.substring(0,100)+(d.length>100?"...":"")),d.length>100&&t("button",{className:"tvs-notes-toggle",onClick:()=>c(!a)},a?"Show less":"Read more"))),t("a",{href:i.permalink||`?p=${i.id}&post_type=tvs_activity`,className:"tvs-activity-link"},"View Details \u2192"))}function A(i){let e=new Date;e.setHours(0,0,0,0);let a=new Date(e);a.setDate(a.getDate()-1);let c=new Date(e);c.setDate(c.getDate()-e.getDay());let n=new Date(c);n.setDate(n.getDate()-7);let s={};return i.forEach(m=>{let r=new Date(m.date);r.setHours(0,0,0,0);let l;r.getTime()===e.getTime()?l="Today":r.getTime()===a.getTime()?l="Yesterday":r>=c?l="This Week":r>=n?l="Last Week":l=r.toLocaleDateString("no-NO",{year:"numeric",month:"long",day:"numeric"}),s[l]||(s[l]={label:l,activities:[]}),s[l].activities.push(m)}),Object.values(s)}function $(i){let e=Math.floor(i/3600),a=Math.floor(i%3600/60),c=i%60;return e>0?`${e}:${String(a).padStart(2,"0")}:${String(c).padStart(2,"0")}`:`${a}:${String(c).padStart(2,"0")}`}function E(i){return new Date(i).toLocaleTimeString("no-NO",{hour:"2-digit",minute:"2-digit"})}function k(){document.querySelectorAll(".tvs-activity-timeline-block").forEach(e=>{let a=parseInt(e.dataset.userId)||0,c=parseInt(e.dataset.limit)||10,n=e.dataset.title||"Activity Timeline",s=e.dataset.showNotes==="1",m=e.dataset.showFilters==="1";window.ReactDOM.createRoot(e).render(t(T,{userId:a,limit:c,title:n,showNotes:s,showFilters:m}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k();})();
//# sourceMappingURL=tvs-block-activity-timeline.js.map
