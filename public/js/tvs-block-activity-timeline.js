(()=>{var{createElement:t,useState:y,useEffect:E}=window.React;function P({userId:n,limit:e,title:s,showNotes:l,showFilters:a}){let[i,d]=y([]),[c,o]=y(!0),[N,u]=y(null),[v,g]=y("all"),[p,h]=y(1),[f,b]=y(0),[w,k]=y(0);E(()=>{D()},[p,v]);let D=async()=>{o(!0),u(null);try{let r=e||10,m=`${window.TVS_SETTINGS.restRoot}tvs/v1/activities/me?per_page=${r}&page=${p}`,T=await fetch(m,{headers:{"X-WP-Nonce":window.TVS_SETTINGS.nonce}});if(!T.ok)throw new Error("Failed to fetch activities");let _=await T.json(),R=parseInt(T.headers.get("X-WP-Total")||"0"),C=parseInt(T.headers.get("X-WP-TotalPages")||"1");d(_||[]),b(R),k(C)}catch(r){console.error("Error fetching activities:",r),u(r.message)}finally{o(!1)}},A=v==="all"?i:i.filter(r=>{let m=r.meta.activity_type;return Array.isArray(m)&&m.length>0&&(m=m[0]),typeof m!="string"&&(m="workout"),m.toLowerCase()===v.toLowerCase()}),$=W(A);return c?t("div",{className:"tvs-timeline-loading"},t("div",{className:"tvs-loading-spinner"})):N?t("div",{className:"tvs-timeline-error"},t("p",null,`Error: ${N}`)):!c&&f===0?t("div",{className:"tvs-timeline-empty"},t("p",null,"No activities found.")):t("div",{className:"tvs-activity-timeline"},t("div",{className:"tvs-timeline-header"},t("div",{className:"tvs-timeline-header-left"},t("h2",{className:"tvs-timeline-title"},s),t("span",{className:"tvs-timeline-count"},`${f} ${f===1?"activity":"activities"}`)),t("div",{className:"tvs-timeline-header-right"},a&&t("select",{className:"tvs-type-filter",value:v,onChange:r=>{g(r.target.value),h(1)}},t("option",{value:"all"},"All Types"),t("option",{value:"run"},"\u{1F3C3} Run"),t("option",{value:"ride"},"\u{1F6B4} Ride"),t("option",{value:"walk"},"\u{1F6B6} Walk"),t("option",{value:"hike"},"\u26F0\uFE0F Hike"),t("option",{value:"swim"},"\u{1F3CA} Swim"),t("option",{value:"workout"},"\u{1F4AA} Workout")),w>1&&t("div",{className:"tvs-timeline-pagination"},t("button",{className:"tvs-pagination-btn",disabled:p===1,onClick:()=>h(r=>r-1)},"\u2190 Previous"),t("span",{className:"tvs-pagination-info"},`Page ${p} of ${w}`),t("button",{className:"tvs-pagination-btn",disabled:p===w,onClick:()=>h(r=>r+1)},"Next \u2192")))),t("div",{className:"tvs-timeline-content"},A.length===0?t("div",{className:"tvs-timeline-empty"},t("p",null,`No ${v} activities found.`)):$.map((r,m)=>t(I,{key:m,group:r,showNotes:l}))))}function I({group:n,showNotes:e}){return t("div",{className:"tvs-timeline-group"},t("div",{className:"tvs-timeline-date-marker"},t("span",{className:"tvs-date-label"},n.label)),t("div",{className:"tvs-timeline-activities"},n.activities.map(s=>t(L,{key:s.id,activity:s,showNotes:e}))))}function L({activity:n,showNotes:e}){let[s,l]=y(!1),a=n.meta||{},i=a.activity_type||"workout";Array.isArray(i)&&i.length>0&&(i=i[0]),typeof i=="object"&&i!==null&&(i="workout");let d=String(i).toLowerCase(),c=a.distance_m?(parseFloat(Array.isArray(a.distance_m)?a.distance_m[0]:a.distance_m)/1e3).toFixed(2):0,o=M(parseInt(Array.isArray(a.duration_s)?a.duration_s[0]:a.duration_s)||0),N=parseInt(Array.isArray(a.rating)?a.rating[0]:a.rating)||0,u=a.notes||"";Array.isArray(u)&&u.length>0&&(u=u[0]);let v=String(u||""),g=a.source||"manual";Array.isArray(g)&&g.length>0&&(g=g[0]);let p=String(g),h={run:{icon:"\u{1F3C3}",color:"#3b82f6",label:"Run"},ride:{icon:"\u{1F6B4}",color:"#10b981",label:"Ride"},walk:{icon:"\u{1F6B6}",color:"#f59e0b",label:"Walk"},hike:{icon:"\u26F0\uFE0F",color:"#f97316",label:"Hike"},swim:{icon:"\u{1F3CA}",color:"#06b6d4",label:"Swim"},workout:{icon:"\u{1F4AA}",color:"#a855f7",label:"Workout"}},f=h[d]||h.workout,b={manual:"Manual Tracker",virtual:"Virtual Route",video:"Video Mode"};return t("div",{className:"tvs-activity-card",style:{borderLeftColor:f.color}},t("div",{className:"tvs-activity-card-main"},t("div",{className:"tvs-activity-card-left"},t("div",{className:"tvs-activity-type"},t("span",{className:"tvs-type-icon"},f.icon),t("span",{className:"tvs-type-label"},f.label)),t("time",{className:"tvs-activity-time"},x(n.date))),t("div",{className:"tvs-activity-card-center"},t("div",{className:"tvs-activity-metrics"},c>0&&t("span",{className:"tvs-metric"},t("span",{className:"tvs-metric-icon"},"\u{1F4CF}"),t("span",{className:"tvs-metric-value"},`${c} km`)),t("span",{className:"tvs-metric"},t("span",{className:"tvs-metric-icon"},"\u23F1\uFE0F"),t("span",{className:"tvs-metric-value"},o))),N>0&&t("div",{className:"tvs-activity-rating"},Array.from({length:10}).map((w,k)=>t("span",{key:k,className:`tvs-star ${k<N?"tvs-star--filled":""}`},"\u2B50")),t("span",{className:"tvs-rating-value"},`${N}/10`))),t("div",{className:"tvs-activity-card-right"},t("span",{className:"tvs-activity-source"},b[p]||p),t("a",{href:n.permalink||`?p=${n.id}&post_type=tvs_activity`,className:"tvs-activity-link"},"View \u2192"))),e&&v&&t("div",{className:"tvs-activity-notes"},t("div",{className:`tvs-notes-content ${s?"expanded":"collapsed"}`},s?v:v.length>100?v.substring(0,100)+"...":v),v.length>100&&t("button",{className:"tvs-notes-toggle",onClick:()=>l(!s)},s?"Show less":"Read more")))}function W(n){let e=new Date;e.setHours(0,0,0,0);let s=new Date(e);s.setDate(s.getDate()-1);let l=new Date(e);l.setDate(l.getDate()-e.getDay());let a=new Date(l);a.setDate(a.getDate()-7);let i={};return n.forEach(d=>{let c=new Date(d.date);c.setHours(0,0,0,0);let o;c.getTime()===e.getTime()?o="Today":c.getTime()===s.getTime()?o="Yesterday":c>=l?o="This Week":c>=a?o="Last Week":o=c.toLocaleDateString("no-NO",{year:"numeric",month:"long",day:"numeric"}),i[o]||(i[o]={label:o,activities:[]}),i[o].activities.push(d)}),Object.values(i)}function M(n){let e=Math.floor(n/3600),s=Math.floor(n%3600/60),l=n%60;return e>0?`${e}:${String(s).padStart(2,"0")}:${String(l).padStart(2,"0")}`:`${s}:${String(l).padStart(2,"0")}`}function x(n){return new Date(n).toLocaleTimeString("no-NO",{hour:"2-digit",minute:"2-digit"})}function S(){document.querySelectorAll(".tvs-activity-timeline-block").forEach(e=>{let s=parseInt(e.dataset.userId)||0,l=parseInt(e.dataset.limit)||10,a=e.dataset.title||"Activity Timeline",i=e.dataset.showNotes==="1",d=e.dataset.showFilters==="1";window.ReactDOM.createRoot(e).render(t(P,{userId:s,limit:l,title:a,showNotes:i,showFilters:d}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S):S();})();
//# sourceMappingURL=tvs-block-activity-timeline.js.map
