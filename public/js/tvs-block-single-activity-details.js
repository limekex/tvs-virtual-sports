(()=>{var{createElement:s,useState:u,useEffect:S}=window.React;function z({exercise:a,onClose:o}){if(!a)return null;let[e,p]=u(null),[_,v]=u(!1),[d,N]=u(!1);return S(()=>{let l=n=>{n.key==="Escape"&&o()};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[o]),S(()=>{let l=a.exercise_id||a.id;l&&Number.isInteger(Number(l))&&!d&&(N(!0),v(!0),fetch(`${window.TVS_SETTINGS.restRoot}tvs/v1/exercises/${l}`).then(n=>n.ok?n.json():(v(!1),null)).then(n=>{n&&n.success&&n.exercise&&(console.log("Exercise API response:",n.exercise),p(n.exercise)),v(!1)}).catch(()=>v(!1)))},[a,d]),s("div",{className:"tvs-modal-overlay",onClick:o},s("div",{className:"tvs-modal-content",onClick:l=>l.stopPropagation()},s("div",{className:"tvs-modal-header"},s("h2",null,a.name||"Exercise Details"),s("button",{className:"tvs-modal-close",onClick:o,"aria-label":"Close"},"\xD7")),s("div",{className:"tvs-modal-body"},_&&s("div",{className:"tvs-modal-loading"},"Loading details..."),e&&s("div",{className:"tvs-exercise-header"},s("div",{className:"tvs-exercise-media"},s("img",{className:"tvs-exercise-image",src:e.animation_url||e.thumbnail||`https://placehold.co/200x150/1a1a1a/666?text=${encodeURIComponent(e.name||"Exercise")}`,alt:e.name||"Exercise",onError:l=>{l.target.src=`https://placehold.co/200x150/1a1a1a/666?text=${encodeURIComponent(e.name||"Exercise")}`}})),e.description&&s("div",{className:"tvs-exercise-description"},s("p",{className:"tvs-modal-text"},e.description))),e&&s("div",{className:"tvs-modal-section"},s("h3",null,"Exercise Information"),s("div",{className:"tvs-modal-info-grid"},(e.category||e.categories&&e.categories.length>0)&&s("div",{className:"tvs-modal-field"},s("span",{className:"tvs-modal-label"},"Category:"),s("span",{className:"tvs-modal-value tvs-exercise-category"},e.category||e.categories.join(", "))),(e.type||e.types&&e.types.length>0)&&s("div",{className:"tvs-modal-field"},s("span",{className:"tvs-modal-label"},"Type:"),s("span",{className:"tvs-modal-value"},e.type||e.types.join(", "))),e.equipment&&Array.isArray(e.equipment)&&e.equipment.length>0&&s("div",{className:"tvs-modal-field"},s("span",{className:"tvs-modal-label"},"Equipment Required:"),s("span",{className:"tvs-modal-value"},e.equipment.map(l=>l.charAt(0).toUpperCase()+l.slice(1).replace("_"," ")).join(", "))),e.muscle_groups&&Array.isArray(e.muscle_groups)&&e.muscle_groups.length>0&&s("div",{className:"tvs-modal-field"},s("span",{className:"tvs-modal-label"},"Muscle Groups:"),s("span",{className:"tvs-modal-value"},e.muscle_groups.map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(", "))),e.difficulty&&s("div",{className:"tvs-modal-field"},s("span",{className:"tvs-modal-label"},"Difficulty:"),s("span",{className:"tvs-modal-value tvs-difficulty-"+e.difficulty},e.difficulty.charAt(0).toUpperCase()+e.difficulty.slice(1))),e.default_metric&&s("div",{className:"tvs-modal-field"},s("span",{className:"tvs-modal-label"},"Default Metric:"),s("span",{className:"tvs-modal-value"},e.default_metric.charAt(0).toUpperCase()+e.default_metric.slice(1))))),(a.sets||a.reps||a.weight||a.duration)&&s("div",{className:"tvs-modal-section"},s("h3",null,"Performed"),s("div",{className:"tvs-modal-metrics"},a.sets&&s("div",{className:"tvs-modal-metric"},s("span",{className:"tvs-modal-metric-value"},a.sets),s("span",{className:"tvs-modal-metric-label"},"Sets")),a.reps&&s("div",{className:"tvs-modal-metric"},s("span",{className:"tvs-modal-metric-value"},a.reps),s("span",{className:"tvs-modal-metric-label"},"Reps")),a.weight!==void 0&&a.weight!==null&&s("div",{className:"tvs-modal-metric"},s("span",{className:"tvs-modal-metric-value"},a.weight===0?"Bodyweight":`${a.weight} kg`),s("span",{className:"tvs-modal-metric-label"},"Weight")),a.duration&&s("div",{className:"tvs-modal-metric"},s("span",{className:"tvs-modal-metric-value"},`${a.duration}s`),s("span",{className:"tvs-modal-metric-label"},"Duration")))),a.description&&s("div",{className:"tvs-modal-section"},s("h3",null,"Exercise Notes"),s("p",{className:"tvs-modal-text"},a.description)),a.notes&&s("div",{className:"tvs-modal-section"},s("h3",null,"Your Notes"),s("p",{className:"tvs-modal-notes"},a.notes)))))}function E({label:a,value:o,unit:e,icon:p}){return s("div",{className:"tvs-metric-card"},s("div",{className:"tvs-metric-card__header"},p&&s("span",{className:"tvs-metric-card__icon"},p),s("span",{className:"tvs-metric-card__label"},a)),s("div",{className:"tvs-metric-card__value"},o,e&&s("span",{className:"tvs-metric-card__unit"},` ${e}`)))}function Q({activityId:a,showComparison:o,showActions:e,showNotes:p,isAuthor:_,fallbackMeta:v}){let[d,N]=u(null),[l,n]=u(!0),[C,R]=u(null),[j,$]=u(null),[m,x]=u(null),[F,A]=u(!1);S(()=>{v&&Object.keys(v).length>0?(N({id:a,meta:v}),n(!1)):B()},[a,v]),S(()=>{if(d&&d.meta){let t=d.meta,c=parseInt(t.route_id||t._route_id||0)||0;c>0&&!m&&!F&&(A(!0),fetch(`${window.TVS_SETTINGS.restRoot}tvs/v1/routes/${c}`).then(i=>i.ok?i.json():null).then(i=>{i&&i.id&&x(i),A(!1)}).catch(()=>A(!1)))}},[d,m,F]);let B=async()=>{n(!0),R(null);try{let t=/^\d+$/.test(a),c;t?c=`${window.TVS_SETTINGS.restRoot}wp/v2/tvs_activity/${a}?context=edit&_embed`:c=`${window.TVS_SETTINGS.restRoot}wp/v2/tvs_activity?slug=${a}&context=edit&_embed`;let i=await fetch(c,{headers:{"X-WP-Nonce":window.TVS_SETTINGS.nonce}});if(!i.ok)throw new Error("Failed to fetch activity");let f=await i.json(),w=t?f:Array.isArray(f)&&f.length>0?f[0]:null;if(!w)throw new Error("Activity not found");console.log("=== DEBUG: Full activity data ==="),console.log("Activity ID:",w.id),console.log("Activity meta:",w.meta),console.log("All activity keys:",Object.keys(w)),N(w)}catch(t){console.error("Error fetching activity:",t),R(t.message)}finally{n(!1)}};if(l)return s("div",{className:"tvs-loading"},s("div",{className:"tvs-loading-spinner"}));if(C)return s("div",{className:"tvs-error"},s("p",null,`Error: ${C}`));if(!d)return s("div",{className:"tvs-empty"},s("p",null,"Activity not found."));let r=d.meta||{},b=parseFloat(r.distance_m||r._distance_m||0)||0,h=parseInt(r.duration_s||r._duration_s||0)||0,T=parseFloat(r.rating||r._rating||0)||0,I=r.notes||r._notes||"",L=r.activity_type||r._activity_type||"workout",H=parseInt(r.route_id||r._route_id||0)||0,k=r.source||r._source||"manual",g=r.exercises||[],y=r.circuits||[],X=(b/1e3).toFixed(2),M=Math.floor(h/3600),V=Math.floor(h%3600/60),G=h%60,U=M>0?`${M}:${String(V).padStart(2,"0")}:${String(G).padStart(2,"0")}`:`${V}:${String(G).padStart(2,"0")}`,q=b>0?(h/(b/1e3)/60).toFixed(2):0,O=h>0?(b/1e3/(h/3600)).toFixed(2):0,D=d.date?new Date(d.date):null,J=D?D.toLocaleDateString("no-NO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",K={manual:"Manual Tracker",virtual:"Virtual Route",video:"Video Mode"},P={run:{label:"Run",emoji:"\u{1F3C3}"},ride:{label:"Ride",emoji:"\u{1F6B4}"},walk:{label:"Walk",emoji:"\u{1F6B6}"},hike:{label:"Hike",emoji:"\u26F0\uFE0F"},swim:{label:"Swim",emoji:"\u{1F3CA}"},workout:{label:"Workout",emoji:"\u{1F4AA}"}}[L.toLowerCase()]||{label:L,emoji:"\u{1F3C3}"};return s("div",{className:"tvs-single-activity-details"},s("div",{className:"tvs-activity-header"},s("div",{className:"tvs-activity-title-wrapper"},s("h1",{className:"tvs-activity-title"},P.emoji+" "+P.label),s("div",{className:"tvs-activity-badges"},s("span",{className:"tvs-source-badge"},K[k]||k),D&&s("time",{className:"tvs-activity-date",dateTime:d.date},J)))),m&&(k==="virtual"||k==="video")&&s("div",{className:"tvs-route-header"},m.image&&s("div",{className:"tvs-route-thumbnail"},s("img",{src:m.image,alt:m.title||"Route",onError:t=>t.target.style.display="none"})),s("div",{className:"tvs-route-info"},s("h2",{className:"tvs-route-name"},m.title||"Route"),s("div",{className:"tvs-route-insights"},m.meta&&m.meta.distance_m&&s("div",{className:"tvs-route-insight"},s("span",{className:"tvs-insight-icon"},"\u{1F4CF}"),s("span",{className:"tvs-insight-value"},`${(m.meta.distance_m/1e3).toFixed(2)} km`)),m.meta&&m.meta.elevation_m&&s("div",{className:"tvs-route-insight"},s("span",{className:"tvs-insight-icon"},"\u26F0\uFE0F"),s("span",{className:"tvs-insight-value"},`${m.meta.elevation_m}m elevation`)),m.surface&&s("div",{className:"tvs-route-insight"},s("span",{className:"tvs-insight-icon"},"\u{1F6E4}\uFE0F"),s("span",{className:"tvs-insight-value"},m.surface))),s("a",{href:`?p=${H}&post_type=tvs_route`,className:"tvs-route-link-btn"},"View Full Route Details \u2192"))),s("div",{className:"tvs-metrics-grid"},s(E,{label:"Distance",value:X,unit:"km",icon:"\u{1F4CF}"}),s(E,{label:"Duration",value:U,icon:"\u23F1\uFE0F"}),q>0&&s(E,{label:"Avg Pace",value:q,unit:"min/km",icon:"\u{1F3C3}"}),O>0&&s(E,{label:"Avg Speed",value:O,unit:"km/h",icon:"\u26A1"})),(g.length>0||y.length>0)&&s("div",{className:"tvs-workout-section"},s("div",{className:"tvs-workout-header"},s("h3",null,"Workout Details"),s("div",{className:"tvs-workout-summary"},y.length>0&&s("span",{className:"tvs-summary-badge"},`${y.length} ${y.length===1?"Circuit":"Circuits"}`),g.length>0&&s("span",{className:"tvs-summary-badge"},`${g.length} ${g.length===1?"Exercise":"Exercises"}`),s("span",{className:"tvs-summary-badge tvs-summary-badge--primary"},U))),y.length>0?s("div",{className:"tvs-circuits-list"},y.map((t,c)=>s("div",{key:c,className:"tvs-circuit-card"},s("div",{className:"tvs-circuit-header"},s("span",{className:"tvs-circuit-name"},t.name||`Circuit ${c+1}`),t.rounds&&s("span",{className:"tvs-circuit-rounds"},`${t.rounds} rounds`)),t.exercises&&t.exercises.length>0&&s("div",{className:"tvs-circuit-exercises"},t.exercises.map((i,f)=>{let w=i.exercise_id||i.id;return s("div",{key:f,className:"tvs-exercise-item"},s("div",{className:"tvs-exercise-item-header"},s("button",{className:"tvs-exercise-link",onClick:()=>$(i)},i.name||"Unknown Exercise"),i.category&&s("span",{className:"tvs-exercise-category"},i.category)),(i.sets||i.reps||i.weight||i.duration)&&s("div",{className:"tvs-exercise-metrics"},i.sets>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},i.sets),s("span",{className:"tvs-metric-label"}," sets")),i.reps>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},i.reps),s("span",{className:"tvs-metric-label"}," reps")),i.weight>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},i.weight),s("span",{className:"tvs-metric-label"}," kg")),i.duration>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},i.duration),s("span",{className:"tvs-metric-label"},"s"))))}))))):g.length>0&&s("div",{className:"tvs-exercises-standalone"},g.map((t,c)=>{let i=t.exercise_id||t.id;return s("div",{key:c,className:"tvs-exercise-item"},s("div",{className:"tvs-exercise-item-header"},s("button",{className:"tvs-exercise-link",onClick:()=>$(t)},t.name||"Unknown Exercise"),t.category&&s("span",{className:"tvs-exercise-category"},t.category)),(t.sets||t.reps||t.weight||t.duration)&&s("div",{className:"tvs-exercise-metrics"},t.sets>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},t.sets),s("span",{className:"tvs-metric-label"}," sets")),t.reps>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},t.reps),s("span",{className:"tvs-metric-label"}," reps")),t.weight>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},t.weight),s("span",{className:"tvs-metric-label"}," kg")),t.duration>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},t.duration),s("span",{className:"tvs-metric-label"},"s"))))}))),T>0&&s("div",{className:"tvs-rating-section"},s("h3",null,"Rating"),s("div",{className:"tvs-stars"},Array.from({length:10}).map((t,c)=>s("span",{key:c,className:`tvs-star ${c<T?"tvs-star--filled":""}`},"\u2B50")),s("span",{className:"tvs-rating-value"},` ${T}/10`))),p&&I&&s("div",{className:"tvs-notes-section"},s("h3",null,"Notes"),s("p",{className:"tvs-notes-content"},I)),e&&_&&s("div",{className:"tvs-action-buttons"},s("button",{className:"tvs-btn tvs-btn--secondary",onClick:()=>window.location.href=`/wp-admin/post.php?post=${a}&action=edit`},"Edit Activity"),s("button",{className:"tvs-btn tvs-btn--danger",onClick:()=>{confirm("Are you sure you want to delete this activity?")&&Y(a)}},"Delete Activity")),j&&s(z,{exercise:j,onClose:()=>$(null)}));async function Y(t){try{if(!(await fetch(`${window.TVS_SETTINGS.restRoot}wp/v2/tvs_activity/${t}`,{method:"DELETE",headers:{"X-WP-Nonce":window.TVS_SETTINGS.nonce,"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete activity");window.tvs_flash&&window.tvs_flash.show("Activity deleted successfully","success"),setTimeout(()=>{window.location.href="/tvs_activity/"},1500)}catch(c){console.error("Error deleting activity:",c),window.tvs_flash&&window.tvs_flash.show("Failed to delete activity","error")}}}function W(){document.querySelectorAll(".tvs-single-activity-details-block").forEach(o=>{let e=parseInt(o.dataset.activityId)||0,p=o.dataset.showComparison==="1",_=o.dataset.showActions==="1",v=o.dataset.showNotes==="1",d=o.dataset.isAuthor==="1",N=null;if(o.dataset.meta)try{N=JSON.parse(o.dataset.meta)}catch(n){console.error("Failed to parse fallback meta:",n)}window.ReactDOM.createRoot(o).render(s(Q,{activityId:e,showComparison:p,showActions:_,showNotes:v,isAuthor:d,fallbackMeta:N}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",W):W();})();
//# sourceMappingURL=tvs-block-single-activity-details.js.map
