(()=>{var{createElement:s,useState:p,useEffect:S}=window.React;function X({exercise:t,onClose:c}){if(!t)return null;let[e,v]=p(null),[w,m]=p(!1),[d,u]=p(!1);return S(()=>{let l=n=>{n.key==="Escape"&&c()};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[c]),S(()=>{let l=t.exercise_id||t.id;l&&Number.isInteger(Number(l))&&!d&&(u(!0),m(!0),fetch(`${window.TVS_SETTINGS.restRoot}tvs/v1/exercises/${l}`).then(n=>n.ok?n.json():(m(!1),null)).then(n=>{n&&n.success&&n.exercise&&(console.log("Exercise API response:",n.exercise),v(n.exercise)),m(!1)}).catch(()=>m(!1)))},[t,d]),s("div",{className:"tvs-modal-overlay",onClick:c},s("div",{className:"tvs-modal-content",onClick:l=>l.stopPropagation()},s("div",{className:"tvs-modal-header"},s("h2",null,t.name||"Exercise Details"),s("button",{className:"tvs-modal-close",onClick:c,"aria-label":"Close"},"\xD7")),s("div",{className:"tvs-modal-body"},w&&s("div",{className:"tvs-modal-loading"},"Loading details..."),e&&s("div",{className:"tvs-exercise-header"},s("div",{className:"tvs-exercise-media"},s("img",{className:"tvs-exercise-image",src:e.animation_url||e.thumbnail||`https://placehold.co/200x150/1a1a1a/666?text=${encodeURIComponent(e.name||"Exercise")}`,alt:e.name||"Exercise",onError:l=>{l.target.src=`https://placehold.co/200x150/1a1a1a/666?text=${encodeURIComponent(e.name||"Exercise")}`}})),e.description&&s("div",{className:"tvs-exercise-description"},s("p",{className:"tvs-modal-text"},e.description))),e&&s("div",{className:"tvs-modal-section"},s("h3",null,"Exercise Information"),s("div",{className:"tvs-modal-info-grid"},(e.category||e.categories&&e.categories.length>0)&&s("div",{className:"tvs-modal-field"},s("span",{className:"tvs-modal-label"},"Category:"),s("span",{className:"tvs-modal-value tvs-exercise-category"},e.category||e.categories.join(", "))),(e.type||e.types&&e.types.length>0)&&s("div",{className:"tvs-modal-field"},s("span",{className:"tvs-modal-label"},"Type:"),s("span",{className:"tvs-modal-value"},e.type||e.types.join(", "))),e.equipment&&Array.isArray(e.equipment)&&e.equipment.length>0&&s("div",{className:"tvs-modal-field"},s("span",{className:"tvs-modal-label"},"Equipment Required:"),s("span",{className:"tvs-modal-value"},e.equipment.map(l=>l.charAt(0).toUpperCase()+l.slice(1).replace("_"," ")).join(", "))),e.muscle_groups&&Array.isArray(e.muscle_groups)&&e.muscle_groups.length>0&&s("div",{className:"tvs-modal-field"},s("span",{className:"tvs-modal-label"},"Muscle Groups:"),s("span",{className:"tvs-modal-value"},e.muscle_groups.map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(", "))),e.difficulty&&s("div",{className:"tvs-modal-field"},s("span",{className:"tvs-modal-label"},"Difficulty:"),s("span",{className:"tvs-modal-value tvs-difficulty-"+e.difficulty},e.difficulty.charAt(0).toUpperCase()+e.difficulty.slice(1))),e.default_metric&&s("div",{className:"tvs-modal-field"},s("span",{className:"tvs-modal-label"},"Default Metric:"),s("span",{className:"tvs-modal-value"},e.default_metric.charAt(0).toUpperCase()+e.default_metric.slice(1))))),(t.sets||t.reps||t.weight||t.duration)&&s("div",{className:"tvs-modal-section"},s("h3",null,"Performed"),s("div",{className:"tvs-modal-metrics"},t.sets&&s("div",{className:"tvs-modal-metric"},s("span",{className:"tvs-modal-metric-value"},t.sets),s("span",{className:"tvs-modal-metric-label"},"Sets")),t.reps&&s("div",{className:"tvs-modal-metric"},s("span",{className:"tvs-modal-metric-value"},t.reps),s("span",{className:"tvs-modal-metric-label"},"Reps")),t.weight!==void 0&&t.weight!==null&&s("div",{className:"tvs-modal-metric"},s("span",{className:"tvs-modal-metric-value"},t.weight===0?"Bodyweight":`${t.weight} kg`),s("span",{className:"tvs-modal-metric-label"},"Weight")),t.duration&&s("div",{className:"tvs-modal-metric"},s("span",{className:"tvs-modal-metric-value"},`${t.duration}s`),s("span",{className:"tvs-modal-metric-label"},"Duration")))),t.description&&s("div",{className:"tvs-modal-section"},s("h3",null,"Exercise Notes"),s("p",{className:"tvs-modal-text"},t.description)),t.notes&&s("div",{className:"tvs-modal-section"},s("h3",null,"Your Notes"),s("p",{className:"tvs-modal-notes"},t.notes)))))}function b({label:t,value:c,unit:e,icon:v}){return s("div",{className:"tvs-metric-card"},s("div",{className:"tvs-metric-card__header"},v&&s("span",{className:"tvs-metric-card__icon"},v),s("span",{className:"tvs-metric-card__label"},t)),s("div",{className:"tvs-metric-card__value"},c,e&&s("span",{className:"tvs-metric-card__unit"},` ${e}`)))}function H({activityId:t,showComparison:c,showActions:e,showNotes:v,isAuthor:w,fallbackMeta:m}){let[d,u]=p(null),[l,n]=p(!0),[$,T]=p(null),[C,E]=p(null);S(()=>{m&&Object.keys(m).length>0?(u({id:t,meta:m}),n(!1)):q()},[t,m]);let q=async()=>{n(!0),T(null);try{let a=/^\d+$/.test(t),r;a?r=`${window.TVS_SETTINGS.restRoot}wp/v2/tvs_activity/${t}?context=edit&_embed`:r=`${window.TVS_SETTINGS.restRoot}wp/v2/tvs_activity?slug=${t}&context=edit&_embed`;let i=await fetch(r,{headers:{"X-WP-Nonce":window.TVS_SETTINGS.nonce}});if(!i.ok)throw new Error("Failed to fetch activity");let y=await i.json(),f=a?y:Array.isArray(y)&&y.length>0?y[0]:null;if(!f)throw new Error("Activity not found");console.log("=== DEBUG: Full activity data ==="),console.log("Activity ID:",f.id),console.log("Activity meta:",f.meta),console.log("All activity keys:",Object.keys(f)),u(f)}catch(a){console.error("Error fetching activity:",a),T(a.message)}finally{n(!1)}};if(l)return s("div",{className:"tvs-loading"},s("div",{className:"tvs-loading-spinner"}));if($)return s("div",{className:"tvs-error"},s("p",null,`Error: ${$}`));if(!d)return s("div",{className:"tvs-empty"},s("p",null,"Activity not found."));let o=d.meta||{},_=parseFloat(o.distance_m||o._distance_m||0)||0,N=parseInt(o.duration_s||o._duration_s||0)||0,k=parseFloat(o.rating||o._rating||0)||0,D=o.notes||o._notes||"",O=o.activity_type||o._activity_type||"workout",F=parseInt(o.route_id||o._route_id||0)||0,R=o.source||o._source||"manual",h=o.exercises||[],g=o.circuits||[],P=(_/1e3).toFixed(2),I=Math.floor(N/3600),L=Math.floor(N%3600/60),M=N%60,j=I>0?`${I}:${String(L).padStart(2,"0")}:${String(M).padStart(2,"0")}`:`${L}:${String(M).padStart(2,"0")}`,U=_>0?(N/(_/1e3)/60).toFixed(2):0,V=N>0?(_/1e3/(N/3600)).toFixed(2):0,A=d.date?new Date(d.date):null,W=A?A.toLocaleDateString("no-NO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",x={manual:"Manual Tracker",virtual:"Virtual Training",video:"Video Mode"};return s("div",{className:"tvs-single-activity-details"},s("div",{className:"tvs-activity-header"},s("div",{className:"tvs-activity-type-badge"},s("span",{className:"tvs-type-label"},O),s("span",{className:"tvs-source-label"},x[R]||R)),A&&s("time",{className:"tvs-activity-date",dateTime:d.date},W)),s("div",{className:"tvs-metrics-grid"},s(b,{label:"Distance",value:P,unit:"km",icon:"\u{1F4CF}"}),s(b,{label:"Duration",value:j,icon:"\u23F1\uFE0F"}),U>0&&s(b,{label:"Avg Pace",value:U,unit:"min/km",icon:"\u{1F3C3}"}),V>0&&s(b,{label:"Avg Speed",value:V,unit:"km/h",icon:"\u26A1"})),(h.length>0||g.length>0)&&s("div",{className:"tvs-workout-section"},s("div",{className:"tvs-workout-header"},s("h3",null,"Workout Details"),s("div",{className:"tvs-workout-summary"},g.length>0&&s("span",{className:"tvs-summary-badge"},`${g.length} ${g.length===1?"Circuit":"Circuits"}`),h.length>0&&s("span",{className:"tvs-summary-badge"},`${h.length} ${h.length===1?"Exercise":"Exercises"}`),s("span",{className:"tvs-summary-badge tvs-summary-badge--primary"},j))),g.length>0?s("div",{className:"tvs-circuits-list"},g.map((a,r)=>s("div",{key:r,className:"tvs-circuit-card"},s("div",{className:"tvs-circuit-header"},s("span",{className:"tvs-circuit-name"},a.name||`Circuit ${r+1}`),a.rounds&&s("span",{className:"tvs-circuit-rounds"},`${a.rounds} rounds`)),a.exercises&&a.exercises.length>0&&s("div",{className:"tvs-circuit-exercises"},a.exercises.map((i,y)=>{let f=i.exercise_id||i.id;return s("div",{key:y,className:"tvs-exercise-item"},s("div",{className:"tvs-exercise-item-header"},s("button",{className:"tvs-exercise-link",onClick:()=>E(i)},i.name||"Unknown Exercise"),i.category&&s("span",{className:"tvs-exercise-category"},i.category)),(i.sets||i.reps||i.weight||i.duration)&&s("div",{className:"tvs-exercise-metrics"},i.sets>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},i.sets),s("span",{className:"tvs-metric-label"}," sets")),i.reps>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},i.reps),s("span",{className:"tvs-metric-label"}," reps")),i.weight>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},i.weight),s("span",{className:"tvs-metric-label"}," kg")),i.duration>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},i.duration),s("span",{className:"tvs-metric-label"},"s"))))}))))):h.length>0&&s("div",{className:"tvs-exercises-standalone"},h.map((a,r)=>{let i=a.exercise_id||a.id;return s("div",{key:r,className:"tvs-exercise-item"},s("div",{className:"tvs-exercise-item-header"},s("button",{className:"tvs-exercise-link",onClick:()=>E(a)},a.name||"Unknown Exercise"),a.category&&s("span",{className:"tvs-exercise-category"},a.category)),(a.sets||a.reps||a.weight||a.duration)&&s("div",{className:"tvs-exercise-metrics"},a.sets>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},a.sets),s("span",{className:"tvs-metric-label"}," sets")),a.reps>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},a.reps),s("span",{className:"tvs-metric-label"}," reps")),a.weight>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},a.weight),s("span",{className:"tvs-metric-label"}," kg")),a.duration>0&&s("span",{className:"tvs-metric"},s("span",{className:"tvs-metric-value"},a.duration),s("span",{className:"tvs-metric-label"},"s"))))}))),k>0&&s("div",{className:"tvs-rating-section"},s("h3",null,"Rating"),s("div",{className:"tvs-stars"},Array.from({length:10}).map((a,r)=>s("span",{key:r,className:`tvs-star ${r<k?"tvs-star--filled":""}`},"\u2B50")),s("span",{className:"tvs-rating-value"},` ${k}/10`))),v&&D&&s("div",{className:"tvs-notes-section"},s("h3",null,"Notes"),s("p",{className:"tvs-notes-content"},D)),F>0&&s("div",{className:"tvs-route-section"},s("h3",null,"Route"),s("a",{href:`?p=${F}&post_type=tvs_route`,className:"tvs-route-link"},"View Route Details \u2192")),e&&w&&s("div",{className:"tvs-action-buttons"},s("button",{className:"tvs-btn tvs-btn--secondary",onClick:()=>window.location.href=`/wp-admin/post.php?post=${t}&action=edit`},"Edit Activity"),s("button",{className:"tvs-btn tvs-btn--danger",onClick:()=>{confirm("Are you sure you want to delete this activity?")&&B(t)}},"Delete Activity")),C&&s(X,{exercise:C,onClose:()=>E(null)}));async function B(a){try{if(!(await fetch(`${window.TVS_SETTINGS.restRoot}wp/v2/tvs_activity/${a}`,{method:"DELETE",headers:{"X-WP-Nonce":window.TVS_SETTINGS.nonce,"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete activity");window.tvs_flash&&window.tvs_flash.show("Activity deleted successfully","success"),setTimeout(()=>{window.location.href="/tvs_activity/"},1500)}catch(r){console.error("Error deleting activity:",r),window.tvs_flash&&window.tvs_flash.show("Failed to delete activity","error")}}}function G(){document.querySelectorAll(".tvs-single-activity-details-block").forEach(c=>{let e=parseInt(c.dataset.activityId)||0,v=c.dataset.showComparison==="1",w=c.dataset.showActions==="1",m=c.dataset.showNotes==="1",d=c.dataset.isAuthor==="1",u=null;if(c.dataset.meta)try{u=JSON.parse(c.dataset.meta)}catch(n){console.error("Failed to parse fallback meta:",n)}window.ReactDOM.createRoot(c).render(s(H,{activityId:e,showComparison:v,showActions:w,showNotes:m,isAuthor:d,fallbackMeta:u}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",G):G();})();
//# sourceMappingURL=tvs-block-single-activity-details.js.map
