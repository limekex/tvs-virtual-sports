{
  "version": 3,
  "sources": ["../../src/utils/debug.js", "../../src/utils/reactMount.js", "../../src/blocks/personal-records/view.js"],
  "sourcesContent": ["// Debug utilities for TVS app\nexport const DEBUG =\n  new URLSearchParams(location.search).get(\"tvsdebug\") === \"1\" ||\n  window.TVS_DEBUG === true ||\n  localStorage.getItem(\"tvsDev\") === \"1\";\n\nexport function log(...args) {\n  if (DEBUG) console.debug(\"[TVS]\", ...args);\n}\n\nexport function err(...args) {\n  console.error(\"[TVS]\", ...args);\n}\n", "// React mount helper paired to the active renderer\nimport { log, err } from './debug.js';\n\nconst hasWindowReact = !!(window.React && window.ReactDOM);\nconst hasWpElement = !!(window.wp && window.wp.element);\nconst wpEl = hasWpElement ? window.wp.element : {};\nconst React = hasWindowReact ? window.React : (wpEl || {});\nconst ReactDOM = hasWindowReact ? window.ReactDOM : (wpEl || null);\n\n// Track mounted roots to safely unmount/re-mount\nconst tvsRoots = new WeakMap();\nconst hasCreateRoot =\n  (ReactDOM && typeof ReactDOM.createRoot === 'function') ||\n  (wpEl && typeof wpEl.createRoot === 'function');\n\nexport function mountReact(Component, props, node) {\n  try {\n    // Unmount existing root if present\n    const existingRoot = tvsRoots.get(node);\n    if (existingRoot && typeof existingRoot.unmount === 'function') {\n      existingRoot.unmount();\n      tvsRoots.delete(node);\n    }\n\n    // Use createRoot API (React 18+)\n    if (hasCreateRoot) {\n      const createRoot = (ReactDOM && ReactDOM.createRoot) || (wpEl && wpEl.createRoot);\n      const root = createRoot(node);\n      tvsRoots.set(node, root);\n      root.render(React.createElement(Component, props));\n      return;\n    }\n\n    // Fallback to legacy API (React <18) - unmount first if needed\n    if (ReactDOM && typeof ReactDOM.unmountComponentAtNode === 'function') {\n      ReactDOM.unmountComponentAtNode(node);\n    }\n\n    const legacyRender = (ReactDOM && ReactDOM.render) || (wpEl && wpEl.render);\n    if (legacyRender) {\n      legacyRender(React.createElement(Component, props), node);\n      return;\n    }\n    err('Ingen render-funksjon tilgjengelig.');\n  } catch (e) {\n    err('Mount feilet:', e);\n  }\n}\n\nexport { React, ReactDOM, wpEl };\n", "import { mountReact, React } from '../../utils/reactMount.js';\n\nfunction fmtDuration(seconds){\n  const s = Math.max(0, Math.floor(seconds||0));\n  const m = Math.floor(s/60); const r = s%60;\n  return `${m}:${String(r).padStart(2,'0')}`;\n}\n\nfunction PersonalRecords({ React, title, showBestTime, showAvgPace, showAvgTempo, showMostRecent, routeId }){\n  const { createElement: h, useEffect, useState } = React;\n  const [data, setData] = useState(null);\n  const [err, setErr] = useState(null);\n  const isLoggedIn = !!(window.TVS_SETTINGS?.user);\n\n  useEffect(() => {\n    if (!isLoggedIn) {\n      setData(null);\n      return;\n    }\n    let cancelled = false;\n    async function load(){\n      try{\n        const root = (window.TVS_SETTINGS && TVS_SETTINGS.restRoot) || '/wp-json/';\n        const qs = new URLSearchParams();\n        if(routeId) qs.set('route_id', String(routeId));\n        const url = `${root.replace(/\\/$/,'')}/tvs/v1/activities/stats?${qs.toString()}`;\n        const res = await fetch(url, { headers: { 'X-WP-Nonce': (window.TVS_SETTINGS && TVS_SETTINGS.nonce) || '' } });\n        if(!res.ok) throw new Error('HTTP '+res.status);\n        const json = await res.json();\n        if(!cancelled) setData(json);\n      }catch(e){ if(!cancelled) setErr(e.message||'Failed'); }\n    }\n    load();\n    return () => { cancelled = true; };\n  }, [routeId, isLoggedIn]);\n\n  if (!isLoggedIn) {\n    const demoItems = [];\n    if (showBestTime) demoItems.push('Best time: 8:45');\n    if (showAvgPace) demoItems.push('Average pace: 5:30/km');\n    if (showAvgTempo) demoItems.push('Average speed: 10.9 km/h');\n    if (showMostRecent) demoItems.push('Most recent: 10:12');\n\n    return h('div', { className: 'tvs-panel' },\n      h('h3', { className: 'tvs-activities-title' }, title || 'Personal Records'),\n      h('ul', { className: 'tvs-list', style: { opacity: 0.5 } }, \n        demoItems.map((it, i) => h('li', { key: i }, it))\n      ),\n      h('div', { className: 'tvs-activities-footer' },\n        h('div', { className: 'tvs-text-muted', style: { marginBottom: '0.5rem' } }, 'Sign in to see your personal records.'),\n        h('div', null,\n          h('a', { href: '/login', className: 'tvs-link', style: { marginRight: 12 } }, 'Log in'),\n          h('a', { href: '/register', className: 'tvs-link' }, 'Register')\n        )\n      )\n    );\n  }\n\n  const items = [];\n  if(showBestTime){\n    const t = data && data.best && data.best.duration_s ? fmtDuration(data.best.duration_s) : '\u2014';\n    const link = data && data.best && data.best.permalink;\n    items.push(h('span', null, 'Best time: ', link ? h('a', { href: link }, t) : t));\n  }\n  if(showAvgPace){\n    const p = data && data.avg && data.avg.pace_text ? data.avg.pace_text : '\u2014';\n    items.push('Average pace: ' + p);\n  }\n  if(showAvgTempo){\n    const s = data && data.avg && data.avg.speed_kmh ? `${data.avg.speed_kmh} km/h` : '\u2014';\n    items.push('Average speed: ' + s);\n  }\n  if(showMostRecent){\n    const r = data && data.recent;\n    const label = r && r.duration_s ? fmtDuration(r.duration_s) : '\u2014';\n    items.push(h('span', null, 'Most recent: ', r && r.permalink ? h('a', { href:r.permalink }, label) : label));\n  }\n\n  return h('div', { className: 'tvs-panel' },\n    h('h3', { className: 'tvs-activities-title' }, title || 'Personal Records'),\n    (!data && !err) ? h('div', { className: 'tvs-text-muted' }, 'Loading\u2026') : null,\n    err ? h('div', { className: 'tvs-text-danger' }, String(err)) : null,\n    h('ul', { className: 'tvs-list' }, items.map((it,i) => h('li', { key:i }, it)))\n  );\n}\n\nfunction mountAll(){\n  const nodes = document.querySelectorAll('.tvs-personal-records-block');\n  nodes.forEach((node, idx) => {\n    if(node.__tvsMounted) return;\n    const title = node.getAttribute('data-title') || '';\n    const showBestTime = node.getAttribute('data-show-best') === '1';\n    const showAvgPace = node.getAttribute('data-show-avg-pace') === '1';\n    const showAvgTempo = node.getAttribute('data-show-avg-tempo') === '1';\n    const showMostRecent = node.getAttribute('data-show-recent') === '1';\n    const routeId = parseInt(node.getAttribute('data-route-id')||'0',10) || 0;\n    mountReact(PersonalRecords, { React, title, showBestTime, showAvgPace, showAvgTempo, showMostRecent, routeId }, node);\n    node.__tvsMounted = true;\n  });\n}\n\nif(document.readyState === 'loading'){\n  document.addEventListener('DOMContentLoaded', mountAll);\n}else{ mountAll(); }\n"],
  "mappings": "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",
  "names": ["DEBUG", "err", "args", "hasWindowReact", "hasWpElement", "wpEl", "React", "ReactDOM", "tvsRoots", "hasCreateRoot", "mountReact", "Component", "props", "node", "existingRoot", "root", "legacyRender", "err", "e", "fmtDuration", "seconds", "m", "r", "PersonalRecords", "React", "title", "showBestTime", "showAvgPace", "showAvgTempo", "showMostRecent", "routeId", "h", "useEffect", "useState", "data", "setData", "err", "setErr", "isLoggedIn", "cancelled", "load", "root", "qs", "url", "res", "json", "e", "demoItems", "it", "i", "items", "link", "p", "s", "label", "mountAll", "node", "idx", "mountReact"]
}
