(()=>{var L=new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1";function R(...c){console.error("[TVS]",...c)}var y=!!(window.React&&window.ReactDOM),I=!!(window.wp&&window.wp.element),u=I?window.wp.element:{},g=y?window.React:u||{},i=y?window.ReactDOM:u||null,N=new WeakMap,V=i&&typeof i.createRoot=="function"||u&&typeof u.createRoot=="function";function E(c,s,o){try{let a=N.get(o);if(a&&typeof a.unmount=="function"&&(a.unmount(),N.delete(o)),V){let l=(i&&i.createRoot||u&&u.createRoot)(o);N.set(o,l),l.render(g.createElement(c,s));return}i&&typeof i.unmountComponentAtNode=="function"&&i.unmountComponentAtNode(o);let d=i&&i.render||u&&u.render;if(d){d(g.createElement(c,s),o);return}R("Ingen render-funksjon tilgjengelig.")}catch(a){R("Mount feilet:",a)}}function b(c){let s=Math.max(0,Math.floor(c||0)),o=Math.floor(s/60),a=s%60;return`${o}:${String(a).padStart(2,"0")}`}function G({React:c,title:s,showBestTime:o,showAvgPace:a,showAvgTempo:d,showMostRecent:m,routeId:l}){let{createElement:e,useEffect:v,useState:T}=c,[n,_]=T(null),[h,x]=T(null),w=!!window.TVS_SETTINGS?.user;if(v(()=>{if(!w){_(null);return}let t=!1;async function r(){try{let p=window.TVS_SETTINGS&&TVS_SETTINGS.restRoot||"/wp-json/",k=new URLSearchParams;l&&k.set("route_id",String(l));let M=`${p.replace(/\/$/,"")}/tvs/v1/activities/stats?${k.toString()}`,S=await fetch(M,{headers:{"X-WP-Nonce":window.TVS_SETTINGS&&TVS_SETTINGS.nonce||""}});if(!S.ok)throw new Error("HTTP "+S.status);let D=await S.json();t||_(D)}catch(p){t||x(p.message||"Failed")}}return r(),()=>{t=!0}},[l,w]),!w){let t=[];return o&&t.push("Best time: 8:45"),a&&t.push("Average pace: 5:30/km"),d&&t.push("Average speed: 10.9 km/h"),m&&t.push("Most recent: 10:12"),e("div",{className:"tvs-panel"},e("h3",{className:"tvs-activities-title"},s||"Personal Records"),e("ul",{className:"tvs-list",style:{opacity:.5}},t.map((r,p)=>e("li",{key:p},r))),e("div",{className:"tvs-activities-footer"},e("div",{className:"tvs-text-muted",style:{marginBottom:"0.5rem"}},"Sign in to see your personal records."),e("div",null,e("a",{href:"/login",className:"tvs-link",style:{marginRight:12}},"Log in"),e("a",{href:"/register",className:"tvs-link"},"Register"))))}let f=[];if(o){let t=n&&n.best&&n.best.duration_s?b(n.best.duration_s):"\u2014",r=n&&n.best&&n.best.permalink;f.push(e("span",null,"Best time: ",r?e("a",{href:r},t):t))}if(a){let t=n&&n.avg&&n.avg.pace_text?n.avg.pace_text:"\u2014";f.push("Average pace: "+t)}if(d){let t=n&&n.avg&&n.avg.speed_kmh?`${n.avg.speed_kmh} km/h`:"\u2014";f.push("Average speed: "+t)}if(m){let t=n&&n.recent,r=t&&t.duration_s?b(t.duration_s):"\u2014";f.push(e("span",null,"Most recent: ",t&&t.permalink?e("a",{href:t.permalink},r):r))}return e("div",{className:"tvs-panel"},e("h3",{className:"tvs-activities-title"},s||"Personal Records"),!n&&!h?e("div",{className:"tvs-text-muted"},"Loading\u2026"):null,h?e("div",{className:"tvs-text-danger"},String(h)):null,e("ul",{className:"tvs-list"},f.map((t,r)=>e("li",{key:r},t))))}function A(){document.querySelectorAll(".tvs-personal-records-block").forEach((s,o)=>{if(s.__tvsMounted)return;let a=s.getAttribute("data-title")||"",d=s.getAttribute("data-show-best")==="1",m=s.getAttribute("data-show-avg-pace")==="1",l=s.getAttribute("data-show-avg-tempo")==="1",e=s.getAttribute("data-show-recent")==="1",v=parseInt(s.getAttribute("data-route-id")||"0",10)||0;E(G,{React:g,title:a,showBestTime:d,showAvgPace:m,showAvgTempo:l,showMostRecent:e,routeId:v},s),s.__tvsMounted=!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",A):A();})();
//# sourceMappingURL=tvs-block-personal-records.js.map
