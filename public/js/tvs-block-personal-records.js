(()=>{var G=new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1";function R(...r){console.error("[TVS]",...r)}var b=!!(window.React&&window.ReactDOM),D=!!(window.wp&&window.wp.element),u=D?window.wp.element:{},p=b?window.React:u||{},i=b?window.ReactDOM:u||null,S=new WeakMap,P=i&&typeof i.createRoot=="function"||u&&typeof u.createRoot=="function";function E(r,o,s){try{let a=S.get(s);if(a&&typeof a.unmount=="function"?(a.unmount(),S.delete(s)):i&&typeof i.unmountComponentAtNode=="function"&&i.unmountComponentAtNode(s),P){let l=(i&&i.createRoot||u&&u.createRoot)(s);S.set(s,l),l.render(p.createElement(r,o));return}let d=i&&i.render||u&&u.render;if(d){d(p.createElement(r,o),s);return}R("Ingen render-funksjon tilgjengelig.")}catch(a){R("Mount feilet:",a)}}function A(r){let o=Math.max(0,Math.floor(r||0)),s=Math.floor(o/60),a=o%60;return`${s}:${String(a).padStart(2,"0")}`}function V({React:r,title:o,showBestTime:s,showAvgPace:a,showAvgTempo:d,showMostRecent:f,routeId:l}){let{createElement:n,useEffect:w,useState:T}=r,[e,k]=T(null),[g,x]=T(null);w(()=>{let t=!1;async function c(){try{let h=window.TVS_SETTINGS&&TVS_SETTINGS.restRoot||"/wp-json/",_=new URLSearchParams;l&&_.set("route_id",String(l));let N=`${h.replace(/\/$/,"")}/tvs/v1/activities/stats?${_.toString()}`,v=await fetch(N,{headers:{"X-WP-Nonce":window.TVS_SETTINGS&&TVS_SETTINGS.nonce||""}});if(!v.ok)throw new Error("HTTP "+v.status);let y=await v.json();t||k(y)}catch(h){t||x(h.message||"Failed")}}return c(),()=>{t=!0}},[l]);let m=[];if(s){let t=e&&e.best&&e.best.duration_s?A(e.best.duration_s):"\u2014",c=e&&e.best&&e.best.permalink;m.push(n("span",null,"Best time: ",c?n("a",{href:c},t):t))}if(a){let t=e&&e.avg&&e.avg.pace_text?e.avg.pace_text:"\u2014";m.push("Average pace: "+t)}if(d){let t=e&&e.avg&&e.avg.speed_kmh?`${e.avg.speed_kmh} km/h`:"\u2014";m.push("Average speed: "+t)}if(f){let t=e&&e.recent,c=t&&t.duration_s?A(t.duration_s):"\u2014";m.push(n("span",null,"Most recent: ",t&&t.permalink?n("a",{href:t.permalink},c):c))}return n("div",{className:"tvs-panel"},n("h3",{className:"tvs-activities-title"},o||"Personal Records"),!e&&!g?n("div",{className:"tvs-text-muted"},"Loading\u2026"):null,g?n("div",{className:"tvs-text-danger"},String(g)):null,n("ul",{className:"tvs-list"},m.map((t,c)=>n("li",{key:c},t))))}function M(){document.querySelectorAll(".tvs-personal-records-block").forEach((o,s)=>{if(o.__tvsMounted)return;let a=o.getAttribute("data-title")||"",d=o.getAttribute("data-show-best")==="1",f=o.getAttribute("data-show-avg-pace")==="1",l=o.getAttribute("data-show-avg-tempo")==="1",n=o.getAttribute("data-show-recent")==="1",w=parseInt(o.getAttribute("data-route-id")||"0",10)||0;E(V,{React:p,title:a,showBestTime:d,showAvgPace:f,showAvgTempo:l,showMostRecent:n,routeId:w},o),o.__tvsMounted=!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",M):M();})();
//# sourceMappingURL=tvs-block-personal-records.js.map
