(()=>{var z=new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1";function X(...e){z&&console.debug("[TVS]",...e)}function Oe(...e){console.error("[TVS]",...e)}var lt=!!(window.React&&window.ReactDOM),At=!!(window.wp&&window.wp.element),ne=At?window.wp.element:{},y=lt?window.React:ne||{},U=lt?window.ReactDOM:ne||null,je=new WeakMap,Pt=U&&typeof U.createRoot=="function"||ne&&typeof ne.createRoot=="function";function ot(e,d,w){try{let g=je.get(w);if(g&&typeof g.unmount=="function"&&(g.unmount(),je.delete(w)),Pt){let f=(U&&U.createRoot||ne&&ne.createRoot)(w);je.set(w,f),f.render(y.createElement(e,d));return}U&&typeof U.unmountComponentAtNode=="function"&&U.unmountComponentAtNode(w);let M=U&&U.render||ne&&ne.render;if(M){M(y.createElement(e,d),w);return}Oe("Ingen render-funksjon tilgjengelig.")}catch(g){Oe("Mount feilet:",g)}}var{useState:ce,useEffect:Ce,useRef:ct}=y;function Lt(e,d){let[w,g]=ce(e);return Ce(()=>{let M=setTimeout(()=>{g(e)},d);return()=>{clearTimeout(M)}},[e,d]),w}function _t({value:e,onChange:d,onSelect:w,placeholder:g="Search exercises...",className:M=""}){let[N,f]=ce([]),[x,u]=ce(!1),[C,n]=ce(!1),[I,v]=ce(-1),[ae,k]=ce(""),[_,Ee]=ce({top:0,left:0,width:0}),A=ct(null),$=ct(null),W=Lt(e,300);Ce(()=>{if(C&&A.current){let a=A.current.getBoundingClientRect();Ee({top:a.bottom+window.scrollY,left:a.left+window.scrollX,width:a.width})}},[C]),Ce(()=>{if(!C)return;let a=()=>{if(A.current){let h=A.current.getBoundingClientRect();Ee({top:h.bottom+window.scrollY,left:h.left+window.scrollX,width:h.width})}};return window.addEventListener("scroll",a,!0),window.addEventListener("resize",a),()=>{window.removeEventListener("scroll",a,!0),window.removeEventListener("resize",a)}},[C]),Ce(()=>{(async()=>{if(W.length<2){f([]),n(!1),k("");return}u(!0),k("");try{let h=`${window.TVS_SETTINGS.restRoot}tvs/v1/exercises/search?q=${encodeURIComponent(W)}&limit=10`,l=await fetch(h,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS.nonce}});if(!l.ok)throw new Error(`Search failed: ${l.status}`);let G=await l.json();f(G.results||[]),n(!0),v(-1)}catch(h){console.error("Exercise search error:",h),k("Search failed. Try again."),f([]),n(!1)}finally{u(!1)}})()},[W]),Ce(()=>{let a=h=>{$.current&&!$.current.contains(h.target)&&A.current&&!A.current.contains(h.target)&&n(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]);let P=a=>{if(!(!C||N.length===0))switch(a.key){case"ArrowDown":a.preventDefault(),v(h=>h<N.length-1?h+1:h);break;case"ArrowUp":a.preventDefault(),v(h=>h>0?h-1:-1);break;case"Enter":a.preventDefault(),I>=0&&I<N.length&&J(N[I]);break;case"Escape":a.preventDefault(),n(!1),v(-1);break;default:break}},J=a=>{console.log("Exercise selected:",a),w({id:a.id,name:a.name,default_metric:a.default_metric||"reps"}),f([]),n(!1),v(-1)},Fe=a=>{switch(a){case"beginner":return"#10b981";case"intermediate":return"#f59e0b";case"advanced":return"#ef4444";default:return"#6b7280"}},Y=()=>!C||N.length===0?null:U.createPortal(y.createElement("div",{ref:$,className:"tvs-exercise-dropdown",style:{position:"absolute",top:`${_.top}px`,left:`${_.left}px`,width:`${_.width}px`,zIndex:999999}},N.map((a,h)=>y.createElement("div",{key:a.id,className:`tvs-exercise-result ${h===I?"tvs-exercise-result-selected":""}`,onClick:()=>J(a),onMouseEnter:()=>v(h)},y.createElement("div",null,y.createElement("div",null,y.createElement("div",null,a.name),y.createElement("div",null,a.category&&y.createElement("span",{className:"tvs-badge tvs-badge-category"},a.category),a.difficulty&&y.createElement("span",{className:"tvs-badge tvs-badge-difficulty",style:{background:Fe(a.difficulty)}},a.difficulty),a.default_metric&&y.createElement("span",{className:"tvs-badge-metric"},a.default_metric==="reps"?"\u{1F522} Reps":"\u23F1 Time")))))),N.length===0&&!x&&W.length>=2&&y.createElement("div",{style:{padding:"12px 16px",color:"var(--tvs-text-secondary)",fontSize:"14px"}},"No exercises found")),document.body);return y.createElement("div",{className:`tvs-exercise-search-container ${M}`},y.createElement("input",{ref:A,type:"text",placeholder:g,value:e,onChange:a=>d(a.target.value),onKeyDown:P,onFocus:()=>{N.length>0&&n(!0)},className:"tvs-exercise-input tvs-input-name",autoComplete:"off"}),x&&y.createElement("div",{className:"tvs-search-spinner"},"\u{1F50D}"),ae&&y.createElement("div",{className:"tvs-search-error"},ae),Y())}var mt=_t;var{useState:me}=window.React,o=window.React,Wt=({circuit:e,isActive:d,onUpdate:w,onRemove:g,onSetActive:M,canRemove:N=!0})=>{let[f,x]=me(""),[u,C]=me(null),[n,I]=me(10),[v,ae]=me(0),[k,_]=me("reps"),[Ee,A]=me(!1),[$,W]=me(e.name),P=()=>{if(!f.trim())return;let l={name:f.trim(),exercise_id:u,reps:n,weight:v,metric_type:k};w({...e,exercises:[...e.exercises,l]}),x(""),C(null),I(10),ae(0),_("reps")},J=l=>{w({...e,exercises:e.exercises.filter((G,Z)=>Z!==l)})},Fe=l=>{w({...e,sets:Math.max(1,parseInt(l)||1)})},Y=()=>{$.trim()&&w({...e,name:$.trim()}),A(!1)},h=(()=>{let l=e.exercises.reduce((Z,R)=>Z+(R.metric_type==="reps"?R.reps:0),0),G=e.exercises.reduce((Z,R)=>Z+R.reps*R.weight,0);return{totalReps:l*e.sets,totalVolume:G*e.sets}})();return o.createElement("div",{className:`tvs-circuit-container ${d?"tvs-circuit-active":""}`,onClick:()=>!d&&M(e.id)},o.createElement("div",{className:"tvs-circuit-header"},Ee?o.createElement("input",{type:"text",value:$,onChange:l=>W(l.target.value),onBlur:Y,onKeyDown:l=>{l.key==="Enter"&&Y(),l.key==="Escape"&&(W(e.name),A(!1))},className:"tvs-circuit-name-edit",autoFocus:!0}):o.createElement("div",{className:"tvs-circuit-name-wrapper",onClick:()=>{W(e.name),A(!0)},title:"Click to edit circuit name"},o.createElement("h4",{className:"tvs-circuit-name"},e.name),o.createElement("span",{className:"tvs-circuit-edit-icon"},"\u270E")),o.createElement("div",{className:"tvs-circuit-sets"},o.createElement("input",{type:"number",value:e.sets,min:"1",onChange:l=>Fe(l.target.value),className:"tvs-circuit-sets-input",title:"Number of rounds"}),o.createElement("span",null,e.sets===1?" round":" rounds")),N&&o.createElement("button",{className:"tvs-btn-icon tvs-circuit-remove",onClick:l=>{l.stopPropagation(),confirm(`Remove ${e.name}?`)&&g(e.id)},title:"Remove circuit"},"\u2715")),e.exercises.length>0&&o.createElement("div",{className:"tvs-circuit-exercises"},e.exercises.map((l,G)=>o.createElement("div",{key:G,className:"tvs-circuit-exercise-item"},o.createElement("span",{className:"tvs-exercise-number"},`${G+1}.`),o.createElement("span",{className:"tvs-exercise-name"},l.name),o.createElement("span",{className:"tvs-exercise-stats"},`${l.reps}${l.metric_type==="time"?"s":""}${l.weight>0?` @ ${l.weight}kg`:" (bodyweight)"}`),o.createElement("button",{className:"tvs-btn-icon",onClick:()=>J(G),title:"Remove exercise"},"\u2715")))),d&&o.createElement("div",{className:"tvs-circuit-add-exercise"},o.createElement("div",{className:"tvs-exercise-form-header"},o.createElement("label",{className:"tvs-form-label tvs-form-label-name"},"Exercise"),o.createElement("label",{className:"tvs-form-label tvs-form-label-reps"},o.createElement("span",{className:"tvs-metric-type-toggle"},o.createElement("button",{type:"button",className:k==="reps"?"tvs-toggle-btn tvs-toggle-active":"tvs-toggle-btn",onClick:()=>_("reps"),title:"Repetitions"},"\u{1F522}"),o.createElement("button",{type:"button",className:k==="time"?"tvs-toggle-btn tvs-toggle-active":"tvs-toggle-btn",onClick:()=>_("time"),title:"Time (seconds)"},"\u23F1"))),o.createElement("label",{className:"tvs-form-label tvs-form-label-weight"},"Weight (0 = bodyweight)")),o.createElement("div",{className:"tvs-exercise-form-inputs"},o.createElement(mt,{value:f,onChange:l=>{x(l),u&&C(null)},onSelect:l=>{x(l.name),C(l.id),_(l.default_metric||"reps"),l.default_metric==="time"?I(60):I(10)},placeholder:"Search exercise...",className:"tvs-exercise-search"}),o.createElement("input",{type:"number",placeholder:k==="reps"?"10":"60",value:n,min:"1",onChange:l=>I(Math.max(1,parseInt(l.target.value)||1)),className:"tvs-exercise-number tvs-input-reps",title:k==="reps"?"Repetitions":"Seconds"}),o.createElement("input",{type:"number",placeholder:"0",value:v,min:"0",step:"0.5",onChange:l=>ae(Math.max(0,parseFloat(l.target.value)||0)),className:"tvs-exercise-number tvs-input-weight"})),o.createElement("button",{className:"tvs-btn tvs-btn-secondary tvs-btn-add-exercise",onClick:P,disabled:!f.trim()},"+ Add")),e.exercises.length>0&&o.createElement("div",{className:"tvs-circuit-summary"},o.createElement("span",null,`${e.exercises.length} exercises`),o.createElement("span",null,"\u2022"),o.createElement("span",null,`${h.totalReps} reps`),h.totalVolume>0&&o.createElement(o.Fragment,null,o.createElement("span",null,"\u2022"),o.createElement("span",null,`${h.totalVolume}kg volume`))))},dt=Wt;var{useState:r,useEffect:Q,useRef:Se}=window.React;async function Be(e,d={}){let w=e.startsWith("/wp-json")?e:`/wp-json${e}`,g=await fetch(w,{...d,headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||"",...d.headers},credentials:"include"});if(!g.ok){let M=await g.json().catch(()=>({}));throw new Error(M.message||`HTTP ${g.status}: ${g.statusText}`)}return g.json()}function Ue({React:e,title:d,showTypeSelector:w,allowedTypes:g,autoStart:M,defaultType:N}){let[f,x]=r("select"),[u,C]=r("live"),[n,I]=r(N),[v,ae]=r(null),[k,_]=r(null),[Ee,A]=r(null),[$,W]=r(!1),[P,J]=r(!1),[Fe,Y]=r(null),[a,h]=r(null),[l,G]=r(null),[Z,R]=r(!1),[Ge,ee]=r(!1),[vt,$e]=r(!1),[pt,Pe]=r(null),[de,re]=r(""),[ft,De]=r(!1),[E,H]=r(0),[S,j]=r(0),[D,ue]=r(0),[B,we]=r(0),[V,ie]=r(0),[q,le]=r(0),[te,oe]=r(0),[L,ve]=r(0),[K,Le]=r(25),[b,ge]=r([{id:1,name:"Circuit 1",sets:1,exercises:[]}]),[ht,be]=r(1),[He,Et]=r([]),[Ot,wt]=r(""),[jt,Bt]=r(null),[Ut,gt]=r(3),[Gt,bt]=r(10),[Ht,yt]=r(0),[Kt,kt]=r("reps"),[ye,Ke]=r(0),[_e,ze]=r(0),[Je,Ye]=r(0),[qe,Xe]=r(0),[Qe,Ze]=r(0),[ke,Re]=r(0),[et,Nt]=r(""),[pe,xt]=r(0),Ne=Se(null),fe=Se(null),xe=Se(null),he=Se(null),Te=Se(null);Q(()=>{he.current&&he.current.scrollIntoView({behavior:"smooth",block:"start"})},[f]),Q(()=>{if(n==="Swim"&&L>0&&K>0){let t=parseFloat((L*K/1e3).toFixed(2));if(j(t),E>0&&L>0){let s=Math.round(E/L);we(s)}}},[L,K,E,n]),Q(()=>{M&&!w&&u==="live"&&st(N)},[]),Q(()=>{let t=localStorage.getItem("tvs_manual_session");if(t)try{let s=JSON.parse(t);s.sessionId&&s.type&&(confirm("You have an unfinished activity. Do you want to continue?")?(_(s.sessionId),I(s.type),C(s.mode||"live"),H(s.elapsed_time||0),j(s.distance||0),ue(s.speed||0),we(s.pace||0),ie(s.incline||0),le(s.cadence||0),oe(s.power||0),x("tracking"),u==="live"&&(xe.current=Date.now()-(s.elapsed_time||0)*1e3,Me())):localStorage.removeItem("tvs_manual_session"))}catch(s){z&&X("Failed to parse saved session:",s),localStorage.removeItem("tvs_manual_session")}},[]);let Me=()=>{Ne.current||u==="retrospective"||(Ne.current=setInterval(()=>{if(xe.current){let t=Math.floor((Date.now()-xe.current)/1e3);H(t)}},1e3))};Q(()=>{if(u==="live"&&f==="tracking"&&!$&&D>0&&E>0){let t=D*E/3600;j(parseFloat(t.toFixed(2)))}},[u,f,$,D,E]);let Ie=()=>{Ne.current&&(clearInterval(Ne.current),Ne.current=null)};Q(()=>(f==="tracking"&&k&&!$&&(fe.current=setInterval(()=>{Ve(!1)},3e4)),()=>{fe.current&&(clearInterval(fe.current),fe.current=null)}),[f,k,$,E,S,D,B,V,q,te]),Q(()=>{f==="tracking"&&k&&localStorage.setItem("tvs_manual_session",JSON.stringify({sessionId:k,type:n,mode:u,elapsed_time:E,distance:S,speed:D,pace:B,incline:V,cadence:q,power:te}))},[f,k,E,S,D,B,V,q,te]);let tt=async()=>{try{"wakeLock"in navigator&&u==="live"&&(Te.current=await navigator.wakeLock.request("screen"),z&&X("Wake Lock activated"))}catch(t){z&&X("Wake Lock error:",t)}},We=async()=>{try{Te.current&&(await Te.current.release(),Te.current=null,z&&X("Wake Lock released"))}catch(t){z&&X("Wake Lock release error:",t)}};Q(()=>()=>{Ie(),fe.current&&clearInterval(fe.current),We()},[]);let st=async t=>{J(!0),Y(null);try{let s=await Be("/tvs/v1/activities/manual/start",{method:"POST",body:JSON.stringify({type:t})});if(s.success&&s.session_id)_(s.session_id),A(s.session_data),I(t),x("tracking"),u==="live"&&(xe.current=Date.now(),Me(),tt()),typeof window.tvsFlash=="function"&&window.tvsFlash(`${t} activity started!`,"success");else throw new Error(data.message||"Failed to start activity")}catch(s){Y(s.message),typeof window.tvsFlash=="function"&&window.tvsFlash(s.message,"error")}finally{J(!1)}},Ve=async(t=!0)=>{if(k)try{let s={elapsed_time:E,distance:S,speed:D,pace:B,incline:V,cadence:q,power:te};n==="Workout"&&(s.circuits=b,s.exercises=b.flatMap(c=>c.exercises.map(m=>({...m,sets:c.sets,circuit_name:c.name})))),n==="Swim"&&(s.laps=L,s.pool_length=K);let i=await Be(`/tvs/v1/activities/manual/${k}`,{method:"PATCH",body:JSON.stringify(s)});i.success&&(A(i.session_data),t&&typeof window.tvsFlash=="function"&&window.tvsFlash("\u{1F4BE} Progress saved","success"))}catch(s){z&&X("Failed to update session:",s)}},nt=async()=>{if(k){v&&(v.duration!==void 0&&H(v.duration),v.distance!==void 0&&j(v.distance),v.incline!==void 0&&ie(v.incline),v.cadence!==void 0&&le(v.cadence),v.power!==void 0&&oe(v.power),v.laps!==void 0&&ve(v.laps),await new Promise(t=>setTimeout(t,10))),await Ve(!1),J(!0),Y(null);try{let t={};v?.notes&&(t.notes=v.notes),v?.rating&&(t.rating=v.rating);let s=await Be(`/tvs/v1/activities/manual/${k}/finish`,{method:"POST",body:JSON.stringify(t)});if(s.success&&s.activity_id)h(s.activity_id),G(s.permalink),x("finished"),Ie(),We(),localStorage.removeItem("tvs_manual_session"),window.dispatchEvent(new CustomEvent("tvs:activity-updated")),typeof window.tvsFlash=="function"&&window.tvsFlash("\u{1F389} Activity saved successfully!","success");else throw new Error(data.message||"Failed to finish activity")}catch(t){Y(t.message),typeof window.tvsFlash=="function"&&window.tvsFlash(t.message,"error")}finally{J(!1)}}},Ct=async()=>{if(a)try{R(!0);let t=await fetch(`/wp-json/tvs/v1/activities/${a}/strava`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},credentials:"same-origin"}),s=await t.json();if(!t.ok)throw new Error(s.message||"Upload failed");typeof window.tvsFlash=="function"&&window.tvsFlash("\u{1F44D} Uploaded to Strava!","success"),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(t){console.error("Strava upload failed:",t),typeof window.tvsFlash=="function"&&window.tvsFlash("Failed to upload to Strava: "+(t?.message||String(t)),"error")}finally{R(!1)}},St=()=>{$e(!0)},Ft=()=>{localStorage.removeItem("tvsManualActivitySession"),I(""),H(0),j(0),ue(0),ie(0),le(0),oe(0),ve(0),Le(25),ge([{id:Date.now(),name:"Circuit 1",sets:1,exercises:[]}]),be(Date.now()),Et([]),wt(""),gt(3),bt(10),yt(0),kt("reps"),W(!1),_(null),x("select"),$e(!1),typeof window.tvsFlash=="function"&&window.tvsFlash("Activity cancelled","info")},$t=()=>{$?(xe.current=Date.now()-E*1e3,W(!1),Me(),tt(),typeof window.tvsFlash=="function"&&window.tvsFlash("\u25B6\uFE0F Activity resumed","success")):(Ie(),W(!0),We(),typeof window.tvsFlash=="function"&&window.tvsFlash("\u23F8 Activity paused","info"))},se=t=>{let s=Math.floor(t/3600),i=Math.floor(t%3600/60),c=t%60;return`${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`},Dt=t=>{let s=Math.floor(t),i=Math.round((t-s)*60);return`${s}:${i.toString().padStart(2,"0")}`},at=t=>{if(!t)return 0;let s=t.split(":").map(i=>parseInt(i,10)||0);return s.length===3?s[0]*3600+s[1]*60+s[2]:s.length===2?s[0]*60+s[1]:s[0]},Ae=(t,s)=>{switch(t){case"duration":let i=at(s);H(Math.max(0,i));break;case"distance":j(Math.max(0,parseFloat(s)||0));break;case"speed":ue(Math.max(0,parseFloat(s)||0));break;case"incline":ie(Math.max(-5,Math.min(15,parseFloat(s)||0)));break;case"cadence":le(Math.max(0,parseInt(s,10)||0));break;case"power":oe(Math.max(0,parseInt(s,10)||0));break;case"laps":ve(Math.max(0,parseInt(s,10)||0));break}Pe(null),re("")};Q(()=>{D>0?we(parseFloat((60/D).toFixed(2))):we(0)},[D]);let rt=(()=>{let s={Run:{display:["distance","speed","pace","incline"],controls:["speed","incline","cadence"]},Walk:{display:["distance","speed","pace","incline"],controls:["speed","incline","cadence"]},Hike:{display:["distance","speed","pace","incline"],controls:["speed","incline","cadence"]},Ride:{display:["distance","speed","incline","cadence"],controls:["speed","incline","cadence","power"]},Swim:{display:["laps","poolLength","distance","pace"],controls:["laps","poolLength"]},Workout:{display:[],controls:[]}}[n]||{display:["distance","speed","pace"],controls:["speed"]};return u==="retrospective"&&(["Run","Walk","Hike","Ride"].includes(n)?(s.controls=["distance","duration","incline","cadence"],n==="Ride"&&s.controls.push("power")):n==="Swim"?s.controls=["laps","poolLength","duration"]:n==="Workout"&&(s.controls=["duration"])),s})(),Tt=t=>{let i={distance:{label:"Distance (km)",value:S.toFixed(2)},speed:{label:"Speed (km/h)",value:D.toFixed(1)},pace:{label:n==="Swim"?"Pace (sec/lap)":"Pace (min/km)",value:B>0?n==="Swim"?B:Dt(B):"\u2014"},incline:{label:"Incline (%)",value:V.toFixed(1)},cadence:{label:n==="Run"?"Cadence (SPM)":"Cadence (RPM)",value:q},laps:{label:"Laps",value:L},poolLength:{label:"Pool Length (m)",value:K}}[t];return i?e.createElement("div",{className:"tvs-metric",key:t},e.createElement("label",null,i.label),e.createElement("div",{className:"tvs-metric-value"},i.value)):null},Mt=t=>{let i={distance:{label:"Distance (km)",value:S.toFixed(2),onDecrease:()=>j(Math.max(0,parseFloat((S-.1).toFixed(2)))),onIncrease:()=>j(parseFloat((S+.1).toFixed(2)))},duration:{label:"Duration (h:mm:ss)",value:se(E),onDecrease:()=>H(Math.max(0,E-60)),onIncrease:()=>H(E+60)},speed:{label:"Speed (km/h)",value:D.toFixed(1),onDecrease:()=>ue(Math.max(0,D-.5)),onIncrease:()=>ue(D+.5)},incline:{label:"Incline (%)",value:V.toFixed(1)+"%",onDecrease:()=>ie(Math.max(-5,parseFloat((V-.5).toFixed(1)))),onIncrease:()=>ie(Math.min(15,parseFloat((V+.5).toFixed(1))))},cadence:{label:n==="Run"?"Cadence (SPM)":"Cadence (RPM)",value:q,onDecrease:()=>le(Math.max(0,q-5)),onIncrease:()=>le(q+5)},power:{label:"Power (W)",value:te,onDecrease:()=>oe(Math.max(0,te-10)),onIncrease:()=>oe(te+10)},laps:{label:"Laps",value:L,onDecrease:()=>ve(Math.max(0,L-1)),onIncrease:()=>ve(L+1)},poolLength:{label:"Pool Length (m)",value:K,onDecrease:()=>Le(25),onIncrease:()=>Le(50)}}[t];if(!i)return null;let c=pt===t,m=u==="retrospective";return e.createElement("div",{className:"tvs-control-row",key:t},e.createElement("label",null,i.label),e.createElement("div",{className:"tvs-control-buttons"},(t==="duration"||t==="distance")&&m&&e.createElement("button",{onClick:t==="duration"?()=>H(Math.max(0,E-1)):()=>j(Math.max(0,parseFloat((S-.01).toFixed(2)))),className:"tvs-btn-small"},t==="duration"?"\u22121s":"\u22120.01"),e.createElement("button",{onClick:i.onDecrease},"\u2212"),c?e.createElement("input",{type:"text",className:"tvs-inline-edit",value:de,onChange:p=>re(p.target.value),onBlur:()=>Ae(t,de),onKeyDown:p=>{p.key==="Enter"&&Ae(t,de),p.key==="Escape"&&(Pe(null),re(""))},autoFocus:!0,placeholder:t==="duration"?"h:mm:ss":i.value}):e.createElement("span",{onClick:m?()=>{Pe(t),re(t==="duration"?se(E):t==="distance"?S.toFixed(2):t==="speed"?D.toFixed(1):t==="incline"?V.toFixed(1):String(i.value))}:null,className:m?"tvs-editable":"",title:m?"Click to edit":""},i.value),e.createElement("button",{onClick:i.onIncrease},"+"),(t==="duration"||t==="distance")&&m&&e.createElement("button",{onClick:t==="duration"?()=>H(E+1):()=>j(parseFloat((S+.01).toFixed(2))),className:"tvs-btn-small"},t==="duration"?"+1s":"+0.01")))};if(f==="select")return e.createElement("div",{className:"tvs-manual-tracker tvs-card",ref:he},e.createElement("h3",{className:"tvs-tracker-title"},d),e.createElement("div",{className:"tvs-mode-selector"},e.createElement("button",{className:`tvs-mode-btn ${u==="live"?"active":""}`,onClick:()=>C("live")},"\u23F1\uFE0F Track Live",e.createElement("span",{className:"tvs-mode-desc"},"Real-time tracking")),e.createElement("button",{className:`tvs-mode-btn ${u==="retrospective"?"active":""}`,onClick:()=>C("retrospective")},"\u{1F4DD} Log Past Activity",e.createElement("span",{className:"tvs-mode-desc"},"Enter completed activity"))),w&&e.createElement("div",{className:"tvs-type-selector"},g.map(t=>e.createElement("button",{key:t,className:`tvs-type-btn ${n===t?"active":""}`,onClick:()=>I(t),disabled:P},Vt(t),e.createElement("span",null,t)))),e.createElement("button",{className:"tvs-btn tvs-btn-primary",onClick:()=>st(n),disabled:P},P?"Starting...":`Start ${n}`));if(f==="tracking")return e.createElement("div",{className:"tvs-manual-tracker tvs-dashboard tvs-card",ref:he},e.createElement("div",{className:"tvs-dashboard-header"},e.createElement("div",null,e.createElement("h3",{className:"tvs-tracker-title"},`${n} Activity`),e.createElement("span",{className:"tvs-badge tvs-badge-accent",style:{fontSize:"var(--tvs-text-xs)",marginTop:"var(--tvs-space-1)"}},u==="retrospective"?"\u{1F4DD} Retrospective":"\u23F1\uFE0F Live")),ft?e.createElement("input",{type:"text",className:"tvs-timer-edit",value:de,onChange:t=>re(t.target.value),onBlur:()=>{Ae("duration",de),De(!1)},onKeyDown:t=>{t.key==="Enter"&&(Ae("duration",de),De(!1)),t.key==="Escape"&&(De(!1),re(""))},autoFocus:!0,placeholder:"h:mm:ss"}):e.createElement("div",{className:u==="retrospective"?"tvs-timer tvs-timer-editable":"tvs-timer",onClick:u==="retrospective"?()=>{De(!0),re(se(E))}:null,title:u==="retrospective"?"Click to edit time":""},se(E))),e.createElement("div",{className:"tvs-metrics-grid"},rt.display.map(Tt)),e.createElement("div",{className:"tvs-controls"},e.createElement("h4",null,n==="Workout"?"Add Your Exercises":"Adjust Metrics"),u==="retrospective"&&e.createElement("p",{className:"tvs-controls-hint"},"\u{1F4A1} Click on any value to edit directly"),rt.controls.map(Mt)),n==="Workout"&&e.createElement("div",{className:"tvs-workout-circuits"},e.createElement("h4",null,"Strength Training"),e.createElement("p",{className:"tvs-workout-hint"},"Organize your workout into circuits. Each circuit can have multiple exercises and rounds."),b.map(t=>e.createElement(dt,{key:t.id,circuit:t,isActive:t.id===ht,onUpdate:s=>{ge(b.map(i=>i.id===s.id?s:i))},onRemove:s=>{let i=b.filter(c=>c.id!==s);if(ge(i),i.length>0)be(i[0].id);else{let c={id:Date.now(),name:"Circuit 1",sets:1,exercises:[]};ge([c]),be(c.id)}},onSetActive:be,canRemove:b.length>1})),e.createElement("button",{className:"tvs-btn tvs-btn-secondary tvs-btn-add-circuit",onClick:()=>{let t={id:Date.now(),name:`Circuit ${b.length+1}`,sets:1,exercises:[]};ge([...b,t]),be(t.id)}},"+ Add Circuit"),(()=>{if(!b.some(m=>m.exercises.length>0))return null;let s=b.reduce((m,p)=>m+p.exercises.length,0),i=b.reduce((m,p)=>{let F=p.exercises.reduce((O,T)=>O+(T.metric_type==="reps"?T.reps:0),0);return m+F*p.sets},0),c=b.reduce((m,p)=>{let F=p.exercises.reduce((O,T)=>O+T.reps*T.weight,0);return m+F*p.sets},0);return e.createElement("div",{className:"tvs-workout-summary"},e.createElement("h5",null,"Workout Totals"),e.createElement("p",null,`\u{1F4CB} ${b.length} circuits \u2022 ${s} exercises`),i>0&&e.createElement("p",null,`\u{1F4AA} ${i} total reps`),c>0&&e.createElement("p",null,`\u{1F3CB}\uFE0F ${c.toFixed(1)}kg total volume`))})()),e.createElement("div",{className:"tvs-action-buttons"},u==="live"&&e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:$t,disabled:P},$?"\u25B6\uFE0F Resume":"\u23F8 Pause"),u==="live"&&e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:Ve,disabled:P},"\u{1F4BE} Save Progress"),e.createElement("button",{className:"tvs-btn tvs-btn-danger",onClick:St,disabled:P},"\u2715 Cancel"),e.createElement("button",{className:"tvs-btn tvs-btn-finish",onClick:()=>{if(n==="Workout"&&!b.some(s=>s.exercises.length>0)){typeof window.tvsFlash=="function"&&window.tvsFlash("\u26A0\uFE0F Add at least one exercise before finishing","error");return}u==="live"?(Ie(),Ke(E),ze(S),Ye(V),Xe(q),Ze(te),Re(L),x("calibration")):ee(!0)},disabled:P},P?"Finishing...":"\u2713 Finish Activity")),$&&e.createElement("div",{className:"tvs-paused-notice tvs-badge tvs-badge-primary"},"\u23F8 Activity paused"),vt&&e.createElement("div",{className:"tvs-modal-overlay",onClick:()=>$e(!1)},e.createElement("div",{className:"tvs-modal tvs-card",onClick:t=>t.stopPropagation()},e.createElement("h3",{className:"tvs-modal-title"},"\u26A0\uFE0F Cancel Activity?"),e.createElement("p",{className:"tvs-modal-text"},"Are you sure you want to cancel this activity? All data will be lost and cannot be recovered."),e.createElement("div",{className:"tvs-modal-actions"},e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:()=>$e(!1)},"Keep Activity"),e.createElement("button",{className:"tvs-btn tvs-btn-danger",onClick:Ft},"\u2715 Cancel Activity")))),Ge&&e.createElement("div",{className:"tvs-modal-overlay",onClick:()=>ee(!1)},e.createElement("div",{className:"tvs-modal tvs-card",onClick:t=>t.stopPropagation()},e.createElement("h3",{className:"tvs-modal-title"},"\u{1F3C1} Finish Activity?"),e.createElement("p",{className:"tvs-modal-text"},`Are you sure you want to finish this ${n.toLowerCase()} activity?`),e.createElement("div",{className:"tvs-modal-summary"},e.createElement("div",null,`\u23F1 Duration: ${se(E)}`),n!=="Workout"&&e.createElement("div",null,`\u{1F4CD} Distance: ${S.toFixed(2)} km`),n==="Swim"&&e.createElement("div",null,`\u{1F3CA} Laps: ${L}`),n==="Swim"&&B>0&&e.createElement("div",null,`\u26A1 Pace: ${B} sec/lap`),n==="Workout"&&He.length>0&&e.createElement("div",null,`\u{1F4AA} Exercises: ${He.length}`)),e.createElement("div",{className:"tvs-modal-actions"},e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:()=>ee(!1)},"Go Back"),e.createElement("button",{className:"tvs-btn tvs-btn-finish",onClick:()=>{ee(!1),nt()},disabled:P},"\u2713 Finish")))));if(f==="calibration"){let t=()=>{ae({duration:ye,distance:_e,incline:Je,cadence:qe,power:Qe,laps:ke,notes:et,rating:pe}),ee(!0)},s=()=>{x("tracking"),u==="live"&&Me()},i=(c,m,p,F="",O=.01,T="number")=>e.createElement("div",{className:"tvs-calibration-field"},e.createElement("label",null,c),e.createElement("div",{className:"tvs-calibration-input-group"},e.createElement("input",{type:T,value:T==="text"?se(m):m,onChange:it=>{if(T==="text"){let It=at(it.target.value);p(It)}else p(parseFloat(it.target.value)||0)},step:O,min:0,className:"tvs-calibration-input",placeholder:c}),F&&e.createElement("span",{className:"tvs-calibration-unit"},F)));return e.createElement("div",{className:"tvs-manual-tracker tvs-calibration",ref:he},e.createElement("h3",null,"\u{1F3AF} Calibrate Your Results"),e.createElement("p",{className:"tvs-calibration-hint"},"Adjust values to match your equipment (treadmill, bike computer, watch, etc.)"),e.createElement("div",{className:"tvs-calibration-grid"},i("Duration",ye,Ke,"",1,"text"),["Run","Walk","Hike","Ride"].includes(n)&&i("Distance",_e,ze,"km",.01),["Run","Walk","Hike","Ride"].includes(n)&&i("Incline",Je,Ye,"%",.5),["Run","Walk","Hike","Ride"].includes(n)&&i("Cadence",qe,Xe,"spm",1),n==="Ride"&&i("Power",Qe,Ze,"W",1),n==="Swim"&&i("Laps",ke,Re,"",1)),e.createElement("div",{className:"tvs-calibration-notes-rating"},e.createElement("div",{className:"tvs-calibration-field"},e.createElement("label",null,"Notes"),e.createElement("textarea",{value:et,onChange:c=>Nt(c.target.value),className:"tvs-calibration-textarea",placeholder:"How did the activity feel? Any observations?",rows:2})),e.createElement("div",{className:"tvs-calibration-field"},e.createElement("label",null,"Rate Your Activity (1-10)"),e.createElement("div",{className:"tvs-rating-scale"},[1,2,3,4,5,6,7,8,9,10].map(c=>e.createElement("button",{key:c,type:"button",className:`tvs-rating-btn ${pe===c?"tvs-rating-btn--active":""}`,onClick:()=>xt(c)},c))),pe>0?e.createElement("div",{className:"tvs-rating-label"},pe<=3?"Challenging":pe<=6?"Moderate":pe<=8?"Good":"Excellent"):null)),e.createElement("div",{className:"tvs-calibration-actions"},e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:s},"\u2190 Back to Tracking"),e.createElement("button",{className:"tvs-btn tvs-btn-finish",onClick:t},"\u2713 Confirm & Finish")),Ge&&e.createElement("div",{className:"tvs-modal-overlay",onClick:()=>ee(!1)},e.createElement("div",{className:"tvs-modal tvs-card",onClick:c=>c.stopPropagation()},e.createElement("h3",{className:"tvs-modal-title"},"\u{1F3C1} Finish Activity?"),e.createElement("p",{className:"tvs-modal-text"},`Are you sure you want to finish this ${n.toLowerCase()} activity with the calibrated values?`),e.createElement("div",{className:"tvs-modal-summary"},e.createElement("div",null,`\u23F1 Duration: ${se(ye)}`),n!=="Workout"&&e.createElement("div",null,`\u{1F4CD} Distance: ${_e.toFixed(2)} km`),n==="Swim"&&e.createElement("div",null,`\u{1F3CA} Laps: ${ke}`),n==="Swim"&&ke>0&&ye>0&&e.createElement("div",null,`\u26A1 Pace: ${Math.round(ye/ke)} sec/lap`),n==="Workout"&&(()=>{let c=b.reduce((m,p)=>m+p.exercises.length,0);return c>0&&e.createElement("div",null,`\u{1F3CB}\uFE0F ${b.length} circuits \u2022 ${c} exercises`)})()),e.createElement("div",{className:"tvs-modal-actions"},e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:()=>ee(!1)},"Go Back"),e.createElement("button",{className:"tvs-btn tvs-btn-finish",onClick:()=>{ee(!1),nt()},disabled:P},"\u2713 Finish")))))}if(f==="finished"){let t=[e.createElement("p",{key:"type"},`Type: ${n}`),e.createElement("p",{key:"duration"},`\u23F1 Duration: ${se(E)}`)];if(n==="Workout"){let s=b.reduce((m,p)=>m+p.exercises.length,0),i=b.reduce((m,p)=>{let F=p.exercises.reduce((O,T)=>O+(T.metric_type==="reps"?T.reps:0),0);return m+F*p.sets},0),c=b.reduce((m,p)=>{let F=p.exercises.reduce((O,T)=>O+T.reps*T.weight,0);return m+F*p.sets},0);t.push(e.createElement("p",{key:"circuits"},`\u{1F3CB}\uFE0F ${b.length} circuits \u2022 ${s} exercises`)),i>0&&t.push(e.createElement("p",{key:"total"},`\u{1F501} Total reps: ${i}`)),c>0&&t.push(e.createElement("p",{key:"volume"},`\u{1F4CA} Total volume: ${c.toFixed(1)} kg`)),s>0&&t.push(e.createElement("div",{key:"circuit-list",className:"tvs-summary-circuits"},b.map((m,p)=>m.exercises.length>0&&e.createElement("div",{key:p,className:"tvs-summary-circuit"},e.createElement("h4",null,`${m.name} (${m.sets} ${m.sets===1?"round":"rounds"})`),m.exercises.map((F,O)=>e.createElement("div",{key:O,className:"tvs-summary-exercise"},`${O+1}. ${F.name} (${F.reps}${F.metric_type==="time"?"s":""}${F.weight>0?` @ ${F.weight}kg`:""})`))))))}else if(n==="Swim")t.push(e.createElement("p",{key:"laps"},`\u{1F3CA} Laps: ${L}`),e.createElement("p",{key:"pool"},`\u{1F4CF} Pool Length: ${K}m`),e.createElement("p",{key:"distance"},`\u{1F4CD} Distance: ${(L*K/1e3).toFixed(2)} km`)),B>0&&t.push(e.createElement("p",{key:"pace"},`\u26A1 Avg Pace: ${B} sec/lap`));else{if(t.push(e.createElement("p",{key:"distance"},`\u{1F4CD} Distance: ${S.toFixed(2)} km`)),S>0&&E>0){let s=(S/(E/3600)).toFixed(1);t.push(e.createElement("p",{key:"speed"},`\u26A1 Avg Speed: ${s} km/h`))}V>0&&t.push(e.createElement("p",{key:"incline"},`\u26F0\uFE0F Incline: ${V.toFixed(1)}%`))}return e.createElement("div",{className:"tvs-manual-tracker tvs-finished",ref:he},e.createElement("h3",null,"\u{1F389} Activity Saved!"),e.createElement("div",{className:"tvs-summary"},t),e.createElement("div",{className:"tvs-finished-actions"},l&&e.createElement("a",{href:l,className:"tvs-btn tvs-btn-primary"},"View Activity"),a&&e.createElement("button",{className:"tvs-btn tvs-btn-strava",onClick:Ct,disabled:Z},Z?"Uploading...":e.createElement(e.Fragment,null,e.createElement("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",style:{marginRight:"8px",verticalAlign:"middle"}},e.createElement("path",{d:"M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"})),"Upload to Strava")),e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:()=>{x("select"),_(null),H(0),j(0),ue(0),we(0),ie(0),le(0),oe(0),ve(0),setSets(0),setReps(0)}},"Start Another Activity")))}return null}function Vt(e){return{Run:"\u{1F3C3}",Ride:"\u{1F6B4}",Walk:"\u{1F6B6}",Hike:"\u{1F97E}",Swim:"\u{1F3CA}",Workout:"\u{1F4AA}"}[e]||"\u{1F3C3}"}function ut(){document.querySelectorAll(".tvs-manual-activity-tracker").forEach((d,w)=>{if(!d.__tvsMounted){let g=d.id||`tvs-manual-tracker-${w}`;d.id||(d.id=g),z&&X("Mounting ManualActivityTracker block (view.js) on:",g);let M=d.getAttribute("data-title")||"Start Activity",N=d.getAttribute("data-show-type-selector")==="1",f=d.getAttribute("data-allowed-types")||"[]",x=JSON.parse(f),u=d.getAttribute("data-auto-start")==="1",C=d.getAttribute("data-default-type")||"Run";ot(Ue,{React:y,title:M,showTypeSelector:N,allowedTypes:x,autoStart:u,defaultType:C},d),d.__tvsMounted=!0}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ut):ut();})();
//# sourceMappingURL=tvs-block-manual-activity-tracker.js.map
