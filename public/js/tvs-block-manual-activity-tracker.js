(()=>{var pe=new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1";function Ne(...e){pe&&console.debug("[TVS]",...e)}function Le(...e){console.error("[TVS]",...e)}var tt=!!(window.React&&window.ReactDOM),Ct=!!(window.wp&&window.wp.element),te=Ct?window.wp.element:{},y=tt?window.React:te||{},U=tt?window.ReactDOM:te||null,We=new WeakMap,St=U&&typeof U.createRoot=="function"||te&&typeof te.createRoot=="function";function st(e,m,w){try{let g=We.get(w);if(g&&typeof g.unmount=="function"?(g.unmount(),We.delete(w)):U&&typeof U.unmountComponentAtNode=="function"&&U.unmountComponentAtNode(w),St){let v=(U&&U.createRoot||te&&te.createRoot)(w);We.set(w,v),v.render(y.createElement(e,m));return}let I=U&&U.render||te&&te.render;if(I){I(y.createElement(e,m),w);return}Le("Ingen render-funksjon tilgjengelig.")}catch(g){Le("Mount feilet:",g)}}var{useState:le,useEffect:xe,useRef:nt}=y;function Ft(e,m){let[w,g]=le(e);return xe(()=>{let I=setTimeout(()=>{g(e)},m);return()=>{clearTimeout(I)}},[e,m]),w}function $t({value:e,onChange:m,onSelect:w,placeholder:g="Search exercises...",className:I=""}){let[N,v]=le([]),[x,d]=le(!1),[C,n]=le(!1),[M,E]=le(-1),[se,k]=le(""),[L,fe]=le({top:0,left:0,width:0}),A=nt(null),$=nt(null),W=Ft(e,300);xe(()=>{if(C&&A.current){let a=A.current.getBoundingClientRect();fe({top:a.bottom+window.scrollY,left:a.left+window.scrollX,width:a.width})}},[C]),xe(()=>{if(!C)return;let a=()=>{if(A.current){let p=A.current.getBoundingClientRect();fe({top:p.bottom+window.scrollY,left:p.left+window.scrollX,width:p.width})}};return window.addEventListener("scroll",a,!0),window.addEventListener("resize",a),()=>{window.removeEventListener("scroll",a,!0),window.removeEventListener("resize",a)}},[C]),xe(()=>{(async()=>{if(W.length<2){v([]),n(!1),k("");return}d(!0),k("");try{let p=`${window.TVS_SETTINGS.restRoot}tvs/v1/exercises/search?q=${encodeURIComponent(W)}&limit=10`,l=await fetch(p,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS.nonce}});if(!l.ok)throw new Error(`Search failed: ${l.status}`);let G=await l.json();v(G.results||[]),n(!0),E(-1)}catch(p){console.error("Exercise search error:",p),k("Search failed. Try again."),v([]),n(!1)}finally{d(!1)}})()},[W]),xe(()=>{let a=p=>{$.current&&!$.current.contains(p.target)&&A.current&&!A.current.contains(p.target)&&n(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]);let P=a=>{if(!(!C||N.length===0))switch(a.key){case"ArrowDown":a.preventDefault(),E(p=>p<N.length-1?p+1:p);break;case"ArrowUp":a.preventDefault(),E(p=>p>0?p-1:-1);break;case"Enter":a.preventDefault(),M>=0&&M<N.length&&z(N[M]);break;case"Escape":a.preventDefault(),n(!1),E(-1);break;default:break}},z=a=>{console.log("Exercise selected:",a),w({id:a.id,name:a.name,default_metric:a.default_metric||"reps"}),v([]),n(!1),E(-1)},Ce=a=>{switch(a){case"beginner":return"#10b981";case"intermediate":return"#f59e0b";case"advanced":return"#ef4444";default:return"#6b7280"}},J=()=>!C||N.length===0?null:U.createPortal(y.createElement("div",{ref:$,className:"tvs-exercise-dropdown",style:{position:"absolute",top:`${L.top}px`,left:`${L.left}px`,width:`${L.width}px`,zIndex:999999}},N.map((a,p)=>y.createElement("div",{key:a.id,className:`tvs-exercise-result ${p===M?"tvs-exercise-result-selected":""}`,onClick:()=>z(a),onMouseEnter:()=>E(p)},y.createElement("div",null,y.createElement("div",null,y.createElement("div",null,a.name),y.createElement("div",null,a.category&&y.createElement("span",{className:"tvs-badge tvs-badge-category"},a.category),a.difficulty&&y.createElement("span",{className:"tvs-badge tvs-badge-difficulty",style:{background:Ce(a.difficulty)}},a.difficulty),a.default_metric&&y.createElement("span",{className:"tvs-badge-metric"},a.default_metric==="reps"?"\u{1F522} Reps":"\u23F1 Time")))))),N.length===0&&!x&&W.length>=2&&y.createElement("div",{style:{padding:"12px 16px",color:"var(--tvs-text-secondary)",fontSize:"14px"}},"No exercises found")),document.body);return y.createElement("div",{className:`tvs-exercise-search-container ${I}`},y.createElement("input",{ref:A,type:"text",placeholder:g,value:e,onChange:a=>m(a.target.value),onKeyDown:P,onFocus:()=>{N.length>0&&n(!0)},className:"tvs-exercise-input tvs-input-name",autoComplete:"off"}),x&&y.createElement("div",{className:"tvs-search-spinner"},"\u{1F50D}"),se&&y.createElement("div",{className:"tvs-search-error"},se),J())}var at=$t;var{useState:oe}=window.React,o=window.React,Dt=({circuit:e,isActive:m,onUpdate:w,onRemove:g,onSetActive:I,canRemove:N=!0})=>{let[v,x]=oe(""),[d,C]=oe(null),[n,M]=oe(10),[E,se]=oe(0),[k,L]=oe("reps"),[fe,A]=oe(!1),[$,W]=oe(e.name),P=()=>{if(!v.trim())return;let l={name:v.trim(),exercise_id:d,reps:n,weight:E,metric_type:k};w({...e,exercises:[...e.exercises,l]}),x(""),C(null),M(10),se(0),L("reps")},z=l=>{w({...e,exercises:e.exercises.filter((G,q)=>q!==l)})},Ce=l=>{w({...e,sets:Math.max(1,parseInt(l)||1)})},J=()=>{$.trim()&&w({...e,name:$.trim()}),A(!1)},p=(()=>{let l=e.exercises.reduce((q,Q)=>q+(Q.metric_type==="reps"?Q.reps:0),0),G=e.exercises.reduce((q,Q)=>q+Q.reps*Q.weight,0);return{totalReps:l*e.sets,totalVolume:G*e.sets}})();return o.createElement("div",{className:`tvs-circuit-container ${m?"tvs-circuit-active":""}`,onClick:()=>!m&&I(e.id)},o.createElement("div",{className:"tvs-circuit-header"},fe?o.createElement("input",{type:"text",value:$,onChange:l=>W(l.target.value),onBlur:J,onKeyDown:l=>{l.key==="Enter"&&J(),l.key==="Escape"&&(W(e.name),A(!1))},className:"tvs-circuit-name-edit",autoFocus:!0}):o.createElement("div",{className:"tvs-circuit-name-wrapper",onClick:()=>{W(e.name),A(!0)},title:"Click to edit circuit name"},o.createElement("h4",{className:"tvs-circuit-name"},e.name),o.createElement("span",{className:"tvs-circuit-edit-icon"},"\u270E")),o.createElement("div",{className:"tvs-circuit-sets"},o.createElement("input",{type:"number",value:e.sets,min:"1",onChange:l=>Ce(l.target.value),className:"tvs-circuit-sets-input",title:"Number of rounds"}),o.createElement("span",null,e.sets===1?" round":" rounds")),N&&o.createElement("button",{className:"tvs-btn-icon tvs-circuit-remove",onClick:l=>{l.stopPropagation(),confirm(`Remove ${e.name}?`)&&g(e.id)},title:"Remove circuit"},"\u2715")),e.exercises.length>0&&o.createElement("div",{className:"tvs-circuit-exercises"},e.exercises.map((l,G)=>o.createElement("div",{key:G,className:"tvs-circuit-exercise-item"},o.createElement("span",{className:"tvs-exercise-number"},`${G+1}.`),o.createElement("span",{className:"tvs-exercise-name"},l.name),o.createElement("span",{className:"tvs-exercise-stats"},`${l.reps}${l.metric_type==="time"?"s":""}${l.weight>0?` @ ${l.weight}kg`:" (bodyweight)"}`),o.createElement("button",{className:"tvs-btn-icon",onClick:()=>z(G),title:"Remove exercise"},"\u2715")))),m&&o.createElement("div",{className:"tvs-circuit-add-exercise"},o.createElement("div",{className:"tvs-exercise-form-header"},o.createElement("label",{className:"tvs-form-label tvs-form-label-name"},"Exercise"),o.createElement("label",{className:"tvs-form-label tvs-form-label-reps"},o.createElement("span",{className:"tvs-metric-type-toggle"},o.createElement("button",{type:"button",className:k==="reps"?"tvs-toggle-btn tvs-toggle-active":"tvs-toggle-btn",onClick:()=>L("reps"),title:"Repetitions"},"\u{1F522}"),o.createElement("button",{type:"button",className:k==="time"?"tvs-toggle-btn tvs-toggle-active":"tvs-toggle-btn",onClick:()=>L("time"),title:"Time (seconds)"},"\u23F1"))),o.createElement("label",{className:"tvs-form-label tvs-form-label-weight"},"Weight (0 = bodyweight)")),o.createElement("div",{className:"tvs-exercise-form-inputs"},o.createElement(at,{value:v,onChange:l=>{x(l),d&&C(null)},onSelect:l=>{x(l.name),C(l.id),L(l.default_metric||"reps"),l.default_metric==="time"?M(60):M(10)},placeholder:"Search exercise...",className:"tvs-exercise-search"}),o.createElement("input",{type:"number",placeholder:k==="reps"?"10":"60",value:n,min:"1",onChange:l=>M(Math.max(1,parseInt(l.target.value)||1)),className:"tvs-exercise-number tvs-input-reps",title:k==="reps"?"Repetitions":"Seconds"}),o.createElement("input",{type:"number",placeholder:"0",value:E,min:"0",step:"0.5",onChange:l=>se(Math.max(0,parseFloat(l.target.value)||0)),className:"tvs-exercise-number tvs-input-weight"})),o.createElement("button",{className:"tvs-btn tvs-btn-secondary tvs-btn-add-exercise",onClick:P,disabled:!v.trim()},"+ Add")),e.exercises.length>0&&o.createElement("div",{className:"tvs-circuit-summary"},o.createElement("span",null,`${e.exercises.length} exercises`),o.createElement("span",null,"\u2022"),o.createElement("span",null,`${p.totalReps} reps`),p.totalVolume>0&&o.createElement(o.Fragment,null,o.createElement("span",null,"\u2022"),o.createElement("span",null,`${p.totalVolume}kg volume`))))},rt=Dt;var{useState:i,useEffect:Y,useRef:Ie}=window.React;async function Ve(e,m={}){let w=e.startsWith("/wp-json")?e:`/wp-json${e}`,g=await fetch(w,{...m,headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||"",...m.headers},credentials:"include"});if(!g.ok){let I=await g.json().catch(()=>({}));throw new Error(I.message||`HTTP ${g.status}: ${g.statusText}`)}return g.json()}function je({React:e,title:m,showTypeSelector:w,allowedTypes:g,autoStart:I,defaultType:N}){let[v,x]=i("select"),[d,C]=i("live"),[n,M]=i(N),[E,se]=i(null),[k,L]=i(null),[fe,A]=i(null),[$,W]=i(!1),[P,z]=i(!1),[Ce,J]=i(null),[a,p]=i(null),[l,G]=i(null),[q,Q]=i(!1),[Oe,Z]=i(!1),[lt,Se]=i(!1),[ot,Me]=i(null),[ce,ne]=i(""),[ct,Fe]=i(!1),[h,H]=i(0),[S,O]=i(0),[D,me]=i(0),[B,he]=i(0),[V,ae]=i(0),[X,re]=i(0),[R,ie]=i(0),[_,de]=i(0),[K,Ae]=i(25),[b,Ee]=i([{id:1,name:"Circuit 1",sets:1,exercises:[]}]),[mt,we]=i(1),[It,dt]=i([]),[Mt,ut]=i(""),[At,Pt]=i(null),[_t,vt]=i(3),[Lt,pt]=i(10),[Wt,ft]=i(0),[Vt,ht]=i("reps"),[ge,Be]=i(0),[Pe,Ue]=i(0),[Ge,He]=i(0),[Ke,ze]=i(0),[Je,Xe]=i(0),[be,Ye]=i(0),ye=Ie(null),ue=Ie(null),ke=Ie(null),ve=Ie(null);Y(()=>{ve.current&&ve.current.scrollIntoView({behavior:"smooth",block:"start"})},[v]),Y(()=>{if(n==="Swim"&&_>0&&K>0){let t=parseFloat((_*K/1e3).toFixed(2));if(O(t),h>0&&_>0){let s=Math.round(h/_);he(s)}}},[_,K,h,n]),Y(()=>{I&&!w&&d==="live"&&qe(N)},[]),Y(()=>{let t=localStorage.getItem("tvs_manual_session");if(t)try{let s=JSON.parse(t);s.sessionId&&s.type&&(confirm("You have an unfinished activity. Do you want to continue?")?(L(s.sessionId),M(s.type),C(s.mode||"live"),H(s.elapsed_time||0),O(s.distance||0),me(s.speed||0),he(s.pace||0),ae(s.incline||0),re(s.cadence||0),ie(s.power||0),x("tracking"),d==="live"&&(ke.current=Date.now()-(s.elapsed_time||0)*1e3,$e())):localStorage.removeItem("tvs_manual_session"))}catch(s){pe&&Ne("Failed to parse saved session:",s),localStorage.removeItem("tvs_manual_session")}},[]);let $e=()=>{ye.current||d==="retrospective"||(ye.current=setInterval(()=>{if(ke.current){let t=Math.floor((Date.now()-ke.current)/1e3);H(t)}},1e3))};Y(()=>{if(d==="live"&&v==="tracking"&&!$&&D>0&&h>0){let t=D*h/3600;O(parseFloat(t.toFixed(2)))}},[d,v,$,D,h]);let De=()=>{ye.current&&(clearInterval(ye.current),ye.current=null)};Y(()=>(v==="tracking"&&k&&!$&&(ue.current=setInterval(()=>{_e(!1)},3e4)),()=>{ue.current&&(clearInterval(ue.current),ue.current=null)}),[v,k,$,h,S,D,B,V,X,R]),Y(()=>{v==="tracking"&&k&&localStorage.setItem("tvs_manual_session",JSON.stringify({sessionId:k,type:n,mode:d,elapsed_time:h,distance:S,speed:D,pace:B,incline:V,cadence:X,power:R}))},[v,k,h,S,D,B,V,X,R]),Y(()=>()=>{De(),ue.current&&clearInterval(ue.current)},[]);let qe=async t=>{z(!0),J(null);try{let s=await Ve("/tvs/v1/activities/manual/start",{method:"POST",body:JSON.stringify({type:t})});if(s.success&&s.session_id)L(s.session_id),A(s.session_data),M(t),x("tracking"),d==="live"&&(ke.current=Date.now(),$e()),typeof window.tvsFlash=="function"&&window.tvsFlash(`${t} activity started!`,"success");else throw new Error(data.message||"Failed to start activity")}catch(s){J(s.message),typeof window.tvsFlash=="function"&&window.tvsFlash(s.message,"error")}finally{z(!1)}},_e=async(t=!0)=>{if(k)try{let s={elapsed_time:h,distance:S,speed:D,pace:B,incline:V,cadence:X,power:R};n==="Workout"&&(s.circuits=b,s.exercises=b.flatMap(f=>f.exercises.map(c=>({...c,sets:f.sets,circuit_name:f.name})))),n==="Swim"&&(s.laps=_,s.pool_length=K);let r=await Ve(`/tvs/v1/activities/manual/${k}`,{method:"PATCH",body:JSON.stringify(s)});r.success&&(A(r.session_data),t&&typeof window.tvsFlash=="function"&&window.tvsFlash("\u{1F4BE} Progress saved","success"))}catch(s){pe&&Ne("Failed to update session:",s)}},Qe=async()=>{if(k){E&&(E.duration!==void 0&&H(E.duration),E.distance!==void 0&&O(E.distance),E.incline!==void 0&&ae(E.incline),E.cadence!==void 0&&re(E.cadence),E.power!==void 0&&ie(E.power),E.laps!==void 0&&de(E.laps),await new Promise(t=>setTimeout(t,10))),await _e(!1),z(!0),J(null);try{let t=await Ve(`/tvs/v1/activities/manual/${k}/finish`,{method:"POST"});if(t.success&&t.activity_id)p(t.activity_id),G(t.permalink),x("finished"),De(),localStorage.removeItem("tvs_manual_session"),window.dispatchEvent(new CustomEvent("tvs:activity-updated")),typeof window.tvsFlash=="function"&&window.tvsFlash("\u{1F389} Activity saved successfully!","success");else throw new Error(data.message||"Failed to finish activity")}catch(t){J(t.message),typeof window.tvsFlash=="function"&&window.tvsFlash(t.message,"error")}finally{z(!1)}}},Et=async()=>{if(a)try{Q(!0);let t=await fetch(`/wp-json/tvs/v1/activities/${a}/strava`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},credentials:"same-origin"}),s=await t.json();if(!t.ok)throw new Error(s.message||"Upload failed");typeof window.tvsFlash=="function"&&window.tvsFlash("\u{1F44D} Uploaded to Strava!","success"),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(t){console.error("Strava upload failed:",t),typeof window.tvsFlash=="function"&&window.tvsFlash("Failed to upload to Strava: "+(t?.message||String(t)),"error")}finally{Q(!1)}},wt=()=>{Se(!0)},gt=()=>{localStorage.removeItem("tvsManualActivitySession"),M(""),H(0),O(0),me(0),ae(0),re(0),ie(0),de(0),Ae(25),Ee([{id:Date.now(),name:"Circuit 1",sets:1,exercises:[]}]),we(Date.now()),dt([]),ut(""),vt(3),pt(10),ft(0),ht("reps"),W(!1),L(null),x("select"),Se(!1),typeof window.tvsFlash=="function"&&window.tvsFlash("Activity cancelled","info")},bt=()=>{$?(ke.current=Date.now()-h*1e3,W(!1),$e(),typeof window.tvsFlash=="function"&&window.tvsFlash("\u25B6\uFE0F Activity resumed","success")):(De(),W(!0),typeof window.tvsFlash=="function"&&window.tvsFlash("\u23F8 Activity paused","info"))},ee=t=>{let s=Math.floor(t/3600),r=Math.floor(t%3600/60),f=t%60;return`${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`},yt=t=>{let s=Math.floor(t),r=Math.round((t-s)*60);return`${s}:${r.toString().padStart(2,"0")}`},Ze=t=>{if(!t)return 0;let s=t.split(":").map(r=>parseInt(r,10)||0);return s.length===3?s[0]*3600+s[1]*60+s[2]:s.length===2?s[0]*60+s[1]:s[0]},Te=(t,s)=>{switch(t){case"duration":let r=Ze(s);H(Math.max(0,r));break;case"distance":O(Math.max(0,parseFloat(s)||0));break;case"speed":me(Math.max(0,parseFloat(s)||0));break;case"incline":ae(Math.max(-5,Math.min(15,parseFloat(s)||0)));break;case"cadence":re(Math.max(0,parseInt(s,10)||0));break;case"power":ie(Math.max(0,parseInt(s,10)||0));break;case"laps":de(Math.max(0,parseInt(s,10)||0));break}Me(null),ne("")};Y(()=>{D>0?he(parseFloat((60/D).toFixed(2))):he(0)},[D]);let Re=(()=>{let s={Run:{display:["distance","speed","pace","incline"],controls:["speed","incline","cadence"]},Walk:{display:["distance","speed","pace","incline"],controls:["speed","incline","cadence"]},Hike:{display:["distance","speed","pace","incline"],controls:["speed","incline","cadence"]},Ride:{display:["distance","speed","incline","cadence"],controls:["speed","incline","cadence","power"]},Swim:{display:["laps","poolLength","distance","pace"],controls:["laps","poolLength"]},Workout:{display:[],controls:[]}}[n]||{display:["distance","speed","pace"],controls:["speed"]};return d==="retrospective"&&(["Run","Walk","Hike","Ride"].includes(n)?(s.controls=["distance","duration","incline","cadence"],n==="Ride"&&s.controls.push("power")):n==="Swim"?s.controls=["laps","poolLength","duration"]:n==="Workout"&&(s.controls=["duration"])),s})(),kt=t=>{let r={distance:{label:"Distance (km)",value:S.toFixed(2)},speed:{label:"Speed (km/h)",value:D.toFixed(1)},pace:{label:n==="Swim"?"Pace (sec/lap)":"Pace (min/km)",value:B>0?n==="Swim"?B:yt(B):"\u2014"},incline:{label:"Incline (%)",value:V.toFixed(1)},cadence:{label:n==="Run"?"Cadence (SPM)":"Cadence (RPM)",value:X},laps:{label:"Laps",value:_},poolLength:{label:"Pool Length (m)",value:K}}[t];return r?e.createElement("div",{className:"tvs-metric",key:t},e.createElement("label",null,r.label),e.createElement("div",{className:"tvs-metric-value"},r.value)):null},Nt=t=>{let r={distance:{label:"Distance (km)",value:S.toFixed(2),onDecrease:()=>O(Math.max(0,parseFloat((S-.1).toFixed(2)))),onIncrease:()=>O(parseFloat((S+.1).toFixed(2)))},duration:{label:"Duration (h:mm:ss)",value:ee(h),onDecrease:()=>H(Math.max(0,h-60)),onIncrease:()=>H(h+60)},speed:{label:"Speed (km/h)",value:D.toFixed(1),onDecrease:()=>me(Math.max(0,D-.5)),onIncrease:()=>me(D+.5)},incline:{label:"Incline (%)",value:V.toFixed(1)+"%",onDecrease:()=>ae(Math.max(-5,parseFloat((V-.5).toFixed(1)))),onIncrease:()=>ae(Math.min(15,parseFloat((V+.5).toFixed(1))))},cadence:{label:n==="Run"?"Cadence (SPM)":"Cadence (RPM)",value:X,onDecrease:()=>re(Math.max(0,X-5)),onIncrease:()=>re(X+5)},power:{label:"Power (W)",value:R,onDecrease:()=>ie(Math.max(0,R-10)),onIncrease:()=>ie(R+10)},laps:{label:"Laps",value:_,onDecrease:()=>de(Math.max(0,_-1)),onIncrease:()=>de(_+1)},poolLength:{label:"Pool Length (m)",value:K,onDecrease:()=>Ae(25),onIncrease:()=>Ae(50)}}[t];if(!r)return null;let f=ot===t,c=d==="retrospective";return e.createElement("div",{className:"tvs-control-row",key:t},e.createElement("label",null,r.label),e.createElement("div",{className:"tvs-control-buttons"},(t==="duration"||t==="distance")&&c&&e.createElement("button",{onClick:t==="duration"?()=>H(Math.max(0,h-1)):()=>O(Math.max(0,parseFloat((S-.01).toFixed(2)))),className:"tvs-btn-small"},t==="duration"?"\u22121s":"\u22120.01"),e.createElement("button",{onClick:r.onDecrease},"\u2212"),f?e.createElement("input",{type:"text",className:"tvs-inline-edit",value:ce,onChange:u=>ne(u.target.value),onBlur:()=>Te(t,ce),onKeyDown:u=>{u.key==="Enter"&&Te(t,ce),u.key==="Escape"&&(Me(null),ne(""))},autoFocus:!0,placeholder:t==="duration"?"h:mm:ss":r.value}):e.createElement("span",{onClick:c?()=>{Me(t),ne(t==="duration"?ee(h):t==="distance"?S.toFixed(2):t==="speed"?D.toFixed(1):t==="incline"?V.toFixed(1):String(r.value))}:null,className:c?"tvs-editable":"",title:c?"Click to edit":""},r.value),e.createElement("button",{onClick:r.onIncrease},"+"),(t==="duration"||t==="distance")&&c&&e.createElement("button",{onClick:t==="duration"?()=>H(h+1):()=>O(parseFloat((S+.01).toFixed(2))),className:"tvs-btn-small"},t==="duration"?"+1s":"+0.01")))};if(v==="select")return e.createElement("div",{className:"tvs-manual-tracker tvs-card",ref:ve},e.createElement("h3",{className:"tvs-tracker-title"},m),e.createElement("div",{className:"tvs-mode-selector"},e.createElement("button",{className:`tvs-mode-btn ${d==="live"?"active":""}`,onClick:()=>C("live")},"\u23F1\uFE0F Track Live",e.createElement("span",{className:"tvs-mode-desc"},"Real-time tracking")),e.createElement("button",{className:`tvs-mode-btn ${d==="retrospective"?"active":""}`,onClick:()=>C("retrospective")},"\u{1F4DD} Log Past Activity",e.createElement("span",{className:"tvs-mode-desc"},"Enter completed activity"))),w&&e.createElement("div",{className:"tvs-type-selector"},g.map(t=>e.createElement("button",{key:t,className:`tvs-type-btn ${n===t?"active":""}`,onClick:()=>M(t),disabled:P},Tt(t),e.createElement("span",null,t)))),e.createElement("button",{className:"tvs-btn tvs-btn-primary",onClick:()=>qe(n),disabled:P},P?"Starting...":`Start ${n}`));if(v==="tracking")return e.createElement("div",{className:"tvs-manual-tracker tvs-dashboard tvs-card",ref:ve},e.createElement("div",{className:"tvs-dashboard-header"},e.createElement("div",null,e.createElement("h3",{className:"tvs-tracker-title"},`${n} Activity`),e.createElement("span",{className:"tvs-badge tvs-badge-accent",style:{fontSize:"var(--tvs-text-xs)",marginTop:"var(--tvs-space-1)"}},d==="retrospective"?"\u{1F4DD} Retrospective":"\u23F1\uFE0F Live")),ct?e.createElement("input",{type:"text",className:"tvs-timer-edit",value:ce,onChange:t=>ne(t.target.value),onBlur:()=>{Te("duration",ce),Fe(!1)},onKeyDown:t=>{t.key==="Enter"&&(Te("duration",ce),Fe(!1)),t.key==="Escape"&&(Fe(!1),ne(""))},autoFocus:!0,placeholder:"h:mm:ss"}):e.createElement("div",{className:d==="retrospective"?"tvs-timer tvs-timer-editable":"tvs-timer",onClick:d==="retrospective"?()=>{Fe(!0),ne(ee(h))}:null,title:d==="retrospective"?"Click to edit time":""},ee(h))),e.createElement("div",{className:"tvs-metrics-grid"},Re.display.map(kt)),e.createElement("div",{className:"tvs-controls"},e.createElement("h4",null,"Adjust Metrics"),d==="retrospective"&&e.createElement("p",{className:"tvs-controls-hint"},"\u{1F4A1} Click on any value to edit directly"),Re.controls.map(Nt)),n==="Workout"&&e.createElement("div",{className:"tvs-workout-circuits"},e.createElement("h4",null,"Strength Training"),e.createElement("p",{className:"tvs-workout-hint"},"Organize your workout into circuits. Each circuit can have multiple exercises and rounds."),b.map(t=>e.createElement(rt,{key:t.id,circuit:t,isActive:t.id===mt,onUpdate:s=>{Ee(b.map(r=>r.id===s.id?s:r))},onRemove:s=>{let r=b.filter(f=>f.id!==s);if(Ee(r),r.length>0)we(r[0].id);else{let f={id:Date.now(),name:"Circuit 1",sets:1,exercises:[]};Ee([f]),we(f.id)}},onSetActive:we,canRemove:b.length>1})),e.createElement("button",{className:"tvs-btn tvs-btn-secondary tvs-btn-add-circuit",onClick:()=>{let t={id:Date.now(),name:`Circuit ${b.length+1}`,sets:1,exercises:[]};Ee([...b,t]),we(t.id)}},"+ Add Circuit"),(()=>{if(!b.some(c=>c.exercises.length>0))return null;let s=b.reduce((c,u)=>c+u.exercises.length,0),r=b.reduce((c,u)=>{let F=u.exercises.reduce((j,T)=>j+(T.metric_type==="reps"?T.reps:0),0);return c+F*u.sets},0),f=b.reduce((c,u)=>{let F=u.exercises.reduce((j,T)=>j+T.reps*T.weight,0);return c+F*u.sets},0);return e.createElement("div",{className:"tvs-workout-summary"},e.createElement("h5",null,"Workout Totals"),e.createElement("p",null,`\u{1F4CB} ${b.length} circuits \u2022 ${s} exercises`),r>0&&e.createElement("p",null,`\u{1F4AA} ${r} total reps`),f>0&&e.createElement("p",null,`\u{1F3CB}\uFE0F ${f.toFixed(1)}kg total volume`))})()),e.createElement("div",{className:"tvs-action-buttons"},d==="live"&&e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:bt,disabled:P},$?"\u25B6\uFE0F Resume":"\u23F8 Pause"),d==="live"&&e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:_e,disabled:P},"\u{1F4BE} Save Progress"),e.createElement("button",{className:"tvs-btn tvs-btn-danger",onClick:wt,disabled:P},"\u2715 Cancel"),e.createElement("button",{className:"tvs-btn tvs-btn-finish",onClick:()=>{if(n==="Workout"&&!b.some(s=>s.exercises.length>0)){typeof window.tvsFlash=="function"&&window.tvsFlash("\u26A0\uFE0F Add at least one exercise before finishing","error");return}d==="live"?(De(),Be(h),Ue(S),He(V),ze(X),Xe(R),Ye(_),x("calibration")):Z(!0)},disabled:P},P?"Finishing...":"\u2713 Finish Activity")),$&&e.createElement("div",{className:"tvs-paused-notice tvs-badge tvs-badge-primary"},"\u23F8 Activity paused"),lt&&e.createElement("div",{className:"tvs-modal-overlay",onClick:()=>Se(!1)},e.createElement("div",{className:"tvs-modal tvs-card",onClick:t=>t.stopPropagation()},e.createElement("h3",{className:"tvs-modal-title"},"\u26A0\uFE0F Cancel Activity?"),e.createElement("p",{className:"tvs-modal-text"},"Are you sure you want to cancel this activity? All data will be lost and cannot be recovered."),e.createElement("div",{className:"tvs-modal-actions"},e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:()=>Se(!1)},"Keep Activity"),e.createElement("button",{className:"tvs-btn tvs-btn-danger",onClick:gt},"\u2715 Cancel Activity")))),Oe&&e.createElement("div",{className:"tvs-modal-overlay",onClick:()=>Z(!1)},e.createElement("div",{className:"tvs-modal tvs-card",onClick:t=>t.stopPropagation()},e.createElement("h3",{className:"tvs-modal-title"},"\u{1F3C1} Finish Activity?"),e.createElement("p",{className:"tvs-modal-text"},`Are you sure you want to finish this ${n.toLowerCase()} activity?`),e.createElement("div",{className:"tvs-modal-summary"},e.createElement("div",null,`\u23F1 Duration: ${ee(h)}`),n!=="Workout"&&e.createElement("div",null,`\u{1F4CD} Distance: ${S.toFixed(2)} km`),n==="Swim"&&e.createElement("div",null,`\u{1F3CA} Laps: ${_}`),n==="Swim"&&B>0&&e.createElement("div",null,`\u26A1 Pace: ${B} sec/lap`),n==="Workout"&&e.createElement("div",null,`\u{1F4AA} Sets: ${sets} \xD7 ${reps} reps`)),e.createElement("div",{className:"tvs-modal-actions"},e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:()=>Z(!1)},"Go Back"),e.createElement("button",{className:"tvs-btn tvs-btn-finish",onClick:()=>{Z(!1),Qe()},disabled:P},"\u2713 Finish")))));if(v==="calibration"){let t=()=>{se({duration:ge,distance:Pe,incline:Ge,cadence:Ke,power:Je,laps:be}),Z(!0)},s=()=>{x("tracking"),d==="live"&&$e()},r=(f,c,u,F="",j=.01,T="number")=>e.createElement("div",{className:"tvs-calibration-field"},e.createElement("label",null,f),e.createElement("div",{className:"tvs-calibration-input-group"},e.createElement("input",{type:T,value:T==="text"?ee(c):c,onChange:et=>{if(T==="text"){let xt=Ze(et.target.value);u(xt)}else u(parseFloat(et.target.value)||0)},step:j,min:0,className:"tvs-calibration-input",placeholder:f}),F&&e.createElement("span",{className:"tvs-calibration-unit"},F)));return e.createElement("div",{className:"tvs-manual-tracker tvs-calibration",ref:ve},e.createElement("h3",null,"\u{1F3AF} Calibrate Your Results"),e.createElement("p",{className:"tvs-calibration-hint"},"Adjust values to match your equipment (treadmill, bike computer, watch, etc.)"),e.createElement("div",{className:"tvs-calibration-grid"},r("Duration",ge,Be,"",1,"text"),["Run","Walk","Hike","Ride"].includes(n)&&r("Distance",Pe,Ue,"km",.01),["Run","Walk","Hike","Ride"].includes(n)&&r("Incline",Ge,He,"%",.5),["Run","Walk","Hike","Ride"].includes(n)&&r("Cadence",Ke,ze,"spm",1),n==="Ride"&&r("Power",Je,Xe,"W",1),n==="Swim"&&r("Laps",be,Ye,"",1)),e.createElement("div",{className:"tvs-calibration-actions"},e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:s},"\u2190 Back to Tracking"),e.createElement("button",{className:"tvs-btn tvs-btn-finish",onClick:t},"\u2713 Confirm & Finish")),Oe&&e.createElement("div",{className:"tvs-modal-overlay",onClick:()=>Z(!1)},e.createElement("div",{className:"tvs-modal tvs-card",onClick:f=>f.stopPropagation()},e.createElement("h3",{className:"tvs-modal-title"},"\u{1F3C1} Finish Activity?"),e.createElement("p",{className:"tvs-modal-text"},`Are you sure you want to finish this ${n.toLowerCase()} activity with the calibrated values?`),e.createElement("div",{className:"tvs-modal-summary"},e.createElement("div",null,`\u23F1 Duration: ${ee(ge)}`),n!=="Workout"&&e.createElement("div",null,`\u{1F4CD} Distance: ${Pe.toFixed(2)} km`),n==="Swim"&&e.createElement("div",null,`\u{1F3CA} Laps: ${be}`),n==="Swim"&&be>0&&ge>0&&e.createElement("div",null,`\u26A1 Pace: ${Math.round(ge/be)} sec/lap`),n==="Workout"&&(()=>{let f=b.reduce((c,u)=>c+u.exercises.length,0);return f>0&&e.createElement("div",null,`\u{1F3CB}\uFE0F ${b.length} circuits \u2022 ${f} exercises`)})()),e.createElement("div",{className:"tvs-modal-actions"},e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:()=>Z(!1)},"Go Back"),e.createElement("button",{className:"tvs-btn tvs-btn-finish",onClick:()=>{Z(!1),Qe()},disabled:P},"\u2713 Finish")))))}if(v==="finished"){let t=[e.createElement("p",{key:"type"},`Type: ${n}`),e.createElement("p",{key:"duration"},`\u23F1 Duration: ${ee(h)}`)];if(n==="Workout"){let s=b.reduce((c,u)=>c+u.exercises.length,0),r=b.reduce((c,u)=>{let F=u.exercises.reduce((j,T)=>j+(T.metric_type==="reps"?T.reps:0),0);return c+F*u.sets},0),f=b.reduce((c,u)=>{let F=u.exercises.reduce((j,T)=>j+T.reps*T.weight,0);return c+F*u.sets},0);t.push(e.createElement("p",{key:"circuits"},`\u{1F3CB}\uFE0F ${b.length} circuits \u2022 ${s} exercises`)),r>0&&t.push(e.createElement("p",{key:"total"},`\u{1F501} Total reps: ${r}`)),f>0&&t.push(e.createElement("p",{key:"volume"},`\u{1F4CA} Total volume: ${f.toFixed(1)} kg`)),s>0&&t.push(e.createElement("div",{key:"circuit-list",className:"tvs-summary-circuits"},b.map((c,u)=>c.exercises.length>0&&e.createElement("div",{key:u,className:"tvs-summary-circuit"},e.createElement("h4",null,`${c.name} (${c.sets} ${c.sets===1?"round":"rounds"})`),c.exercises.map((F,j)=>e.createElement("div",{key:j,className:"tvs-summary-exercise"},`${j+1}. ${F.name} (${F.reps}${F.metric_type==="time"?"s":""}${F.weight>0?` @ ${F.weight}kg`:""})`))))))}else if(n==="Swim")t.push(e.createElement("p",{key:"laps"},`\u{1F3CA} Laps: ${_}`),e.createElement("p",{key:"pool"},`\u{1F4CF} Pool Length: ${K}m`),e.createElement("p",{key:"distance"},`\u{1F4CD} Distance: ${(_*K/1e3).toFixed(2)} km`)),B>0&&t.push(e.createElement("p",{key:"pace"},`\u26A1 Avg Pace: ${B} sec/lap`));else{if(t.push(e.createElement("p",{key:"distance"},`\u{1F4CD} Distance: ${S.toFixed(2)} km`)),S>0&&h>0){let s=(S/(h/3600)).toFixed(1);t.push(e.createElement("p",{key:"speed"},`\u26A1 Avg Speed: ${s} km/h`))}V>0&&t.push(e.createElement("p",{key:"incline"},`\u26F0\uFE0F Incline: ${V.toFixed(1)}%`))}return e.createElement("div",{className:"tvs-manual-tracker tvs-finished",ref:ve},e.createElement("h3",null,"\u{1F389} Activity Saved!"),e.createElement("div",{className:"tvs-summary"},t),e.createElement("div",{className:"tvs-finished-actions"},l&&e.createElement("a",{href:l,className:"tvs-btn tvs-btn-primary"},"View Activity"),a&&e.createElement("button",{className:"tvs-btn tvs-btn-strava",onClick:Et,disabled:q},q?"Uploading...":e.createElement(e.Fragment,null,e.createElement("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",style:{marginRight:"8px",verticalAlign:"middle"}},e.createElement("path",{d:"M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"})),"Upload to Strava")),e.createElement("button",{className:"tvs-btn tvs-btn-secondary",onClick:()=>{x("select"),L(null),H(0),O(0),me(0),he(0),ae(0),re(0),ie(0),de(0),setSets(0),setReps(0)}},"Start Another Activity")))}return null}function Tt(e){return{Run:"\u{1F3C3}",Ride:"\u{1F6B4}",Walk:"\u{1F6B6}",Hike:"\u{1F97E}",Swim:"\u{1F3CA}",Workout:"\u{1F4AA}"}[e]||"\u{1F3C3}"}function it(){document.querySelectorAll(".tvs-manual-activity-tracker").forEach((m,w)=>{if(!m.__tvsMounted){let g=m.id||`tvs-manual-tracker-${w}`;m.id||(m.id=g),pe&&Ne("Mounting ManualActivityTracker block (view.js) on:",g);let I=m.getAttribute("data-title")||"Start Activity",N=m.getAttribute("data-show-type-selector")==="1",v=m.getAttribute("data-allowed-types")||"[]",x=JSON.parse(v),d=m.getAttribute("data-auto-start")==="1",C=m.getAttribute("data-default-type")||"Run";st(je,{React:y,title:I,showTypeSelector:N,allowedTypes:x,autoStart:d,defaultType:C},m),m.__tvsMounted=!0}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",it):it();})();
//# sourceMappingURL=tvs-block-manual-activity-tracker.js.map
