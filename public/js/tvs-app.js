(()=>{var t2=Object.create;var S1=Object.defineProperty;var C2=Object.getOwnPropertyDescriptor;var r2=Object.getOwnPropertyNames;var i2=Object.getPrototypeOf,a2=Object.prototype.hasOwnProperty;var y1=(t,C)=>()=>(C||t((C={exports:{}}).exports,C),C.exports);var e2=(t,C,r,i)=>{if(C&&typeof C=="object"||typeof C=="function")for(let e of r2(C))!a2.call(t,e)&&e!==r&&S1(t,e,{get:()=>C[e],enumerable:!(i=C2(C,e))||i.enumerable});return t};var b1=(t,C,r)=>(r=t!=null?t2(i2(t)):{},e2(C||!t||!t.__esModule?S1(r,"default",{value:t,enumerable:!0}):r,t));var G1=y1(n=>{"use strict";var q=Symbol.for("react.element"),L2=Symbol.for("react.portal"),n2=Symbol.for("react.fragment"),o2=Symbol.for("react.strict_mode"),M2=Symbol.for("react.profiler"),g2=Symbol.for("react.provider"),Z2=Symbol.for("react.context"),l2=Symbol.for("react.forward_ref"),c2=Symbol.for("react.suspense"),u2=Symbol.for("react.memo"),d2=Symbol.for("react.lazy"),D1=Symbol.iterator;function p2(t){return t===null||typeof t!="object"?null:(t=D1&&t[D1]||t["@@iterator"],typeof t=="function"?t:null)}var U1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E1=Object.assign,I1={};function W(t,C,r){this.props=t,this.context=C,this.refs=I1,this.updater=r||U1}W.prototype.isReactComponent={};W.prototype.setState=function(t,C){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,C,"setState")};W.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function N1(){}N1.prototype=W.prototype;function g1(t,C,r){this.props=t,this.context=C,this.refs=I1,this.updater=r||U1}var Z1=g1.prototype=new N1;Z1.constructor=g1;E1(Z1,W.prototype);Z1.isPureReactComponent=!0;var T1=Array.isArray,_1=Object.prototype.hasOwnProperty,l1={current:null},O1={key:!0,ref:!0,__self:!0,__source:!0};function W1(t,C,r){var i,e={},a=null,V=null;if(C!=null)for(i in C.ref!==void 0&&(V=C.ref),C.key!==void 0&&(a=""+C.key),C)_1.call(C,i)&&!O1.hasOwnProperty(i)&&(e[i]=C[i]);var g=arguments.length-2;if(g===1)e.children=r;else if(1<g){for(var o=Array(g),M=0;M<g;M++)o[M]=arguments[M+2];e.children=o}if(t&&t.defaultProps)for(i in g=t.defaultProps,g)e[i]===void 0&&(e[i]=g[i]);return{$$typeof:q,type:t,key:a,ref:V,props:e,_owner:l1.current}}function h2(t,C){return{$$typeof:q,type:t.type,key:C,ref:t.ref,props:t.props,_owner:t._owner}}function c1(t){return typeof t=="object"&&t!==null&&t.$$typeof===q}function v2(t){var C={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return C[r]})}var A1=/\/+/g;function M1(t,C){return typeof t=="object"&&t!==null&&t.key!=null?v2(""+t.key):C.toString(36)}function a1(t,C,r,i,e){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var V=!1;if(t===null)V=!0;else switch(a){case"string":case"number":V=!0;break;case"object":switch(t.$$typeof){case q:case L2:V=!0}}if(V)return V=t,e=e(V),t=i===""?"."+M1(V,0):i,T1(e)?(r="",t!=null&&(r=t.replace(A1,"$&/")+"/"),a1(e,C,r,"",function(M){return M})):e!=null&&(c1(e)&&(e=h2(e,r+(!e.key||V&&V.key===e.key?"":(""+e.key).replace(A1,"$&/")+"/")+t)),C.push(e)),1;if(V=0,i=i===""?".":i+":",T1(t))for(var g=0;g<t.length;g++){a=t[g];var o=i+M1(a,g);V+=a1(a,C,r,o,e)}else if(o=p2(t),typeof o=="function")for(t=o.call(t),g=0;!(a=t.next()).done;)a=a.value,o=i+M1(a,g++),V+=a1(a,C,r,o,e);else if(a==="object")throw C=String(t),Error("Objects are not valid as a React child (found: "+(C==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":C)+"). If you meant to render a collection of children, use an array instead.");return V}function i1(t,C,r){if(t==null)return t;var i=[],e=0;return a1(t,i,"","",function(a){return C.call(r,a,e++)}),i}function x2(t){if(t._status===-1){var C=t._result;C=C(),C.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=C)}if(t._status===1)return t._result.default;throw t._result}var d={current:null},e1={transition:null},s2={ReactCurrentDispatcher:d,ReactCurrentBatchConfig:e1,ReactCurrentOwner:l1};n.Children={map:i1,forEach:function(t,C,r){i1(t,function(){C.apply(this,arguments)},r)},count:function(t){var C=0;return i1(t,function(){C++}),C},toArray:function(t){return i1(t,function(C){return C})||[]},only:function(t){if(!c1(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};n.Component=W;n.Fragment=n2;n.Profiler=M2;n.PureComponent=g1;n.StrictMode=o2;n.Suspense=c2;n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=s2;n.cloneElement=function(t,C,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=E1({},t.props),e=t.key,a=t.ref,V=t._owner;if(C!=null){if(C.ref!==void 0&&(a=C.ref,V=l1.current),C.key!==void 0&&(e=""+C.key),t.type&&t.type.defaultProps)var g=t.type.defaultProps;for(o in C)_1.call(C,o)&&!O1.hasOwnProperty(o)&&(i[o]=C[o]===void 0&&g!==void 0?g[o]:C[o])}var o=arguments.length-2;if(o===1)i.children=r;else if(1<o){g=Array(o);for(var M=0;M<o;M++)g[M]=arguments[M+2];i.children=g}return{$$typeof:q,type:t.type,key:e,ref:a,props:i,_owner:V}};n.createContext=function(t){return t={$$typeof:Z2,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:g2,_context:t},t.Consumer=t};n.createElement=W1;n.createFactory=function(t){var C=W1.bind(null,t);return C.type=t,C};n.createRef=function(){return{current:null}};n.forwardRef=function(t){return{$$typeof:l2,render:t}};n.isValidElement=c1;n.lazy=function(t){return{$$typeof:d2,_payload:{_status:-1,_result:t},_init:x2}};n.memo=function(t,C){return{$$typeof:u2,type:t,compare:C===void 0?null:C}};n.startTransition=function(t){var C=e1.transition;e1.transition={};try{t()}finally{e1.transition=C}};n.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};n.useCallback=function(t,C){return d.current.useCallback(t,C)};n.useContext=function(t){return d.current.useContext(t)};n.useDebugValue=function(){};n.useDeferredValue=function(t){return d.current.useDeferredValue(t)};n.useEffect=function(t,C){return d.current.useEffect(t,C)};n.useId=function(){return d.current.useId()};n.useImperativeHandle=function(t,C,r){return d.current.useImperativeHandle(t,C,r)};n.useInsertionEffect=function(t,C){return d.current.useInsertionEffect(t,C)};n.useLayoutEffect=function(t,C){return d.current.useLayoutEffect(t,C)};n.useMemo=function(t,C){return d.current.useMemo(t,C)};n.useReducer=function(t,C,r){return d.current.useReducer(t,C,r)};n.useRef=function(t){return d.current.useRef(t)};n.useState=function(t){return d.current.useState(t)};n.useSyncExternalStore=function(t,C,r){return d.current.useSyncExternalStore(t,C,r)};n.useTransition=function(){return d.current.useTransition()};n.version="18.2.0"});var u1=y1((A2,j1)=>{"use strict";j1.exports=G1()});var O=new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1";function c(...t){O&&console.debug("[TVS]",...t)}function u(...t){console.error("[TVS]",...t)}var k1=!!(window.React&&window.ReactDOM),H2=!!(window.wp&&window.wp.element),T=H2?window.wp.element:{},y=k1?window.React:T||{},S=k1?window.ReactDOM:T||null,n1=new WeakMap,V2=S&&typeof S.createRoot=="function"||T&&typeof T.createRoot=="function";function P1(t,C,r){try{let i=n1.get(r);if(i&&typeof i.unmount=="function"?(i.unmount(),n1.delete(r)):S&&typeof S.unmountComponentAtNode=="function"&&S.unmountComponentAtNode(r),V2){let V=(S&&S.createRoot||T&&T.createRoot)(r);n1.set(r,V),V.render(y.createElement(t,C));return}let e=S&&S.render||T&&T.render;if(e){e(y.createElement(t,C),r);return}u("Ingen render-funksjon tilgjengelig.")}catch(i){u("Mount feilet:",i)}}function K(t){return new Promise(C=>setTimeout(C,t))}async function r1(t,C,r="operation"){let i;try{return await Promise.race([t,new Promise((e,a)=>{i=setTimeout(()=>a(new Error(r+" timed out")),C)})])}finally{clearTimeout(i)}}function o1({React:t,currentTime:C,duration:r}){let i=t.createElement,e=Math.floor(C/60),a=Math.floor(C%60),V=(o,M)=>o+":"+(M<10?"0":"")+M,g=r>0?C/r*100:0;return i("div",{className:"tvs-progress"},i("div",{className:"tvs-progress__bar"},i("div",{className:"tvs-progress__fill",style:{width:Math.min(g,100)+"%"}})),i("div",{className:"tvs-progress__time"},V(e,a)+" / "+V(Math.floor(r/60),Math.floor(r%60))))}var G=b1(u1());var d1=b1(u1()),p1={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},h1=d1.default.createContext&&d1.default.createContext(p1);var A=function(){return A=Object.assign||function(t){for(var C,r=1,i=arguments.length;r<i;r++){C=arguments[r];for(var e in C)Object.prototype.hasOwnProperty.call(C,e)&&(t[e]=C[e])}return t},A.apply(this,arguments)},f2=function(t,C){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&C.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var e=0,i=Object.getOwnPropertySymbols(t);e<i.length;e++)C.indexOf(i[e])<0&&Object.prototype.propertyIsEnumerable.call(t,i[e])&&(r[i[e]]=t[i[e]]);return r};function z1(t){return t&&t.map(function(C,r){return G.default.createElement(C.tag,A({key:r},C.attr),z1(C.child))})}function H1(t){return function(C){return G.default.createElement(w2,A({attr:A({},t.attr)},C),z1(t.child))}}function w2(t){var C=function(r){var i=t.attr,e=t.size,a=t.title,V=f2(t,["attr","size","title"]),g=e||r.size||"1em",o;return r.className&&(o=r.className),t.className&&(o=(o?o+" ":"")+t.className),G.default.createElement("svg",A({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,i,V,{className:o,style:A(A({color:t.color||r.color},r.style),t.style),height:g,width:g,xmlns:"http://www.w3.org/2000/svg"}),a&&G.default.createElement("title",null,a),t.children)};return h1!==void 0?G.default.createElement(h1.Consumer,null,function(r){return C(r)}):C(p1)}function K1(t){return H1({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M18.5374 19.5674C16.7844 21.0831 14.4993 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 14.1361 21.3302 16.1158 20.1892 17.7406L17 12H20C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C14.1502 20 16.1022 19.1517 17.5398 17.7716L18.5374 19.5674Z"}}]})(t)}function v1(t){return H1({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M9.82986 8.78986L7.99998 9.45588V13H5.99998V8.05H6.015L11.2834 6.13247C11.5274 6.03855 11.7922 5.99162 12.0648 6.0008C13.1762 6.02813 14.1522 6.75668 14.4917 7.82036C14.678 8.40431 14.848 8.79836 15.0015 9.0025C15.9138 10.2155 17.3653 11 19 11V13C16.8253 13 14.8823 12.0083 13.5984 10.4526L12.9008 14.4085L15 16.17V23H13V17.1025L10.7307 15.1984L10.003 19.3253L3.10938 18.1098L3.45667 16.1401L8.38071 17.0084L9.82986 8.78986ZM13.5 5.5C12.3954 5.5 11.5 4.60457 11.5 3.5C11.5 2.39543 12.3954 1.5 13.5 1.5C14.6046 1.5 15.5 2.39543 15.5 3.5C15.5 4.60457 14.6046 5.5 13.5 5.5Z"}}]})(t)}function q1(t){return H1({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 22C4 17.5817 7.58172 14 12 14C16.4183 14 20 17.5817 20 22H18C18 18.6863 15.3137 16 12 16C8.68629 16 6 18.6863 6 22H4ZM12 13C8.685 13 6 10.315 6 7C6 3.685 8.685 1 12 1C15.315 1 18 3.685 18 7C18 10.315 15.315 13 12 13ZM12 11C14.21 11 16 9.21 16 7C16 4.79 14.21 3 12 3C9.79 3 8 4.79 8 7C8 9.21 9.79 11 12 11Z"}}]})(t)}function x1(){let t=y.createElement;return t("div",{className:"tvs-loading",role:"status","aria-live":"polite"},t("svg",{viewBox:"0 0 64 64",className:"tvs-runner","aria-hidden":"true"},t("line",{x1:4,y1:60,x2:60,y2:60,stroke:"#bbb",strokeWidth:2,className:"track"}),t("circle",{cx:26,cy:12,r:5,fill:"none",stroke:"#111",strokeWidth:2}),t("line",{x1:26,y1:17,x2:26,y2:35,stroke:"#111",strokeWidth:2}),t("line",{x1:26,y1:22,x2:40,y2:18,stroke:"#111",strokeWidth:2,className:"arm front",style:{transformOrigin:"26px 22px"}}),t("line",{x1:26,y1:22,x2:12,y2:26,stroke:"#111",strokeWidth:2,className:"arm back",style:{transformOrigin:"26px 22px"}}),t("line",{x1:26,y1:35,x2:40,y2:48,stroke:"#111",strokeWidth:2,className:"leg front",style:{transformOrigin:"26px 35px"}}),t("line",{x1:26,y1:35,x2:16,y2:54,stroke:"#111",strokeWidth:2,className:"leg back",style:{transformOrigin:"26px 35px"}})),t("div",null,t("div",{className:"tvs-skel line"}),t("div",{className:"tvs-skel line sm"}),t("div",null,t("span",{className:"tvs-skel block"}),t("span",{className:"tvs-skel block"}),t("span",{className:"tvs-skel block"}))))}function s1({React:t,routeId:C,lastStatus:r,lastError:i,currentTime:e,duration:a}){let{useEffect:V,useRef:g,useState:o,createElement:M}=t;function s(E){let{useEffect:P,useRef:Z,useState:_}=E,[D,B]=_(0),I=Z(performance.now()),v=Z(0);return P(()=>{let R,x=N=>{v.current+=1,N-I.current>=1e3&&(B(v.current),v.current=0,I.current=N),R=requestAnimationFrame(x)};return R=requestAnimationFrame(x),()=>cancelAnimationFrame(R)},[]),D}let b=s(t),Q=g(null),[U,j]=o(!1),[k,w1]=o({x:16,y:16});V(()=>{if(!Q.current)return;let P,Z,_,D,B=!1;function I(x){x.target.closest(".tvs-dev__header")&&(B=!0,P=x.clientX,Z=x.clientY,_=k.x,D=k.y,x.preventDefault())}function v(x){B&&w1({x:_+(x.clientX-P),y:D+(x.clientY-Z)})}function R(){B=!1}return window.addEventListener("mousedown",I),window.addEventListener("mousemove",v),window.addEventListener("mouseup",R),()=>{window.removeEventListener("mousedown",I),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",R)}},[k]);let Y=a>0?(e/a*100).toFixed(1):"0.0",h={env:window.TVS_SETTINGS?.env,version:window.TVS_SETTINGS?.version,restRoot:window.TVS_SETTINGS?.restRoot,user:window.TVS_SETTINGS?.user,routeId:C,lastStatus:r||"idle",lastError:i?String(i):null,currentTime:e?e.toFixed(1):"0.0",duration:a||0,progress:Y+"%",fps:b};function f(E,P,Z){return M("div",{className:"tvs-dev__row"},M("span",null,E),M("code",{className:Z?"tvs-dev__err":""},P))}function B1(){navigator.clipboard.writeText(JSON.stringify({...h,time:new Date().toISOString()},null,2)).catch(console.error)}return M("div",{ref:Q,className:`tvs-dev ${U?"is-min":""}`,style:{left:k.x+"px",top:k.y+"px"}},M("div",{className:"tvs-dev__header"},M("strong",null,"TVS Dev"),M("div",{className:"tvs-dev__spacer"}),M("span",{className:"tvs-dev__pill"},h.env||"n/a"),M("button",{className:"tvs-dev__btn",onClick:()=>j(!U),"aria-label":"Minimize"},"\u2581")),M("div",{className:"tvs-dev__body"},f("Route",h.routeId??"n/a"),f("User",h.user??"guest"),f("REST",h.restRoot??"n/a"),f("Status",h.lastStatus),h.lastError?f("Error",h.lastError,!0):null,f("Duration",h.duration+"s"),f("Current",h.currentTime+"s"),f("Progress",h.progress),f("FPS",String(h.fps)),M("div",{className:"tvs-dev__actions"},M("button",{onClick:B1,className:"tvs-dev__btn"},"Copy debug"),M("button",{onClick:()=>{localStorage.setItem("tvsDev","0"),location.reload()},className:"tvs-dev__btn tvs-dev__btn--ghost"},"Disable"))))}var $=Number(new URLSearchParams(location.search).get("tvsslow")||0);function f1({initialData:t,routeId:C}){let{useEffect:r,useState:i,useRef:e,createElement:a}=y,[V,g]=i(t||null),[o,M]=i(null),[s,b]=i(!1),[Q,U]=i(!1),[j,k]=i(null),[w1,Y]=i([]),[h,f]=i(!1),[B1,E]=i(null),[P,Z]=i(t?"inline":"loading"),[_,D]=i(null),[B,I]=i(0),[v,R]=i(!1),x=e(null),N=e(null);function w(L,H="success"){typeof window.tvsFlash=="function"&&window.tvsFlash(L,H)}r(()=>{let L=new URLSearchParams(location.search).get("tvsforcefetch")==="1";if(V&&!L){c("Har inline payload, skipper fetch.",V);return}if(!C){M("Mangler routeId \u2013 hverken inline payload eller data-route-id.");return}(async()=>{try{c("Henter rute via REST:",C," (tvsslow:",$,"ms)"),Z("loading"),$&&await K($);let l=await(await fetch(`/wp-json/tvs/v1/routes/${encodeURIComponent(C)}`,{credentials:"same-origin"})).json();c("REST OK:",l),g(l),Z("ok")}catch(H){u("REST FAIL:",H),M("Kunne ikke hente rutedata."),D(H?.message||String(H)),Z("error")}})()},[C]),r(()=>{V1()},[]);async function V1(){try{f(!0);let H=await fetch("/wp-json/tvs/v1/activities/me",{credentials:"same-origin",headers:{"X-TVS-Nonce":window.TVS_SETTINGS?.nonce||""}});if(!H.ok)throw new Error("Failed to load activities");let l=await H.json(),m=Array.isArray(l)?l:l.activities||[];Y(m)}catch(L){u("Load activities FAIL:",L),Y([])}finally{f(!1)}}r(()=>{if(!V)return;let L=x.current;if(!L)return;let H=null,l=!1;function m(){return new Promise((p,C1)=>{if(window.Vimeo&&window.Vimeo.Player)return p();let z=document.querySelector('script[src="https://player.vimeo.com/api/player.js"]');if(z){z.addEventListener("load",()=>p()),z.addEventListener("error",()=>C1(new Error("Vimeo API failed to load")));return}let F=document.createElement("script");F.src="https://player.vimeo.com/api/player.js",F.async=!0,F.onload=()=>p(),F.onerror=()=>C1(new Error("Vimeo API failed to load")),document.head.appendChild(F)})}return(async()=>{try{if(await m(),l)return;H=new window.Vimeo.Player(L),N.current=H,c("Vimeo Player constructed"),H.getDuration().catch(()=>{});try{await H.ready(),l||(R(!0),c("Vimeo Player ready"))}catch(p){u("Vimeo ready() rejected:",p)}H.on("timeupdate",p=>{typeof p?.seconds=="number"&&I(p.seconds)})}catch{u("Vimeo API init failed")}})(),()=>{l=!0;try{H&&H.off&&H.off("timeupdate"),H&&H.destroy&&H.destroy()}catch{}N.current=null,R(!1)}},[V]);async function X(L=8e3){let H=Date.now();for(;Date.now()-H<L;){let l=N.current;if(l)try{return await l.ready(),R(!0),l}catch{}await K(100)}throw new Error("Video player is not ready")}function Q1(L){let H=V?.meta||{},l=Number(H.duration_s||0),m=Number(H.distance_m||0);if(l>0&&m>0&&L>=0){let p=Math.min(1,L/l);return Math.round(m*p)}return 0}async function R1(){try{b(!0),c("Start clicked");let L=await X();Z("starting");try{await r1(L.play(),4e3,"play()"),c("Playback started")}catch(H){throw u("play() failed:",H),w("Could not start playback: "+(H?.message||String(H)),"error"),H}try{let H=await r1(L.getCurrentTime(),1500,"getCurrentTime");typeof H=="number"&&H>.5?(await K(150),await r1(L.setCurrentTime(0),2e3,"setCurrentTime(0)"),c("Seeked to 0")):c("Already at start, skipping seek")}catch(H){c("Post-play seek skipped:",H?.message||String(H))}k(new Date),U(!0),Z("running"),w("Activity started")}catch(L){u("Start session failed:",L),w("Player not ready yet. Please wait a moment and try again.","error"),Z("error")}finally{b(!1)}}async function Y1(){try{b(!0),c("Resume clicked");let L=await X();Z("starting");try{await L.play(),c("Playback resumed")}catch(H){throw u("resume play() failed:",H),w("Could not resume playback: "+(H?.message||String(H)),"error"),H}U(!0),Z("running"),w("Activity resumed")}catch(L){u("Resume session failed:",L),w("Player not ready yet. Please wait a moment and try again.","error"),Z("error")}finally{b(!1)}}async function X1(){try{c("Pause clicked");let L=await X();try{await L.pause(),c("Playback paused")}catch(H){throw u("pause() failed:",H),w("Failed to pause: "+(H?.message||String(H)),"error"),H}U(!1),Z("paused"),w("Activity paused")}catch(L){u("[TVS] Pause failed:",L),Z("error")}}async function F1(){try{b(!0),c("Finish clicked");let L=await X();Z("saving");try{await L.pause(),c("Playback paused before save")}catch(L1){u("pause before save failed:",L1)}let H=await L.getCurrentTime(),l=Math.max(0,Math.floor(H||0)),m=j?j.toISOString():new Date(Date.now()-l*1e3).toISOString(),p=Q1(l),C1={route_id:V.id,route_name:V.title||"Unknown Route",activity_date:new Date().toISOString(),started_at:m,duration_s:l,distance_m:p},z=window.TVS_SETTINGS?.nonce||"";$&&await K($);let F=await fetch("/wp-json/tvs/v1/activities",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":z},credentials:"same-origin",body:JSON.stringify(C1)});if(!F.ok){let L1=await F.json();throw new Error(L1.message||`HTTP ${F.status}`)}await F.json(),w("Activity saved!"),Z("ok"),U(!1),k(null),await V1(),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(L){u("[TVS] Save activity failed:",L),w("Failed to save activity: "+(L?.message||String(L)),"error"),D(L?.message||String(L)),Z("error")}finally{b(!1)}}async function B2(L){try{E(L),Z("uploading");let H=await fetch(`/wp-json/tvs/v1/activities/${L}/strava`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},credentials:"same-origin"}),l=await H.json();if(!H.ok)throw new Error(l.message||"Upload failed");w("Uploaded to Strava!"),Z("ok"),await V1(),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(H){u("Strava upload FAIL:",H),w("Failed to upload to Strava: "+(H?.message||String(H)),"error"),D(H?.message||String(H)),Z("error")}finally{E(null)}}if(o)return a("div",{className:"tvs-route tvs-error"},String(o));if(!V)return y.createElement(x1,null);let R2=V.title||"Route",J=V.meta||{},m1=J.vimeo_id?String(J.vimeo_id):"",t1=Number(J.duration_s||0),J1=!!window.TVS_SETTINGS?.user;return a("div",{className:"tvs-app"},a("div",{className:"tvs-panel tvs-app__container"},m1?a("div",{className:"tvs-video"},a("iframe",{ref:x,width:560,height:315,src:"https://player.vimeo.com/video/"+encodeURIComponent(m1)+"?controls=0&title=0&byline=0&portrait=0&pip=0&playsinline=1&dnt=1&transparent=0&muted=0",frameBorder:0,allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0})):null,new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1"?a("div",{className:"tvs-meta"},a("pre",null,JSON.stringify(J,null,2))):null,a(o1,{React:y,currentTime:B,duration:t1}),a("div",{className:"tvs-btns"},J1?Q?[a("button",{key:"pause",className:"tvs-btn tvs-btn--warning",onClick:X1,disabled:s||!v,"aria-label":"Pause activity",title:"Pause activity"},a(q1,{"aria-hidden":!0})),a("button",{key:"finish",className:"tvs-btn tvs-btn--success",onClick:F1,disabled:s||!v,"aria-label":"Finish and save activity",title:"Finish and save activity"},s?a("span",{className:"tvs-spinner","aria-hidden":"true"}):"\u2714")]:B>0&&j&&(t1===0||B<t1-.5)?[a("button",{key:"resume",className:"tvs-btn tvs-btn--primary",onClick:Y1,disabled:s||!v,"aria-label":"Resume activity",title:"Resume activity"},s?a("span",{className:"tvs-spinner","aria-hidden":"true"}):a(v1,{"aria-hidden":!0})),a("button",{key:"finish",className:"tvs-btn tvs-btn--success",onClick:F1,disabled:s||!v,"aria-label":"Finish and save activity",title:"Finish and save activity"},s?a("span",{className:"tvs-spinner","aria-hidden":"true"}):"\u2714"),a("button",{key:"restart",className:"tvs-btn tvs-btn--outline",onClick:R1,disabled:s||!v,"aria-label":"Restart from beginning",title:"Restart from beginning"},a(K1,{"aria-hidden":!0}))]:a("button",{className:"tvs-btn tvs-btn--primary",onClick:R1,disabled:s||!v,"aria-label":"Start activity",title:"Start activity"},s?a("span",{className:"tvs-spinner","aria-hidden":"true"}):a(v1,{"aria-hidden":!0})):a("div",{className:"tvs-alert tvs-alert--warning"},a("div",{className:"tvs-row tvs-mb-2"},a("span",{className:"tvs-badge tvs-badge-warning"},"Warning"),a("strong",null," You must be logged in")),a("p",null,"Please ",a("a",{href:"/login"},"log in")," to create activities and upload to Strava. Don't have an account? ",a("a",{href:"/register"},"Register here"),".")))),O?a(s1,{React:y,routeId:C,lastStatus:P,lastError:_,currentTime:B,duration:t1}):null)}O||document.addEventListener("keydown",t=>{if(t.key==="`"){try{localStorage.setItem("tvsDev","1")}catch{}location.reload()}});function $1(){let t=document.getElementById("tvs-app-root");if(t){let C=window.tvs_route_payload||null,r=t.getAttribute("data-route-id")||C&&C.id;c("Boot \u2192 routeId:",r,"inline payload:",!!C),P1(f1,{initialData:C,routeId:r},t)}}O?c("Debug mode enabled."):document.addEventListener("keydown",function(t){if(t.key==="`"){let C=new URL(location.href);C.searchParams.set("tvsdebug","1"),location.href=C.toString()}});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",$1):$1();})();
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
//# sourceMappingURL=tvs-app.js.map
