(()=>{var J4=Object.create;var i4=Object.defineProperty;var t3=Object.getOwnPropertyDescriptor;var c3=Object.getOwnPropertyNames;var r3=Object.getPrototypeOf,a3=Object.prototype.hasOwnProperty;var l4=(t,a)=>()=>(a||t((a={exports:{}}).exports,a),a.exports);var i3=(t,a,l,i)=>{if(a&&typeof a=="object"||typeof a=="function")for(let e of c3(a))!a3.call(t,e)&&e!==l&&i4(t,e,{get:()=>a[e],enumerable:!(i=t3(a,e))||i.enumerable});return t};var C4=(t,a,l)=>(l=t!=null?J4(r3(t)):{},i3(a||!t||!t.__esModule?i4(l,"default",{value:t,enumerable:!0}):l,t));var p4=l4(x=>{"use strict";var C2=Symbol.for("react.element"),e3=Symbol.for("react.portal"),o3=Symbol.for("react.fragment"),h3=Symbol.for("react.strict_mode"),n3=Symbol.for("react.profiler"),v3=Symbol.for("react.provider"),H3=Symbol.for("react.context"),d3=Symbol.for("react.forward_ref"),V3=Symbol.for("react.suspense"),L3=Symbol.for("react.memo"),g3=Symbol.for("react.lazy"),h4=Symbol.iterator;function u3(t){return t===null||typeof t!="object"?null:(t=h4&&t[h4]||t["@@iterator"],typeof t=="function"?t:null)}var H4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},d4=Object.assign,V4={};function K1(t,a,l){this.props=t,this.context=a,this.refs=V4,this.updater=l||H4}K1.prototype.isReactComponent={};K1.prototype.setState=function(t,a){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,a,"setState")};K1.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function L4(){}L4.prototype=K1.prototype;function O2(t,a,l){this.props=t,this.context=a,this.refs=V4,this.updater=l||H4}var U2=O2.prototype=new L4;U2.constructor=O2;d4(U2,K1.prototype);U2.isPureReactComponent=!0;var n4=Array.isArray,g4=Object.prototype.hasOwnProperty,I2={current:null},u4={key:!0,ref:!0,__self:!0,__source:!0};function M4(t,a,l){var i,e={},c=null,g=null;if(a!=null)for(i in a.ref!==void 0&&(g=a.ref),a.key!==void 0&&(c=""+a.key),a)g4.call(a,i)&&!u4.hasOwnProperty(i)&&(e[i]=a[i]);var z=arguments.length-2;if(z===1)e.children=l;else if(1<z){for(var M=Array(z),Z=0;Z<z;Z++)M[Z]=arguments[Z+2];e.children=M}if(t&&t.defaultProps)for(i in z=t.defaultProps,z)e[i]===void 0&&(e[i]=z[i]);return{$$typeof:C2,type:t,key:c,ref:g,props:e,_owner:I2.current}}function M3(t,a){return{$$typeof:C2,type:t.type,key:a,ref:t.ref,props:t.props,_owner:t._owner}}function N2(t){return typeof t=="object"&&t!==null&&t.$$typeof===C2}function p3(t){var a={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(l){return a[l]})}var v4=/\/+/g;function E2(t,a){return typeof t=="object"&&t!==null&&t.key!=null?p3(""+t.key):a.toString(36)}function p2(t,a,l,i,e){var c=typeof t;(c==="undefined"||c==="boolean")&&(t=null);var g=!1;if(t===null)g=!0;else switch(c){case"string":case"number":g=!0;break;case"object":switch(t.$$typeof){case C2:case e3:g=!0}}if(g)return g=t,e=e(g),t=i===""?"."+E2(g,0):i,n4(e)?(l="",t!=null&&(l=t.replace(v4,"$&/")+"/"),p2(e,a,l,"",function(Z){return Z})):e!=null&&(N2(e)&&(e=M3(e,l+(!e.key||g&&g.key===e.key?"":(""+e.key).replace(v4,"$&/")+"/")+t)),a.push(e)),1;if(g=0,i=i===""?".":i+":",n4(t))for(var z=0;z<t.length;z++){c=t[z];var M=i+E2(c,z);g+=p2(c,a,l,M,e)}else if(M=u3(t),typeof M=="function")for(t=M.call(t),z=0;!(c=t.next()).done;)c=c.value,M=i+E2(c,z++),g+=p2(c,a,l,M,e);else if(c==="object")throw a=String(t),Error("Objects are not valid as a React child (found: "+(a==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.");return g}function M2(t,a,l){if(t==null)return t;var i=[],e=0;return p2(t,i,"","",function(c){return a.call(l,c,e++)}),i}function s3(t){if(t._status===-1){var a=t._result;a=a(),a.then(function(l){(t._status===0||t._status===-1)&&(t._status=1,t._result=l)},function(l){(t._status===0||t._status===-1)&&(t._status=2,t._result=l)}),t._status===-1&&(t._status=0,t._result=a)}if(t._status===1)return t._result.default;throw t._result}var j={current:null},s2={transition:null},x3={ReactCurrentDispatcher:j,ReactCurrentBatchConfig:s2,ReactCurrentOwner:I2};x.Children={map:M2,forEach:function(t,a,l){M2(t,function(){a.apply(this,arguments)},l)},count:function(t){var a=0;return M2(t,function(){a++}),a},toArray:function(t){return M2(t,function(a){return a})||[]},only:function(t){if(!N2(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};x.Component=K1;x.Fragment=o3;x.Profiler=n3;x.PureComponent=O2;x.StrictMode=h3;x.Suspense=V3;x.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=x3;x.cloneElement=function(t,a,l){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=d4({},t.props),e=t.key,c=t.ref,g=t._owner;if(a!=null){if(a.ref!==void 0&&(c=a.ref,g=I2.current),a.key!==void 0&&(e=""+a.key),t.type&&t.type.defaultProps)var z=t.type.defaultProps;for(M in a)g4.call(a,M)&&!u4.hasOwnProperty(M)&&(i[M]=a[M]===void 0&&z!==void 0?z[M]:a[M])}var M=arguments.length-2;if(M===1)i.children=l;else if(1<M){z=Array(M);for(var Z=0;Z<M;Z++)z[Z]=arguments[Z+2];i.children=z}return{$$typeof:C2,type:t.type,key:e,ref:c,props:i,_owner:g}};x.createContext=function(t){return t={$$typeof:H3,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:v3,_context:t},t.Consumer=t};x.createElement=M4;x.createFactory=function(t){var a=M4.bind(null,t);return a.type=t,a};x.createRef=function(){return{current:null}};x.forwardRef=function(t){return{$$typeof:d3,render:t}};x.isValidElement=N2;x.lazy=function(t){return{$$typeof:g3,_payload:{_status:-1,_result:t},_init:s3}};x.memo=function(t,a){return{$$typeof:L3,type:t,compare:a===void 0?null:a}};x.startTransition=function(t){var a=s2.transition;s2.transition={};try{t()}finally{s2.transition=a}};x.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};x.useCallback=function(t,a){return j.current.useCallback(t,a)};x.useContext=function(t){return j.current.useContext(t)};x.useDebugValue=function(){};x.useDeferredValue=function(t){return j.current.useDeferredValue(t)};x.useEffect=function(t,a){return j.current.useEffect(t,a)};x.useId=function(){return j.current.useId()};x.useImperativeHandle=function(t,a,l){return j.current.useImperativeHandle(t,a,l)};x.useInsertionEffect=function(t,a){return j.current.useInsertionEffect(t,a)};x.useLayoutEffect=function(t,a){return j.current.useLayoutEffect(t,a)};x.useMemo=function(t,a){return j.current.useMemo(t,a)};x.useReducer=function(t,a,l){return j.current.useReducer(t,a,l)};x.useRef=function(t){return j.current.useRef(t)};x.useState=function(t){return j.current.useState(t)};x.useSyncExternalStore=function(t,a,l){return j.current.useSyncExternalStore(t,a,l)};x.useTransition=function(){return j.current.useTransition()};x.version="18.2.0"});var G2=l4((O3,s4)=>{"use strict";s4.exports=p4()});var _1=new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1";function A(...t){_1&&console.debug("[TVS]",...t)}function N(...t){console.error("[TVS]",...t)}var e4=!!(window.React&&window.ReactDOM),l3=!!(window.wp&&window.wp.element),w1=l3?window.wp.element:{},r1=e4?window.React:w1||{},u1=e4?window.ReactDOM:w1||null,T2=new WeakMap,C3=u1&&typeof u1.createRoot=="function"||w1&&typeof w1.createRoot=="function";function o4(t,a,l){try{let i=T2.get(l);if(i&&typeof i.unmount=="function"?(i.unmount(),T2.delete(l)):u1&&typeof u1.unmountComponentAtNode=="function"&&u1.unmountComponentAtNode(l),C3){let g=(u1&&u1.createRoot||w1&&w1.createRoot)(l);T2.set(l,g),g.render(r1.createElement(t,a));return}let e=u1&&u1.render||w1&&w1.render;if(e){e(r1.createElement(t,a),l);return}N("Ingen render-funksjon tilgjengelig.")}catch(i){N("Mount feilet:",i)}}function j1(t){return new Promise(a=>setTimeout(a,t))}async function u2(t,a,l="operation"){let i;try{return await Promise.race([t,new Promise((e,c)=>{i=setTimeout(()=>c(new Error(l+" timed out")),a)})])}finally{clearTimeout(i)}}function P2({React:t,currentTime:a,duration:l}){let i=t.createElement,e=Math.floor(a/60),c=Math.floor(a%60),g=(M,Z)=>M+":"+(Z<10?"0":"")+Z,z=l>0?a/l*100:0;return i("div",{className:"tvs-progress"},i("div",{className:"tvs-progress__bar"},i("div",{className:"tvs-progress__fill",style:{width:Math.min(z,100)+"%"}})),i("div",{className:"tvs-progress__time"},g(e,c)+" / "+g(Math.floor(l/60),Math.floor(l%60))))}var Q1=C4(G2(),1);var q2=C4(G2(),1),W2={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},_2=q2.default.createContext&&q2.default.createContext(W2);var Z3=["attr","size","title"];function f3(t,a){if(t==null)return{};var l=z3(t,a),i,e;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(e=0;e<c.length;e++)i=c[e],!(a.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(t,i)&&(l[i]=t[i])}return l}function z3(t,a){if(t==null)return{};var l={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){if(a.indexOf(i)>=0)continue;l[i]=t[i]}return l}function x2(){return x2=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var l=arguments[a];for(var i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i])}return t},x2.apply(this,arguments)}function x4(t,a){var l=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);a&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),l.push.apply(l,i)}return l}function Z2(t){for(var a=1;a<arguments.length;a++){var l=arguments[a]!=null?arguments[a]:{};a%2?x4(Object(l),!0).forEach(function(i){m3(t,i,l[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(l)):x4(Object(l)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(l,i))})}return t}function m3(t,a,l){return a=w3(a),a in t?Object.defineProperty(t,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):t[a]=l,t}function w3(t){var a=B3(t,"string");return typeof a=="symbol"?a:a+""}function B3(t,a){if(typeof t!="object"||!t)return t;var l=t[Symbol.toPrimitive];if(l!==void 0){var i=l.call(t,a||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function Z4(t){return t&&t.map((a,l)=>Q1.default.createElement(a.tag,Z2({key:l},a.attr),Z4(a.child)))}function y(t){return a=>Q1.default.createElement(F3,x2({attr:Z2({},t.attr)},a),Z4(t.child))}function F3(t){var a=l=>{var{attr:i,size:e,title:c}=t,g=f3(t,Z3),z=e||l.size||"1em",M;return l.className&&(M=l.className),t.className&&(M=(M?M+" ":"")+t.className),Q1.default.createElement("svg",x2({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},l.attr,i,g,{className:M,style:Z2(Z2({color:t.color||l.color},l.style),t.style),height:z,width:z,xmlns:"http://www.w3.org/2000/svg"}),c&&Q1.default.createElement("title",null,c),t.children)};return _2!==void 0?Q1.default.createElement(_2.Consumer,null,l=>a(l)):a(W2)}function f4(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"},child:[]}]})(t)}function z4(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M11.9999 10.8284L7.0502 15.7782L5.63599 14.364L11.9999 8L18.3639 14.364L16.9497 15.7782L11.9999 10.8284Z"},child:[]}]})(t)}function f2(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M18.5374 19.5674C16.7844 21.0831 14.4993 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 14.1361 21.3302 16.1158 20.1892 17.7406L17 12H20C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C14.1502 20 16.1022 19.1517 17.5398 17.7716L18.5374 19.5674Z"},child:[]}]})(t)}function j2(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M7 19V13H17V19H19V7.82843L16.1716 5H5V19H7ZM4 3H17L21 7V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM9 15V19H15V15H9Z"},child:[]}]})(t)}function m4(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M20 22H4C3.44772 22 3 21.5523 3 21V3C3 2.44772 3.44772 2 4 2H20C20.5523 2 21 2.44772 21 3V21C21 21.5523 20.5523 22 20 22ZM19 20V4H5V20H19ZM8 7H16V9H8V7ZM8 11H16V13H8V11ZM8 15H16V17H8V15Z"},child:[]}]})(t)}function w4(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM16.5 7.5L10 10L7.5 16.5L14 14L16.5 7.5ZM12 13C11.4477 13 11 12.5523 11 12C11 11.4477 11.4477 11 12 11C12.5523 11 13 11.4477 13 12C13 12.5523 12.5523 13 12 13Z"},child:[]}]})(t)}function B4(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM15.5 8.5L13.5 13.5L8.5 15.5L10.5 10.5L15.5 8.5Z"},child:[]}]})(t)}function F4(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 20.8995L16.9497 15.9497C19.6834 13.2161 19.6834 8.78392 16.9497 6.05025C14.2161 3.31658 9.78392 3.31658 7.05025 6.05025C4.31658 8.78392 4.31658 13.2161 7.05025 15.9497L12 20.8995ZM12 23.7279L5.63604 17.364C2.12132 13.8492 2.12132 8.15076 5.63604 4.63604C9.15076 1.12132 14.8492 1.12132 18.364 4.63604C21.8787 8.15076 21.8787 13.8492 18.364 17.364L12 23.7279ZM12 13C13.1046 13 14 12.1046 14 11C14 9.89543 13.1046 9 12 9C10.8954 9 10 9.89543 10 11C10 12.1046 10.8954 13 12 13ZM12 15C9.79086 15 8 13.2091 8 11C8 8.79086 9.79086 7 12 7C14.2091 7 16 8.79086 16 11C16 13.2091 14.2091 15 12 15Z"},child:[]}]})(t)}function z2(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M18 7H22V9H16V3H18V7ZM8 9H2V7H6V3H8V9ZM18 17V21H16V15H22V17H18ZM8 15V21H6V17H2V15H8Z"},child:[]}]})(t)}function $1(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8 3V5H4V9H2V3H8ZM2 21V15H4V19H8V21H2ZM22 21H16V19H20V15H22V21ZM22 9H20V5H16V3H22V9Z"},child:[]}]})(t)}function m2(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM9 9H11V15H9V9ZM13 9H15V15H13V9Z"},child:[]}]})(t)}function Y1(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM10.6219 8.41459L15.5008 11.6672C15.6846 11.7897 15.7343 12.0381 15.6117 12.2219C15.5824 12.2658 15.5447 12.3035 15.5008 12.3328L10.6219 15.5854C10.4381 15.708 10.1897 15.6583 10.0672 15.4745C10.0234 15.4088 10 15.3316 10 15.2526V8.74741C10 8.52649 10.1791 8.34741 10.4 8.34741C10.479 8.34741 10.5562 8.37078 10.6219 8.41459Z"},child:[]}]})(t)}function R4(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M17 18.4142L21.1925 22.6067L22.6067 21.1925L2.80769 1.39349L1.39348 2.80771L2.58579 4.00001H2C1.44772 4.00001 1 4.44773 1 5.00001V19C1 19.5523 1.44772 20 2 20H16C16.5523 20 17 19.5523 17 19V18.4142ZM15 16.4142V18H3V6.00001H4.58579L15 16.4142ZM23 18.0397C23 18.2517 22.875 18.4176 22.7083 18.4943L21 16.786V8.84133L17 11.6413V12.786L15 10.786V6.00001H10.214L8.21402 4.00001H16C16.5523 4.00001 17 4.44773 17 5.00001V9.20001L22.2133 5.55073C22.5447 5.31876 23 5.55583 23 5.96034V18.0397Z"},child:[]}]})(t)}function A4(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M17 9.2L22.2133 5.55071C22.4395 5.39235 22.7513 5.44737 22.9096 5.6736C22.9684 5.75764 23 5.85774 23 5.96033V18.0397C23 18.3158 22.7761 18.5397 22.5 18.5397C22.3974 18.5397 22.2973 18.5081 22.2133 18.4493L17 14.8V19C17 19.5523 16.5523 20 16 20H2C1.44772 20 1 19.5523 1 19V5C1 4.44772 1.44772 4 2 4H16C16.5523 4 17 4.44772 17 5V9.2ZM17 12.3587L21 15.1587V8.84131L17 11.6413V12.3587ZM3 6V18H15V6H3Z"},child:[]}]})(t)}function S4(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M11 11V5H13V11H19V13H13V19H11V13H5V11H11Z"},child:[]}]})(t)}function y4(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M5 11V13H19V11H5Z"},child:[]}]})(t)}function D4(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748ZM10 10V7H12V10H15V12H12V15H10V12H7V10H10Z"},child:[]}]})(t)}function b4(t){return y({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748ZM7 10H15V12H7V10Z"},child:[]}]})(t)}function K2(){let t=r1.createElement;return t("div",{className:"tvs-loading",role:"status","aria-live":"polite"},t("svg",{viewBox:"0 0 64 64",className:"tvs-runner","aria-hidden":"true"},t("line",{x1:4,y1:60,x2:60,y2:60,stroke:"#bbb",strokeWidth:2,className:"track"}),t("circle",{cx:26,cy:12,r:5,fill:"none",stroke:"#111",strokeWidth:2}),t("line",{x1:26,y1:17,x2:26,y2:35,stroke:"#111",strokeWidth:2}),t("line",{x1:26,y1:22,x2:40,y2:18,stroke:"#111",strokeWidth:2,className:"arm front",style:{transformOrigin:"26px 22px"}}),t("line",{x1:26,y1:22,x2:12,y2:26,stroke:"#111",strokeWidth:2,className:"arm back",style:{transformOrigin:"26px 22px"}}),t("line",{x1:26,y1:35,x2:40,y2:48,stroke:"#111",strokeWidth:2,className:"leg front",style:{transformOrigin:"26px 35px"}}),t("line",{x1:26,y1:35,x2:16,y2:54,stroke:"#111",strokeWidth:2,className:"leg back",style:{transformOrigin:"26px 35px"}})),t("div",null,t("div",{className:"tvs-skel line"}),t("div",{className:"tvs-skel line sm"}),t("div",null,t("span",{className:"tvs-skel block"}),t("span",{className:"tvs-skel block"}),t("span",{className:"tvs-skel block"}))))}function Q2({React:t,routeId:a,lastStatus:l,lastError:i,currentTime:e,duration:c}){let{useEffect:g,useRef:z,useState:M,createElement:Z}=t;function a1(X){let{useEffect:G,useRef:J,useState:F}=X,[L,p]=F(0),R=J(performance.now()),K=J(0);return G(()=>{let D,U=Q=>{K.current+=1,Q-R.current>=1e3&&(p(K.current),K.current=0,R.current=Q),D=requestAnimationFrame(U)};return D=requestAnimationFrame(U),()=>cancelAnimationFrame(D)},[]),L}let M1=a1(t),b1=z(null),[Y,B1]=M(!1),[n1,w2]=M({x:16,y:16});g(()=>{if(!b1.current)return;let G,J,F,L,p=!1;function R(U){U.target.closest(".tvs-dev__header")&&(p=!0,G=U.clientX,J=U.clientY,F=n1.x,L=n1.y,U.preventDefault())}function K(U){p&&w2({x:F+(U.clientX-G),y:L+(U.clientY-J)})}function D(){p=!1}return window.addEventListener("mousedown",R),window.addEventListener("mousemove",K),window.addEventListener("mouseup",D),()=>{window.removeEventListener("mousedown",R),window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",D)}},[n1]);let X1=c>0?(e/c*100).toFixed(1):"0.0",O={env:window.TVS_SETTINGS?.env,version:window.TVS_SETTINGS?.version,restRoot:window.TVS_SETTINGS?.restRoot,user:window.TVS_SETTINGS?.user,routeId:a,lastStatus:l||"idle",lastError:i?String(i):null,currentTime:e?e.toFixed(1):"0.0",duration:c||0,progress:X1+"%",fps:M1};function m(X,G,J){return Z("div",{className:"tvs-dev__row"},Z("span",null,X),Z("code",{className:J?"tvs-dev__err":""},G))}function F1(){navigator.clipboard.writeText(JSON.stringify({...O,time:new Date().toISOString()},null,2)).catch(console.error)}return Z("div",{ref:b1,className:`tvs-dev ${Y?"is-min":""}`,style:{left:n1.x+"px",top:n1.y+"px"}},Z("div",{className:"tvs-dev__header"},Z("strong",null,"TVS Dev"),Z("div",{className:"tvs-dev__spacer"}),Z("span",{className:"tvs-dev__pill"},O.env||"n/a"),Z("button",{className:"tvs-dev__btn",onClick:()=>B1(!Y),"aria-label":"Minimize"},"\u2581")),Z("div",{className:"tvs-dev__body"},m("Route",O.routeId??"n/a"),m("User",O.user??"guest"),m("REST",O.restRoot??"n/a"),m("Status",O.lastStatus),O.lastError?m("Error",O.lastError,!0):null,m("Duration",O.duration+"s"),m("Current",O.currentTime+"s"),m("Progress",O.progress),m("FPS",String(O.fps)),Z("div",{className:"tvs-dev__actions"},Z("button",{onClick:F1,className:"tvs-dev__btn"},"Copy debug"),Z("button",{onClick:()=>{localStorage.setItem("tvsDev","0"),location.reload()},className:"tvs-dev__btn tvs-dev__btn--ghost"},"Disable"))))}function k4(t){return y({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 320h-96c-17.6 0-32-14.4-32-32s14.4-32 32-32h96s96-107 96-160-43-96-96-96-96 43-96 96c0 25.5 22.2 63.4 45.3 96H320c-52.9 0-96 43.1-96 96s43.1 96 96 96h96c17.6 0 32 14.4 32 32s-14.4 32-32 32H185.5c-16 24.8-33.8 47.7-47.3 64H416c52.9 0 96-43.1 96-96s-43.1-96-96-96zm0-256c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zM96 256c-53 0-96 43-96 96s96 160 96 160 96-107 96-160-43-96-96-96zm0 128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(t)}function T4(t){return y({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"},child:[]}]})(t)}var P4={FaLandmark:"\u{1F3DB}\uFE0F",FaTheaterMasks:"\u{1F3AD}",FaFortAwesome:"\u{1F3F0}",FaChurch:"\u26EA",FaTrain:"\u{1F689}",FaTree:"\u{1F333}",FaMountain:"\u{1F3D4}\uFE0F",FaWater:"\u{1F4A7}",FaBridge:"\u{1F309}",FaMonument:"\u{1F5FF}",FaUniversity:"\u{1F393}",FaHospital:"\u{1F3E5}",FaStore:"\u{1F3EA}",FaCoffee:"\u2615",FaCamera:"\u{1F4F7}"};function $2({routeData:t,routeId:a}){let{useEffect:l,useState:i,useRef:e,createElement:c}=r1,g=window.TVS_SETTINGS?.mapbox||{},{accessToken:z="",style:M="mapbox://styles/mapbox/satellite-streets-v12",initialZoom:Z=14,flyToZoom:a1=16,minZoom:M1=10,maxZoom:b1=18,pitch:Y=60,bearing:B1=0,defaultSpeed:n1=1,cameraOffset:w2=2e-4,smoothFactor:X1=.7,markerColor:O="#ff0000",routeColor:m="#ec4899",routeWidth:F1=6,terrainEnabled:X=!1,terrainExaggeration:G=1.5,buildings3dEnabled:J=!1}=g,F=new URLSearchParams(window.location.search).get("debug")==="1",L=(...r)=>{F&&console.log("[VirtualTraining]",...r)};function p(r,o="success"){typeof window.tvsFlash=="function"&&window.tvsFlash(r,o)}let[R,K]=i(!0),[D,U]=i(12),[Q,v1]=i(!1),[i1,B2]=i(!0),[$,p1]=i(!0),[k1,T1]=i(!0),[P,J1]=i(null),[s1,R1]=i(0),[P1,o2]=i(0),[x1,k]=i(0),[A1,t2]=i(0),[h2,E1]=i(0),[Z1,O1]=i(!1),[F2,c2]=i(!1),[n2,f1]=i(""),[l1,U1]=i(""),[C1,I1]=i(!1),[H1,C]=i("Run"),h=e(null),V=e(null),S=e(null),H=e(null),z1=e(null),e1=e(null),t1=e(null),W=e(i1),d1=e($),S1=e(D),y1=e(null),N1=e(null),D1=e(null),r2=e(0),m1=e(null),a2=e(null),G1=e(null),v2=e(null),H2=e(null),R2=e(null),[X2,O4]=i([]),[U4,A2]=i(!1),d2=r=>{G1.current&&(clearTimeout(G1.current),G1.current=null),r===null&&a2.current!==null?(A2(!0),G1.current=setTimeout(()=>{a2.current=null,J1(null),A2(!1)},300)):(A2(!1),a2.current=r,J1(r))},V2=t?.meta?.gpx_url||"",J2=t?.title||"Route",i2=t?.mapbox_token||"",[S2,t4]=i(0),V1=S2>0?S2:t?.meta?.distance_km||0,y2=V1>0&&D>0?Math.round(V1/D*60):0;l(()=>{W.current=i1},[i1]),l(()=>{d1.current=$},[$]),l(()=>{S1.current=D},[D]),l(()=>{F&&(console.log("\u{1F30D} window.TVS_SETTINGS:",window.TVS_SETTINGS),console.log("\u{1F4E6} window.TVS_SETTINGS.mapbox:",window.TVS_SETTINGS?.mapbox),console.log("\u{1F4CA} mapboxSettings object:",g),console.log("\u{1F527} Mapbox Settings:",{hasSettings:!!window.TVS_SETTINGS?.mapbox,style:M,initialZoom:Z,pitch:Y,terrainEnabled:X,terrainExaggeration:G,markerColor:O,routeColor:m,routeWidth:F1}))},[]);function l2(r,o,d,v){let s=(d-r)*Math.PI/180,n=(v-o)*Math.PI/180,u=Math.sin(s/2)*Math.sin(s/2)+Math.cos(r*Math.PI/180)*Math.cos(d*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 6371*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))}function I4(r,o,d,v){let E=(v-o)*Math.PI/180,s=Math.sin(E)*Math.cos(d*Math.PI/180),n=Math.cos(r*Math.PI/180)*Math.sin(d*Math.PI/180)-Math.sin(r*Math.PI/180)*Math.cos(d*Math.PI/180)*Math.cos(E);return(Math.atan2(s,n)*180/Math.PI+360)%360}function N4(r,o,d,v){if(!d||d.length===0)return 0;let E=0,s=1/0;d.forEach((u,o1)=>{let _=l2(u.lat,u.lng,o,r);_<s&&(s=_,E=o1)});let n=0;for(let u=0;u<E&&u<d.length-1;u++)n+=l2(d[u].lat,d[u].lng,d[u+1].lat,d[u+1].lng);return n}l(()=>{!a||m1.current||(async()=>{try{L("\u{1F4CA} Pre-loading route distance for routeId:",a);let r=await fetch(`/wp-json/tvs/v1/routes/${a}/gpx-data`);if(!r.ok){console.error("\u274C Failed to pre-fetch GPX data:",r.status,r.statusText);return}let o=await r.json();if(!o.points||o.points.length===0){console.error("\u274C No GPS points in GPX data");return}m1.current=o;let d=0;for(let v=0;v<o.points.length-1;v++)d+=l2(o.points[v].lat,o.points[v].lng,o.points[v+1].lat,o.points[v+1].lng);L("\u2705 Pre-calculated distance:",d.toFixed(2),"km"),t4(d)}catch(r){console.error("\u274C Failed to pre-load distance:",r)}})()},[a]),l(()=>{a&&(L("\u{1F4CD} Fetching PoI data..."),(async()=>{try{let r=await fetch(`/wp-json/tvs/v1/routes/${a}/pois`);if(!r.ok){L("\u26A0\uFE0F No PoI data available:",r.status);return}let o=await r.json();L("\u2705 Loaded PoIs:",o.length,"items");let d=o.map(v=>({id:v.id,name:v.name,description:v.description||"",triggerDistanceMeters:v.trigger_distance_m||150,hideDistanceMeters:v.hide_distance_m||100,lng:v.lng,lat:v.lat,icon:v.icon||"\u{1F4CD}",color:v.color||"#8b5cf6",imageUrl:v.image_url||null,imageThumbnail:v.image_thumbnail||null,customIconUrl:v.custom_icon_url||null,iconType:v.icon_type||"library"}));O4(d)}catch(r){console.error("\u274C Failed to load PoI data:",r)}})())},[a]),l(()=>()=>{G1.current&&clearTimeout(G1.current)},[]),l(()=>{if(!H2.current||!m1.current?.points){F&&console.log("Elevation chart: missing canvas or GPX data",{hasCanvas:!!H2.current,hasGpxData:!!m1.current,hasPoints:!!m1.current?.points});return}let r=H2.current,o=r.getContext("2d"),d=m1.current.points;F&&console.log("Drawing elevation chart with",d.length,"points");let v=r.width,E=r.height;o.clearRect(0,0,v,E);let s=d.map(_=>_.ele||0).filter(_=>_>0);if(s.length===0){F&&console.log("No elevation data found in GPX points");return}F&&console.log("Elevation range:",Math.min(...s),"-",Math.max(...s));let n=Math.min(...s),o1=Math.max(...s)-n;if(o1===0){F&&console.log("Elevation range is 0, cannot draw chart");return}o.beginPath(),o.strokeStyle="#667eea",o.lineWidth=2,o.fillStyle="rgba(102, 126, 234, 0.2)",d.forEach((_,L1)=>{if(!_.ele)return;let B=L1/(d.length-1)*v,f=E-(_.ele-n)/o1*E;L1===0?o.moveTo(B,f):o.lineTo(B,f)}),o.lineTo(v,E),o.lineTo(0,E),o.closePath(),o.fill(),o.beginPath(),d.forEach((_,L1)=>{if(!_.ele)return;let B=L1/(d.length-1)*v,f=E-(_.ele-n)/o1*E;L1===0?o.moveTo(B,f):o.lineTo(B,f)}),o.stroke(),F&&console.log("Elevation chart drawn successfully")},[R]),l(()=>{if(!R){if(!V2||!window.mapboxgl||!h.current||!i2){L("\u23F3 Waiting for map initialization:",{gpxUrl:!!V2,mapboxgl:!!window.mapboxgl,mapRef:!!h.current,mapboxToken:!!i2,isWelcome:R});return}return L("\u{1F5FA}\uFE0F Initializing map..."),(async()=>{try{let r=m1.current;if(r)L("\u267B\uFE0F Using cached GPX data");else{L("\u{1F4E5} Fetching GPX data from REST endpoint...");let d=await fetch(`/wp-json/tvs/v1/routes/${a}/gpx-data`);if(!d.ok){console.error("\u274C Failed to fetch GPX data:",d.status,d.statusText),p("Failed to load route data. Please refresh the page.","error");return}r=await d.json(),m1.current=r}if(L("\u{1F4E6} GPX data ready:",{points:r.points?.length,first:r.points?.[0],last:r.points?.[r.points?.length-1],gpxUrl:V2}),!r.points||r.points.length===0){console.error("\u274C No GPS points in GPX data"),p("No GPS data found for this route.","error");return}if(S2===0){let d=0;for(let v=0;v<r.points.length-1;v++)d+=l2(r.points[v].lat,r.points[v].lng,r.points[v+1].lat,r.points[v+1].lng);L("\u2705 Calculated distance during map init:",d.toFixed(2),"km"),t4(d)}window.mapboxgl.accessToken=i2||z;let o=new window.mapboxgl.Map({container:h.current,style:M,center:[r.points[0].lng,r.points[0].lat],zoom:Z,pitch:Y,bearing:B1,minZoom:M1,maxZoom:b1});V.current=o,o.on("load",()=>{if(L("\u{1F6E0}\uFE0F Map loaded, attempting to create GSAP timeline..."),X&&(L("\u{1F3D4}\uFE0F Enabling 3D terrain with exaggeration:",G),o.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),o.setTerrain({source:"mapbox-dem",exaggeration:G})),J){L("\u{1F3E2} Enabling 3D buildings");let n=o.getStyle().layers.find(u=>u.type==="symbol"&&u.layout["text-field"])?.id;o.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","min_height"],"fill-extrusion-opacity":.6}},n)}let d=r.points.map(s=>[s.lng,s.lat]);o.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:d}}}),o.addLayer({id:"route-line",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":m,"line-width":F1,"line-opacity":1}}),e1.current="route-line",o.addSource("completed-route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[r.points[0].lng,r.points[0].lat]]}}}),o.addLayer({id:"completed-route-line",type:"line",source:"completed-route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#84cc16","line-width":F1,"line-opacity":1}}),z1.current="completed-route-line";let v=document.createElement("div");v.className="virtual-training-marker",v.style.width="20px",v.style.height="20px",v.style.borderRadius="50%",v.style.backgroundColor=O,v.style.border="3px solid white",v.style.boxShadow="0 0 10px rgba(0,0,0,0.5)";let E=new window.mapboxgl.Marker(v).setLngLat([r.points[0].lng,r.points[0].lat]).addTo(o);if(S.current=E,X2.forEach(s=>{let n=document.createElement("div");if(n.className="poi-marker",n.style.width="40px",n.style.height="40px",n.style.borderRadius="50%",n.style.backgroundColor=s.color||"#8b5cf6",n.style.border="3px solid white",n.style.boxShadow="0 2px 6px rgba(0,0,0,0.3)",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.cursor="pointer",s.iconType==="custom"&&s.customIconUrl){n.style.fontSize="0",n.style.padding="6px";let u=document.createElement("img");u.src=s.customIconUrl,u.style.width="100%",u.style.height="100%",u.style.objectFit="contain",u.style.filter="drop-shadow(0 1px 2px rgba(0,0,0,0.3))",n.appendChild(u)}else{let u=P4[s.icon]||s.icon||"\u{1F4CD}";n.style.fontSize="20px",n.style.textShadow="0 1px 2px rgba(0,0,0,0.3)",n.innerHTML=u}new window.mapboxgl.Marker(n).setLngLat([s.lng,s.lat]).addTo(o)}),window.gsap){!r.points||r.points.length<2?console.warn("\u274C Not enough route points for animation!"):L("\u2705 Enough route points, initializing smooth timeline...",r.points.length);let s=r.distance_km/D*3600;L("\u{1F552} Timeline duration (s):",s);let n=[0];for(let B=1;B<r.points.length;B++){let f=l2(r.points[B-1].lat,r.points[B-1].lng,r.points[B].lat,r.points[B].lng);n.push(n[B-1]+f)}let u=n[n.length-1];L("\u{1F4CF} Total distance from points:",u.toFixed(3),"km");let o1={lng:r.points[0].lng,lat:r.points[0].lat},_={bearing:0},L1=window.gsap.timeline({paused:!0,onUpdate:()=>{let B=L1.progress()*u,f=0;for(let w=0;w<n.length-1;w++)if(B>=n[w]&&B<=n[w+1]){f=w;break}let g2=0;if(f<n.length-1){let w=n[f],b=n[f+1]-w;b>0&&(g2=(B-w)/b)}let q1,W1;if(f<r.points.length-1?(q1=r.points[f].lng+(r.points[f+1].lng-r.points[f].lng)*g2,W1=r.points[f].lat+(r.points[f+1].lat-r.points[f].lat)*g2):(q1=r.points[r.points.length-1].lng,W1=r.points[r.points.length-1].lat),S.current&&S.current.setLngLat([q1,W1]),d1.current&&f<r.points.length-1){let T=Math.min(B+.02,u),b=f;for(let q=f;q<n.length-1;q++)if(T>=n[q]&&T<=n[q+1]){b=q;break}let c1=0;if(b<n.length-1){let q=n[b],a4=n[b+1]-q;a4>0&&(c1=(T-q)/a4)}let g1,I;b<r.points.length-1?(g1=r.points[b].lng+(r.points[b+1].lng-r.points[b].lng)*c1,I=r.points[b].lat+(r.points[b+1].lat-r.points[b].lat)*c1):(g1=r.points[r.points.length-1].lng,I=r.points[r.points.length-1].lat);let h1=I4(W1,q1,I,g1);if(v2.current!==null){let q=h1-v2.current;q>180&&(q-=360),q<-180&&(q+=360),h1=v2.current+q*.15}_.bearing=h1,v2.current=h1}W.current&&V.current&&V.current.jumpTo({center:[q1,W1],bearing:d1.current?_.bearing:0});let b2=r.points.slice(0,f+1).map(w=>[w.lng,w.lat]);if(b2.push([q1,W1]),b2.length>0&&V.current&&V.current.getSource("completed-route")?.setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:b2}}),R1(B),R2.current&&u>0){let w=B/u*100;R2.current.style.left=`${w}%`,F&&Math.random()<.01&&console.log("Marker position:",w.toFixed(2)+"%")}if(r.points[f]?.ele!==void 0){let w=r.points[f].ele;f<r.points.length-1&&r.points[f+1]?.ele!==void 0&&(w=r.points[f].ele+(r.points[f+1].ele-r.points[f].ele)*g2),o2(Math.round(w));let b=Math.min(B+.2,u),c1=0,g1=0;for(let I=f;I<r.points.length-1;I++){let h1=n[I],q=n[I+1];if(h1>b)break;q<=b&&r.points[I]?.ele!==void 0&&r.points[I+1]?.ele!==void 0&&(c1+=r.points[I+1].ele-r.points[I].ele,g1++)}if(g1>0){let I=(b-B)*1e3;if(I>0){let h1=c1/I*100;k(Math.round(h1))}}}let k2=0;N1.current&&(k2=(Date.now()-N1.current-r2.current)/1e3,t2(k2));let X4=u-B,r4=S1.current;if(r4>0){let w=X4/r4*3600,T=k2+w;E1(T)}X2.forEach(w=>{let T=N4(w.lng,w.lat,r.points,f),b=(w.triggerDistanceMeters||150)/1e3,c1=(w.hideDistanceMeters||100)/1e3,g1=B>=T-b&&B<=T,I=B>T&&B<=T+c1,h1=B>T+c1;g1||I?a2.current?.id!==w.id&&(L("\u2705 Showing PoI:",w.name,{currentDist:B.toFixed(2),poiDist:T.toFixed(2),phase:g1?"approaching":"passed",triggerRange:`${(T-b).toFixed(2)} - ${T.toFixed(2)}`,hideRange:`${T.toFixed(2)} - ${(T+c1).toFixed(2)}`}),d2(w)):a2.current?.id===w.id&&h1&&(L("\u274C Hiding PoI:",w.name,{currentDist:B.toFixed(2),poiDist:T.toFixed(2),hideThreshold:(T+c1).toFixed(2)}),d2(null))})}});L1.to(o1,{lng:r.points[r.points.length-1].lng,lat:r.points[r.points.length-1].lat,duration:s,ease:"none"},0),H.current=L1,y1.current=D,L("\u{1F3AC} GSAP smooth timeline created:",{keyframes:1}),L("\u{1F4CD} timelineRef.current set:",!!H.current),L("\u26A1 Initial speed stored:",D)}})}catch(r){console.error("\u274C Failed to load GPX data:",r),p("Error loading route data: "+r.message,"error")}})(),()=>{V.current&&V.current.remove(),H.current&&H.current.kill()}}},[V2,a,i2,R]);function G4(){L("\u25B6\uFE0F Start Training clicked"),L("  - Timeline exists:",!!H.current),L("  - Map exists:",!!V.current),L("  - Marker exists:",!!S.current),L("  - GSAP available:",!!window.gsap),K(!1);let r=V1/D*3600;E1(r),setTimeout(()=>{H.current&&L2()},100)}function L2(){if(H.current){if(Q)H.current.pause(),D1.current=Date.now(),p("Activity paused");else if(N1.current){if(D1.current){let r=Date.now()-D1.current;r2.current+=r,D1.current=null,p("Activity resumed")}H.current.play()}else if(N1.current=Date.now(),r2.current=0,p("Activity started"),L("\u{1F3AC} First play detected, preparing flyTo..."),L("  - Map instance:",!!V.current),L("  - Marker:",!!S.current),L("  - Timeline:",!!H.current),V.current&&S.current&&H.current){let r=S.current.getLngLat();L("\u2708\uFE0F Starting flyTo animation (2s):",{lng:r.lng,lat:r.lat,zoom:Z+2,currentZoom:V.current.getZoom()}),H.current.pause(),V.current.flyTo({center:[r.lng,r.lat],zoom:a1,pitch:Y,duration:2e3,essential:!0}),setTimeout(()=>{H.current&&(L("\u25B6\uFE0F Starting timeline after flyTo complete"),H.current.play())},2100)}else console.warn("\u26A0\uFE0F Cannot execute flyTo - waiting for map/marker/timeline..."),H.current&&H.current.play();v1(!Q)}}function q4(){if(!H.current)return;H.current.restart(),v1(!0),R1(0),t2(0),d2(null),N1.current=Date.now(),D1.current=null,r2.current=0;let r=V1/S1.current*3600;E1(r),p("Activity restarted")}function W4(){if(V.current){let r=W.current;W.current=!1,V.current.zoomIn(),setTimeout(()=>{W.current=r},100)}}function _4(){if(V.current){let r=W.current;W.current=!1,V.current.zoomOut(),setTimeout(()=>{W.current=r},100)}}function j4(){let r=Math.min(D+1,50);if(U(r),H.current&&y1.current){let o=r/y1.current;H.current.timeScale(o),L(`\u26A1 Speed increased to ${r} km/h (timeScale: ${o.toFixed(2)})`),p(`Speed increased to ${r} km/h`,"success")}}function K4(){let r=Math.max(D-1,1);if(U(r),H.current&&y1.current){let o=r/y1.current;H.current.timeScale(o),L(`\u26A1 Speed decreased to ${r} km/h (timeScale: ${o.toFixed(2)})`),p(`Speed decreased to ${r} km/h`,"warning")}}function Q4(){if(!V.current||!e1.current)return;let r=k1?"none":"visible";V.current.setLayoutProperty("route-line","visibility",r),T1(!k1)}function $4(){f1(s1.toFixed(3));let r=Math.round(A1),o=Math.floor(r/3600),d=Math.floor(r%3600/60),v=r%60;o>0?U1(`${o}:${d.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`):U1(`${d}:${v.toString().padStart(2,"0")}`),c2(!0),Q&&H.current&&(H.current.pause(),D1.current=Date.now(),v1(!1))}async function Y4(){if(!n2||!l1){p("Please enter both distance and time","error");return}I1(!0);try{let r=parseFloat(n2)*1e3,o;if(l1.includes(":")){let s=l1.split(":").map(n=>parseInt(n.trim())||0);if(s.length===3){let[n,u,o1]=s;o=n*3600+u*60+o1}else if(s.length===2){let[n,u]=s;o=n*60+u}else o=0}else o=parseInt(l1)||0;if(r<=0||o<=0){p("Distance and time must be greater than zero","error"),I1(!1);return}let d=new Date().toISOString(),v=await fetch("/wp-json/tvs/v1/activities",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},body:JSON.stringify({route_id:a,route_name:J2,activity_date:d,started_at:d,ended_at:d,duration_s:o,distance_m:r,visibility:"private",activity_type:H1,is_virtual:!0})});if(!v.ok){let s=await v.json().catch(()=>({}));throw new Error(s.message||"Failed to save activity")}let E=await v.json();L("\u2705 Activity saved:",E),c2(!1),I1(!1),H.current&&(H.current.pause(),H.current.progress(0)),K(!0),v1(!1),R1(0),t2(0),E1(0),d2(null),N1.current=null,D1.current=null,r2.current=0,p("Activity saved successfully! \u{1F389}","success"),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(r){console.error("Failed to save activity:",r),p("Failed to save activity: "+(r?.message||"Unknown error"),"error"),I1(!1)}}function c4(){let r=document.querySelector(".tvs-virtual-training");r&&(Z1?(document.exitFullscreen&&document.exitFullscreen(),O1(!1)):(r.requestFullscreen&&r.requestFullscreen(),O1(!0)))}l(()=>{function r(){O1(!!document.fullscreenElement)}return document.addEventListener("fullscreenchange",r),()=>document.removeEventListener("fullscreenchange",r)},[]),l(()=>{function r(o){(o.key==="f"||o.key==="F")&&(R||c4())}return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[R,Z1]);function D2(r){let o=Math.floor(r/60),d=Math.floor(r%60);return`${o}:${d.toString().padStart(2,"0")}`}return R?i2?c("div",{className:"tvs-virtual-training tvs-virtual-training--welcome"},c("div",{className:"tvs-panel tvs-welcome-panel"},c("h2",{className:"tvs-welcome-title"},J2),c("div",{className:"tvs-welcome-stats"},c("div",{className:"tvs-stat-card"},c("span",{className:"tvs-stat-label"},"Distance"),c("span",{className:"tvs-stat-value"},V1>0?`${V1.toFixed(2)} km`:"Loading...")),c("div",{className:"tvs-stat-card"},c("span",{className:"tvs-stat-label"},"Est. Duration"),c("span",{className:"tvs-stat-value"},y2>0?`${y2} min`:"--"))),c("div",{className:"tvs-speed-section"},c("label",{className:"tvs-speed-label"},c("span",{className:"tvs-speed-title"},"Set your initial speed"),c("span",{className:"tvs-speed-hint"},"You can increase/decrease during the activity according to your treadmill speed")),c("div",{className:"tvs-speed-input-group"},c("input",{type:"number",className:"tvs-input tvs-speed-input",value:D,onChange:r=>U(Number(r.target.value)||12),min:1,max:50,step:.5}),c("span",{className:"tvs-speed-unit"},"km/h"))),c("button",{className:"tvs-btn tvs-btn--primary tvs-welcome-btn",onClick:G4,disabled:V1<=0},V1>0?"Start Training":"Loading route data..."))):c("div",{className:"tvs-virtual-training tvs-virtual-training--welcome"},c("div",{className:"virtual-training-welcome"},c("h2",null,"\u26A0\uFE0F Configuration Required"),c("p",{style:{color:"#e53e3e",marginBottom:"1rem"}},"Mapbox access token is missing. Please configure it in TVS Settings."),c("p",null,"Administrators: Go to TVS \u2192 Settings and add your Mapbox token."))):c("div",{className:`tvs-virtual-training ${Z1?"tvs-virtual-training--fullscreen":""}`},c("div",{ref:h,className:"virtual-training-map",style:{width:"100%",height:Z1?"calc(100vh - 80px)":"70vh"}}),c("div",{className:"training-stats"},c("div",{className:"stat-item"},c("span",{className:"stat-label"},"Distance"),c("span",{className:"stat-value"},`${R?"0.00":s1.toFixed(2)} / ${V1.toFixed(2)} km`)),c("div",{className:"stat-item"},c("span",{className:"stat-label"},"Time"),c("span",{className:"stat-value"},`${R?"0:00":D2(A1)} / ${D2(R?y2*60:h2)}`)),c("div",{className:"stat-item"},c("span",{className:"stat-label"},"Speed"),c("span",{className:"stat-value"},`${D} km/h`)),c("div",{className:"stat-item"},c("span",{className:"stat-label"},"Elevation"),c("span",{className:"stat-value"},`${P1} m`)),c("div",{className:"stat-item"},c("span",{className:"stat-label"},"Gradient"),c("span",{className:"stat-value",style:{color:x1>0?"#f56565":x1<0?"#48bb78":"white"}},`${x1>0?"+":""}${x1}%`)),c("div",{className:"elevation-chart-container"},c("canvas",{ref:H2,className:"elevation-chart",width:300,height:80}),c("div",{ref:R2,className:"elevation-marker",style:{left:"0%"}}))),!Q&&!R&&c("div",{className:"training-overlay-start",onClick:L2},c("div",{className:"overlay-content"},c("button",{className:"overlay-play-btn",onClick:L2},c(Y1,{size:64})),c("div",{style:{fontSize:20,fontWeight:600,marginTop:16}},"Push play to start"))),P&&c("div",{className:`poi-popup tvs-panel tvs-panel--elevated${U4?" poi-popup--hiding":""}`},P.imageThumbnail&&c("div",{className:"poi-image"},c("img",{src:P.imageThumbnail,alt:P.name})),c("div",{className:"poi-content"},c("div",{className:"poi-header"},P.iconType==="custom"&&P.customIconUrl?c("div",{className:"poi-icon poi-icon-custom",style:{backgroundColor:P.color||"#8b5cf6"}},c("img",{src:P.customIconUrl,alt:"Icon",style:{width:"100%",height:"100%",objectFit:"contain",filter:"brightness(0) invert(1)"}})):c("div",{className:"poi-icon",style:{backgroundColor:P.color||"#8b5cf6"}},P4[P.icon]||P.icon||"\u{1F4CD}"),c("h3",{className:"poi-title"},P.name)),P.description&&c("p",{className:"poi-description"},P.description))),c("div",{className:"training-controls"},c("button",{className:"control-btn",onClick:L2,title:Q?"Pause":"Play"},c(Q?m2:Y1,{size:24})),c("button",{className:"control-btn",onClick:K4,title:"Decrease Speed"},c(y4,{size:24})),c("button",{className:"control-btn",onClick:j4,title:"Increase Speed"},c(S4,{size:24})),c("button",{className:"control-btn",onClick:_4,title:"Zoom Out"},c(b4,{size:24})),c("button",{className:"control-btn",onClick:W4,title:"Zoom In"},c(D4,{size:24})),c("button",{className:`control-btn ${i1?"active":""}`,onClick:()=>B2(!i1),title:i1?"Camera Follow On":"Camera Follow Off"},c(i1?A4:R4,{size:24})),c("button",{className:`control-btn ${$?"active":""}`,onClick:()=>p1(!$),title:$?"Compass Mode On":"Compass Mode Off",disabled:!i1},c($?w4:B4,{size:24})),c("button",{className:`control-btn ${k1?"active":""}`,onClick:Q4,title:k1?"Hide Route Line":"Show Route Line"},c(k4,{size:20})),c("button",{className:"control-btn",onClick:q4,title:"Restart"},c(f2,{size:24})),c("button",{className:"control-btn save-btn",onClick:$4,title:"Save Activity",disabled:R||s1<.1},c(T4,{size:24})),c("button",{className:"control-btn",onClick:c4,title:Z1?"Exit Fullscreen":"Fullscreen"},c(Z1?z2:$1,{size:24}))),F2&&c("div",{className:"save-modal-overlay",onClick:()=>c2(!1)},c("div",{className:"save-modal",onClick:r=>r.stopPropagation()},c("h3",null,"\u{1F4BE} Save Activity"),c("p",null,`Enter actual data from your ${H1==="Ride"?"bike/trainer":"treadmill"}:`),c("div",{className:"modal-field"},c("label",null,"Activity Type"),c("div",{className:"activity-type-selector",style:{display:"flex",gap:"8px",marginTop:"8px"}},["Walk","Run","Ride"].map(r=>c("button",{key:r,type:"button",className:`activity-type-btn ${H1===r?"active":""}`,onClick:()=>C(r),style:{flex:1,padding:"12px",border:H1===r?"2px solid #3b82f6":"2px solid #e5e7eb",borderRadius:"8px",background:H1===r?"#eff6ff":"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",transition:"all 0.2s"}},c("span",{style:{fontSize:"24px"}},r==="Walk"?"\u{1F6B6}":r==="Run"?"\u{1F3C3}":"\u{1F6B4}"),c("span",{style:{fontSize:"14px",fontWeight:H1===r?"600":"400"}},r))))),c("div",{className:"modal-field"},c("label",null,"Distance (km)"),c("input",{type:"text",value:n2,onChange:r=>f1(r.target.value),placeholder:"8.234"}),c("small",{style:{color:"#718096",fontSize:"0.75rem",marginTop:"0.25rem",display:"block"}},"Supports decimals (e.g., 8.234 km)")),c("div",{className:"modal-field"},c("label",null,"Time (H:MM:SS, MM:SS, or seconds)"),c("input",{type:"text",value:l1,onChange:r=>U1(r.target.value),placeholder:"1:23:45 or 45:23"}),c("small",{style:{color:"#718096",fontSize:"0.75rem",marginTop:"0.25rem",display:"block"}},"Format: H:MM:SS (e.g., 1:23:45), MM:SS (e.g., 45:23), or just seconds (e.g., 2723)")),c("div",{className:"modal-buttons"},c("button",{className:"btn-secondary",onClick:()=>c2(!1),disabled:C1},"Cancel"),c("button",{className:"btn-primary",onClick:Y4,disabled:C1},C1?"Saving...":"Save Activity")))))}var e2=Number(new URLSearchParams(location.search).get("tvsslow")||0);function Y2({initialData:t,routeId:a}){let{useEffect:l,useState:i,useRef:e,createElement:c}=r1,[g,z]=i(t||null),[M,Z]=i(null),[a1,M1]=i(!1),[b1,Y]=i(!1),[B1,n1]=i(null),[w2,X1]=i(null),[O,m]=i(t?"inline":"loading"),[F1,X]=i(null),[G,J]=i(0),[F,L]=i(!1),[p,R]=i(!1),[K,D]=i(!0),[U,Q]=i(!0),[v1,i1]=i(!0),[B2,$]=i(!1),[p1,k1]=i("Run"),[T1,P]=i(""),[J1,s1]=i(""),[R1,P1]=i(!1),o2=e(null),x1=e(null);function k(C,h="success"){typeof window.tvsFlash=="function"&&window.tvsFlash(C,h)}l(()=>{let C=new URLSearchParams(location.search).get("tvsforcefetch")==="1";if(g&&!C){A("Har inline payload, skipper fetch.",g);return}if(!a){Z("Mangler routeId \u2013 hverken inline payload eller data-route-id.");return}(async()=>{try{A("Henter rute via REST:",a," (tvsslow:",e2,"ms)"),m("loading"),e2&&await j1(e2);let V=await(await fetch(`/wp-json/tvs/v1/routes/${encodeURIComponent(a)}`,{credentials:"same-origin"})).json();A("REST OK:",V),z(V),m("ok")}catch(h){N("REST FAIL:",h),Z("Kunne ikke hente rutedata."),X(h?.message||String(h)),m("error")}})()},[a]),l(()=>{if(!g)return;let C=o2.current;if(!C)return;let h=null,V=!1;function S(){return new Promise((H,z1)=>{if(window.Vimeo&&window.Vimeo.Player)return H();let e1=document.querySelector('script[src="https://player.vimeo.com/api/player.js"]');if(e1){e1.addEventListener("load",()=>H()),e1.addEventListener("error",()=>z1(new Error("Vimeo API failed to load")));return}let t1=document.createElement("script");t1.src="https://player.vimeo.com/api/player.js",t1.async=!0,t1.onload=()=>H(),t1.onerror=()=>z1(new Error("Vimeo API failed to load")),document.head.appendChild(t1)})}return(async()=>{try{if(await S(),V)return;h=new window.Vimeo.Player(C),x1.current=h,A("Vimeo Player constructed"),h.getDuration().catch(()=>{});try{await h.ready(),V||(L(!0),A("Vimeo Player ready"))}catch(H){N("Vimeo ready() rejected:",H)}h.on("timeupdate",H=>{typeof H?.seconds=="number"&&J(H.seconds)})}catch{N("Vimeo API init failed")}})(),()=>{V=!0;try{h&&h.off&&h.off("timeupdate"),h&&h.destroy&&h.destroy()}catch{}x1.current=null,L(!1)}},[g]),l(()=>{async function C(V){if((V.key==="f"||V.key==="F")&&V.target.tagName!=="INPUT"&&V.target.tagName!=="TEXTAREA"){V.preventDefault();let S=!p;if(S&&!F){k("Please wait for video to load","warning");return}if(R(S),S){await j1(100);try{let H=document.querySelector(".tvs-app");H&&H.requestFullscreen&&await H.requestFullscreen()}catch(H){console.warn("Fullscreen not supported or denied:",H)}}else if(document.fullscreenElement)try{await document.exitFullscreen()}catch(H){console.warn("Error exiting fullscreen:",H)}}if(V.key==="Escape"&&p&&(R(!1),document.fullscreenElement))try{await document.exitFullscreen()}catch(S){console.warn("Error exiting fullscreen:",S)}}function h(){!document.fullscreenElement&&p&&R(!1)}return window.addEventListener("keydown",C),document.addEventListener("fullscreenchange",h),()=>{window.removeEventListener("keydown",C),document.removeEventListener("fullscreenchange",h)}},[p,F]);async function A1(C=8e3){let h=Date.now();for(;Date.now()-h<C;){let V=x1.current;if(V)try{return await V.ready(),L(!0),V}catch{}await j1(100)}throw new Error("Video player is not ready")}function t2(C){let h=g?.meta||{},V=Number(h.duration_s||0),S=Number(h.distance_m||0);if(V>0&&S>0&&C>=0){let H=Math.min(1,C/V);return Math.round(S*H)}return 0}async function h2(){try{M1(!0),A("Start clicked");let C=await A1();m("starting");try{await u2(C.play(),4e3,"play()"),A("Playback started")}catch(h){throw N("play() failed:",h),k("Could not start playback: "+(h?.message||String(h)),"error"),h}try{let h=await u2(C.getCurrentTime(),1500,"getCurrentTime");typeof h=="number"&&h>.5?(await j1(150),await u2(C.setCurrentTime(0),2e3,"setCurrentTime(0)"),A("Seeked to 0")):A("Already at start, skipping seek")}catch(h){A("Post-play seek skipped:",h?.message||String(h))}n1(new Date),Y(!0),m("running"),k("Activity started")}catch(C){N("Start session failed:",C),k("Player not ready yet. Please wait a moment and try again.","error"),m("error")}finally{M1(!1)}}async function E1(){try{M1(!0),A("Resume clicked");let C=await A1();m("starting");try{await C.play(),A("Playback resumed")}catch(h){throw N("resume play() failed:",h),k("Could not resume playback: "+(h?.message||String(h)),"error"),h}Y(!0),m("running"),k("Activity resumed")}catch(C){N("Resume session failed:",C),k("Player not ready yet. Please wait a moment and try again.","error"),m("error")}finally{M1(!1)}}async function Z1(){try{A("Pause clicked");let C=await A1();try{await C.pause(),A("Playback paused")}catch(h){throw N("pause() failed:",h),k("Failed to pause: "+(h?.message||String(h)),"error"),h}Y(!1),m("paused"),k("Activity paused")}catch(C){N("[TVS] Pause failed:",C),m("error")}}async function O1(){try{A("Finish clicked");let C=await A1();m("pausing");try{await C.pause(),A("Playback paused before save dialog")}catch(e1){N("pause before save dialog failed:",e1)}let h=await C.getCurrentTime(),V=Math.max(0,Math.floor(h||0)),S=t2(V),H=Math.floor(V/60),z1=V%60;P(`${H}:${z1.toString().padStart(2,"0")}`),s1((S/1e3).toFixed(2)),$(!0)}catch(C){N("[TVS] Failed to open save dialog:",C),k("Failed to open save dialog: "+(C?.message||String(C)),"error"),m("error")}}async function F2(){try{P1(!0);let C=0;if(T1.includes(":")){let W=T1.split(":").map(d1=>parseInt(d1.trim())||0);if(W.length===3){let[d1,S1,y1]=W;C=d1*3600+S1*60+y1}else if(W.length===2){let[d1,S1]=W;C=d1*60+S1}else C=0}else C=parseInt(T1)||0;let h=Math.round(parseFloat(J1)*1e3);if(h<=0||C<=0){k("Distance and time must be greater than zero","error"),P1(!1);return}let V=new Date().toISOString(),S=B1?B1.toISOString():new Date(Date.now()-C*1e3).toISOString(),H=new Date(new Date(S).getTime()+C*1e3).toISOString(),z1={route_id:g.id,route_name:g.title||"Unknown Route",activity_date:V,started_at:S,ended_at:H,duration_s:C,distance_m:h,visibility:"private",activity_type:p1,is_virtual:!1},e1=window.TVS_SETTINGS?.nonce||"";e2&&await j1(e2);let t1=await fetch("/wp-json/tvs/v1/activities",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":e1},credentials:"same-origin",body:JSON.stringify(z1)});if(!t1.ok){let W=await t1.json();throw new Error(W.message||`HTTP ${t1.status}`)}await t1.json(),$(!1),P1(!1),P(""),s1(""),k("Activity saved! \u{1F389}","success"),m("ok"),Y(!1),n1(null),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(C){N("[TVS] Save activity failed:",C),k("Failed to save activity: "+(C?.message||String(C)),"error"),X(C?.message||String(C)),m("error"),P1(!1)}}async function c2(C){try{X1(C),m("uploading");let h=await fetch(`/wp-json/tvs/v1/activities/${C}/strava`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},credentials:"same-origin"}),V=await h.json();if(!h.ok)throw new Error(V.message||"Upload failed");k("Uploaded to Strava!"),m("ok"),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(h){N("Strava upload FAIL:",h),k("Failed to upload to Strava: "+(h?.message||String(h)),"error"),X(h?.message||String(h)),m("error")}finally{X1(null)}}if(M)return c("div",{className:"tvs-route tvs-error"},String(M));if(!g)return r1.createElement(K2,null);let n2=g.title||"Route",f1=g.meta||{},l1=f1.vimeo_id?String(f1.vimeo_id):"",U1=f1.gpx_url||"",C1=Number(f1.duration_s||0),I1=!!window.TVS_SETTINGS?.user;if(!l1&&U1)return c($2,{routeData:g,routeId:a});if(!l1&&!U1)return c("div",{className:"tvs-route tvs-fallback"},c("p",null,"This route has no video or GPX data available."));let H1=I1?b1?[c("button",{key:"pause",className:"control-btn",onClick:Z1,disabled:a1||!F,title:"Pause activity"},c(m2,{size:24})),c("button",{key:"finish",className:"control-btn save-btn",onClick:O1,disabled:a1||!F,title:"Finish and save activity"},c(j2,{size:24})),!p&&c("button",{key:"fullscreen",className:"control-btn",onClick:async()=>{if(!F){k("Please wait for video to load","warning");return}R(!0);try{let C=document.querySelector(".tvs-app");C&&C.requestFullscreen&&await C.requestFullscreen()}catch(C){console.warn("Fullscreen not supported or denied:",C)}},disabled:!F,title:"Enter fullscreen mode (F)"},c($1,{size:24}))]:G>0&&B1&&(C1===0||G<C1-.5)?[c("button",{key:"resume",className:"control-btn",onClick:E1,disabled:a1||!F,title:"Resume activity"},c(Y1,{size:24})),c("button",{key:"finish",className:"control-btn save-btn",onClick:O1,disabled:a1||!F,title:"Finish and save activity"},c(j2,{size:24})),c("button",{key:"restart",className:"control-btn",onClick:h2,disabled:a1||!F,title:"Restart from beginning"},c(f2,{size:24})),!p&&c("button",{key:"fullscreen",className:"control-btn",onClick:async()=>{if(!F){k("Please wait for video to load","warning");return}R(!0);try{let C=document.querySelector(".tvs-app");C&&C.requestFullscreen&&await C.requestFullscreen()}catch(C){console.warn("Fullscreen not supported or denied:",C)}},disabled:!F,title:"Enter fullscreen mode (F)"},c($1,{size:24}))]:[c("button",{key:"start",className:"control-btn",onClick:h2,disabled:a1||!F,title:"Start activity"},c(Y1,{size:24})),!p&&c("button",{key:"fullscreen",className:"control-btn",onClick:async()=>{if(!F){k("Please wait for video to load","warning");return}R(!0);try{let C=document.querySelector(".tvs-app");C&&C.requestFullscreen&&await C.requestFullscreen()}catch(C){console.warn("Fullscreen not supported or denied:",C)}},disabled:!F,title:"Enter fullscreen mode (F)"},c($1,{size:24}))]:c("div",{className:"tvs-alert tvs-alert--warning",style:{margin:"0 auto",maxWidth:"500px"}},c("div",{className:"tvs-row tvs-mb-2"},c("span",{className:"tvs-badge tvs-badge-warning"},"Warning"),c("strong",null," You must be logged in")),c("p",null,"Please ",c("a",{href:"/login"},"log in")," to create activities and upload to Strava. Don't have an account? ",c("a",{href:"/register"},"Register here"),"."));return c("div",{className:`tvs-app${p?" tvs-app--cinematic":""}`},c("div",{key:"video-container",className:p?"tvs-video-container":"tvs-panel tvs-app__container"},l1?c("div",{className:p?"tvs-video tvs-video--cinematic":"tvs-video"},c("iframe",{ref:o2,width:560,height:315,src:"https://player.vimeo.com/video/"+encodeURIComponent(l1)+"?controls=0&title=0&byline=0&portrait=0&pip=0&playsinline=1&dnt=1&transparent=0&muted=0",frameBorder:0,allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0})):null,p&&K&&c("div",{key:"minimap",className:"tvs-video-overlay tvs-video-overlay--minimap"},c("div",{className:"tvs-overlay-placeholder"},"Mini-map")),p&&U&&c("div",{key:"routeinfo",className:"tvs-video-overlay tvs-video-overlay--routeinfo"},c("div",{className:"tvs-overlay-placeholder"},"Route Info")),!p&&c(P2,{React:r1,currentTime:G,duration:C1}),!p&&(new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1")?c("div",{className:"tvs-meta"},c("pre",null,JSON.stringify(f1,null,2))):null,!p&&c("div",{className:"training-controls"},H1)),p?c("div",{className:`tvs-control-panel${v1?"":" tvs-control-panel--hidden"}`,style:C1>0?{"--progress":`${Math.min(G/C1*100,100)}%`}:void 0},c("button",{className:"tvs-control-panel-tab",onClick:()=>i1(C=>!C),"aria-label":v1?"Hide controls":"Show controls",title:v1?"Hide controls":"Show controls"},c(v1?f4:z4,{"aria-hidden":!0})),c("div",{className:"tvs-control-panel-content"},c("div",{className:"training-controls",style:{position:"relative",bottom:"auto",left:"auto",transform:"none"}},H1),c("div",{className:"tvs-cinematic-extras",style:{display:"flex",gap:"12px",marginLeft:"auto"}},c("button",{className:"control-btn",onClick:()=>D(C=>!C),title:K?"Hide minimap":"Show minimap"},c(F4,{size:24})),c("button",{className:"control-btn",onClick:()=>Q(C=>!C),title:U?"Hide route info":"Show route info"},c(m4,{size:24})),c("button",{className:"control-btn",onClick:async()=>{if(R(!1),document.fullscreenElement)try{await document.exitFullscreen()}catch(C){console.warn("Error exiting fullscreen:",C)}},title:"Exit cinematic mode (press F or Escape)"},c(z2,{size:24}))))):null,_1?c(Q2,{React:r1,routeId:a,lastStatus:O,lastError:F1,currentTime:G,duration:C1}):null,B2&&c("div",{className:"save-modal-overlay",onClick:()=>$(!1)},c("div",{className:"save-modal",onClick:C=>C.stopPropagation()},c("h3",null,"\u{1F4BE} Save Activity"),c("p",null,`Enter actual data from your ${p1==="Ride"?"bike/trainer":"treadmill"}:`),c("div",{className:"modal-field"},c("label",null,"Activity Type"),c("div",{className:"activity-type-selector",style:{display:"flex",gap:"8px",marginTop:"8px"}},["Walk","Run","Ride"].map(C=>c("button",{key:C,type:"button",className:`activity-type-btn ${p1===C?"active":""}`,onClick:()=>k1(C),style:{flex:1,padding:"12px",border:p1===C?"2px solid #3b82f6":"2px solid #e5e7eb",borderRadius:"8px",background:p1===C?"#eff6ff":"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",transition:"all 0.2s"}},c("span",{style:{fontSize:"24px"}},C==="Walk"?"\u{1F6B6}":C==="Run"?"\u{1F3C3}":"\u{1F6B4}"),c("span",{style:{fontSize:"14px",fontWeight:p1===C?"600":"400"}},C))))),c("div",{className:"modal-field"},c("label",null,"Distance (km)"),c("input",{type:"text",value:J1,onChange:C=>s1(C.target.value),placeholder:"8.234"}),c("small",{style:{color:"#718096",fontSize:"0.75rem",marginTop:"0.25rem",display:"block"}},"Supports decimals (e.g., 8.234 km)")),c("div",{className:"modal-field"},c("label",null,"Time (H:MM:SS, MM:SS, or seconds)"),c("input",{type:"text",value:T1,onChange:C=>P(C.target.value),placeholder:"1:23:45 or 45:23"}),c("small",{style:{color:"#718096",fontSize:"0.75rem",marginTop:"0.25rem",display:"block"}},"Format: H:MM:SS (e.g., 1:23:45), MM:SS (e.g., 45:23), or just seconds (e.g., 2723)")),c("div",{className:"modal-buttons"},c("button",{className:"btn-secondary",onClick:()=>{$(!1),P(""),s1("")},disabled:R1},"Cancel"),c("button",{className:"btn-primary",onClick:F2,disabled:R1},R1?"Saving...":"Save Activity")))))}_1||document.addEventListener("keydown",t=>{if(t.key==="`"){try{localStorage.setItem("tvsDev","1")}catch{}location.reload()}});function E4(){let t=document.getElementById("tvs-app-root");if(t){let a=window.tvs_route_payload||null,l=t.getAttribute("data-route-id")||a&&a.id;A("\u{1F680} Boot Debug:"),A("  - Mount element:",!!t),A("  - Route ID:",l),A("  - window.tvs_route_payload:",window.tvs_route_payload),A("  - Inline payload:",a),A("Boot \u2192 routeId:",l,"inline payload:",!!a),o4(Y2,{initialData:a,routeId:l},t)}}_1?A("Debug mode enabled."):document.addEventListener("keydown",function(t){if(t.key==="`"){let a=new URL(location.href);a.searchParams.set("tvsdebug","1"),location.href=a.toString()}});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E4):E4();})();
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
//# sourceMappingURL=tvs-app.js.map
