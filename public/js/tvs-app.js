(()=>{var X=new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1";function w(...N){X&&console.debug("[TVS]",...N)}function h(...N){console.error("[TVS]",...N)}function J(N){return new Promise(u=>setTimeout(u,N))}var ge=!!(window.React&&window.ReactDOM),_e=!!(window.wp&&window.wp.element),j=_e?window.wp.element:{},D=ge?window.React:j||{},F=ge?window.ReactDOM:j||null,ce=new WeakMap,Te=F&&typeof F.createRoot=="function"||j&&typeof j.createRoot=="function";function de(N,u,S){try{let E=ce.get(S);if(E&&typeof E.unmount=="function"?(E.unmount(),ce.delete(S)):F&&typeof F.unmountComponentAtNode=="function"&&F.unmountComponentAtNode(S),Te){let U=(F&&F.createRoot||j&&j.createRoot)(S);ce.set(S,U),U.render(D.createElement(N,u));return}let $=F&&F.render||j&&j.render;if($){$(D.createElement(N,u),S);return}h("Ingen render-funksjon tilgjengelig.")}catch(E){h("Mount feilet:",E)}}function ue({React:N,currentTime:u,duration:S}){let E=N.createElement,$=Math.floor(u/60),Y=Math.floor(u%60),U=(ae,q)=>ae+":"+(q<10?"0":"")+q,oe=S>0?u/S*100:0;return E("div",{className:"tvs-progress"},E("div",{className:"tvs-progress__bar"},E("div",{className:"tvs-progress__fill",style:{width:Math.min(oe,100)+"%"}})),E("div",{className:"tvs-progress__time"},U($,Y)+" / "+U(Math.floor(S/60),Math.floor(S%60))))}function me(N){let u=N.createElement;return u("div",{className:"tvs-loading",role:"status","aria-live":"polite"},u("svg",{viewBox:"0 0 64 64",className:"tvs-runner","aria-hidden":"true"},u("line",{x1:4,y1:60,x2:60,y2:60,stroke:"#bbb",strokeWidth:2,className:"track"}),u("circle",{cx:26,cy:12,r:5,fill:"none",stroke:"#111",strokeWidth:2}),u("line",{x1:26,y1:17,x2:26,y2:35,stroke:"#111",strokeWidth:2}),u("line",{x1:26,y1:22,x2:40,y2:18,stroke:"#111",strokeWidth:2,className:"arm front",style:{transformOrigin:"26px 22px"}}),u("line",{x1:26,y1:22,x2:12,y2:26,stroke:"#111",strokeWidth:2,className:"arm back",style:{transformOrigin:"26px 22px"}}),u("line",{x1:26,y1:35,x2:40,y2:48,stroke:"#111",strokeWidth:2,className:"leg front",style:{transformOrigin:"26px 35px"}}),u("line",{x1:26,y1:35,x2:16,y2:54,stroke:"#111",strokeWidth:2,className:"leg back",style:{transformOrigin:"26px 35px"}})),u("div",null,u("div",{className:"tvs-skel line"}),u("div",{className:"tvs-skel line sm"}),u("div",null,u("span",{className:"tvs-skel block"}),u("span",{className:"tvs-skel block"}),u("span",{className:"tvs-skel block"}))))}(function(){let N=(r,i)=>(i||document).querySelector(r),u=r=>new URLSearchParams(location.search).get(r);X||document.addEventListener("keydown",r=>{r.key==="`"&&(localStorage.setItem("tvsDev","1"),location.reload())});let S=Number(new URLSearchParams(location.search).get("tvsslow")||0);async function E(r,i,n="operation"){let d;try{return await Promise.race([r,new Promise((_,a)=>{d=setTimeout(()=>a(new Error(n+" timed out")),i)})])}finally{clearTimeout(d)}}function $(r){let i=Math.floor(r/60),n=Math.floor(r%60);return i+":"+(n<10?"0":"")+n}function Y(r){let{useEffect:i,useRef:n,useState:d}=r,[_,a]=d(0),e=n(performance.now()),l=n(0);return i(()=>{let b,m=s=>{l.current+=1,s-e.current>=1e3&&(a(l.current),l.current=0,e.current=s),b=requestAnimationFrame(m)};return b=requestAnimationFrame(m),()=>cancelAnimationFrame(b)},[]),_}function U({React:r,routeId:i,lastStatus:n,lastError:d,currentTime:_,duration:a}){let{useEffect:e,useRef:l,useState:b,createElement:m}=r,s=Y(r),x=l(null),[v,c]=b(!1),[p,M]=b({x:16,y:16});e(()=>{if(!x.current)return;let R,A,g,K,O=!1;function z(P){P.target.closest(".tvs-dev__header")&&(O=!0,R=P.clientX,A=P.clientY,g=p.x,K=p.y,P.preventDefault())}function Q(P){O&&M({x:g+(P.clientX-R),y:K+(P.clientY-A)})}function L(){O=!1}return window.addEventListener("mousedown",z),window.addEventListener("mousemove",Q),window.addEventListener("mouseup",L),()=>{window.removeEventListener("mousedown",z),window.removeEventListener("mousemove",Q),window.removeEventListener("mouseup",L)}},[p]);let B=a>0?(_/a*100).toFixed(1):"0.0",y={env:window.TVS_SETTINGS?.env,version:window.TVS_SETTINGS?.version,restRoot:window.TVS_SETTINGS?.restRoot,user:window.TVS_SETTINGS?.user,routeId:i,lastStatus:n||"idle",lastError:d?String(d):null,currentTime:_?_.toFixed(1):"0.0",duration:a||0,progress:B+"%",fps:s};function G(){navigator.clipboard.writeText(JSON.stringify({...y,time:new Date().toISOString()},null,2)).catch(console.error)}return m("div",{ref:x,className:`tvs-dev ${v?"is-min":""}`,style:{left:p.x+"px",top:p.y+"px"}},m("div",{className:"tvs-dev__header"},m("strong",null,"TVS Dev"),m("div",{className:"tvs-dev__spacer"}),m("span",{className:"tvs-dev__pill"},y.env||"n/a"),m("button",{className:"tvs-dev__btn",onClick:()=>c(!v),"aria-label":"Minimize"},"\u2581")),m("div",{className:"tvs-dev__body"},T("Route",y.routeId??"n/a"),T("User",y.user??"guest"),T("REST",y.restRoot??"n/a"),T("Status",y.lastStatus),y.lastError?T("Error",y.lastError,!0):null,T("Duration",y.duration+"s"),T("Current",y.currentTime+"s"),T("Progress",y.progress),T("FPS",String(y.fps)),m("div",{className:"tvs-dev__actions"},m("button",{onClick:G,className:"tvs-dev__btn"},"Copy debug"),m("button",{onClick:()=>{localStorage.setItem("tvsDev","0"),location.reload()},className:"tvs-dev__btn tvs-dev__btn--ghost"},"Disable"))));function T(W,R,A){return r.createElement("div",{className:"tvs-dev__row"},r.createElement("span",null,W),r.createElement("code",{className:A?"tvs-dev__err":""},R))}}function oe({initialData:r,routeId:i}){let{useEffect:n,useState:d,useRef:_,createElement:a}=D,[e,l]=d(r||null),[b,m]=d(null),[s,x]=d(!1),[v,c]=d(!1),[p,M]=d(null),[B,y]=d([]),[G,T]=d(!1),[W,R]=d(null),[A,g]=d(r?"inline":"loading"),[K,O]=d(null),[z,Q]=d(0),[L,P]=d(!1),re=_(null),ie=_(null);function C(o,t="success"){window.tvsFlash(o,t)}n(()=>{let o=new URLSearchParams(location.search).get("tvsforcefetch")==="1";if(e&&!o){w("Har inline payload, skipper fetch.",e);return}if(!i){m("Mangler routeId \u2013 hverken inline payload eller data-route-id.");return}(async()=>{try{w("Henter rute via REST:",i," (tvsslow:",S,"ms)"),g("loading"),S&&await J(S);let f=await(await fetch(`/wp-json/tvs/v1/routes/${encodeURIComponent(i)}`,{credentials:"same-origin"})).json();w("REST OK:",f),l(f),g("ok")}catch(t){h("REST FAIL:",t),m("Kunne ikke hente rutedata."),O(t?.message||String(t)),g("error")}})()},[i]),n(()=>{se()},[]);async function se(){try{T(!0);let t=await fetch("/wp-json/tvs/v1/activities/me",{credentials:"same-origin",headers:{"X-TVS-Nonce":window.TVS_SETTINGS?.nonce||""}});if(!t.ok)throw new Error("Failed to load activities");let f=await t.json(),V=Array.isArray(f)?f:f.activities||[];y(V)}catch(o){h("Load activities FAIL:",o),y([])}finally{T(!1)}}n(()=>{if(!e)return;let o=re.current;if(!o)return;let t=null,f=!1;function V(){return new Promise((k,ne)=>{if(window.Vimeo&&window.Vimeo.Player)return k();let H=document.querySelector('script[src="https://player.vimeo.com/api/player.js"]');if(H){H.addEventListener("load",()=>k()),H.addEventListener("error",()=>ne(new Error("Vimeo API failed to load")));return}let I=document.createElement("script");I.src="https://player.vimeo.com/api/player.js",I.async=!0,I.onload=()=>k(),I.onerror=()=>ne(new Error("Vimeo API failed to load")),document.head.appendChild(I)})}return(async()=>{try{if(await V(),f)return;t=new window.Vimeo.Player(o),ie.current=t,w("Vimeo Player constructed"),t.getDuration().then(k=>{!Number(e?.meta?.duration_s)&&typeof k=="number"&&k>0}).catch(()=>{});try{await t.ready(),f||(P(!0),w("Vimeo Player ready"))}catch(k){h("Vimeo ready() rejected:",k)}t.on("timeupdate",k=>{typeof k?.seconds=="number"&&Q(k.seconds)})}catch{h("Vimeo API init failed")}})(),()=>{f=!0;try{t&&t.off&&t.off("timeupdate"),t&&t.destroy&&t.destroy()}catch{}ie.current=null,P(!1)}},[e]);async function Z(o=8e3){let t=Date.now();for(;Date.now()-t<o;){let f=ie.current;if(f)try{return await f.ready(),P(!0),f}catch{}await J(100)}throw new Error("Video player is not ready")}function he(o){let t=e?.meta||{},f=Number(t.duration_s||0),V=Number(t.distance_m||0);if(f>0&&V>0&&o>=0){let k=Math.min(1,o/f);return Math.round(V*k)}return 0}async function fe(){try{x(!0),w("Start clicked");let o=await Z();g("starting");try{await E(o.play(),4e3,"play()"),w("Playback started")}catch(t){throw h("play() failed:",t),C("Could not start playback: "+(t?.message||String(t)),"error"),t}try{let t=await E(o.getCurrentTime(),1500,"getCurrentTime");typeof t=="number"&&t>.5?(await J(150),await E(o.setCurrentTime(0),2e3,"setCurrentTime(0)"),w("Seeked to 0")):w("Already at start, skipping seek")}catch(t){w("Post-play seek skipped:",t?.message||String(t))}M(new Date),c(!0),g("running"),C("Activity started")}catch(o){h("Start session failed:",o),C("Player not ready yet. Please wait a moment and try again.","error"),g("error")}finally{x(!1)}}async function Se(){try{x(!0),w("Resume clicked");let o=await Z();g("starting");try{await o.play(),w("Playback resumed")}catch(t){throw h("resume play() failed:",t),C("Could not resume playback: "+(t?.message||String(t)),"error"),t}c(!0),g("running"),C("Activity resumed")}catch(o){h("Resume session failed:",o),C("Player not ready yet. Please wait a moment and try again.","error"),g("error")}finally{x(!1)}}async function be(){try{w("Pause clicked");let o=await Z();try{await o.pause(),w("Playback paused")}catch(t){throw h("pause() failed:",t),C("Failed to pause: "+(t?.message||String(t)),"error"),t}c(!1),g("paused"),C("Activity paused")}catch(o){h("[TVS] Pause failed:",o),g("error")}}async function pe(){try{x(!0),w("Finish clicked");let o=await Z();g("saving");try{await o.pause(),w("Playback paused before save")}catch(le){h("pause before save failed:",le)}let t=await o.getCurrentTime(),f=Math.max(0,Math.floor(t||0)),V=p?p.toISOString():new Date(Date.now()-f*1e3).toISOString(),k=he(f),ne={route_id:e.id,route_name:e.title||"Unknown Route",activity_date:new Date().toISOString(),started_at:V,duration_s:f,distance_m:k},H=window.TVS_SETTINGS?.nonce||"";S&&await J(S);let I=await fetch("/wp-json/tvs/v1/activities",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":H},credentials:"same-origin",body:JSON.stringify(ne)});if(!I.ok){let le=await I.json();throw new Error(le.message||`HTTP ${I.status}`)}let Ne=await I.json();C("Activity saved!"),g("ok"),c(!1),M(null),await se(),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(o){h("[TVS] Save activity failed:",o),C("Failed to save activity: "+(o?.message||String(o)),"error"),O(o?.message||String(o)),g("error")}finally{x(!1)}}async function Ee(o){try{R(o),g("uploading");let t=await fetch(`/wp-json/tvs/v1/activities/${o}/strava`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},credentials:"same-origin"}),f=await t.json();if(!t.ok)throw new Error(f.message||"Upload failed");C("Uploaded to Strava!"),g("ok"),await se(),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(t){h("Strava upload FAIL:",t),C("Failed to upload to Strava: "+(t?.message||String(t)),"error"),O(t?.message||String(t)),g("error")}finally{R(null)}}if(b)return a("div",{className:"tvs-route tvs-error"},String(b));if(!e)return D.createElement(me,null);let xe=e.title||"Route",ee=e.meta||{},ye=ee.vimeo_id?String(ee.vimeo_id):"",te=Number(ee.duration_s||0),ke=!!window.TVS_SETTINGS?.user;return a("div",{className:"tvs-app"},a("h2",null,xe),ye?a("div",{className:"tvs-video"},a("iframe",{ref:re,width:560,height:315,src:"https://player.vimeo.com/video/"+encodeURIComponent(ye)+"?controls=0&title=0&byline=0&portrait=0&pip=0&playsinline=1&dnt=1&transparent=0&muted=0",frameBorder:0,allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0})):null,new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1"?a("div",{className:"tvs-meta"},a("pre",null,JSON.stringify(ee,null,2))):null,a(ue,{React:D,currentTime:z,duration:te}),a("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"}},ke?v?[a("button",{key:"pause",className:"tvs-btn",onClick:be,disabled:s||!L,style:{backgroundColor:"#f59e0b"}},"Pause"),a("button",{key:"finish",className:"tvs-btn",onClick:pe,disabled:s||!L,style:{backgroundColor:"#10b981"}},s?a("span",{className:"tvs-spinner","aria-hidden":"true"}):null,s?" Saving...":"Finish & Save")]:z>0&&p&&(te===0||z<te-.5)?[a("button",{key:"resume",className:"tvs-btn",onClick:Se,disabled:s||!L},s?a("span",{className:"tvs-spinner","aria-hidden":"true"}):null,s?" Starting...":"Resume Activity"),a("button",{key:"finish",className:"tvs-btn",onClick:pe,disabled:s||!L,style:{backgroundColor:"#10b981"}},s?a("span",{className:"tvs-spinner","aria-hidden":"true"}):null,s?" Saving...":"Finish & Save"),a("button",{key:"restart",className:"tvs-btn",onClick:fe,disabled:s||!L,style:{backgroundColor:"#334155"}},"Restart from 0:00")]:a("button",{className:"tvs-btn",onClick:fe,disabled:s||!L},s?a("span",{className:"tvs-spinner","aria-hidden":"true"}):null,s?" Starting...":"Start Activity"):a("div",{style:{backgroundColor:"#fef3c7",border:"1px solid #f59e0b",padding:"1rem",margin:"0.5rem 0 0 0",borderRadius:"4px",width:"100%"}},a("strong",null,"\u26A0\uFE0F You must be logged in"),a("p",{style:{margin:"0.5rem 0 0 0"}},"Please ",a("a",{href:"/login",style:{color:"#1f2937",textDecoration:"underline"}},"log in")," to create activities and upload to Strava. Don't have an account? ",a("a",{href:"/register",style:{color:"#1f2937",textDecoration:"underline"}},"Register here"),"."))),X?a(U,{React:D,routeId:i,lastStatus:A,lastError:K,currentTime:z,duration:te}):null)}function ae({React:r,activities:i,loadingActivities:n,uploadToStrava:d,uploadingId:_}){let{useState:a,createElement:e}=r,[l,b]=a(!1),m=i.slice(0,5);return e("div",{className:"tvs-activities-block",style:{marginTop:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",background:"#fff",padding:"1rem"}},e("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1rem"}},e("h3",{style:{margin:0,fontSize:"1.25rem"}},"Recent Activities"),e("button",{onClick:()=>b(!l),style:{fontSize:"1.2em",background:"none",border:"none",cursor:"pointer",color:"#666"},"aria-label":l?"Expand":"Minimize"},l?"\u25B8":"\u25BE")),l?null:n?e("p",{style:{color:"#666"}},"Loading activities..."):m.length===0?e("p",{style:{color:"#666"}},"Start a new activity when you're ready"):e("div",null,e("div",{className:"tvs-activities-list",style:{marginBottom:"1rem"}},m.map(s=>e(q,{key:s.id,activity:s,uploadToStrava:d,uploading:_===s.id,React:r,compact:!0}))),e("div",{style:{textAlign:"center",paddingTop:"0.5rem",borderTop:"1px solid #e5e7eb"}},e("a",{href:"/my-activities",style:{color:"#2563eb",textDecoration:"none",fontSize:"0.9rem"}},"Go to my activities \u2192"))))}function q({activity:r,uploadToStrava:i,uploading:n,React:d,compact:_,dummy:a}){let{createElement:e}=d,l=r.meta||{},b=r.id,m=l._tvs_synced_strava?.[0]||l.synced_strava?.[0],s=l._tvs_strava_remote_id?.[0]||l.strava_activity_id?.[0],x=m==="1"||m===1,v=l._tvs_distance_m?.[0]||l.distance_m?.[0]||0,c=l._tvs_duration_s?.[0]||l.duration_s?.[0]||0,p=l._tvs_route_id?.[0]||l.route_id?.[0],M=l._tvs_route_name?.[0]||l.route_name?.[0]||"Unknown Route",B=l._tvs_activity_date?.[0]||l.activity_date?.[0]||r.date||"",y="";if(B)try{y=new Date(B).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{y=B}let G=y?`${M} (${y})`:M;if(_){let{useState:T}=d,[W,R]=T(!1);return a?e("div",{className:"tvs-activity-card-compact",style:{padding:"0.75rem",marginBottom:"0.5rem",borderRadius:"4px",background:"linear-gradient(90deg, #f3f4f6 60%, #e5e7eb 100%)",fontSize:"0.9rem",position:"relative",opacity:.6,filter:"grayscale(0.7)",pointerEvents:"none"}},e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"}},e("div",{style:{flex:1,minWidth:0}},e("div",{style:{fontWeight:"500",marginBottom:"0.25rem"}},G),e("div",{style:{fontSize:"0.85rem",color:"#888"}},v>0?(v/1e3).toFixed(2)+" km":"",v>0&&c>0?" \xB7 ":"",c>0?Math.floor(c/60)+" min":"")),e("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexShrink:0}},e("span",{style:{color:"#bbb",fontSize:"1.5rem",lineHeight:1,display:"flex",alignItems:"center"},title:"Preview"},"\u2713"),e("div",{style:{width:"32px",height:"32px",borderRadius:"4px",backgroundColor:"#e5e7eb",color:"#ccc",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold"}},"S")))):e("div",{className:"tvs-activity-card-compact",style:{padding:"0.75rem",marginBottom:"0.5rem",borderRadius:"4px",backgroundColor:"#f9fafb",fontSize:"0.9rem",position:"relative"}},e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"}},e("div",{style:{flex:1,minWidth:0}},e("div",{style:{fontWeight:"500",marginBottom:"0.25rem"}},G),e("div",{style:{fontSize:"0.85rem",color:"#666"}},v>0?(v/1e3).toFixed(2)+" km":"",v>0&&c>0?" \xB7 ":"",c>0?Math.floor(c/60)+" min":"")),e("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexShrink:0}},x?e("span",{style:{color:"#10b981",fontSize:"1.5rem",lineHeight:1,display:"flex",alignItems:"center"},title:"Synced to Strava"},"\u2713"):null,e("div",{style:{position:"relative"}},x?e("a",{href:s?"https://www.strava.com/activities/"+s:"#",target:"_blank",rel:"noopener noreferrer",title:"View on Strava",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"4px",backgroundColor:"#fc4c02",color:"white",textDecoration:"none",fontSize:"0.9rem",fontWeight:"bold"}},"S"):e("button",{onClick:A=>{A.stopPropagation(),R(!W)},disabled:n,title:"Upload to Strava",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"4px",backgroundColor:n?"#ccc":"#fc4c02",color:"white",border:"none",cursor:n?"wait":"pointer",fontSize:"0.9rem",fontWeight:"bold"}},n?"...":"S"),W&&!x&&!n?e("div",{style:{position:"absolute",right:0,top:"calc(100% + 0.5rem)",backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"0.75rem",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06)",zIndex:1e3,minWidth:"200px",whiteSpace:"nowrap"}},e("div",{style:{fontSize:"0.9rem",marginBottom:"0.5rem",color:"#374151"}},"Upload to Strava?"),e("div",{style:{display:"flex",gap:"0.5rem"}},e("button",{onClick:A=>{A.stopPropagation(),R(!1),i(b)},style:{flex:1,padding:"0.5rem 0.75rem",backgroundColor:"#fc4c02",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.85rem",fontWeight:"500"}},"Upload"),e("button",{onClick:A=>{A.stopPropagation(),R(!1)},style:{flex:1,padding:"0.5rem 0.75rem",backgroundColor:"#f3f4f6",color:"#374151",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.85rem"}},"Cancel"))):null))),W?e("div",{style:{position:"fixed",inset:0,zIndex:999},onClick:()=>R(!1)}):null)}return e("div",{className:"tvs-activity-card",style:{border:"1px solid #ddd",padding:"1rem",marginBottom:"1rem",borderRadius:"4px",backgroundColor:x?"#f0f9ff":"#fff"}},e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},e("div",null,e("strong",null,G),e("div",{style:{marginTop:"0.5rem",fontSize:"0.9rem",color:"#666"}},v>0?e("span",null,"Distance: "+(v/1e3).toFixed(2)+" km "):null,c>0?e("span",null,"Duration: "+Math.floor(c/60)+" min"):null)),e("div",null,x?e("div",{style:{textAlign:"right"}},e("span",{style:{color:"#10b981",fontWeight:"bold"}},"\u2713 Synced to Strava"),s?e("a",{href:"https://www.strava.com/activities/"+s,target:"_blank",rel:"noopener noreferrer",style:{display:"block",marginTop:"0.25rem",fontSize:"0.85rem"}},"View on Strava \u2192"):null):e("button",{className:"tvs-btn tvs-btn-strava",onClick:()=>i(b),disabled:n,style:{backgroundColor:"#fc4c02",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"4px",cursor:n?"wait":"pointer",opacity:n?.6:1}},n?"Uploading...":"Upload to Strava"))))}function ve(){let r=document.getElementById("tvs-app-root");if(r){let i=window.tvs_route_payload||null,n=r.getAttribute("data-route-id")||i&&i.id;w("Boot \u2192 routeId:",n,"inline payload:",!!i),de(oe,{initialData:i,routeId:n},r)}window.tvsMyActivitiesMount&&Array.isArray(window.tvsMyActivitiesMount)&&window.tvsMyActivitiesMount.forEach(i=>{let n=document.getElementById(i);n&&(w("Mounting MyActivities block on:",i),de(we,{},n))})}function we(){let{useState:r,useEffect:i,createElement:n}=D,[d,_]=r([]),[a,e]=r(!1),[l,b]=r(null),m=!!window.TVS_SETTINGS?.user;i(()=>{if(!m)return;s();let v=()=>{X&&console.info("[TVS] MyActivitiesStandalone: Received activity update event, reloading..."),s()};return window.addEventListener("tvs:activity-updated",v),()=>{window.removeEventListener("tvs:activity-updated",v)}},[]);async function s(){try{e(!0);let c=await fetch("/wp-json/tvs/v1/activities/me",{credentials:"same-origin",headers:{"X-TVS-Nonce":window.TVS_SETTINGS?.nonce||""}});if(!c.ok)throw new Error("Failed to load activities");let p=await c.json(),M=Array.isArray(p)?p:p.activities||[];_(M)}catch(v){h("Load activities FAIL:",v),_([])}finally{e(!1)}}async function x(v){try{b(v);let c=await fetch(`/wp-json/tvs/v1/activities/${v}/strava`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},credentials:"same-origin"}),p=await c.json();if(!c.ok)throw new Error(p.message||"Upload failed");window.tvsFlash("Uploaded to Strava!"),await s(),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(c){h("Strava upload FAIL:",c),window.tvsFlash("Failed to upload to Strava: "+(c?.message||String(c)),"error")}finally{b(null)}}if(!m){let v=Array.from({length:3}).map((c,p)=>({id:"dummy-"+p,meta:{_tvs_route_name:["Sample Route "+(p+1)],_tvs_activity_date:[new Date(Date.now()-p*864e5).toISOString()],_tvs_distance_m:[Math.round(5e3+Math.random()*5e3)],_tvs_duration_s:[Math.round(1200+Math.random()*1800)]}}));return n("div",{className:"tvs-activities-block",style:{marginTop:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",background:"#fff",padding:"1rem"}},n("h3",{style:{marginTop:0}},"My Activities"),n("div",{className:"tvs-activities-list",style:{marginBottom:"1rem"}},v.map(c=>n(q,{key:c.id,activity:c,React:D,compact:!0,dummy:!0}))),n("div",{style:{textAlign:"center",color:"#888",fontSize:"0.95rem",marginBottom:"0.5rem"}},"Sign in to see your recent activities."),n("div",{style:{textAlign:"center"}},n("a",{href:"/login",style:{color:"#1f2937",textDecoration:"underline",marginRight:12}},"Log in"),n("a",{href:"/register",style:{color:"#1f2937",textDecoration:"underline"}},"Register")))}return n(ae,{React:D,activities:d,loadingActivities:a,uploadToStrava:x,uploadingId:l})}X?w("Debug mode enabled."):document.addEventListener("keydown",function(r){if(r.key==="`"){let i=new URL(location.href);i.searchParams.set("tvsdebug","1"),location.href=i.toString()}}),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ve):ve()})();})();
//# sourceMappingURL=tvs-app.js.map
