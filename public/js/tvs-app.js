(()=>{(function(){let he=(t,i)=>(i||document).querySelector(t),Se=t=>new URLSearchParams(location.search).get(t),U=new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1";U||document.addEventListener("keydown",t=>{t.key==="`"&&(localStorage.setItem("tvsDev","1"),location.reload())});function L(...t){U&&console.debug("[TVS]",...t)}function _(...t){console.error("[TVS]",...t)}let Y=!!(window.React&&window.ReactDOM),I=!!(window.wp&&window.wp.element)?window.wp.element:{},N=Y?window.React:I||{},A=Y?window.ReactDOM:I||null,H=new WeakMap,se=A&&typeof A.createRoot=="function"||I&&typeof I.createRoot=="function";function K(t,i,n){try{let r=H.get(n);if(r&&typeof r.unmount=="function"?(r.unmount(),H.delete(n)):A&&typeof A.unmountComponentAtNode=="function"&&A.unmountComponentAtNode(n),se){let e=(A&&A.createRoot||I&&I.createRoot)(n);H.set(n,e),e.render(N.createElement(t,i));return}let v=A&&A.render||I&&I.render;if(v){v(N.createElement(t,i),n);return}_("Ingen render-funksjon tilgjengelig.")}catch(r){_("Mount feilet:",r)}}let W=Number(new URLSearchParams(location.search).get("tvsslow")||0);function Q(t){return new Promise(i=>setTimeout(i,t))}function Z(t){let i=Math.floor(t/60),n=Math.floor(t%60);return i+":"+(n<10?"0":"")+n}function ae({React:t,currentTime:i,duration:n}){let r=t.createElement,v=n>0?i/n*100:0;return r("div",{className:"tvs-progress"},r("div",{className:"tvs-progress__bar"},r("div",{className:"tvs-progress__fill",style:{width:Math.min(v,100)+"%"}})),r("div",{className:"tvs-progress__time"},Z(i)+" / "+Z(n)))}function re(){let t=N.createElement;return t("div",{className:"tvs-loading",role:"status","aria-live":"polite"},t("svg",{viewBox:"0 0 64 64",className:"tvs-runner","aria-hidden":"true"},t("line",{x1:4,y1:60,x2:60,y2:60,stroke:"#bbb",strokeWidth:2,className:"track"}),t("circle",{cx:26,cy:12,r:5,fill:"none",stroke:"#111",strokeWidth:2}),t("line",{x1:26,y1:17,x2:26,y2:35,stroke:"#111",strokeWidth:2}),t("line",{x1:26,y1:22,x2:40,y2:18,stroke:"#111",strokeWidth:2,className:"arm front",style:{transformOrigin:"26px 22px"}}),t("line",{x1:26,y1:22,x2:12,y2:26,stroke:"#111",strokeWidth:2,className:"arm back",style:{transformOrigin:"26px 22px"}}),t("line",{x1:26,y1:35,x2:40,y2:48,stroke:"#111",strokeWidth:2,className:"leg front",style:{transformOrigin:"26px 35px"}}),t("line",{x1:26,y1:35,x2:16,y2:54,stroke:"#111",strokeWidth:2,className:"leg back",style:{transformOrigin:"26px 35px"}})),t("div",null,t("div",{className:"tvs-skel line"}),t("div",{className:"tvs-skel line sm"}),t("div",null,t("span",{className:"tvs-skel block"}),t("span",{className:"tvs-skel block"}),t("span",{className:"tvs-skel block"}))))}function ce(t){let{useEffect:i,useRef:n,useState:r}=t,[v,s]=r(0),e=n(performance.now()),l=n(0);return i(()=>{let w,u=c=>{l.current+=1,c-e.current>=1e3&&(s(l.current),l.current=0,e.current=c),w=requestAnimationFrame(u)};return w=requestAnimationFrame(u),()=>cancelAnimationFrame(w)},[]),v}function le({React:t,routeId:i,lastStatus:n,lastError:r,currentTime:v,duration:s}){let{useEffect:e,useRef:l,useState:w,createElement:u}=t,c=ce(t),h=l(null),[m,d]=w(!1),[f,R]=w({x:16,y:16});e(()=>{if(!h.current)return;let k,E,y,B,M=!1;function P(x){x.target.closest(".tvs-dev__header")&&(M=!0,k=x.clientX,E=x.clientY,y=f.x,B=f.y,x.preventDefault())}function G(x){M&&R({x:y+(x.clientX-k),y:B+(x.clientY-E)})}function O(){M=!1}return window.addEventListener("mousedown",P),window.addEventListener("mousemove",G),window.addEventListener("mouseup",O),()=>{window.removeEventListener("mousedown",P),window.removeEventListener("mousemove",G),window.removeEventListener("mouseup",O)}},[f]);let F=s>0?(v/s*100).toFixed(1):"0.0",p={env:window.TVS_SETTINGS?.env,version:window.TVS_SETTINGS?.version,restRoot:window.TVS_SETTINGS?.restRoot,user:window.TVS_SETTINGS?.user,routeId:i,lastStatus:n||"idle",lastError:r?String(r):null,currentTime:v?v.toFixed(1):"0.0",duration:s||0,progress:F+"%",fps:c};function V(){navigator.clipboard.writeText(JSON.stringify({...p,time:new Date().toISOString()},null,2)).catch(console.error)}return u("div",{ref:h,className:`tvs-dev ${m?"is-min":""}`,style:{left:f.x+"px",top:f.y+"px"}},u("div",{className:"tvs-dev__header"},u("strong",null,"TVS Dev"),u("div",{className:"tvs-dev__spacer"}),u("span",{className:"tvs-dev__pill"},p.env||"n/a"),u("button",{className:"tvs-dev__btn",onClick:()=>d(!m),"aria-label":"Minimize"},"\u2581")),u("div",{className:"tvs-dev__body"},S("Route",p.routeId??"n/a"),S("User",p.user??"guest"),S("REST",p.restRoot??"n/a"),S("Status",p.lastStatus),p.lastError?S("Error",p.lastError,!0):null,S("Duration",p.duration+"s"),S("Current",p.currentTime+"s"),S("Progress",p.progress),S("FPS",String(p.fps)),u("div",{className:"tvs-dev__actions"},u("button",{onClick:V,className:"tvs-dev__btn"},"Copy debug"),u("button",{onClick:()=>{localStorage.setItem("tvsDev","0"),location.reload()},className:"tvs-dev__btn tvs-dev__btn--ghost"},"Disable"))));function S(D,k,E){return t.createElement("div",{className:"tvs-dev__row"},t.createElement("span",null,D),t.createElement("code",{className:E?"tvs-dev__err":""},k))}}function de({initialData:t,routeId:i}){let{useEffect:n,useState:r,useRef:v,createElement:s}=N,[e,l]=r(t||null),[w,u]=r(null),[c,h]=r(!1),[m,d]=r(!1),[f,R]=r(null),[F,p]=r([]),[V,S]=r(!1),[D,k]=r(null),[E,y]=r(t?"inline":"loading"),[B,M]=r(null),[P,G]=r(0),O=v(null),x=v(null);function j(o,a="success"){window.tvsFlash(o,a)}n(()=>{let o=new URLSearchParams(location.search).get("tvsforcefetch")==="1";if(e&&!o){L("Har inline payload, skipper fetch.",e);return}if(!i){u("Mangler routeId \u2013 hverken inline payload eller data-route-id.");return}(async()=>{try{L("Henter rute via REST:",i," (tvsslow:",W,"ms)"),y("loading"),W&&await Q(W);let g=await(await fetch(`/wp-json/tvs/v1/routes/${encodeURIComponent(i)}`,{credentials:"same-origin"})).json();L("REST OK:",g),l(g),y("ok")}catch(a){_("REST FAIL:",a),u("Kunne ikke hente rutedata."),M(a?.message||String(a)),y("error")}})()},[i]),n(()=>{J()},[]);async function J(){try{S(!0);let a=await fetch("/wp-json/tvs/v1/activities/me",{credentials:"same-origin",headers:{"X-TVS-Nonce":window.TVS_SETTINGS?.nonce||""}});if(!a.ok)throw new Error("Failed to load activities");let g=await a.json(),C=Array.isArray(g)?g:g.activities||[];p(C)}catch(o){_("Load activities FAIL:",o),p([])}finally{S(!1)}}n(()=>{if(!e)return;let o=O.current;if(!o)return;let a=null,g=!1;function C(){return new Promise((b,q)=>{if(window.Vimeo&&window.Vimeo.Player)return b();let z=document.querySelector('script[src="https://player.vimeo.com/api/player.js"]');if(z){z.addEventListener("load",()=>b()),z.addEventListener("error",()=>q(new Error("Vimeo API failed to load")));return}let T=document.createElement("script");T.src="https://player.vimeo.com/api/player.js",T.async=!0,T.onload=()=>b(),T.onerror=()=>q(new Error("Vimeo API failed to load")),document.head.appendChild(T)})}return(async()=>{try{if(await C(),g)return;a=new window.Vimeo.Player(o),x.current=a,a.getDuration().then(b=>{!Number(e?.meta?.duration_s)&&typeof b=="number"&&b>0}).catch(()=>{}),a.ready().catch(()=>{}),a.on("timeupdate",b=>{typeof b?.seconds=="number"&&G(b.seconds)})}catch{_("Vimeo API init failed")}})(),()=>{g=!0;try{a&&a.off&&a.off("timeupdate"),a&&a.destroy&&a.destroy()}catch{}x.current=null}},[e]);function ve(o){let a=e?.meta||{},g=Number(a.duration_s||0),C=Number(a.distance_m||0);if(g>0&&C>0&&o>=0){let b=Math.min(1,o/g);return Math.round(C*b)}return 0}async function ne(){try{let o=x.current;if(!o)return;h(!0),y("starting"),await o.setCurrentTime(0).catch(()=>{}),await o.play().catch(()=>{}),R(new Date),d(!0),y("running")}catch(o){_("Start session failed:",o),y("error")}finally{h(!1)}}async function fe(){try{let o=x.current;if(!o)return;h(!0),y("starting"),await o.play().catch(()=>{}),d(!0),y("running")}catch(o){_("Resume session failed:",o),y("error")}finally{h(!1)}}async function pe(){try{let o=x.current;if(!o)return;await o.pause(),d(!1),y("paused")}catch(o){_("[TVS] Pause failed:",o),j("Failed to pause: "+(o?.message||String(o)),"error"),y("error")}}async function oe(){try{let o=x.current;if(!o)return;h(!0),y("saving"),await o.pause();let a=await o.getCurrentTime(),g=Math.max(0,Math.floor(a||0)),C=f?f.toISOString():new Date(Date.now()-g*1e3).toISOString(),b=ve(g),q={route_id:e.id,route_name:e.title||"Unknown Route",activity_date:new Date().toISOString(),started_at:C,duration_s:g,distance_m:b},z=window.TVS_SETTINGS?.nonce||"";W&&await Q(W);let T=await fetch("/wp-json/tvs/v1/activities",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":z},credentials:"same-origin",body:JSON.stringify(q)});if(!T.ok){let we=await T.json();throw new Error(we.message||`HTTP ${T.status}`)}let _e=await T.json();j("Activity saved!"),y("ok"),d(!1),R(null),await J(),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(o){_("[TVS] Save activity failed:",o),j("Failed to save activity: "+(o?.message||String(o)),"error"),M(o?.message||String(o)),y("error")}finally{h(!1)}}async function xe(o){try{k(o),y("uploading");let a=await fetch(`/wp-json/tvs/v1/activities/${o}/strava`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},credentials:"same-origin"}),g=await a.json();if(!a.ok)throw new Error(g.message||"Upload failed");j("Uploaded to Strava!"),y("ok"),await J(),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(a){_("Strava upload FAIL:",a),j("Failed to upload to Strava: "+(a?.message||String(a)),"error"),M(a?.message||String(a)),y("error")}finally{k(null)}}if(w)return s("div",{className:"tvs-route tvs-error"},String(w));if(!e)return N.createElement(re,null);let ye=e.title||"Route",X=e.meta||{},ie=X.vimeo_id?String(X.vimeo_id):"",$=Number(X.duration_s||0),ge=!!window.TVS_SETTINGS?.user;return s("div",{className:"tvs-app"},s("h2",null,ye),ie?s("div",{className:"tvs-video"},s("iframe",{ref:O,width:560,height:315,src:"https://player.vimeo.com/video/"+encodeURIComponent(ie)+"?controls=0&title=0&byline=0&portrait=0&pip=0&playsinline=1&dnt=1&transparent=0&muted=0",frameBorder:0,allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0})):null,new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1"?s("div",{className:"tvs-meta"},s("pre",null,JSON.stringify(X,null,2))):null,s(ae,{React:N,currentTime:P,duration:$}),s("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"}},ge?m?[s("button",{key:"pause",className:"tvs-btn",onClick:pe,disabled:c,style:{backgroundColor:"#f59e0b"}},"Pause"),s("button",{key:"finish",className:"tvs-btn",onClick:oe,disabled:c,style:{backgroundColor:"#10b981"}},c?s("span",{className:"tvs-spinner","aria-hidden":"true"}):null,c?" Saving...":"Finish & Save")]:P>0&&f&&($===0||P<$-.5)?[s("button",{key:"resume",className:"tvs-btn",onClick:fe,disabled:c},c?s("span",{className:"tvs-spinner","aria-hidden":"true"}):null,c?" Starting...":"Resume Activity"),s("button",{key:"finish",className:"tvs-btn",onClick:oe,disabled:c,style:{backgroundColor:"#10b981"}},c?s("span",{className:"tvs-spinner","aria-hidden":"true"}):null,c?" Saving...":"Finish & Save"),s("button",{key:"restart",className:"tvs-btn",onClick:ne,disabled:c,style:{backgroundColor:"#334155"}},"Restart from 0:00")]:s("button",{className:"tvs-btn",onClick:ne,disabled:c},c?s("span",{className:"tvs-spinner","aria-hidden":"true"}):null,c?" Starting...":"Start Activity"):s("div",{style:{backgroundColor:"#fef3c7",border:"1px solid #f59e0b",padding:"1rem",margin:"0.5rem 0 0 0",borderRadius:"4px",width:"100%"}},s("strong",null,"\u26A0\uFE0F You must be logged in"),s("p",{style:{margin:"0.5rem 0 0 0"}},"Please ",s("a",{href:"/login",style:{color:"#1f2937",textDecoration:"underline"}},"log in")," to create activities and upload to Strava. Don't have an account? ",s("a",{href:"/register",style:{color:"#1f2937",textDecoration:"underline"}},"Register here"),"."))),U?s(le,{React:N,routeId:i,lastStatus:E,lastError:B,currentTime:P,duration:$}):null)}function ue({React:t,activities:i,loadingActivities:n,uploadToStrava:r,uploadingId:v}){let{useState:s,createElement:e}=t,[l,w]=s(!1),u=i.slice(0,5);return e("div",{className:"tvs-activities-block",style:{marginTop:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",background:"#fff",padding:"1rem"}},e("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1rem"}},e("h3",{style:{margin:0,fontSize:"1.25rem"}},"Recent Activities"),e("button",{onClick:()=>w(!l),style:{fontSize:"1.2em",background:"none",border:"none",cursor:"pointer",color:"#666"},"aria-label":l?"Expand":"Minimize"},l?"\u25B8":"\u25BE")),l?null:n?e("p",{style:{color:"#666"}},"Loading activities..."):u.length===0?e("p",{style:{color:"#666"}},"Start a new activity when you're ready"):e("div",null,e("div",{className:"tvs-activities-list",style:{marginBottom:"1rem"}},u.map(c=>e(ee,{key:c.id,activity:c,uploadToStrava:r,uploading:v===c.id,React:t,compact:!0}))),e("div",{style:{textAlign:"center",paddingTop:"0.5rem",borderTop:"1px solid #e5e7eb"}},e("a",{href:"/my-activities",style:{color:"#2563eb",textDecoration:"none",fontSize:"0.9rem"}},"Go to my activities \u2192"))))}function ee({activity:t,uploadToStrava:i,uploading:n,React:r,compact:v,dummy:s}){let{createElement:e}=r,l=t.meta||{},w=t.id,u=l._tvs_synced_strava?.[0]||l.synced_strava?.[0],c=l._tvs_strava_remote_id?.[0]||l.strava_activity_id?.[0],h=u==="1"||u===1,m=l._tvs_distance_m?.[0]||l.distance_m?.[0]||0,d=l._tvs_duration_s?.[0]||l.duration_s?.[0]||0,f=l._tvs_route_id?.[0]||l.route_id?.[0],R=l._tvs_route_name?.[0]||l.route_name?.[0]||"Unknown Route",F=l._tvs_activity_date?.[0]||l.activity_date?.[0]||t.date||"",p="";if(F)try{p=new Date(F).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{p=F}let V=p?`${R} (${p})`:R;if(v){let{useState:S}=r,[D,k]=S(!1);return s?e("div",{className:"tvs-activity-card-compact",style:{padding:"0.75rem",marginBottom:"0.5rem",borderRadius:"4px",background:"linear-gradient(90deg, #f3f4f6 60%, #e5e7eb 100%)",fontSize:"0.9rem",position:"relative",opacity:.6,filter:"grayscale(0.7)",pointerEvents:"none"}},e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"}},e("div",{style:{flex:1,minWidth:0}},e("div",{style:{fontWeight:"500",marginBottom:"0.25rem"}},V),e("div",{style:{fontSize:"0.85rem",color:"#888"}},m>0?(m/1e3).toFixed(2)+" km":"",m>0&&d>0?" \xB7 ":"",d>0?Math.floor(d/60)+" min":"")),e("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexShrink:0}},e("span",{style:{color:"#bbb",fontSize:"1.5rem",lineHeight:1,display:"flex",alignItems:"center"},title:"Preview"},"\u2713"),e("div",{style:{width:"32px",height:"32px",borderRadius:"4px",backgroundColor:"#e5e7eb",color:"#ccc",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold"}},"S")))):e("div",{className:"tvs-activity-card-compact",style:{padding:"0.75rem",marginBottom:"0.5rem",borderRadius:"4px",backgroundColor:"#f9fafb",fontSize:"0.9rem",position:"relative"}},e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"}},e("div",{style:{flex:1,minWidth:0}},e("div",{style:{fontWeight:"500",marginBottom:"0.25rem"}},V),e("div",{style:{fontSize:"0.85rem",color:"#666"}},m>0?(m/1e3).toFixed(2)+" km":"",m>0&&d>0?" \xB7 ":"",d>0?Math.floor(d/60)+" min":"")),e("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexShrink:0}},h?e("span",{style:{color:"#10b981",fontSize:"1.5rem",lineHeight:1,display:"flex",alignItems:"center"},title:"Synced to Strava"},"\u2713"):null,e("div",{style:{position:"relative"}},h?e("a",{href:c?"https://www.strava.com/activities/"+c:"#",target:"_blank",rel:"noopener noreferrer",title:"View on Strava",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"4px",backgroundColor:"#fc4c02",color:"white",textDecoration:"none",fontSize:"0.9rem",fontWeight:"bold"}},"S"):e("button",{onClick:E=>{E.stopPropagation(),k(!D)},disabled:n,title:"Upload to Strava",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"4px",backgroundColor:n?"#ccc":"#fc4c02",color:"white",border:"none",cursor:n?"wait":"pointer",fontSize:"0.9rem",fontWeight:"bold"}},n?"...":"S"),D&&!h&&!n?e("div",{style:{position:"absolute",right:0,top:"calc(100% + 0.5rem)",backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"0.75rem",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06)",zIndex:1e3,minWidth:"200px",whiteSpace:"nowrap"}},e("div",{style:{fontSize:"0.9rem",marginBottom:"0.5rem",color:"#374151"}},"Upload to Strava?"),e("div",{style:{display:"flex",gap:"0.5rem"}},e("button",{onClick:E=>{E.stopPropagation(),k(!1),i(w)},style:{flex:1,padding:"0.5rem 0.75rem",backgroundColor:"#fc4c02",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.85rem",fontWeight:"500"}},"Upload"),e("button",{onClick:E=>{E.stopPropagation(),k(!1)},style:{flex:1,padding:"0.5rem 0.75rem",backgroundColor:"#f3f4f6",color:"#374151",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.85rem"}},"Cancel"))):null))),D?e("div",{style:{position:"fixed",inset:0,zIndex:999},onClick:()=>k(!1)}):null)}return e("div",{className:"tvs-activity-card",style:{border:"1px solid #ddd",padding:"1rem",marginBottom:"1rem",borderRadius:"4px",backgroundColor:h?"#f0f9ff":"#fff"}},e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},e("div",null,e("strong",null,V),e("div",{style:{marginTop:"0.5rem",fontSize:"0.9rem",color:"#666"}},m>0?e("span",null,"Distance: "+(m/1e3).toFixed(2)+" km "):null,d>0?e("span",null,"Duration: "+Math.floor(d/60)+" min"):null)),e("div",null,h?e("div",{style:{textAlign:"right"}},e("span",{style:{color:"#10b981",fontWeight:"bold"}},"\u2713 Synced to Strava"),c?e("a",{href:"https://www.strava.com/activities/"+c,target:"_blank",rel:"noopener noreferrer",style:{display:"block",marginTop:"0.25rem",fontSize:"0.85rem"}},"View on Strava \u2192"):null):e("button",{className:"tvs-btn tvs-btn-strava",onClick:()=>i(w),disabled:n,style:{backgroundColor:"#fc4c02",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"4px",cursor:n?"wait":"pointer",opacity:n?.6:1}},n?"Uploading...":"Upload to Strava"))))}function te(){let t=document.getElementById("tvs-app-root");if(t){let i=window.tvs_route_payload||null,n=t.getAttribute("data-route-id")||i&&i.id;L("Boot \u2192 routeId:",n,"inline payload:",!!i),K(de,{initialData:i,routeId:n},t)}window.tvsMyActivitiesMount&&Array.isArray(window.tvsMyActivitiesMount)&&window.tvsMyActivitiesMount.forEach(i=>{let n=document.getElementById(i);n&&(L("Mounting MyActivities block on:",i),K(me,{},n))})}function me(){let{useState:t,useEffect:i,createElement:n}=N,[r,v]=t([]),[s,e]=t(!1),[l,w]=t(null),u=!!window.TVS_SETTINGS?.user;i(()=>{if(!u)return;c();let m=()=>{U&&console.info("[TVS] MyActivitiesStandalone: Received activity update event, reloading..."),c()};return window.addEventListener("tvs:activity-updated",m),()=>{window.removeEventListener("tvs:activity-updated",m)}},[]);async function c(){try{e(!0);let d=await fetch("/wp-json/tvs/v1/activities/me",{credentials:"same-origin",headers:{"X-TVS-Nonce":window.TVS_SETTINGS?.nonce||""}});if(!d.ok)throw new Error("Failed to load activities");let f=await d.json(),R=Array.isArray(f)?f:f.activities||[];v(R)}catch(m){_("Load activities FAIL:",m),v([])}finally{e(!1)}}async function h(m){try{w(m);let d=await fetch(`/wp-json/tvs/v1/activities/${m}/strava`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},credentials:"same-origin"}),f=await d.json();if(!d.ok)throw new Error(f.message||"Upload failed");window.tvsFlash("Uploaded to Strava!"),await c(),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(d){_("Strava upload FAIL:",d),window.tvsFlash("Failed to upload to Strava: "+(d?.message||String(d)),"error")}finally{w(null)}}if(!u){let m=Array.from({length:3}).map((d,f)=>({id:"dummy-"+f,meta:{_tvs_route_name:["Sample Route "+(f+1)],_tvs_activity_date:[new Date(Date.now()-f*864e5).toISOString()],_tvs_distance_m:[Math.round(5e3+Math.random()*5e3)],_tvs_duration_s:[Math.round(1200+Math.random()*1800)]}}));return n("div",{className:"tvs-activities-block",style:{marginTop:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",background:"#fff",padding:"1rem"}},n("h3",{style:{marginTop:0}},"My Activities"),n("div",{className:"tvs-activities-list",style:{marginBottom:"1rem"}},m.map(d=>n(ee,{key:d.id,activity:d,React:N,compact:!0,dummy:!0}))),n("div",{style:{textAlign:"center",color:"#888",fontSize:"0.95rem",marginBottom:"0.5rem"}},"Sign in to see your recent activities."),n("div",{style:{textAlign:"center"}},n("a",{href:"/login",style:{color:"#1f2937",textDecoration:"underline",marginRight:12}},"Log in"),n("a",{href:"/register",style:{color:"#1f2937",textDecoration:"underline"}},"Register")))}return n(ue,{React:N,activities:r,loadingActivities:s,uploadToStrava:h,uploadingId:l})}U?L("Debug mode enabled."):document.addEventListener("keydown",function(t){if(t.key==="`"){let i=new URL(location.href);i.searchParams.set("tvsdebug","1"),location.href=i.toString()}}),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",te):te()})();})();
//# sourceMappingURL=tvs-app.js.map
