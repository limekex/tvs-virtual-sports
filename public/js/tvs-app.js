(()=>{(function(){let xe=(t,a)=>(a||document).querySelector(t),_e=t=>new URLSearchParams(location.search).get(t),W=new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1";W||document.addEventListener("keydown",t=>{t.key==="`"&&(localStorage.setItem("tvsDev","1"),location.reload())});function F(...t){W&&console.debug("[TVS]",...t)}function x(...t){console.error("[TVS]",...t)}let ee=!!(window.React&&window.ReactDOM),D=!!(window.wp&&window.wp.element)?window.wp.element:{},N=ee?window.React:D||{},R=ee?window.ReactDOM:D||null,J=new WeakMap,le=R&&typeof R.createRoot=="function"||D&&typeof D.createRoot=="function";function te(t,a,n){try{let r=J.get(n);if(r&&typeof r.unmount=="function"?(r.unmount(),J.delete(n)):R&&typeof R.unmountComponentAtNode=="function"&&R.unmountComponentAtNode(n),le){let e=(R&&R.createRoot||D&&D.createRoot)(n);J.set(n,e),e.render(N.createElement(t,a));return}let f=R&&R.render||D&&D.render;if(f){f(N.createElement(t,a),n);return}x("Ingen render-funksjon tilgjengelig.")}catch(r){x("Mount feilet:",r)}}let O=Number(new URLSearchParams(location.search).get("tvsslow")||0);function Y(t){return new Promise(a=>setTimeout(a,t))}function ne(t){let a=Math.floor(t/60),n=Math.floor(t%60);return a+":"+(n<10?"0":"")+n}function ce({React:t,currentTime:a,duration:n}){let r=t.createElement,f=n>0?a/n*100:0;return r("div",{className:"tvs-progress"},r("div",{className:"tvs-progress__bar"},r("div",{className:"tvs-progress__fill",style:{width:Math.min(f,100)+"%"}})),r("div",{className:"tvs-progress__time"},ne(a)+" / "+ne(n)))}function de(){let t=N.createElement;return t("div",{className:"tvs-loading",role:"status","aria-live":"polite"},t("svg",{viewBox:"0 0 64 64",className:"tvs-runner","aria-hidden":"true"},t("line",{x1:4,y1:60,x2:60,y2:60,stroke:"#bbb",strokeWidth:2,className:"track"}),t("circle",{cx:26,cy:12,r:5,fill:"none",stroke:"#111",strokeWidth:2}),t("line",{x1:26,y1:17,x2:26,y2:35,stroke:"#111",strokeWidth:2}),t("line",{x1:26,y1:22,x2:40,y2:18,stroke:"#111",strokeWidth:2,className:"arm front",style:{transformOrigin:"26px 22px"}}),t("line",{x1:26,y1:22,x2:12,y2:26,stroke:"#111",strokeWidth:2,className:"arm back",style:{transformOrigin:"26px 22px"}}),t("line",{x1:26,y1:35,x2:40,y2:48,stroke:"#111",strokeWidth:2,className:"leg front",style:{transformOrigin:"26px 35px"}}),t("line",{x1:26,y1:35,x2:16,y2:54,stroke:"#111",strokeWidth:2,className:"leg back",style:{transformOrigin:"26px 35px"}})),t("div",null,t("div",{className:"tvs-skel line"}),t("div",{className:"tvs-skel line sm"}),t("div",null,t("span",{className:"tvs-skel block"}),t("span",{className:"tvs-skel block"}),t("span",{className:"tvs-skel block"}))))}function ue(t){let{useEffect:a,useRef:n,useState:r}=t,[f,i]=r(0),e=n(performance.now()),c=n(0);return a(()=>{let w,u=l=>{c.current+=1,l-e.current>=1e3&&(i(c.current),c.current=0,e.current=l),w=requestAnimationFrame(u)};return w=requestAnimationFrame(u),()=>cancelAnimationFrame(w)},[]),f}function me({React:t,routeId:a,lastStatus:n,lastError:r,currentTime:f,duration:i}){let{useEffect:e,useRef:c,useState:w,createElement:u}=t,l=ue(t),h=c(null),[m,d]=w(!1),[p,A]=w({x:16,y:16});e(()=>{if(!h.current)return;let _,k,g,B,M=!1;function L(E){E.target.closest(".tvs-dev__header")&&(M=!0,_=E.clientX,k=E.clientY,g=p.x,B=p.y,E.preventDefault())}function G(E){M&&A({x:g+(E.clientX-_),y:B+(E.clientY-k)})}function I(){M=!1}return window.addEventListener("mousedown",L),window.addEventListener("mousemove",G),window.addEventListener("mouseup",I),()=>{window.removeEventListener("mousedown",L),window.removeEventListener("mousemove",G),window.removeEventListener("mouseup",I)}},[p]);let j=i>0?(f/i*100).toFixed(1):"0.0",y={env:window.TVS_SETTINGS?.env,version:window.TVS_SETTINGS?.version,restRoot:window.TVS_SETTINGS?.restRoot,user:window.TVS_SETTINGS?.user,routeId:a,lastStatus:n||"idle",lastError:r?String(r):null,currentTime:f?f.toFixed(1):"0.0",duration:i||0,progress:j+"%",fps:l};function U(){navigator.clipboard.writeText(JSON.stringify({...y,time:new Date().toISOString()},null,2)).catch(console.error)}return u("div",{ref:h,className:`tvs-dev ${m?"is-min":""}`,style:{left:p.x+"px",top:p.y+"px"}},u("div",{className:"tvs-dev__header"},u("strong",null,"TVS Dev"),u("div",{className:"tvs-dev__spacer"}),u("span",{className:"tvs-dev__pill"},y.env||"n/a"),u("button",{className:"tvs-dev__btn",onClick:()=>d(!m),"aria-label":"Minimize"},"\u2581")),u("div",{className:"tvs-dev__body"},S("Route",y.routeId??"n/a"),S("User",y.user??"guest"),S("REST",y.restRoot??"n/a"),S("Status",y.lastStatus),y.lastError?S("Error",y.lastError,!0):null,S("Duration",y.duration+"s"),S("Current",y.currentTime+"s"),S("Progress",y.progress),S("FPS",String(y.fps)),u("div",{className:"tvs-dev__actions"},u("button",{onClick:U,className:"tvs-dev__btn"},"Copy debug"),u("button",{onClick:()=>{localStorage.setItem("tvsDev","0"),location.reload()},className:"tvs-dev__btn tvs-dev__btn--ghost"},"Disable"))));function S(P,_,k){return t.createElement("div",{className:"tvs-dev__row"},t.createElement("span",null,P),t.createElement("code",{className:k?"tvs-dev__err":""},_))}}function ve({initialData:t,routeId:a}){let{useEffect:n,useState:r,useRef:f,createElement:i}=N,[e,c]=r(t||null),[w,u]=r(null),[l,h]=r(!1),[m,d]=r(!1),[p,A]=r(null),[j,y]=r([]),[U,S]=r(!1),[P,_]=r(null),[k,g]=r(t?"inline":"loading"),[B,M]=r(null),[L,G]=r(0),[I,E]=r(!1),K=f(null),Q=f(null);function V(o,s="success"){window.tvsFlash(o,s)}n(()=>{let o=new URLSearchParams(location.search).get("tvsforcefetch")==="1";if(e&&!o){F("Har inline payload, skipper fetch.",e);return}if(!a){u("Mangler routeId \u2013 hverken inline payload eller data-route-id.");return}(async()=>{try{F("Henter rute via REST:",a," (tvsslow:",O,"ms)"),g("loading"),O&&await Y(O);let v=await(await fetch(`/wp-json/tvs/v1/routes/${encodeURIComponent(a)}`,{credentials:"same-origin"})).json();F("REST OK:",v),c(v),g("ok")}catch(s){x("REST FAIL:",s),u("Kunne ikke hente rutedata."),M(s?.message||String(s)),g("error")}})()},[a]),n(()=>{Z()},[]);async function Z(){try{S(!0);let s=await fetch("/wp-json/tvs/v1/activities/me",{credentials:"same-origin",headers:{"X-TVS-Nonce":window.TVS_SETTINGS?.nonce||""}});if(!s.ok)throw new Error("Failed to load activities");let v=await s.json(),C=Array.isArray(v)?v:v.activities||[];y(C)}catch(o){x("Load activities FAIL:",o),y([])}finally{S(!1)}}n(()=>{if(!e)return;let o=K.current;if(!o)return;let s=null,v=!1;function C(){return new Promise((b,H)=>{if(window.Vimeo&&window.Vimeo.Player)return b();let z=document.querySelector('script[src="https://player.vimeo.com/api/player.js"]');if(z){z.addEventListener("load",()=>b()),z.addEventListener("error",()=>H(new Error("Vimeo API failed to load")));return}let T=document.createElement("script");T.src="https://player.vimeo.com/api/player.js",T.async=!0,T.onload=()=>b(),T.onerror=()=>H(new Error("Vimeo API failed to load")),document.head.appendChild(T)})}return(async()=>{try{if(await C(),v)return;s=new window.Vimeo.Player(o),Q.current=s,s.getDuration().then(b=>{!Number(e?.meta?.duration_s)&&typeof b=="number"&&b>0}).catch(()=>{});try{await s.ready(),v||E(!0)}catch{}s.on("timeupdate",b=>{typeof b?.seconds=="number"&&G(b.seconds)})}catch{x("Vimeo API init failed")}})(),()=>{v=!0;try{s&&s.off&&s.off("timeupdate"),s&&s.destroy&&s.destroy()}catch{}Q.current=null,E(!1)}},[e]);async function X(o=5e3){let s=Date.now();for(;Date.now()-s<o;){let v=Q.current;if(v)try{return await v.ready(),E(!0),v}catch{}await Y(100)}throw new Error("Video player is not ready")}function ye(o){let s=e?.meta||{},v=Number(s.duration_s||0),C=Number(s.distance_m||0);if(v>0&&C>0&&o>=0){let b=Math.min(1,o/v);return Math.round(C*b)}return 0}async function ie(){try{h(!0);let o=await X();g("starting"),await o.setCurrentTime(0).catch(()=>{}),await o.play().catch(()=>{}),A(new Date),d(!0),g("running")}catch(o){x("Start session failed:",o),V("Player not ready yet. Please wait a moment and try again.","error"),g("error")}finally{h(!1)}}async function ge(){try{h(!0);let o=await X();g("starting"),await o.play().catch(()=>{}),d(!0),g("running")}catch(o){x("Resume session failed:",o),V("Player not ready yet. Please wait a moment and try again.","error"),g("error")}finally{h(!1)}}async function we(){try{await(await X()).pause(),d(!1),g("paused")}catch(o){x("[TVS] Pause failed:",o),V("Failed to pause: "+(o?.message||String(o)),"error"),g("error")}}async function se(){try{h(!0);let o=await X();g("saving"),await o.pause();let s=await o.getCurrentTime(),v=Math.max(0,Math.floor(s||0)),C=p?p.toISOString():new Date(Date.now()-v*1e3).toISOString(),b=ye(v),H={route_id:e.id,route_name:e.title||"Unknown Route",activity_date:new Date().toISOString(),started_at:C,duration_s:v,distance_m:b},z=window.TVS_SETTINGS?.nonce||"";O&&await Y(O);let T=await fetch("/wp-json/tvs/v1/activities",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":z},credentials:"same-origin",body:JSON.stringify(H)});if(!T.ok){let be=await T.json();throw new Error(be.message||`HTTP ${T.status}`)}let Ne=await T.json();V("Activity saved!"),g("ok"),d(!1),A(null),await Z(),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(o){x("[TVS] Save activity failed:",o),V("Failed to save activity: "+(o?.message||String(o)),"error"),M(o?.message||String(o)),g("error")}finally{h(!1)}}async function Ee(o){try{_(o),g("uploading");let s=await fetch(`/wp-json/tvs/v1/activities/${o}/strava`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},credentials:"same-origin"}),v=await s.json();if(!s.ok)throw new Error(v.message||"Upload failed");V("Uploaded to Strava!"),g("ok"),await Z(),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(s){x("Strava upload FAIL:",s),V("Failed to upload to Strava: "+(s?.message||String(s)),"error"),M(s?.message||String(s)),g("error")}finally{_(null)}}if(w)return i("div",{className:"tvs-route tvs-error"},String(w));if(!e)return N.createElement(de,null);let he=e.title||"Route",$=e.meta||{},re=$.vimeo_id?String($.vimeo_id):"",q=Number($.duration_s||0),Se=!!window.TVS_SETTINGS?.user;return i("div",{className:"tvs-app"},i("h2",null,he),re?i("div",{className:"tvs-video"},i("iframe",{ref:K,width:560,height:315,src:"https://player.vimeo.com/video/"+encodeURIComponent(re)+"?controls=0&title=0&byline=0&portrait=0&pip=0&playsinline=1&dnt=1&transparent=0&muted=0",frameBorder:0,allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0})):null,new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1"?i("div",{className:"tvs-meta"},i("pre",null,JSON.stringify($,null,2))):null,i(ce,{React:N,currentTime:L,duration:q}),i("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"}},Se?m?[i("button",{key:"pause",className:"tvs-btn",onClick:we,disabled:l||!I,style:{backgroundColor:"#f59e0b"}},"Pause"),i("button",{key:"finish",className:"tvs-btn",onClick:se,disabled:l||!I,style:{backgroundColor:"#10b981"}},l?i("span",{className:"tvs-spinner","aria-hidden":"true"}):null,l?" Saving...":"Finish & Save")]:L>0&&p&&(q===0||L<q-.5)?[i("button",{key:"resume",className:"tvs-btn",onClick:ge,disabled:l||!I},l?i("span",{className:"tvs-spinner","aria-hidden":"true"}):null,l?" Starting...":"Resume Activity"),i("button",{key:"finish",className:"tvs-btn",onClick:se,disabled:l||!I,style:{backgroundColor:"#10b981"}},l?i("span",{className:"tvs-spinner","aria-hidden":"true"}):null,l?" Saving...":"Finish & Save"),i("button",{key:"restart",className:"tvs-btn",onClick:ie,disabled:l||!I,style:{backgroundColor:"#334155"}},"Restart from 0:00")]:i("button",{className:"tvs-btn",onClick:ie,disabled:l||!I},l?i("span",{className:"tvs-spinner","aria-hidden":"true"}):null,l?" Starting...":"Start Activity"):i("div",{style:{backgroundColor:"#fef3c7",border:"1px solid #f59e0b",padding:"1rem",margin:"0.5rem 0 0 0",borderRadius:"4px",width:"100%"}},i("strong",null,"\u26A0\uFE0F You must be logged in"),i("p",{style:{margin:"0.5rem 0 0 0"}},"Please ",i("a",{href:"/login",style:{color:"#1f2937",textDecoration:"underline"}},"log in")," to create activities and upload to Strava. Don't have an account? ",i("a",{href:"/register",style:{color:"#1f2937",textDecoration:"underline"}},"Register here"),"."))),W?i(me,{React:N,routeId:a,lastStatus:k,lastError:B,currentTime:L,duration:q}):null)}function fe({React:t,activities:a,loadingActivities:n,uploadToStrava:r,uploadingId:f}){let{useState:i,createElement:e}=t,[c,w]=i(!1),u=a.slice(0,5);return e("div",{className:"tvs-activities-block",style:{marginTop:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",background:"#fff",padding:"1rem"}},e("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1rem"}},e("h3",{style:{margin:0,fontSize:"1.25rem"}},"Recent Activities"),e("button",{onClick:()=>w(!c),style:{fontSize:"1.2em",background:"none",border:"none",cursor:"pointer",color:"#666"},"aria-label":c?"Expand":"Minimize"},c?"\u25B8":"\u25BE")),c?null:n?e("p",{style:{color:"#666"}},"Loading activities..."):u.length===0?e("p",{style:{color:"#666"}},"Start a new activity when you're ready"):e("div",null,e("div",{className:"tvs-activities-list",style:{marginBottom:"1rem"}},u.map(l=>e(oe,{key:l.id,activity:l,uploadToStrava:r,uploading:f===l.id,React:t,compact:!0}))),e("div",{style:{textAlign:"center",paddingTop:"0.5rem",borderTop:"1px solid #e5e7eb"}},e("a",{href:"/my-activities",style:{color:"#2563eb",textDecoration:"none",fontSize:"0.9rem"}},"Go to my activities \u2192"))))}function oe({activity:t,uploadToStrava:a,uploading:n,React:r,compact:f,dummy:i}){let{createElement:e}=r,c=t.meta||{},w=t.id,u=c._tvs_synced_strava?.[0]||c.synced_strava?.[0],l=c._tvs_strava_remote_id?.[0]||c.strava_activity_id?.[0],h=u==="1"||u===1,m=c._tvs_distance_m?.[0]||c.distance_m?.[0]||0,d=c._tvs_duration_s?.[0]||c.duration_s?.[0]||0,p=c._tvs_route_id?.[0]||c.route_id?.[0],A=c._tvs_route_name?.[0]||c.route_name?.[0]||"Unknown Route",j=c._tvs_activity_date?.[0]||c.activity_date?.[0]||t.date||"",y="";if(j)try{y=new Date(j).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{y=j}let U=y?`${A} (${y})`:A;if(f){let{useState:S}=r,[P,_]=S(!1);return i?e("div",{className:"tvs-activity-card-compact",style:{padding:"0.75rem",marginBottom:"0.5rem",borderRadius:"4px",background:"linear-gradient(90deg, #f3f4f6 60%, #e5e7eb 100%)",fontSize:"0.9rem",position:"relative",opacity:.6,filter:"grayscale(0.7)",pointerEvents:"none"}},e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"}},e("div",{style:{flex:1,minWidth:0}},e("div",{style:{fontWeight:"500",marginBottom:"0.25rem"}},U),e("div",{style:{fontSize:"0.85rem",color:"#888"}},m>0?(m/1e3).toFixed(2)+" km":"",m>0&&d>0?" \xB7 ":"",d>0?Math.floor(d/60)+" min":"")),e("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexShrink:0}},e("span",{style:{color:"#bbb",fontSize:"1.5rem",lineHeight:1,display:"flex",alignItems:"center"},title:"Preview"},"\u2713"),e("div",{style:{width:"32px",height:"32px",borderRadius:"4px",backgroundColor:"#e5e7eb",color:"#ccc",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold"}},"S")))):e("div",{className:"tvs-activity-card-compact",style:{padding:"0.75rem",marginBottom:"0.5rem",borderRadius:"4px",backgroundColor:"#f9fafb",fontSize:"0.9rem",position:"relative"}},e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"}},e("div",{style:{flex:1,minWidth:0}},e("div",{style:{fontWeight:"500",marginBottom:"0.25rem"}},U),e("div",{style:{fontSize:"0.85rem",color:"#666"}},m>0?(m/1e3).toFixed(2)+" km":"",m>0&&d>0?" \xB7 ":"",d>0?Math.floor(d/60)+" min":"")),e("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexShrink:0}},h?e("span",{style:{color:"#10b981",fontSize:"1.5rem",lineHeight:1,display:"flex",alignItems:"center"},title:"Synced to Strava"},"\u2713"):null,e("div",{style:{position:"relative"}},h?e("a",{href:l?"https://www.strava.com/activities/"+l:"#",target:"_blank",rel:"noopener noreferrer",title:"View on Strava",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"4px",backgroundColor:"#fc4c02",color:"white",textDecoration:"none",fontSize:"0.9rem",fontWeight:"bold"}},"S"):e("button",{onClick:k=>{k.stopPropagation(),_(!P)},disabled:n,title:"Upload to Strava",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"4px",backgroundColor:n?"#ccc":"#fc4c02",color:"white",border:"none",cursor:n?"wait":"pointer",fontSize:"0.9rem",fontWeight:"bold"}},n?"...":"S"),P&&!h&&!n?e("div",{style:{position:"absolute",right:0,top:"calc(100% + 0.5rem)",backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"0.75rem",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06)",zIndex:1e3,minWidth:"200px",whiteSpace:"nowrap"}},e("div",{style:{fontSize:"0.9rem",marginBottom:"0.5rem",color:"#374151"}},"Upload to Strava?"),e("div",{style:{display:"flex",gap:"0.5rem"}},e("button",{onClick:k=>{k.stopPropagation(),_(!1),a(w)},style:{flex:1,padding:"0.5rem 0.75rem",backgroundColor:"#fc4c02",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.85rem",fontWeight:"500"}},"Upload"),e("button",{onClick:k=>{k.stopPropagation(),_(!1)},style:{flex:1,padding:"0.5rem 0.75rem",backgroundColor:"#f3f4f6",color:"#374151",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.85rem"}},"Cancel"))):null))),P?e("div",{style:{position:"fixed",inset:0,zIndex:999},onClick:()=>_(!1)}):null)}return e("div",{className:"tvs-activity-card",style:{border:"1px solid #ddd",padding:"1rem",marginBottom:"1rem",borderRadius:"4px",backgroundColor:h?"#f0f9ff":"#fff"}},e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},e("div",null,e("strong",null,U),e("div",{style:{marginTop:"0.5rem",fontSize:"0.9rem",color:"#666"}},m>0?e("span",null,"Distance: "+(m/1e3).toFixed(2)+" km "):null,d>0?e("span",null,"Duration: "+Math.floor(d/60)+" min"):null)),e("div",null,h?e("div",{style:{textAlign:"right"}},e("span",{style:{color:"#10b981",fontWeight:"bold"}},"\u2713 Synced to Strava"),l?e("a",{href:"https://www.strava.com/activities/"+l,target:"_blank",rel:"noopener noreferrer",style:{display:"block",marginTop:"0.25rem",fontSize:"0.85rem"}},"View on Strava \u2192"):null):e("button",{className:"tvs-btn tvs-btn-strava",onClick:()=>a(w),disabled:n,style:{backgroundColor:"#fc4c02",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"4px",cursor:n?"wait":"pointer",opacity:n?.6:1}},n?"Uploading...":"Upload to Strava"))))}function ae(){let t=document.getElementById("tvs-app-root");if(t){let a=window.tvs_route_payload||null,n=t.getAttribute("data-route-id")||a&&a.id;F("Boot \u2192 routeId:",n,"inline payload:",!!a),te(ve,{initialData:a,routeId:n},t)}window.tvsMyActivitiesMount&&Array.isArray(window.tvsMyActivitiesMount)&&window.tvsMyActivitiesMount.forEach(a=>{let n=document.getElementById(a);n&&(F("Mounting MyActivities block on:",a),te(pe,{},n))})}function pe(){let{useState:t,useEffect:a,createElement:n}=N,[r,f]=t([]),[i,e]=t(!1),[c,w]=t(null),u=!!window.TVS_SETTINGS?.user;a(()=>{if(!u)return;l();let m=()=>{W&&console.info("[TVS] MyActivitiesStandalone: Received activity update event, reloading..."),l()};return window.addEventListener("tvs:activity-updated",m),()=>{window.removeEventListener("tvs:activity-updated",m)}},[]);async function l(){try{e(!0);let d=await fetch("/wp-json/tvs/v1/activities/me",{credentials:"same-origin",headers:{"X-TVS-Nonce":window.TVS_SETTINGS?.nonce||""}});if(!d.ok)throw new Error("Failed to load activities");let p=await d.json(),A=Array.isArray(p)?p:p.activities||[];f(A)}catch(m){x("Load activities FAIL:",m),f([])}finally{e(!1)}}async function h(m){try{w(m);let d=await fetch(`/wp-json/tvs/v1/activities/${m}/strava`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},credentials:"same-origin"}),p=await d.json();if(!d.ok)throw new Error(p.message||"Upload failed");window.tvsFlash("Uploaded to Strava!"),await l(),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(d){x("Strava upload FAIL:",d),window.tvsFlash("Failed to upload to Strava: "+(d?.message||String(d)),"error")}finally{w(null)}}if(!u){let m=Array.from({length:3}).map((d,p)=>({id:"dummy-"+p,meta:{_tvs_route_name:["Sample Route "+(p+1)],_tvs_activity_date:[new Date(Date.now()-p*864e5).toISOString()],_tvs_distance_m:[Math.round(5e3+Math.random()*5e3)],_tvs_duration_s:[Math.round(1200+Math.random()*1800)]}}));return n("div",{className:"tvs-activities-block",style:{marginTop:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",background:"#fff",padding:"1rem"}},n("h3",{style:{marginTop:0}},"My Activities"),n("div",{className:"tvs-activities-list",style:{marginBottom:"1rem"}},m.map(d=>n(oe,{key:d.id,activity:d,React:N,compact:!0,dummy:!0}))),n("div",{style:{textAlign:"center",color:"#888",fontSize:"0.95rem",marginBottom:"0.5rem"}},"Sign in to see your recent activities."),n("div",{style:{textAlign:"center"}},n("a",{href:"/login",style:{color:"#1f2937",textDecoration:"underline",marginRight:12}},"Log in"),n("a",{href:"/register",style:{color:"#1f2937",textDecoration:"underline"}},"Register")))}return n(fe,{React:N,activities:r,loadingActivities:i,uploadToStrava:h,uploadingId:c})}W?F("Debug mode enabled."):document.addEventListener("keydown",function(t){if(t.key==="`"){let a=new URL(location.href);a.searchParams.set("tvsdebug","1"),location.href=a.toString()}}),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ae):ae()})();})();
//# sourceMappingURL=tvs-app.js.map
