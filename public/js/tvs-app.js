(()=>{var U4=Object.create;var i4=Object.defineProperty;var I4=Object.getOwnPropertyDescriptor;var N4=Object.getOwnPropertyNames;var G4=Object.getPrototypeOf,q4=Object.prototype.hasOwnProperty;var W4=(r,l)=>()=>(l||r((l={exports:{}}).exports,l),l.exports);var j4=(r,l,C,i)=>{if(l&&typeof l=="object"||typeof l=="function")for(let v of N4(l))!q4.call(r,v)&&v!==C&&i4(r,v,{get:()=>l[v],enumerable:!(i=I4(l,v))||i.enumerable});return r};var l4=(r,l,C)=>(C=r!=null?U4(G4(r)):{},j4(l||!r||!r.__esModule?i4(C,"default",{value:r,enumerable:!0}):C,r));var N2=W4((v3,o4)=>{o4.exports=window.React});var W=new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1";function M(...r){W&&console.debug("[TVS]",...r)}function I(...r){console.error("[TVS]",...r)}var C4=!!(window.React&&window.ReactDOM),_4=!!(window.wp&&window.wp.element),F1=_4?window.wp.element:{},r1=C4?window.React:F1||{},x1=C4?window.ReactDOM:F1||null,U2=new WeakMap,K4=x1&&typeof x1.createRoot=="function"||F1&&typeof F1.createRoot=="function";function e4(r,l,C){try{let i=U2.get(C);if(i&&typeof i.unmount=="function"&&(i.unmount(),U2.delete(C)),K4){let R=(x1&&x1.createRoot||F1&&F1.createRoot)(C);U2.set(C,R),R.render(r1.createElement(r,l));return}x1&&typeof x1.unmountComponentAtNode=="function"&&x1.unmountComponentAtNode(C);let v=x1&&x1.render||F1&&F1.render;if(v){v(r1.createElement(r,l),C);return}I("Ingen render-funksjon tilgjengelig.")}catch(i){I("Mount feilet:",i)}}function Q1(r){return new Promise(l=>setTimeout(l,r))}async function z2(r,l,C="operation"){let i;try{return await Promise.race([r,new Promise((v,t)=>{i=setTimeout(()=>t(new Error(C+" timed out")),l)})])}finally{clearTimeout(i)}}function I2({React:r,currentTime:l,duration:C}){let i=r.createElement,v=Math.floor(l/60),t=Math.floor(l%60),R=(N,A)=>N+":"+(A<10?"0":"")+A,a1=C>0?l/C*100:0;return i("div",{className:"tvs-progress"},i("div",{className:"tvs-progress__bar"},i("div",{className:"tvs-progress__fill",style:{width:Math.min(a1,100)+"%"}})),i("div",{className:"tvs-progress__time"},R(v,t)+" / "+R(Math.floor(C/60),Math.floor(C%60))))}var $1=l4(N2(),1);var G2=l4(N2(),1),q2={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},W2=G2.default.createContext&&G2.default.createContext(q2);var Q4=["attr","size","title"];function $4(r,l){if(r==null)return{};var C=Y4(r,l),i,v;if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);for(v=0;v<t.length;v++)i=t[v],!(l.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(C[i]=r[i])}return C}function Y4(r,l){if(r==null)return{};var C={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(l.indexOf(i)>=0)continue;C[i]=r[i]}return C}function m2(){return m2=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var C=arguments[l];for(var i in C)Object.prototype.hasOwnProperty.call(C,i)&&(r[i]=C[i])}return r},m2.apply(this,arguments)}function h4(r,l){var C=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);l&&(i=i.filter(function(v){return Object.getOwnPropertyDescriptor(r,v).enumerable})),C.push.apply(C,i)}return C}function w2(r){for(var l=1;l<arguments.length;l++){var C=arguments[l]!=null?arguments[l]:{};l%2?h4(Object(C),!0).forEach(function(i){X4(r,i,C[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(C)):h4(Object(C)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(C,i))})}return r}function X4(r,l,C){return l=J4(l),l in r?Object.defineProperty(r,l,{value:C,enumerable:!0,configurable:!0,writable:!0}):r[l]=C,r}function J4(r){var l=t3(r,"string");return typeof l=="symbol"?l:l+""}function t3(r,l){if(typeof r!="object"||!r)return r;var C=r[Symbol.toPrimitive];if(C!==void 0){var i=C.call(r,l||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(r)}function n4(r){return r&&r.map((l,C)=>$1.default.createElement(l.tag,w2({key:C},l.attr),n4(l.child)))}function S(r){return l=>$1.default.createElement(c3,m2({attr:w2({},r.attr)},l),n4(r.child))}function c3(r){var l=C=>{var{attr:i,size:v,title:t}=r,R=$4(r,Q4),a1=v||C.size||"1em",N;return C.className&&(N=C.className),r.className&&(N=(N?N+" ":"")+r.className),$1.default.createElement("svg",m2({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},C.attr,i,R,{className:N,style:w2(w2({color:r.color||C.color},C.style),r.style),height:a1,width:a1,xmlns:"http://www.w3.org/2000/svg"}),t&&$1.default.createElement("title",null,t),r.children)};return W2!==void 0?$1.default.createElement(W2.Consumer,null,C=>l(C)):l(q2)}function H2(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"},child:[]}]})(r)}function d2(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M11.9999 10.8284L7.0502 15.7782L5.63599 14.364L11.9999 8L18.3639 14.364L16.9497 15.7782L11.9999 10.8284Z"},child:[]}]})(r)}function B2(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M18.5374 19.5674C16.7844 21.0831 14.4993 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 14.1361 21.3302 16.1158 20.1892 17.7406L17 12H20C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C14.1502 20 16.1022 19.1517 17.5398 17.7716L18.5374 19.5674Z"},child:[]}]})(r)}function j2(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M7 19V13H17V19H19V7.82843L16.1716 5H5V19H7ZM4 3H17L21 7V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM9 15V19H15V15H9Z"},child:[]}]})(r)}function v4(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M20 22H4C3.44772 22 3 21.5523 3 21V3C3 2.44772 3.44772 2 4 2H20C20.5523 2 21 2.44772 21 3V21C21 21.5523 20.5523 22 20 22ZM19 20V4H5V20H19ZM8 7H16V9H8V7ZM8 11H16V13H8V11ZM8 15H16V17H8V15Z"},child:[]}]})(r)}function H4(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM16.5 7.5L10 10L7.5 16.5L14 14L16.5 7.5ZM12 13C11.4477 13 11 12.5523 11 12C11 11.4477 11.4477 11 12 11C12.5523 11 13 11.4477 13 12C13 12.5523 12.5523 13 12 13Z"},child:[]}]})(r)}function d4(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM15.5 8.5L13.5 13.5L8.5 15.5L10.5 10.5L15.5 8.5Z"},child:[]}]})(r)}function V4(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 20.8995L16.9497 15.9497C19.6834 13.2161 19.6834 8.78392 16.9497 6.05025C14.2161 3.31658 9.78392 3.31658 7.05025 6.05025C4.31658 8.78392 4.31658 13.2161 7.05025 15.9497L12 20.8995ZM12 23.7279L5.63604 17.364C2.12132 13.8492 2.12132 8.15076 5.63604 4.63604C9.15076 1.12132 14.8492 1.12132 18.364 4.63604C21.8787 8.15076 21.8787 13.8492 18.364 17.364L12 23.7279ZM12 13C13.1046 13 14 12.1046 14 11C14 9.89543 13.1046 9 12 9C10.8954 9 10 9.89543 10 11C10 12.1046 10.8954 13 12 13ZM12 15C9.79086 15 8 13.2091 8 11C8 8.79086 9.79086 7 12 7C14.2091 7 16 8.79086 16 11C16 13.2091 14.2091 15 12 15Z"},child:[]}]})(r)}function F2(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M18 7H22V9H16V3H18V7ZM8 9H2V7H6V3H8V9ZM18 17V21H16V15H22V17H18ZM8 15V21H6V17H2V15H8Z"},child:[]}]})(r)}function Y1(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8 3V5H4V9H2V3H8ZM2 21V15H4V19H8V21H2ZM22 21H16V19H20V15H22V21ZM22 9H20V5H16V3H22V9Z"},child:[]}]})(r)}function R2(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM9 9H11V15H9V9ZM13 9H15V15H13V9Z"},child:[]}]})(r)}function X1(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM10.6219 8.41459L15.5008 11.6672C15.6846 11.7897 15.7343 12.0381 15.6117 12.2219C15.5824 12.2658 15.5447 12.3035 15.5008 12.3328L10.6219 15.5854C10.4381 15.708 10.1897 15.6583 10.0672 15.4745C10.0234 15.4088 10 15.3316 10 15.2526V8.74741C10 8.52649 10.1791 8.34741 10.4 8.34741C10.479 8.34741 10.5562 8.37078 10.6219 8.41459Z"},child:[]}]})(r)}function L4(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M17 18.4142L21.1925 22.6067L22.6067 21.1925L2.80769 1.39349L1.39348 2.80771L2.58579 4.00001H2C1.44772 4.00001 1 4.44773 1 5.00001V19C1 19.5523 1.44772 20 2 20H16C16.5523 20 17 19.5523 17 19V18.4142ZM15 16.4142V18H3V6.00001H4.58579L15 16.4142ZM23 18.0397C23 18.2517 22.875 18.4176 22.7083 18.4943L21 16.786V8.84133L17 11.6413V12.786L15 10.786V6.00001H10.214L8.21402 4.00001H16C16.5523 4.00001 17 4.44773 17 5.00001V9.20001L22.2133 5.55073C22.5447 5.31876 23 5.55583 23 5.96034V18.0397Z"},child:[]}]})(r)}function g4(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M17 9.2L22.2133 5.55071C22.4395 5.39235 22.7513 5.44737 22.9096 5.6736C22.9684 5.75764 23 5.85774 23 5.96033V18.0397C23 18.3158 22.7761 18.5397 22.5 18.5397C22.3974 18.5397 22.2973 18.5081 22.2133 18.4493L17 14.8V19C17 19.5523 16.5523 20 16 20H2C1.44772 20 1 19.5523 1 19V5C1 4.44772 1.44772 4 2 4H16C16.5523 4 17 4.44772 17 5V9.2ZM17 12.3587L21 15.1587V8.84131L17 11.6413V12.3587ZM3 6V18H15V6H3Z"},child:[]}]})(r)}function u4(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M11 11V5H13V11H19V13H13V19H11V13H5V11H11Z"},child:[]}]})(r)}function M4(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M5 11V13H19V11H5Z"},child:[]}]})(r)}function p4(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748ZM10 10V7H12V10H15V12H12V15H10V12H7V10H10Z"},child:[]}]})(r)}function s4(r){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748ZM7 10H15V12H7V10Z"},child:[]}]})(r)}function _2(){let r=r1.createElement;return r("div",{className:"tvs-loading",role:"status","aria-live":"polite"},r("svg",{viewBox:"0 0 64 64",className:"tvs-runner","aria-hidden":"true"},r("line",{x1:4,y1:60,x2:60,y2:60,stroke:"#bbb",strokeWidth:2,className:"track"}),r("circle",{cx:26,cy:12,r:5,fill:"none",stroke:"#111",strokeWidth:2}),r("line",{x1:26,y1:17,x2:26,y2:35,stroke:"#111",strokeWidth:2}),r("line",{x1:26,y1:22,x2:40,y2:18,stroke:"#111",strokeWidth:2,className:"arm front",style:{transformOrigin:"26px 22px"}}),r("line",{x1:26,y1:22,x2:12,y2:26,stroke:"#111",strokeWidth:2,className:"arm back",style:{transformOrigin:"26px 22px"}}),r("line",{x1:26,y1:35,x2:40,y2:48,stroke:"#111",strokeWidth:2,className:"leg front",style:{transformOrigin:"26px 35px"}}),r("line",{x1:26,y1:35,x2:16,y2:54,stroke:"#111",strokeWidth:2,className:"leg back",style:{transformOrigin:"26px 35px"}})),r("div",null,r("div",{className:"tvs-skel line"}),r("div",{className:"tvs-skel line sm"}),r("div",null,r("span",{className:"tvs-skel block"}),r("span",{className:"tvs-skel block"}),r("span",{className:"tvs-skel block"}))))}function K2({React:r,routeId:l,lastStatus:C,lastError:i,currentTime:v,duration:t}){let{useEffect:R,useRef:a1,useState:N,createElement:A}=r;function i1(J){let{useEffect:G,useRef:t1,useState:F}=J,[d,g]=F(0),f=t1(performance.now()),K=t1(0);return G(()=>{let y,O=Q=>{K.current+=1,Q-f.current>=1e3&&(g(K.current),K.current=0,f.current=Q),y=requestAnimationFrame(O)};return y=requestAnimationFrame(O),()=>cancelAnimationFrame(y)},[]),d}let Z1=i1(r),T1=a1(null),[X,R1]=N(!1),[o1,A2]=N({x:16,y:16});R(()=>{if(!T1.current)return;let G,t1,F,d,g=!1;function f(O){O.target.closest(".tvs-dev__header")&&(g=!0,G=O.clientX,t1=O.clientY,F=o1.x,d=o1.y,O.preventDefault())}function K(O){g&&A2({x:F+(O.clientX-G),y:d+(O.clientY-t1)})}function y(){g=!1}return window.addEventListener("mousedown",f),window.addEventListener("mousemove",K),window.addEventListener("mouseup",y),()=>{window.removeEventListener("mousedown",f),window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",y)}},[o1]);let J1=t>0?(v/t*100).toFixed(1):"0.0",P={env:window.TVS_SETTINGS?.env,version:window.TVS_SETTINGS?.version,restRoot:window.TVS_SETTINGS?.restRoot,user:window.TVS_SETTINGS?.user,routeId:l,lastStatus:C||"idle",lastError:i?String(i):null,currentTime:v?v.toFixed(1):"0.0",duration:t||0,progress:J1+"%",fps:Z1};function Z(J,G,t1){return A("div",{className:"tvs-dev__row"},A("span",null,J),A("code",{className:t1?"tvs-dev__err":""},G))}function A1(){navigator.clipboard.writeText(JSON.stringify({...P,time:new Date().toISOString()},null,2)).catch(console.error)}return A("div",{ref:T1,className:`tvs-dev ${X?"is-min":""}`,style:{left:o1.x+"px",top:o1.y+"px"}},A("div",{className:"tvs-dev__header"},A("strong",null,"TVS Dev"),A("div",{className:"tvs-dev__spacer"}),A("span",{className:"tvs-dev__pill"},P.env||"n/a"),A("button",{className:"tvs-dev__btn",onClick:()=>R1(!X),"aria-label":"Minimize"},"\u2581")),A("div",{className:"tvs-dev__body"},Z("Route",P.routeId??"n/a"),Z("User",P.user??"guest"),Z("REST",P.restRoot??"n/a"),Z("Status",P.lastStatus),P.lastError?Z("Error",P.lastError,!0):null,Z("Duration",P.duration+"s"),Z("Current",P.currentTime+"s"),Z("Progress",P.progress),Z("FPS",String(P.fps)),A("div",{className:"tvs-dev__actions"},A("button",{onClick:A1,className:"tvs-dev__btn"},"Copy debug"),A("button",{onClick:()=>{localStorage.setItem("tvsDev","0"),location.reload()},className:"tvs-dev__btn tvs-dev__btn--ghost"},"Disable"))))}function x4(r){return S({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 320h-96c-17.6 0-32-14.4-32-32s14.4-32 32-32h96s96-107 96-160-43-96-96-96-96 43-96 96c0 25.5 22.2 63.4 45.3 96H320c-52.9 0-96 43.1-96 96s43.1 96 96 96h96c17.6 0 32 14.4 32 32s-14.4 32-32 32H185.5c-16 24.8-33.8 47.7-47.3 64H416c52.9 0 96-43.1 96-96s-43.1-96-96-96zm0-256c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zM96 256c-53 0-96 43-96 96s96 160 96 160 96-107 96-160-43-96-96-96zm0 128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(r)}function Z4(r){return S({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"},child:[]}]})(r)}var f4={FaLandmark:"\u{1F3DB}\uFE0F",FaTheaterMasks:"\u{1F3AD}",FaFortAwesome:"\u{1F3F0}",FaChurch:"\u26EA",FaTrain:"\u{1F689}",FaTree:"\u{1F333}",FaMountain:"\u{1F3D4}\uFE0F",FaWater:"\u{1F4A7}",FaBridge:"\u{1F309}",FaMonument:"\u{1F5FF}",FaUniversity:"\u{1F393}",FaHospital:"\u{1F3E5}",FaStore:"\u{1F3EA}",FaCoffee:"\u2615",FaCamera:"\u{1F4F7}"};function Q2({routeData:r,routeId:l}){let{useEffect:C,useState:i,useRef:v,createElement:t}=r1,R=window.TVS_SETTINGS?.mapbox||{},{accessToken:a1="",style:N="mapbox://styles/mapbox/satellite-streets-v12",initialZoom:A=14,flyToZoom:i1=16,minZoom:Z1=10,maxZoom:T1=18,pitch:X=60,bearing:R1=0,defaultSpeed:o1=1,cameraOffset:A2=2e-4,smoothFactor:J1=.7,markerColor:P="#ff0000",routeColor:Z="#ec4899",routeWidth:A1=6,terrainEnabled:J=!1,terrainExaggeration:G=1.5,buildings3dEnabled:t1=!1}=R,F=new URLSearchParams(window.location.search).get("debug")==="1",d=(...c)=>{F&&console.log("[VirtualTraining]",...c)};function g(c,e="success"){typeof window.tvsFlash=="function"&&window.tvsFlash(c,e)}let[f,K]=i(!0),[y,O]=i(12),[Q,h1]=i(!1),[l1,S2]=i(!0),[$,f1]=i(!0),[P1,O1]=i(!0),[T,t2]=i(null),[n1,S1]=i(0),[y2,v1]=i(0),[E1,c2]=i(0),[z1,U1]=i(0),[I1,H1]=i(0),[z,N1]=i(!1),[r2,d1]=i(!1),[a2,i2]=i(""),[y1,l2]=i(""),[G1,D2]=i(""),[m1,Y2]=i(0),[V1,L1]=i(!1),[g1,w1]=i("Run"),[D1,L2]=i(!1),[a,o]=i(!1),p=v(null),V=v(null),s=v(null),u=v(null),u1=v(null),_=v(null),M1=v(null),j=v(l1),b1=v($),C2=v(y),e2=v(null),q1=v(null),k1=v(null),o2=v(0),B1=v(null),h2=v(null),W1=v(null),g2=v(null),u2=v(null),b2=v(null),M2=v(null),[X2,m4]=i([]),[w4,k2]=i(!1),p2=c=>{W1.current&&(clearTimeout(W1.current),W1.current=null),c===null&&h2.current!==null?(k2(!0),W1.current=setTimeout(()=>{h2.current=null,t2(null),k2(!1)},300)):(k2(!1),h2.current=c,t2(c))},s2=r?.meta?.gpx_url||"",J2=r?.title||"Route",n2=r?.mapbox_token||"",[T2,t4]=i(0),C1=T2>0?T2:r?.meta?.distance_km||0,x2=C1>0&&y>0?Math.round(C1/y*60):0;C(()=>{j.current=l1},[l1]),C(()=>{b1.current=$},[$]),C(()=>{C2.current=y},[y]),C(()=>{F&&(console.log("\u{1F30D} window.TVS_SETTINGS:",window.TVS_SETTINGS),console.log("\u{1F4E6} window.TVS_SETTINGS.mapbox:",window.TVS_SETTINGS?.mapbox),console.log("\u{1F4CA} mapboxSettings object:",R),console.log("\u{1F527} Mapbox Settings:",{hasSettings:!!window.TVS_SETTINGS?.mapbox,style:N,initialZoom:A,pitch:X,terrainEnabled:J,terrainExaggeration:G,markerColor:P,routeColor:Z,routeWidth:A1}))},[]);function v2(c,e,H,n){let m=(H-c)*Math.PI/180,h=(n-e)*Math.PI/180,L=Math.sin(m/2)*Math.sin(m/2)+Math.cos(c*Math.PI/180)*Math.cos(H*Math.PI/180)*Math.sin(h/2)*Math.sin(h/2);return 6371*(2*Math.atan2(Math.sqrt(L),Math.sqrt(1-L)))}function B4(c,e,H,n){let b=(n-e)*Math.PI/180,m=Math.sin(b)*Math.cos(H*Math.PI/180),h=Math.cos(c*Math.PI/180)*Math.sin(H*Math.PI/180)-Math.sin(c*Math.PI/180)*Math.cos(H*Math.PI/180)*Math.cos(b);return(Math.atan2(m,h)*180/Math.PI+360)%360}function F4(c,e,H,n){if(!H||H.length===0)return 0;let b=0,m=1/0;H.forEach((L,Y)=>{let E=v2(L.lat,L.lng,e,c);E<m&&(m=E,b=Y)});let h=0;for(let L=0;L<b&&L<H.length-1;L++)h+=v2(H[L].lat,H[L].lng,H[L+1].lat,H[L+1].lng);return h}C(()=>{!l||B1.current||(async()=>{try{d("\u{1F4CA} Pre-loading route distance for routeId:",l);let c=await fetch(`/wp-json/tvs/v1/routes/${l}/gpx-data`);if(!c.ok){console.error("\u274C Failed to pre-fetch GPX data:",c.status,c.statusText);return}let e=await c.json();if(!e.points||e.points.length===0){console.error("\u274C No GPS points in GPX data");return}B1.current=e;let H=0;for(let n=0;n<e.points.length-1;n++)H+=v2(e.points[n].lat,e.points[n].lng,e.points[n+1].lat,e.points[n+1].lng);d("\u2705 Pre-calculated distance:",H.toFixed(2),"km"),t4(H)}catch(c){console.error("\u274C Failed to pre-load distance:",c)}})()},[l]),C(()=>{l&&(d("\u{1F4CD} Fetching PoI data..."),(async()=>{try{let c=await fetch(`/wp-json/tvs/v1/routes/${l}/pois`);if(!c.ok){d("\u26A0\uFE0F No PoI data available:",c.status);return}let e=await c.json();d("\u2705 Loaded PoIs:",e.length,"items");let H=e.map(n=>({id:n.id,name:n.name,description:n.description||"",triggerDistanceMeters:n.trigger_distance_m||150,hideDistanceMeters:n.hide_distance_m||100,lng:n.lng,lat:n.lat,icon:n.icon||"\u{1F4CD}",color:n.color||"#8b5cf6",imageUrl:n.image_url||null,imageThumbnail:n.image_thumbnail||null,customIconUrl:n.custom_icon_url||null,iconType:n.icon_type||"library"}));m4(H)}catch(c){console.error("\u274C Failed to load PoI data:",c)}})())},[l]),C(()=>()=>{W1.current&&clearTimeout(W1.current)},[]),C(()=>{if(!u2.current||!B1.current?.points){F&&console.log("Elevation chart: missing canvas or GPX data",{hasCanvas:!!u2.current,hasGpxData:!!B1.current,hasPoints:!!B1.current?.points});return}let c=u2.current,e=c.getContext("2d"),H=B1.current.points;F&&console.log("Drawing elevation chart with",H.length,"points");let n=c.width,b=c.height;e.clearRect(0,0,n,b);let m=H.map(E=>E.ele||0).filter(E=>E>0);if(m.length===0){F&&console.log("No elevation data found in GPX points");return}F&&console.log("Elevation range:",Math.min(...m),"-",Math.max(...m));let h=Math.min(...m),Y=Math.max(...m)-h;if(Y===0){F&&console.log("Elevation range is 0, cannot draw chart");return}e.beginPath(),e.strokeStyle="#667eea",e.lineWidth=2,e.fillStyle="rgba(102, 126, 234, 0.2)",H.forEach((E,p1)=>{if(!E.ele)return;let B=p1/(H.length-1)*n,x=b-(E.ele-h)/Y*b;p1===0?e.moveTo(B,x):e.lineTo(B,x)}),e.lineTo(n,b),e.lineTo(0,b),e.closePath(),e.fill(),e.beginPath(),H.forEach((E,p1)=>{if(!E.ele)return;let B=p1/(H.length-1)*n,x=b-(E.ele-h)/Y*b;p1===0?e.moveTo(B,x):e.lineTo(B,x)}),e.stroke(),F&&console.log("Elevation chart drawn successfully")},[f]),C(()=>{if(!f){if(!s2||!window.mapboxgl||!p.current||!n2){d("\u23F3 Waiting for map initialization:",{gpxUrl:!!s2,mapboxgl:!!window.mapboxgl,mapRef:!!p.current,mapboxToken:!!n2,isWelcome:f});return}return d("\u{1F5FA}\uFE0F Initializing map..."),(async()=>{try{let c=B1.current;if(c)d("\u267B\uFE0F Using cached GPX data");else{d("\u{1F4E5} Fetching GPX data from REST endpoint...");let H=await fetch(`/wp-json/tvs/v1/routes/${l}/gpx-data`);if(!H.ok){console.error("\u274C Failed to fetch GPX data:",H.status,H.statusText),g("Failed to load route data. Please refresh the page.","error");return}c=await H.json(),B1.current=c}if(d("\u{1F4E6} GPX data ready:",{points:c.points?.length,first:c.points?.[0],last:c.points?.[c.points?.length-1],gpxUrl:s2}),!c.points||c.points.length===0){console.error("\u274C No GPS points in GPX data"),g("No GPS data found for this route.","error");return}if(T2===0){let H=0;for(let n=0;n<c.points.length-1;n++)H+=v2(c.points[n].lat,c.points[n].lng,c.points[n+1].lat,c.points[n+1].lng);d("\u2705 Calculated distance during map init:",H.toFixed(2),"km"),t4(H)}window.mapboxgl.accessToken=n2||a1;let e=new window.mapboxgl.Map({container:p.current,style:N,center:[c.points[0].lng,c.points[0].lat],zoom:A,pitch:X,bearing:R1,minZoom:Z1,maxZoom:T1});V.current=e,e.on("load",()=>{if(d("\u{1F6E0}\uFE0F Map loaded, attempting to create GSAP timeline..."),J&&(d("\u{1F3D4}\uFE0F Enabling 3D terrain with exaggeration:",G),e.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),e.setTerrain({source:"mapbox-dem",exaggeration:G})),t1){d("\u{1F3E2} Enabling 3D buildings");let h=e.getStyle().layers.find(L=>L.type==="symbol"&&L.layout["text-field"])?.id;e.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","min_height"],"fill-extrusion-opacity":.6}},h)}let H=c.points.map(m=>[m.lng,m.lat]);e.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:H}}}),e.addLayer({id:"route-line",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":Z,"line-width":A1,"line-opacity":1}}),_.current="route-line",e.addSource("completed-route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[c.points[0].lng,c.points[0].lat]]}}}),e.addLayer({id:"completed-route-line",type:"line",source:"completed-route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#84cc16","line-width":A1,"line-opacity":1}}),u1.current="completed-route-line";let n=document.createElement("div");n.className="virtual-training-marker",n.style.width="20px",n.style.height="20px",n.style.borderRadius="50%",n.style.backgroundColor=P,n.style.border="3px solid white",n.style.boxShadow="0 0 10px rgba(0,0,0,0.5)";let b=new window.mapboxgl.Marker(n).setLngLat([c.points[0].lng,c.points[0].lat]).addTo(e);if(s.current=b,X2.forEach(m=>{let h=document.createElement("div");if(h.className="poi-marker",h.style.width="40px",h.style.height="40px",h.style.borderRadius="50%",h.style.backgroundColor=m.color||"#8b5cf6",h.style.border="3px solid white",h.style.boxShadow="0 2px 6px rgba(0,0,0,0.3)",h.style.display="flex",h.style.alignItems="center",h.style.justifyContent="center",h.style.cursor="pointer",m.iconType==="custom"&&m.customIconUrl){h.style.fontSize="0",h.style.padding="6px";let L=document.createElement("img");L.src=m.customIconUrl,L.style.width="100%",L.style.height="100%",L.style.objectFit="contain",L.style.filter="drop-shadow(0 1px 2px rgba(0,0,0,0.3))",h.appendChild(L)}else{let L=f4[m.icon]||m.icon||"\u{1F4CD}";h.style.fontSize="20px",h.style.textShadow="0 1px 2px rgba(0,0,0,0.3)",h.innerHTML=L}new window.mapboxgl.Marker(h).setLngLat([m.lng,m.lat]).addTo(e)}),window.gsap){!c.points||c.points.length<2?console.warn("\u274C Not enough route points for animation!"):d("\u2705 Enough route points, initializing smooth timeline...",c.points.length);let m=c.distance_km/y*3600;d("\u{1F552} Timeline duration (s):",m);let h=[0];for(let B=1;B<c.points.length;B++){let x=v2(c.points[B-1].lat,c.points[B-1].lng,c.points[B].lat,c.points[B].lng);h.push(h[B-1]+x)}let L=h[h.length-1];d("\u{1F4CF} Total distance from points:",L.toFixed(3),"km");let Y={lng:c.points[0].lng,lat:c.points[0].lat},E={bearing:0},p1=window.gsap.timeline({paused:!0,onUpdate:()=>{let B=p1.progress()*L,x=0;for(let w=0;w<h.length-1;w++)if(B>=h[w]&&B<=h[w+1]){x=w;break}let f2=0;if(x<h.length-1){let w=h[x],D=h[x+1]-w;D>0&&(f2=(B-w)/D)}let _1,K1;if(x<c.points.length-1?(_1=c.points[x].lng+(c.points[x+1].lng-c.points[x].lng)*f2,K1=c.points[x].lat+(c.points[x+1].lat-c.points[x].lat)*f2):(_1=c.points[c.points.length-1].lng,K1=c.points[c.points.length-1].lat),s.current&&s.current.setLngLat([_1,K1]),b1.current&&x<c.points.length-1){let k=Math.min(B+.02,L),D=x;for(let q=x;q<h.length-1;q++)if(k>=h[q]&&k<=h[q+1]){D=q;break}let c1=0;if(D<h.length-1){let q=h[D],a4=h[D+1]-q;a4>0&&(c1=(k-q)/a4)}let s1,U;D<c.points.length-1?(s1=c.points[D].lng+(c.points[D+1].lng-c.points[D].lng)*c1,U=c.points[D].lat+(c.points[D+1].lat-c.points[D].lat)*c1):(s1=c.points[c.points.length-1].lng,U=c.points[c.points.length-1].lat);let e1=B4(K1,_1,U,s1);if(g2.current!==null){let q=e1-g2.current;q>180&&(q-=360),q<-180&&(q+=360),e1=g2.current+q*.15}E.bearing=e1,g2.current=e1}j.current&&V.current&&V.current.jumpTo({center:[_1,K1],bearing:b1.current?E.bearing:0});let O2=c.points.slice(0,x+1).map(w=>[w.lng,w.lat]);if(O2.push([_1,K1]),O2.length>0&&V.current&&V.current.getSource("completed-route")?.setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:O2}}),S1(B),b2.current&&L>0){let w=B/L*100;b2.current.style.left=`${w}%`,F&&Math.random()<.01&&console.log("Marker position:",w.toFixed(2)+"%")}if(c.points[x]?.ele!==void 0){let w=c.points[x].ele;x<c.points.length-1&&c.points[x+1]?.ele!==void 0&&(w=c.points[x].ele+(c.points[x+1].ele-c.points[x].ele)*f2),v1(Math.round(w));let D=Math.min(B+.2,L),c1=0,s1=0;for(let U=x;U<c.points.length-1;U++){let e1=h[U],q=h[U+1];if(e1>D)break;q<=D&&c.points[U]?.ele!==void 0&&c.points[U+1]?.ele!==void 0&&(c1+=c.points[U+1].ele-c.points[U].ele,s1++)}if(s1>0){let U=(D-B)*1e3;if(U>0){let e1=c1/U*100;c2(Math.round(e1))}}}let E2=0;q1.current&&(E2=(Date.now()-q1.current-o2.current)/1e3,U1(E2));let E4=L-B,r4=C2.current;if(r4>0){let w=E4/r4*3600,k=E2+w;H1(k)}X2.forEach(w=>{let k=F4(w.lng,w.lat,c.points,x),D=(w.triggerDistanceMeters||150)/1e3,c1=(w.hideDistanceMeters||100)/1e3,s1=B>=k-D&&B<=k,U=B>k&&B<=k+c1,e1=B>k+c1;s1||U?h2.current?.id!==w.id&&(d("\u2705 Showing PoI:",w.name,{currentDist:B.toFixed(2),poiDist:k.toFixed(2),phase:s1?"approaching":"passed",triggerRange:`${(k-D).toFixed(2)} - ${k.toFixed(2)}`,hideRange:`${k.toFixed(2)} - ${(k+c1).toFixed(2)}`}),p2(w)):h2.current?.id===w.id&&e1&&(d("\u274C Hiding PoI:",w.name,{currentDist:B.toFixed(2),poiDist:k.toFixed(2),hideThreshold:(k+c1).toFixed(2)}),p2(null))})}});p1.to(Y,{lng:c.points[c.points.length-1].lng,lat:c.points[c.points.length-1].lat,duration:m,ease:"none"},0),u.current=p1,e2.current=y,d("\u{1F3AC} GSAP smooth timeline created:",{keyframes:1}),d("\u{1F4CD} timelineRef.current set:",!!u.current),d("\u26A1 Initial speed stored:",y)}})}catch(c){console.error("\u274C Failed to load GPX data:",c),g("Error loading route data: "+c.message,"error")}})(),()=>{V.current&&V.current.remove(),u.current&&u.current.kill()}}},[s2,l,n2,f]);function R4(){d("\u25B6\uFE0F Start Training clicked"),d("  - Timeline exists:",!!u.current),d("  - Map exists:",!!V.current),d("  - Marker exists:",!!s.current),d("  - GSAP available:",!!window.gsap),K(!1);let c=C1/y*3600;H1(c),setTimeout(()=>{u.current&&Z2()},100)}function Z2(){if(u.current){if(Q)u.current.pause(),k1.current=Date.now(),P2(),g("Activity paused");else if(O4(),q1.current){if(k1.current){let c=Date.now()-k1.current;o2.current+=c,k1.current=null,g("Activity resumed")}u.current.play()}else if(q1.current=Date.now(),o2.current=0,g("Activity started"),d("\u{1F3AC} First play detected, preparing flyTo..."),d("  - Map instance:",!!V.current),d("  - Marker:",!!s.current),d("  - Timeline:",!!u.current),V.current&&s.current&&u.current){let c=s.current.getLngLat();d("\u2708\uFE0F Starting flyTo animation (2s):",{lng:c.lng,lat:c.lat,zoom:A+2,currentZoom:V.current.getZoom()}),u.current.pause(),V.current.flyTo({center:[c.lng,c.lat],zoom:i1,pitch:X,duration:2e3,essential:!0}),setTimeout(()=>{u.current&&(d("\u25B6\uFE0F Starting timeline after flyTo complete"),u.current.play())},2100)}else console.warn("\u26A0\uFE0F Cannot execute flyTo - waiting for map/marker/timeline..."),u.current&&u.current.play();h1(!Q)}}function A4(){if(!u.current)return;u.current.restart(),h1(!0),S1(0),U1(0),p2(null),q1.current=Date.now(),k1.current=null,o2.current=0;let c=C1/C2.current*3600;H1(c),g("Activity restarted")}function S4(){if(V.current){let c=j.current;j.current=!1,V.current.zoomIn(),setTimeout(()=>{j.current=c},100)}}function y4(){if(V.current){let c=j.current;j.current=!1,V.current.zoomOut(),setTimeout(()=>{j.current=c},100)}}function D4(){let c=Math.min(y+1,50);if(O(c),u.current&&e2.current){let e=c/e2.current;u.current.timeScale(e),d(`\u26A1 Speed increased to ${c} km/h (timeScale: ${e.toFixed(2)})`),g(`Speed increased to ${c} km/h`,"success")}}function b4(){let c=Math.max(y-1,1);if(O(c),u.current&&e2.current){let e=c/e2.current;u.current.timeScale(e),d(`\u26A1 Speed decreased to ${c} km/h (timeScale: ${e.toFixed(2)})`),g(`Speed decreased to ${c} km/h`,"warning")}}function k4(){if(!V.current||!_.current)return;let c=P1?"none":"visible";V.current.setLayoutProperty("route-line","visibility",c),O1(!P1)}function T4(){i2(n1.toFixed(3));let c=Math.round(z1),e=Math.floor(c/3600),H=Math.floor(c%3600/60),n=c%60;e>0?l2(`${e}:${H.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`):l2(`${H}:${n.toString().padStart(2,"0")}`),d1(!0),Q&&u.current&&(u.current.pause(),k1.current=Date.now(),h1(!1))}async function P4(){if(!a2||!y1){g("Please enter both distance and time","error");return}L1(!0);try{let c=parseFloat(a2)*1e3,e;if(y1.includes(":")){let h=y1.split(":").map(L=>parseInt(L.trim())||0);if(h.length===3){let[L,Y,E]=h;e=L*3600+Y*60+E}else if(h.length===2){let[L,Y]=h;e=L*60+Y}else e=0}else e=parseInt(y1)||0;if(c<=0||e<=0){g("Distance and time must be greater than zero","error"),L1(!1);return}let H=new Date().toISOString(),n={route_id:l,route_name:J2,activity_date:H,started_at:H,ended_at:H,duration_s:e,distance_m:c,visibility:"private",activity_type:g1,is_virtual:!0,source:"virtual"};G1&&(n.notes=G1),m1>0&&(n.rating=m1);let b=await fetch("/wp-json/tvs/v1/activities",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},body:JSON.stringify(n)});if(!b.ok){let h=await b.json().catch(()=>({}));throw new Error(h.message||"Failed to save activity")}let m=await b.json();d("\u2705 Activity saved:",m),d1(!1),L1(!1),u.current&&(u.current.pause(),u.current.progress(0)),K(!0),h1(!1),P2(),S1(0),U1(0),H1(0),p2(null),q1.current=null,k1.current=null,o2.current=0,g("Activity saved successfully! \u{1F389}","success"),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(c){console.error("Failed to save activity:",c),g("Failed to save activity: "+(c?.message||"Unknown error"),"error"),L1(!1)}}function c4(){let c=document.querySelector(".tvs-virtual-training");c&&(z?(document.exitFullscreen&&document.exitFullscreen(),N1(!1)):(c.requestFullscreen&&c.requestFullscreen(),N1(!0)))}C(()=>{function c(){let e=!!document.fullscreenElement;N1(e),setTimeout(()=>{V.current&&V.current.resize()},100)}return document.addEventListener("fullscreenchange",c),()=>document.removeEventListener("fullscreenchange",c)},[]),C(()=>{V.current&&(setTimeout(()=>V.current.resize(),50),setTimeout(()=>V.current.resize(),150),setTimeout(()=>V.current.resize(),300))},[z]),C(()=>{function c(e){(e.key==="f"||e.key==="F")&&(f||c4())}return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[f,z]);let O4=async()=>{try{"wakeLock"in navigator&&(M2.current=await navigator.wakeLock.request("screen"),W&&M("Wake Lock activated"))}catch(c){W&&M("Wake Lock error:",c)}},P2=async()=>{try{M2.current&&(await M2.current.release(),M2.current=null,W&&M("Wake Lock released"))}catch(c){W&&M("Wake Lock release error:",c)}};C(()=>()=>{M1.current&&cancelAnimationFrame(M1.current),P2()},[]);function j1(c){let e=Math.floor(c/60),H=Math.floor(c%60);return`${e}:${H.toString().padStart(2,"0")}`}return f?n2?t("div",{className:"tvs-virtual-training tvs-virtual-training--welcome"},t("div",{className:"tvs-panel tvs-welcome-panel"},t("h2",{className:"tvs-welcome-title"},J2),t("div",{className:"tvs-welcome-stats"},t("div",{className:"tvs-stat-card"},t("span",{className:"tvs-stat-label"},"Distance"),t("span",{className:"tvs-stat-value"},C1>0?`${C1.toFixed(2)} km`:"Loading...")),t("div",{className:"tvs-stat-card"},t("span",{className:"tvs-stat-label"},"Est. Duration"),t("span",{className:"tvs-stat-value"},x2>0?`${x2} min`:"--"))),t("div",{className:"tvs-speed-section"},t("label",{className:"tvs-speed-label"},t("span",{className:"tvs-speed-title"},"Set your initial speed"),t("span",{className:"tvs-speed-hint"},"You can increase/decrease during the activity according to your treadmill speed")),t("div",{className:"tvs-speed-input-group"},t("input",{type:"number",className:"tvs-input tvs-speed-input",value:y,onChange:c=>O(Number(c.target.value)||12),min:1,max:50,step:.5}),t("span",{className:"tvs-speed-unit"},"km/h"))),t("button",{className:"tvs-btn tvs-btn--primary tvs-welcome-btn",onClick:R4,disabled:C1<=0},C1>0?"Start Training":"Loading route data..."))):t("div",{className:"tvs-virtual-training tvs-virtual-training--welcome"},t("div",{className:"virtual-training-welcome"},t("h2",null,"\u26A0\uFE0F Configuration Required"),t("p",{style:{color:"#e53e3e",marginBottom:"1rem"}},"Mapbox access token is missing. Please configure it in TVS Settings."),t("p",null,"Administrators: Go to TVS \u2192 Settings and add your Mapbox token."))):t("div",{className:`tvs-virtual-training ${z?"tvs-virtual-training--fullscreen":""}`},t("div",{ref:p,className:"virtual-training-map",style:{width:z?"100vw":"100%",height:z?"100vh":"70vh",position:z?"fixed":"relative",top:z?0:"auto",left:z?0:"auto",zIndex:z?1:"auto"}}),t("div",{className:`training-stats ${D1?"training-stats--minimized":""}`,onClick:()=>L2(!D1),title:D1?"Click to expand":"Click to minimize"},t("div",{className:"stats-toggle-icon"},t(D1?H2:d2,{size:16})),D1?[t("div",{key:"distance",className:"stat-item"},t("span",{className:"stat-label"},"Distance"),t("span",{className:"stat-value"},`${f?"0.00":n1.toFixed(2)}/${C1.toFixed(2)} km`)),t("div",{key:"time",className:"stat-item"},t("span",{className:"stat-label"},"Time"),t("span",{className:"stat-value"},`${f?"0:00":j1(z1)}/${j1(f?x2*60:I1)}`))]:[t("div",{key:"distance",className:"stat-item"},t("span",{className:"stat-label"},"Distance"),t("span",{className:"stat-value"},`${f?"0.00":n1.toFixed(2)} / ${C1.toFixed(2)} km`)),t("div",{key:"time",className:"stat-item"},t("span",{className:"stat-label"},"Time"),t("span",{className:"stat-value"},`${f?"0:00":j1(z1)} / ${j1(f?x2*60:I1)}`)),t("div",{key:"speed",className:"stat-item"},t("span",{className:"stat-label"},"Speed"),t("span",{className:"stat-value"},`${y} km/h`)),t("div",{key:"elevation",className:"stat-item"},t("span",{className:"stat-label"},"Elevation"),t("span",{className:"stat-value"},`${y2} m`)),t("div",{key:"gradient",className:"stat-item"},t("span",{className:"stat-label"},"Gradient"),t("span",{className:"stat-value",style:{color:E1>0?"#f56565":E1<0?"#48bb78":"white"}},`${E1>0?"+":""}${E1}%`)),t("div",{key:"chart",className:"elevation-chart-container"},t("canvas",{ref:u2,className:"elevation-chart",width:300,height:80}),t("div",{ref:b2,className:"elevation-marker",style:{left:"0%"}}))]),!Q&&!f?t("div",{className:"training-overlay-start",onClick:Z2},t("div",{className:"overlay-content"},t("button",{className:"overlay-play-btn",onClick:Z2},t(X1,{size:64})),t("div",{style:{fontSize:20,fontWeight:600,marginTop:16}},"Push play to start"))):null,T?t("div",{className:`poi-popup tvs-panel tvs-panel--elevated${w4?" poi-popup--hiding":""}`},T.imageThumbnail?t("div",{className:"poi-image"},t("img",{src:T.imageThumbnail,alt:T.name})):null,t("div",{className:"poi-content"},t("div",{className:"poi-header"},T.iconType==="custom"&&T.customIconUrl?t("div",{className:"poi-icon poi-icon-custom",style:{backgroundColor:T.color||"#8b5cf6"}},t("img",{src:T.customIconUrl,alt:"Icon",style:{width:"100%",height:"100%",objectFit:"contain",filter:"brightness(0) invert(1)"}})):t("div",{className:"poi-icon",style:{backgroundColor:T.color||"#8b5cf6"}},f4[T.icon]||T.icon||"\u{1F4CD}"),t("h3",{className:"poi-title"},T.name)),T.description?t("p",{className:"poi-description"},T.description):null)):null,t("div",{className:`training-controls ${a?"training-controls--hidden":""}`},t("button",{className:"control-btn",onClick:Z2,title:Q?"Pause":"Play"},t(Q?R2:X1,{size:24})),t("button",{className:"control-btn",onClick:b4,title:"Decrease Speed"},t(M4,{size:24})),t("button",{className:"control-btn",onClick:D4,title:"Increase Speed"},t(u4,{size:24})),t("button",{className:"control-btn",onClick:y4,title:"Zoom Out"},t(s4,{size:24})),t("button",{className:"control-btn",onClick:S4,title:"Zoom In"},t(p4,{size:24})),t("button",{className:`control-btn ${l1?"active":""}`,onClick:()=>S2(!l1),title:l1?"Camera Follow On":"Camera Follow Off"},t(l1?g4:L4,{size:24})),t("button",{className:`control-btn ${$?"active":""}`,onClick:()=>f1(!$),title:$?"Compass Mode On":"Compass Mode Off",disabled:!l1},t($?H4:d4,{size:24})),t("button",{className:`control-btn ${P1?"active":""}`,onClick:k4,title:P1?"Hide Route Line":"Show Route Line"},t(x4,{size:20})),t("button",{className:"control-btn",onClick:A4,title:"Restart"},t(B2,{size:24})),t("button",{className:"control-btn save-btn",onClick:T4,title:"Save Activity",disabled:f||n1<.1},t(Z4,{size:24})),t("button",{className:"control-btn",onClick:c4,title:z?"Exit Fullscreen":"Fullscreen"},t(z?F2:Y1,{size:24}))),!f&&a?t("div",{className:"controls-toggle-btn",onClick:()=>o(!1),title:"Show Controls"},t(d2,{size:28})):null,!f&&!a?t("div",{className:"controls-hide-btn",onClick:()=>o(!0),title:"Hide Controls"},t(H2,{size:20})):null,r2?t("div",{className:"save-modal-overlay",onClick:()=>d1(!1)},t("div",{className:"save-modal",onClick:c=>c.stopPropagation()},t("h3",null,"\u{1F4BE} Save Activity"),t("p",null,`Enter actual data from your ${g1==="Ride"?"bike/trainer":"treadmill"}:`),t("div",{className:"modal-field"},t("label",null,"Activity Type"),t("div",{className:"activity-type-selector",style:{display:"flex",gap:"8px",marginTop:"8px"}},["Walk","Run","Ride"].map(c=>t("button",{key:c,type:"button",className:`activity-type-btn ${g1===c?"active":""}`,onClick:()=>w1(c),style:{flex:1,padding:"12px",border:g1===c?"2px solid #3b82f6":"2px solid #e5e7eb",borderRadius:"8px",background:g1===c?"#eff6ff":"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",transition:"all 0.2s"}},[t("span",{key:"icon",style:{fontSize:"24px"}},c==="Walk"?"\u{1F6B6}":c==="Run"?"\u{1F3C3}":"\u{1F6B4}"),t("span",{key:"label",style:{fontSize:"14px",fontWeight:g1===c?"600":"400"}},c)])))),t("div",{className:"modal-fields-row"},t("div",{className:"modal-field"},t("label",null,"Distance (km)"),t("input",{type:"text",value:a2,onChange:c=>i2(c.target.value),placeholder:"8.234"}),t("small",null,"e.g., 8.234 km")),t("div",{className:"modal-field"},t("label",null,"Time"),t("input",{type:"text",value:y1,onChange:c=>l2(c.target.value),placeholder:"1:23:45"}),t("small",null,"H:MM:SS or MM:SS"))),t("div",{className:"modal-field"},t("label",null,"Notes (optional)"),t("textarea",{value:G1,onChange:c=>D2(c.target.value),placeholder:"How did the activity feel? Any observations?",rows:2})),t("div",{className:"modal-field"},t("label",null,"Rate Your Activity (1-10, optional)"),t("div",{className:"tvs-rating-scale"},[1,2,3,4,5,6,7,8,9,10].map(c=>t("button",{key:c,type:"button",onClick:()=>Y2(c),className:`tvs-rating-btn ${m1===c?"tvs-rating-btn--active":""}`},c))),m1>0?t("div",{className:"tvs-rating-label"},m1<=3?"Challenging":m1<=6?"Moderate":m1<=8?"Good":"Excellent"):null),t("div",{className:"modal-buttons"},t("button",{className:"btn-secondary",onClick:()=>d1(!1),disabled:V1},"Cancel"),t("button",{className:"btn-primary",onClick:P4,disabled:V1},V1?"Saving...":"Save Activity")))):null)}var V2=Number(new URLSearchParams(location.search).get("tvsslow")||0);function $2({initialData:r,routeId:l}){let{useEffect:C,useState:i,useRef:v,createElement:t}=r1,[R,a1]=i(r||null),[N,A]=i(null),[i1,Z1]=i(!1),[T1,X]=i(!1),[R1,o1]=i(null),[A2,J1]=i(null),[P,Z]=i(r?"inline":"loading"),[A1,J]=i(null),[G,t1]=i(0),[F,d]=i(!1),[g,f]=i(!1),[K,y]=i(!0),[O,Q]=i(!0),[h1,l1]=i(!0),[S2,$]=i(!1),[f1,P1]=i("Run"),[O1,T]=i(""),[t2,n1]=i(""),[S1,y2]=i(""),[v1,E1]=i(0),[c2,z1]=i(!1),U1=v(null),I1=v(null),H1=v(null);function z(a,o="success"){typeof window.tvsFlash=="function"&&window.tvsFlash(a,o)}C(()=>{let a=new URLSearchParams(location.search).get("tvsforcefetch")==="1";if(R&&!a){M("Har inline payload, skipper fetch.",R);return}if(!l){A("Mangler routeId \u2013 hverken inline payload eller data-route-id.");return}(async()=>{try{M("Henter rute via REST:",l," (tvsslow:",V2,"ms)"),Z("loading"),V2&&await Q1(V2);let p=await(await fetch(`/wp-json/tvs/v1/routes/${encodeURIComponent(l)}`,{credentials:"same-origin"})).json();M("REST OK:",p),a1(p),Z("ok")}catch(o){I("REST FAIL:",o),A("Kunne ikke hente rutedata."),J(o?.message||String(o)),Z("error")}})()},[l]),C(()=>{if(!R)return;let a=U1.current;if(!a)return;let o=null,p=!1;function V(){return new Promise((s,u)=>{if(window.Vimeo&&window.Vimeo.Player)return s();let u1=document.querySelector('script[src="https://player.vimeo.com/api/player.js"]');if(u1){u1.addEventListener("load",()=>s()),u1.addEventListener("error",()=>u(new Error("Vimeo API failed to load")));return}let _=document.createElement("script");_.src="https://player.vimeo.com/api/player.js",_.async=!0,_.onload=()=>s(),_.onerror=()=>u(new Error("Vimeo API failed to load")),document.head.appendChild(_)})}return(async()=>{try{if(await V(),p)return;o=new window.Vimeo.Player(a),I1.current=o,M("Vimeo Player constructed"),o.getDuration().catch(()=>{});try{await o.ready(),p||(d(!0),M("Vimeo Player ready"))}catch(s){I("Vimeo ready() rejected:",s)}o.on("timeupdate",s=>{typeof s?.seconds=="number"&&t1(s.seconds)})}catch{I("Vimeo API init failed")}})(),()=>{p=!0;try{o&&o.off&&o.off("timeupdate"),o&&o.destroy&&o.destroy()}catch{}I1.current=null,d(!1),r2()}},[R]);let N1=async()=>{try{"wakeLock"in navigator&&(H1.current=await navigator.wakeLock.request("screen"),W&&M("Wake Lock activated"))}catch(a){W&&M("Wake Lock error:",a)}},r2=async()=>{try{H1.current&&(await H1.current.release(),H1.current=null,W&&M("Wake Lock released"))}catch(a){W&&M("Wake Lock release error:",a)}};C(()=>{async function a(p){if((p.key==="f"||p.key==="F")&&p.target.tagName!=="INPUT"&&p.target.tagName!=="TEXTAREA"){p.preventDefault();let V=!g;if(V&&!F){z("Please wait for video to load","warning");return}if(f(V),V){await Q1(100);try{let s=document.querySelector(".tvs-app");s&&s.requestFullscreen&&await s.requestFullscreen()}catch(s){console.warn("Fullscreen not supported or denied:",s)}}else if(document.fullscreenElement)try{await document.exitFullscreen()}catch(s){console.warn("Error exiting fullscreen:",s)}}if(p.key==="Escape"&&g&&(f(!1),document.fullscreenElement))try{await document.exitFullscreen()}catch(V){console.warn("Error exiting fullscreen:",V)}}function o(){!document.fullscreenElement&&g&&f(!1)}return window.addEventListener("keydown",a),document.addEventListener("fullscreenchange",o),()=>{window.removeEventListener("keydown",a),document.removeEventListener("fullscreenchange",o)}},[g,F]);async function d1(a=8e3){let o=Date.now();for(;Date.now()-o<a;){let p=I1.current;if(p)try{return await p.ready(),d(!0),p}catch{}await Q1(100)}throw new Error("Video player is not ready")}function a2(a){let o=R?.meta||{},p=Number(o.duration_s||0),V=Number(o.distance_m||0);if(p>0&&V>0&&a>=0){let s=Math.min(1,a/p);return Math.round(V*s)}return 0}async function i2(){try{Z1(!0),M("Start clicked");let a=await d1();Z("starting");try{await z2(a.play(),4e3,"play()"),M("Playback started")}catch(o){throw I("play() failed:",o),z("Could not start playback: "+(o?.message||String(o)),"error"),o}try{let o=await z2(a.getCurrentTime(),1500,"getCurrentTime");typeof o=="number"&&o>.5?(await Q1(150),await z2(a.setCurrentTime(0),2e3,"setCurrentTime(0)"),M("Seeked to 0")):M("Already at start, skipping seek")}catch(o){M("Post-play seek skipped:",o?.message||String(o))}o1(new Date),X(!0),N1(),Z("running"),z("Activity started")}catch(a){I("Start session failed:",a),z("Player not ready yet. Please wait a moment and try again.","error"),Z("error")}finally{Z1(!1)}}async function y1(){try{Z1(!0),M("Resume clicked");let a=await d1();Z("starting");try{await a.play(),M("Playback resumed")}catch(o){throw I("resume play() failed:",o),z("Could not resume playback: "+(o?.message||String(o)),"error"),o}X(!0),N1(),Z("running"),z("Activity resumed")}catch(a){I("Resume session failed:",a),z("Player not ready yet. Please wait a moment and try again.","error"),Z("error")}finally{Z1(!1)}}async function l2(){try{M("Pause clicked");let a=await d1();try{await a.pause(),M("Playback paused")}catch(o){throw I("pause() failed:",o),z("Failed to pause: "+(o?.message||String(o)),"error"),o}X(!1),r2(),Z("paused"),z("Activity paused")}catch(a){I("[TVS] Pause failed:",a),Z("error")}}async function G1(){try{M("Finish clicked");let a=await d1();Z("pausing");try{await a.pause(),M("Playback paused before save dialog")}catch(u1){I("pause before save dialog failed:",u1)}let o=await a.getCurrentTime(),p=Math.max(0,Math.floor(o||0)),V=a2(p),s=Math.floor(p/60),u=p%60;T(`${s}:${u.toString().padStart(2,"0")}`),n1((V/1e3).toFixed(2)),$(!0)}catch(a){I("[TVS] Failed to open save dialog:",a),z("Failed to open save dialog: "+(a?.message||String(a)),"error"),Z("error")}}async function D2(){try{z1(!0);let a=0;if(O1.includes(":")){let M1=O1.split(":").map(j=>parseInt(j.trim())||0);if(M1.length===3){let[j,b1,C2]=M1;a=j*3600+b1*60+C2}else if(M1.length===2){let[j,b1]=M1;a=j*60+b1}else a=0}else a=parseInt(O1)||0;let o=Math.round(parseFloat(t2)*1e3);if(o<=0||a<=0){z("Distance and time must be greater than zero","error"),z1(!1);return}let p=new Date().toISOString(),V=R1?R1.toISOString():new Date(Date.now()-a*1e3).toISOString(),s=new Date(new Date(V).getTime()+a*1e3).toISOString(),u={route_id:R.id,route_name:R.title||"Unknown Route",activity_date:p,started_at:V,ended_at:s,duration_s:a,distance_m:o,visibility:"private",activity_type:f1,is_virtual:!1,source:R.meta&&R.meta.video_url?"video":"virtual"};S1&&(u.notes=S1),v1>0&&(u.rating=v1);let u1=window.TVS_SETTINGS?.nonce||"";V2&&await Q1(V2);let _=await fetch("/wp-json/tvs/v1/activities",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":u1},credentials:"same-origin",body:JSON.stringify(u)});if(!_.ok){let M1=await _.json();throw new Error(M1.message||`HTTP ${_.status}`)}await _.json(),$(!1),z1(!1),T(""),n1(""),z("Activity saved! \u{1F389}","success"),Z("ok"),X(!1),r2(),o1(null),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(a){I("[TVS] Save activity failed:",a),z("Failed to save activity: "+(a?.message||String(a)),"error"),J(a?.message||String(a)),Z("error"),z1(!1)}}async function m1(a){try{J1(a),Z("uploading");let o=await fetch(`/wp-json/tvs/v1/activities/${a}/strava`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},credentials:"same-origin"}),p=await o.json();if(!o.ok)throw new Error(p.message||"Upload failed");z("Uploaded to Strava!"),Z("ok"),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(o){I("Strava upload FAIL:",o),z("Failed to upload to Strava: "+(o?.message||String(o)),"error"),J(o?.message||String(o)),Z("error")}finally{J1(null)}}if(N)return t("div",{className:"tvs-route tvs-error"},String(N));if(!R)return r1.createElement(_2,null);let Y2=R.title||"Route",V1=R.meta||{},L1=V1.vimeo_id?String(V1.vimeo_id):"",g1=V1.gpx_url||"",w1=Number(V1.duration_s||0),D1=!!window.TVS_SETTINGS?.user;if(!L1&&g1)return t(Q2,{routeData:R,routeId:l});if(!L1&&!g1)return t("div",{className:"tvs-route tvs-fallback"},t("p",null,"This route has no video or GPX data available."));let L2=D1?T1?[t("button",{key:"pause",className:"control-btn",onClick:l2,disabled:i1||!F,title:"Pause activity"},t(R2,{size:24})),t("button",{key:"finish",className:"control-btn save-btn",onClick:G1,disabled:i1||!F,title:"Finish and save activity"},t(j2,{size:24})),g?null:t("button",{key:"fullscreen",className:"control-btn",onClick:async()=>{if(!F){z("Please wait for video to load","warning");return}f(!0);try{let a=document.querySelector(".tvs-app");a&&a.requestFullscreen&&await a.requestFullscreen()}catch(a){console.warn("Fullscreen not supported or denied:",a)}},disabled:!F,title:"Enter fullscreen mode (F)"},t(Y1,{size:24}))].filter(Boolean):G>0&&R1&&(w1===0||G<w1-.5)?[t("button",{key:"resume",className:"control-btn",onClick:y1,disabled:i1||!F,title:"Resume activity"},t(X1,{size:24})),t("button",{key:"finish",className:"control-btn save-btn",onClick:G1,disabled:i1||!F,title:"Finish and save activity"},t(j2,{size:24})),t("button",{key:"restart",className:"control-btn",onClick:i2,disabled:i1||!F,title:"Restart from beginning"},t(B2,{size:24})),g?null:t("button",{key:"fullscreen",className:"control-btn",onClick:async()=>{if(!F){z("Please wait for video to load","warning");return}f(!0);try{let a=document.querySelector(".tvs-app");a&&a.requestFullscreen&&await a.requestFullscreen()}catch(a){console.warn("Fullscreen not supported or denied:",a)}},disabled:!F,title:"Enter fullscreen mode (F)"},t(Y1,{size:24}))].filter(Boolean):[t("button",{key:"start",className:"control-btn",onClick:i2,disabled:i1||!F,title:"Start activity"},t(X1,{size:24})),g?null:t("button",{key:"fullscreen",className:"control-btn",onClick:async()=>{if(!F){z("Please wait for video to load","warning");return}f(!0);try{let a=document.querySelector(".tvs-app");a&&a.requestFullscreen&&await a.requestFullscreen()}catch(a){console.warn("Fullscreen not supported or denied:",a)}},disabled:!F,title:"Enter fullscreen mode (F)"},t(Y1,{size:24}))].filter(Boolean):t("div",{className:"tvs-alert tvs-alert--warning",style:{margin:"0 auto",maxWidth:"500px"}},t("div",{className:"tvs-row tvs-mb-2"},t("span",{className:"tvs-badge tvs-badge-warning"},"Warning"),t("strong",null," You must be logged in")),t("p",null,"Please ",t("a",{href:"/login"},"log in")," to create activities and upload to Strava. Don't have an account? ",t("a",{href:"/register"},"Register here"),"."));return t("div",{className:`tvs-app${g?" tvs-app--cinematic":""}`},t("div",{key:"video-container",className:g?"tvs-video-container":"tvs-panel tvs-app__container"},L1?t("div",{className:g?"tvs-video tvs-video--cinematic":"tvs-video"},t("iframe",{ref:U1,width:560,height:315,src:"https://player.vimeo.com/video/"+encodeURIComponent(L1)+"?controls=0&title=0&byline=0&portrait=0&pip=0&playsinline=1&dnt=1&transparent=0&muted=0",frameBorder:0,allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0})):null,g&&K?t("div",{key:"minimap",className:"tvs-video-overlay tvs-video-overlay--minimap"},t("div",{className:"tvs-overlay-placeholder"},"Mini-map")):null,g&&O?t("div",{key:"routeinfo",className:"tvs-video-overlay tvs-video-overlay--routeinfo"},t("div",{className:"tvs-overlay-placeholder"},"Route Info")):null,g?null:t(I2,{React:r1,currentTime:G,duration:w1}),g?null:new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1"?t("div",{className:"tvs-meta"},t("pre",null,JSON.stringify(V1,null,2))):null,g?null:t("div",{className:"training-controls"},L2)),g?t("div",{className:`tvs-control-panel${h1?"":" tvs-control-panel--hidden"}`,style:w1>0?{"--progress":`${Math.min(G/w1*100,100)}%`}:void 0},t("button",{className:"tvs-control-panel-tab",onClick:()=>l1(a=>!a),"aria-label":h1?"Hide controls":"Show controls",title:h1?"Hide controls":"Show controls"},t(h1?H2:d2,{"aria-hidden":!0})),t("div",{className:"tvs-control-panel-content"},t("div",{className:"training-controls",style:{position:"relative",bottom:"auto",left:"auto",transform:"none"}},L2),t("div",{className:"tvs-cinematic-extras",style:{display:"flex",gap:"12px",marginLeft:"auto"}},t("button",{className:"control-btn",onClick:()=>y(a=>!a),title:K?"Hide minimap":"Show minimap"},t(V4,{size:24})),t("button",{className:"control-btn",onClick:()=>Q(a=>!a),title:O?"Hide route info":"Show route info"},t(v4,{size:24})),t("button",{className:"control-btn",onClick:async()=>{if(f(!1),document.fullscreenElement)try{await document.exitFullscreen()}catch(a){console.warn("Error exiting fullscreen:",a)}},title:"Exit cinematic mode (press F or Escape)"},t(F2,{size:24}))))):null,W?t(K2,{React:r1,routeId:l,lastStatus:P,lastError:A1,currentTime:G,duration:w1}):null,S2?t("div",{className:"save-modal-overlay",onClick:()=>$(!1)},t("div",{className:"save-modal",onClick:a=>a.stopPropagation()},t("h3",null,"\u{1F4BE} Save Activity"),t("p",null,`Enter actual data from your ${f1==="Ride"?"bike/trainer":"treadmill"}:`),t("div",{className:"modal-field"},t("label",null,"Activity Type"),t("div",{className:"activity-type-selector",style:{display:"flex",gap:"8px",marginTop:"8px"}},["Walk","Run","Ride"].map(a=>t("button",{key:a,type:"button",className:`activity-type-btn ${f1===a?"active":""}`,onClick:()=>P1(a),style:{flex:1,padding:"12px",border:f1===a?"2px solid #3b82f6":"2px solid #e5e7eb",borderRadius:"8px",background:f1===a?"#eff6ff":"white",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",transition:"all 0.2s"}},[t("span",{key:"icon",style:{fontSize:"24px"}},a==="Walk"?"\u{1F6B6}":a==="Run"?"\u{1F3C3}":"\u{1F6B4}"),t("span",{key:"label",style:{fontSize:"14px",fontWeight:f1===a?"600":"400"}},a)])))),t("div",{className:"modal-fields-row"},t("div",{className:"modal-field"},t("label",null,"Distance (km)"),t("input",{type:"text",value:t2,onChange:a=>n1(a.target.value),placeholder:"8.234"}),t("small",null,"e.g., 8.234 km")),t("div",{className:"modal-field"},t("label",null,"Time"),t("input",{type:"text",value:O1,onChange:a=>T(a.target.value),placeholder:"1:23:45"}),t("small",null,"H:MM:SS or MM:SS"))),t("div",{className:"modal-field"},t("label",null,"Notes (optional)"),t("textarea",{value:S1,onChange:a=>y2(a.target.value),placeholder:"How did the activity feel? Any observations?",rows:2})),t("div",{className:"modal-field"},t("label",null,"Rate Your Activity (1-10, optional)"),t("div",{className:"tvs-rating-scale"},[1,2,3,4,5,6,7,8,9,10].map(a=>t("button",{key:a,type:"button",onClick:()=>E1(a),className:`tvs-rating-btn ${v1===a?"tvs-rating-btn--active":""}`},a))),v1>0?t("div",{className:"tvs-rating-label"},v1<=3?"Challenging":v1<=6?"Moderate":v1<=8?"Good":"Excellent"):null),t("div",{className:"modal-buttons"},t("button",{className:"btn-secondary",onClick:()=>{$(!1),T(""),n1("")},disabled:c2},"Cancel"),t("button",{className:"btn-primary",onClick:D2,disabled:c2},c2?"Saving...":"Save Activity")))):null)}W||document.addEventListener("keydown",r=>{if(r.key==="`"){try{localStorage.setItem("tvsDev","1")}catch{}location.reload()}});function z4(){let r=document.getElementById("tvs-app-root");if(r){let l=window.tvs_route_payload||null,C=r.getAttribute("data-route-id")||l&&l.id;M("\u{1F680} Boot Debug:"),M("  - Mount element:",!!r),M("  - Route ID:",C),M("  - window.tvs_route_payload:",window.tvs_route_payload),M("  - Inline payload:",l),M("Boot \u2192 routeId:",C,"inline payload:",!!l),e4($2,{initialData:l,routeId:C},r)}}W?M("Debug mode enabled."):document.addEventListener("keydown",function(r){if(r.key==="`"){let l=new URL(location.href);l.searchParams.set("tvsdebug","1"),location.href=l.toString()}});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",z4):z4();})();
//# sourceMappingURL=tvs-app.js.map
