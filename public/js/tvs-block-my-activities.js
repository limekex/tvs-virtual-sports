(()=>{var S=new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1";function T(...r){S&&console.debug("[TVS]",...r)}function w(...r){console.error("[TVS]",...r)}var D=!!(window.React&&window.ReactDOM),N=!!(window.wp&&window.wp.element),u=N?window.wp.element:{},A=D?window.React:u||{},m=D?window.ReactDOM:u||null,E=new WeakMap,U=m&&typeof m.createRoot=="function"||u&&typeof u.createRoot=="function";function z(r,a,e){try{let o=E.get(e);if(o&&typeof o.unmount=="function"?(o.unmount(),E.delete(e)):m&&typeof m.unmountComponentAtNode=="function"&&m.unmountComponentAtNode(e),U){let t=(m&&m.createRoot||u&&u.createRoot)(e);E.set(e,t),t.render(A.createElement(r,a));return}let f=m&&m.render||u&&u.render;if(f){f(A.createElement(r,a),e);return}w("Ingen render-funksjon tilgjengelig.")}catch(o){w("Mount feilet:",o)}}function _({activity:r,uploadToStrava:a,uploading:e,React:o,compact:f,dummy:y}){let{createElement:t,useState:l}=o,s=r.meta||{},p=r.id,d=s._tvs_synced_strava?.[0]||s.synced_strava?.[0],v=s._tvs_strava_remote_id?.[0]||s.strava_activity_id?.[0],g=d==="1"||d===1,n=s._tvs_distance_m?.[0]||s.distance_m?.[0]||0,i=s._tvs_duration_s?.[0]||s.duration_s?.[0]||0,c=s._tvs_route_name?.[0]||s.route_name?.[0]||"Unknown Route",h=s._tvs_activity_date?.[0]||s.activity_date?.[0]||r.date||"",k="";if(h)try{k=new Date(h).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{k=h}let C=k?`${c} (${k})`:c;if(f){let[b,R]=l(!1);return y?t("div",{className:"tvs-activity-card-compact",style:{padding:"0.75rem",marginBottom:"0.5rem",borderRadius:"4px",background:"linear-gradient(90deg, #f3f4f6 60%, #e5e7eb 100%)",fontSize:"0.9rem",position:"relative",opacity:.6,filter:"grayscale(0.7)",pointerEvents:"none"}},t("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"}},t("div",{style:{flex:1,minWidth:0}},t("div",{style:{fontWeight:"500",marginBottom:"0.25rem"}},C),t("div",{style:{fontSize:"0.85rem",color:"#888"}},n>0?(n/1e3).toFixed(2)+" km":"",n>0&&i>0?" \xB7 ":"",i>0?Math.floor(i/60)+" min":"")),t("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexShrink:0}},t("span",{style:{color:"#bbb",fontSize:"1.5rem",lineHeight:1,display:"flex",alignItems:"center"},title:"Preview"},"\u2713"),t("div",{style:{width:"32px",height:"32px",borderRadius:"4px",backgroundColor:"#e5e7eb",color:"#ccc",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold"}},"S")))):t("div",{className:"tvs-activity-card-compact",style:{padding:"0.75rem",marginBottom:"0.5rem",borderRadius:"4px",backgroundColor:"#f9fafb",fontSize:"0.9rem",position:"relative"}},t("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"}},t("div",{style:{flex:1,minWidth:0}},t("div",{style:{fontWeight:"500",marginBottom:"0.25rem"}},C),t("div",{style:{fontSize:"0.85rem",color:"#666"}},n>0?(n/1e3).toFixed(2)+" km":"",n>0&&i>0?" \xB7 ":"",i>0?Math.floor(i/60)+" min":"")),t("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexShrink:0}},g?t("span",{style:{color:"#10b981",fontSize:"1.5rem",lineHeight:1,display:"flex",alignItems:"center"},title:"Synced to Strava"},"\u2713"):null,t("div",{style:{position:"relative"}},g?t("a",{href:v?"https://www.strava.com/activities/"+v:"#",target:"_blank",rel:"noopener noreferrer",title:"View on Strava",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"4px",backgroundColor:"#fc4c02",color:"white",textDecoration:"none",fontSize:"0.9rem",fontWeight:"bold"}},"S"):t("button",{onClick:x=>{x.stopPropagation(),R(!b)},disabled:e,title:"Upload to Strava",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"4px",backgroundColor:e?"#ccc":"#fc4c02",color:"white",border:"none",cursor:e?"wait":"pointer",fontSize:"0.9rem",fontWeight:"bold"}},e?"...":"S"),b&&!g&&!e?t("div",{style:{position:"absolute",right:0,top:"calc(100% + 0.5rem)",backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"0.75rem",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06)",zIndex:1e3,minWidth:"200px",whiteSpace:"nowrap"}},t("div",{style:{fontSize:"0.9rem",marginBottom:"0.5rem",color:"#374151"}},"Upload to Strava?"),t("div",{style:{display:"flex",gap:"0.5rem"}},t("button",{onClick:x=>{x.stopPropagation(),R(!1),a(p)},style:{flex:1,padding:"0.5rem 0.75rem",backgroundColor:"#fc4c02",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.85rem",fontWeight:"500"}},"Upload"),t("button",{onClick:x=>{x.stopPropagation(),R(!1)},style:{flex:1,padding:"0.5rem 0.75rem",backgroundColor:"#f3f4f6",color:"#374151",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.85rem"}},"Cancel"))):null))),b?t("div",{style:{position:"fixed",inset:0,zIndex:999},onClick:()=>R(!1)}):null)}return t("div",{className:"tvs-activity-card",style:{border:"1px solid #ddd",padding:"1rem",marginBottom:"1rem",borderRadius:"4px",backgroundColor:g?"#f0f9ff":"#fff"}},t("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},t("div",null,t("strong",null,C),t("div",{style:{marginTop:"0.5rem",fontSize:"0.9rem",color:"#666"}},n>0?t("span",null,"Distance: "+(n/1e3).toFixed(2)+" km "):null,i>0?t("span",null,"Duration: "+Math.floor(i/60)+" min"):null)),t("div",null,g?t("div",{style:{textAlign:"right"}},t("span",{style:{color:"#10b981",fontWeight:"bold"}},"\u2713 Synced to Strava"),v?t("a",{href:"https://www.strava.com/activities/"+v,target:"_blank",rel:"noopener noreferrer",style:{display:"block",marginTop:"0.25rem",fontSize:"0.85rem"}},"View on Strava \u2192"):null):t("button",{className:"tvs-btn tvs-btn-strava",onClick:()=>a(p),disabled:e,style:{backgroundColor:"#fc4c02",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"4px",cursor:e?"wait":"pointer",opacity:e?.6:1}},e?"Uploading...":"Upload to Strava"))))}function I({React:r,activities:a,loadingActivities:e,uploadToStrava:o,uploadingId:f}){let{useState:y,createElement:t}=r,[l,s]=y(!1),p=a.slice(0,5);return t("div",{className:"tvs-activities-block",style:{marginTop:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",background:"#fff",padding:"1rem"}},t("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1rem"}},t("h3",{style:{margin:0,fontSize:"1.25rem"}},"Recent Activities"),t("button",{onClick:()=>s(!l),style:{fontSize:"1.2em",background:"none",border:"none",cursor:"pointer",color:"#666"},"aria-label":l?"Expand":"Minimize"},l?"\u25B8":"\u25BE")),l?null:e?t("p",{style:{color:"#666"}},"Loading activities..."):p.length===0?t("p",{style:{color:"#666"}},"Start a new activity when you're ready"):t("div",null,t("div",{className:"tvs-activities-list",style:{marginBottom:"1rem"}},p.map(d=>t(_,{key:d.id,activity:d,uploadToStrava:o,uploading:f===d.id,React:r,compact:!0}))),t("div",{style:{textAlign:"center",paddingTop:"0.5rem",borderTop:"1px solid #e5e7eb"}},t("a",{href:"/my-activities",style:{color:"#2563eb",textDecoration:"none",fontSize:"0.9rem"}},"Go to my activities \u2192"))))}function M({React:r}){let{useState:a,useEffect:e,createElement:o}=r,[f,y]=a([]),[t,l]=a(!1),[s,p]=a(null),d=!!window.TVS_SETTINGS?.user;e(()=>{if(!d)return;v();let n=()=>{S&&console.info("[TVS] MyActivitiesStandalone: Received activity update event, reloading..."),v()};return window.addEventListener("tvs:activity-updated",n),()=>{window.removeEventListener("tvs:activity-updated",n)}},[]);async function v(){try{l(!0);let i=await fetch("/wp-json/tvs/v1/activities/me",{credentials:"same-origin",headers:{"X-TVS-Nonce":window.TVS_SETTINGS?.nonce||""}});if(!i.ok)throw new Error("Failed to load activities");let c=await i.json(),h=Array.isArray(c)?c:c.activities||[];y(h)}catch(n){w("Load activities FAIL:",n),y([])}finally{l(!1)}}async function g(n){try{p(n);let i=await fetch(`/wp-json/tvs/v1/activities/${n}/strava`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.TVS_SETTINGS?.nonce||""},credentials:"same-origin"}),c=await i.json();if(!i.ok)throw new Error(c.message||"Upload failed");window.tvsFlash("Uploaded to Strava!"),await v(),window.dispatchEvent(new CustomEvent("tvs:activity-updated"))}catch(i){w("Strava upload FAIL:",i),window.tvsFlash("Failed to upload to Strava: "+(i?.message||String(i)),"error")}finally{p(null)}}if(!d){let n=Array.from({length:3}).map((i,c)=>({id:"dummy-"+c,meta:{_tvs_route_name:["Sample Route "+(c+1)],_tvs_activity_date:[new Date(Date.now()-c*864e5).toISOString()],_tvs_distance_m:[Math.round(5e3+Math.random()*5e3)],_tvs_duration_s:[Math.round(1200+Math.random()*1800)]}}));return o("div",{className:"tvs-activities-block",style:{marginTop:"1rem",border:"1px solid #e5e7eb",borderRadius:"8px",background:"#fff",padding:"1rem"}},o("h3",{style:{marginTop:0}},"My Activities"),o("div",{className:"tvs-activities-list",style:{marginBottom:"1rem"}},n.map(i=>o(_,{key:i.id,activity:i,React:r,compact:!0,dummy:!0}))),o("div",{style:{textAlign:"center",color:"#888",fontSize:"0.95rem",marginBottom:"0.5rem"}},"Sign in to see your recent activities."),o("div",{style:{textAlign:"center"}},o("a",{href:"/login",style:{color:"#1f2937",textDecoration:"underline",marginRight:12}},"Log in"),o("a",{href:"/register",style:{color:"#1f2937",textDecoration:"underline"}},"Register")))}return o(I,{React:r,activities:f,loadingActivities:t,uploadToStrava:g,uploadingId:s})}function j(){document.querySelectorAll(".tvs-my-activities-block").forEach((a,e)=>{if(!a.__tvsMounted){let o=a.id||`tvs-my-activities-${e}`;a.id||(a.id=o),S&&T("Mounting MyActivities block (view.js) on:",o),z(M,{React:A},a),a.__tvsMounted=!0}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",j):j();})();
//# sourceMappingURL=tvs-block-my-activities.js.map
