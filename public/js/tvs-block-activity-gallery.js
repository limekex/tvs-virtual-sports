(()=>{var{createElement:a,useState:d,useEffect:E}=window.React;function L({userId:t,limit:s,title:i,layout:l,columns:o,showFilters:c}){let[n,m]=d([]),[y,A]=d(!0),[g,k]=d(null),[h,$]=d("all"),[p,S]=d("all"),[f,P]=d("newest"),[D,b]=d(null),[N,C]=d(1),[w,F]=d(0);E(()=>{R()},[N]);let R=async()=>{A(!0),k(null);try{let e=`${window.TVS_SETTINGS.restRoot}tvs/v1/activities/me?per_page=${s}&page=${N}`,r=await fetch(e,{headers:{"X-WP-Nonce":window.TVS_SETTINGS.nonce}});if(!r.ok)throw new Error("Failed to fetch activities");let v=await r.json(),u=parseInt(r.headers.get("X-WP-Total")||"0"),W=parseInt(r.headers.get("X-WP-TotalPages")||"1");m(v||[]),F(W)}catch(e){console.error("Error fetching activities:",e),k(e.message)}finally{A(!1)}},I=n.filter(e=>{if(h!=="all"){let r=e.meta.activity_type;if(Array.isArray(r)&&r.length>0&&(r=r[0]),typeof r!="string"&&(r="workout"),r.toLowerCase()!==h.toLowerCase())return!1}if(p!=="all"){let r=new Date(e.date),u=Math.floor((new Date-r)/(1e3*60*60*24));if(p==="7d"&&u>7||p==="30d"&&u>30||p==="90d"&&u>90)return!1}return!0}).sort((e,r)=>{if(f==="newest")return new Date(r.date)-new Date(e.date);if(f==="oldest")return new Date(e.date)-new Date(r.date);if(f==="distance"){let v=parseFloat(Array.isArray(e.meta.distance_m)?e.meta.distance_m[0]:e.meta.distance_m)||0;return(parseFloat(Array.isArray(r.meta.distance_m)?r.meta.distance_m[0]:r.meta.distance_m)||0)-v}if(f==="rating"){let v=parseInt(Array.isArray(e.meta.rating)?e.meta.rating[0]:e.meta.rating)||0;return(parseInt(Array.isArray(r.meta.rating)?r.meta.rating[0]:r.meta.rating)||0)-v}return 0});return y?a("div",{className:"tvs-gallery-loading"},a("div",{className:"tvs-loading-spinner"})):g?a("div",{className:"tvs-gallery-error"},a("p",null,`Error: ${g}`)):a("div",{className:"tvs-activity-gallery"},[a("div",{className:"tvs-gallery-header"},[a("h2",{className:"tvs-gallery-title"},i),c&&a("div",{className:"tvs-gallery-filters"},[a("select",{className:"tvs-filter-select",value:h,onChange:e=>$(e.target.value)},[a("option",{value:"all"},"All Types"),a("option",{value:"run"},"\u{1F3C3} Run"),a("option",{value:"ride"},"\u{1F6B4} Ride"),a("option",{value:"walk"},"\u{1F6B6} Walk"),a("option",{value:"hike"},"\u26F0\uFE0F Hike"),a("option",{value:"swim"},"\u{1F3CA} Swim"),a("option",{value:"workout"},"\u{1F4AA} Workout")]),a("select",{className:"tvs-filter-select",value:p,onChange:e=>S(e.target.value)},[a("option",{value:"all"},"All Time"),a("option",{value:"7d"},"Last 7 Days"),a("option",{value:"30d"},"Last 30 Days"),a("option",{value:"90d"},"Last 90 Days")]),a("select",{className:"tvs-filter-select",value:f,onChange:e=>P(e.target.value)},[a("option",{value:"newest"},"Newest First"),a("option",{value:"oldest"},"Oldest First"),a("option",{value:"distance"},"Longest Distance"),a("option",{value:"rating"},"Best Rating")])])]),I.length===0?a("div",{className:"tvs-gallery-empty"},a("p",null,"No activities found matching your filters.")):a("div",{className:`tvs-gallery-grid tvs-gallery-grid--${l} tvs-gallery-grid--cols-${o}`},I.map(e=>a(B,{key:e.id,activity:e,onClick:()=>b(e)}))),w>1&&a("div",{className:"tvs-gallery-pagination"},[a("button",{className:"tvs-pagination-btn",disabled:N===1,onClick:()=>C(e=>e-1)},"\u2190 Previous"),a("span",{className:"tvs-pagination-info"},`Page ${N} of ${w}`),a("button",{className:"tvs-pagination-btn",disabled:N===w,onClick:()=>C(e=>e+1)},"Next \u2192")]),D&&a(M,{activity:D,onClose:()=>b(null)})])}function B({activity:t,onClick:s}){let i=t.meta.activity_type;Array.isArray(i)&&i.length>0&&(i=i[0]),typeof i!="string"&&(i="Workout");let l=t.meta.route_id;Array.isArray(l)&&l.length>0&&(l=l[0]),l=parseInt(l)||0;let o=t.meta.distance_m;Array.isArray(o)&&o.length>0&&(o=o[0]),o=parseFloat(o)||0;let c=t.meta.duration_s;Array.isArray(c)&&c.length>0&&(c=c[0]),c=parseInt(c)||0;let n=t.meta.rating;Array.isArray(n)&&n.length>0&&(n=n[0]),n=parseInt(n)||0;let m=T(i),y=l>0;return a("div",{className:`tvs-gallery-card tvs-gallery-card--${m.className}`,onClick:s},[a("div",{className:"tvs-gallery-card-image"},y?a("div",{className:"tvs-gallery-card-map"},a("div",{className:"tvs-map-placeholder"},"\u{1F5FA}\uFE0F")):a("div",{className:"tvs-gallery-card-icon"},a("span",{className:"tvs-activity-icon"},m.icon))),a("div",{className:"tvs-gallery-card-overlay"},[a("div",{className:"tvs-gallery-card-badge"},a("span",null,m.label)),n>0&&a("div",{className:"tvs-gallery-card-rating"},Array.from({length:10}).map((A,g)=>a("span",{key:g,className:`tvs-star ${g<n?"tvs-star--filled":""}`},"\u2605")))]),a("div",{className:"tvs-gallery-card-info"},[a("div",{className:"tvs-gallery-card-metrics"},[a("span",{className:"tvs-metric"},`${(o/1e3).toFixed(2)} km`),a("span",{className:"tvs-metric"},_(c))]),a("div",{className:"tvs-gallery-card-date"},G(t.date))])])}function M({activity:t,onClose:s}){let i=t.meta.activity_type;Array.isArray(i)&&(i=i[0]);let l=t.meta.distance_m;Array.isArray(l)&&(l=l[0]),l=parseFloat(l)||0;let o=t.meta.duration_s;Array.isArray(o)&&(o=o[0]),o=parseInt(o)||0;let c=t.meta.rating;Array.isArray(c)&&(c=c[0]),c=parseInt(c)||0;let n=t.meta.notes;Array.isArray(n)&&(n=n[0]),n=String(n||"");let m=T(i);return a("div",{className:"tvs-gallery-modal-overlay",onClick:s},[a("div",{className:"tvs-gallery-modal",onClick:y=>y.stopPropagation()},[a("button",{className:"tvs-modal-close",onClick:s},"\xD7"),a("div",{className:"tvs-modal-header"},[a("span",{className:"tvs-modal-icon"},m.icon),a("h3",null,t.title),a("span",{className:"tvs-modal-type"},m.label)]),a("div",{className:"tvs-modal-metrics"},[a("div",{className:"tvs-modal-metric"},[a("span",{className:"tvs-modal-metric-label"},"Distance"),a("span",{className:"tvs-modal-metric-value"},`${(l/1e3).toFixed(2)} km`)]),a("div",{className:"tvs-modal-metric"},[a("span",{className:"tvs-modal-metric-label"},"Duration"),a("span",{className:"tvs-modal-metric-value"},_(o))]),a("div",{className:"tvs-modal-metric"},[a("span",{className:"tvs-modal-metric-label"},"Pace"),a("span",{className:"tvs-modal-metric-value"},o&&l?`${(o/60/(l/1e3)).toFixed(2)} min/km`:"N/A")]),c>0&&a("div",{className:"tvs-modal-metric"},[a("span",{className:"tvs-modal-metric-label"},"Rating"),a("span",{className:"tvs-modal-metric-value"},`${c}/10 \u2605`)])]),n&&a("div",{className:"tvs-modal-notes"},[a("h4",null,"Notes"),a("p",null,n)]),a("div",{className:"tvs-modal-footer"},[a("a",{href:t.permalink,className:"tvs-modal-btn tvs-modal-btn--primary"},"View Full Details"),a("button",{className:"tvs-modal-btn",onClick:s},"Close")])])])}function T(t){let s={Run:{icon:"\u{1F3C3}",label:"Run",className:"run",color:"#3b82f6"},Ride:{icon:"\u{1F6B4}",label:"Ride",className:"ride",color:"#10b981"},Walk:{icon:"\u{1F6B6}",label:"Walk",className:"walk",color:"#f59e0b"},Hike:{icon:"\u26F0\uFE0F",label:"Hike",className:"hike",color:"#f97316"},Swim:{icon:"\u{1F3CA}",label:"Swim",className:"swim",color:"#06b6d4"},Workout:{icon:"\u{1F4AA}",label:"Workout",className:"workout",color:"#a855f7"}};return s[t]||s.Workout}function _(t){if(!t)return"0m";let s=Math.floor(t/3600),i=Math.floor(t%3600/60);return s>0?`${s}h ${i}m`:`${i}m`}function G(t){let s=new Date(t),l=Math.floor((new Date-s)/(1e3*60*60*24));return l===0?"Today":l===1?"Yesterday":l<7?`${l} days ago`:s.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".tvs-activity-gallery-block").forEach(s=>{let i={userId:parseInt(s.dataset.userId)||0,limit:parseInt(s.dataset.limit)||12,title:s.dataset.title||"Activity Gallery",layout:s.dataset.layout||"grid",columns:parseInt(s.dataset.columns)||3,showFilters:s.dataset.showFilters==="1"};window.ReactDOM.createRoot(s).render(a(L,i))})});})();
//# sourceMappingURL=tvs-block-activity-gallery.js.map
