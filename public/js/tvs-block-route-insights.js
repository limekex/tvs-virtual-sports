(()=>{var U=new URLSearchParams(location.search).get("tvsdebug")==="1"||window.TVS_DEBUG===!0||localStorage.getItem("tvsDev")==="1";function _(...c){console.error("[TVS]",...c)}var D=!!(window.React&&window.ReactDOM),V=!!(window.wp&&window.wp.element),m=V?window.wp.element:{},M=D?window.React:m||{},f=D?window.ReactDOM:m||null,$=new WeakMap,C=f&&typeof f.createRoot=="function"||m&&typeof m.createRoot=="function";function A(c,t,e){try{let o=$.get(e);if(o&&typeof o.unmount=="function"&&(o.unmount(),$.delete(e)),C){let a=(f&&f.createRoot||m&&m.createRoot)(e);$.set(e,a),a.render(M.createElement(c,t));return}f&&typeof f.unmountComponentAtNode=="function"&&f.unmountComponentAtNode(e);let i=f&&f.render||m&&m.render;if(i){i(M.createElement(c,t),e);return}_("Ingen render-funksjon tilgjengelig.")}catch(o){_("Mount feilet:",o)}}function I(c){let t=Math.max(0,Math.floor(c||0)),e=Math.floor(t/3600),o=Math.floor(t%3600/60),i=t%60;return e>0?`${e}:${String(o).padStart(2,"0")}:${String(i).padStart(2,"0")}`:`${o}:${String(i).padStart(2,"0")}`}function O({React:c,routeId:t}){let{createElement:e,useEffect:o,useRef:i,useState:h}=c,a=i(null),[s,p]=h(null);return o(()=>{if(!t)return;let w=!1;async function l(){try{let S=`${(window.TVS_SETTINGS&&TVS_SETTINGS.restRoot||"/wp-json/").replace(/\/$/,"")}/tvs/v1/routes/${encodeURIComponent(t)}/gpx-data`,g=await fetch(S);if(!g.ok)throw new Error("HTTP "+g.status);let d=await g.json();if(w)return;let u=(d.points||[]).map(E=>E.ele).filter(E=>Number.isFinite(E)),n=a.current;if(!n)return;let r=n.getContext("2d"),R=n.width=260,T=n.height=50;if(r.clearRect(0,0,R,T),u.length<2){p("No elevation data");return}let v=Math.min(...u),y=Math.max(...u),j=Math.max(1,y-v);r.strokeStyle="#0ea5e9",r.lineWidth=2,r.beginPath(),u.forEach((E,N)=>{let k=N/(u.length-1)*(R-4)+2,b=(1-(E-v)/j)*(T-6)+3;N===0?r.moveTo(k,b):r.lineTo(k,b)}),r.stroke()}catch(x){w||p(x.message||"Failed")}}return l(),()=>{w=!0}},[t]),e("div",null,e("canvas",{ref:a,width:260,height:50,style:{maxWidth:"100%",display:"block"}}),s?e("div",{className:"tvs-text-muted",style:{fontSize:".85em"}},String(s)):null)}function L({React:c,title:t,showElevation:e,showSurface:o,showEta:i,showMapsLink:h,routeId:a}){let{createElement:s,useEffect:p,useState:w}=c,[l,x]=w(null),[S,g]=w(null);p(()=>{let n=!1;async function r(){if(!a){g("No route selected.");return}try{let T=`${(window.TVS_SETTINGS&&TVS_SETTINGS.restRoot||"/wp-json/").replace(/\/$/,"")}/tvs/v1/routes/${encodeURIComponent(a)}/insights`,v=await fetch(T);if(!v.ok)throw new Error("HTTP "+v.status);let y=await v.json();n||x(y)}catch(R){n||g(R.message||"Failed")}}return r(),()=>{n=!0}},[a]);let d=[],u=l&&l.meta||{};if(e){let r=`Distance: ${(u.distance_m?`${(u.distance_m/1e3).toFixed(2)} km`:null)||"\u2014"} \u2022 Elevation: ${u.elevation_m?Math.round(u.elevation_m)+" m":"\u2014"}`;d.push(s("div",null,r,a?s(O,{React:c,routeId:a}):null))}if(o&&d.push(`Surface: ${u.surface||"\u2014"}`),i){let n=l&&l.computed&&l.computed.eta_s?I(l.computed.eta_s):"\u2014";d.push(`Estimated time: ${n}`)}if(h){let n=l&&l.maps_url;d.push(n?s("a",{href:n,target:"_blank",rel:"noopener noreferrer"},"Open in Google Maps (midpoint)"):"Open in Google Maps (\u2014)")}return s("div",{className:"tvs-panel"},s("h3",{className:"tvs-activities-title"},t||"Route Insights"),!l&&!S?s("div",{className:"tvs-text-muted"},"Loading\u2026"):null,S?s("div",{className:"tvs-text-danger"},String(S)):null,s("ul",{className:"tvs-list"},d.map((n,r)=>s("li",{key:r},n))))}function G(){document.querySelectorAll(".tvs-route-insights-block").forEach((t,e)=>{if(t.__tvsMounted)return;let o=t.getAttribute("data-title")||"",i=t.getAttribute("data-show-elevation")==="1",h=t.getAttribute("data-show-surface")==="1",a=t.getAttribute("data-show-eta")==="1",s=t.getAttribute("data-show-maps-link")==="1",p=parseInt(t.getAttribute("data-route-id")||"0",10)||0;A(L,{React:M,title:o,showElevation:i,showSurface:h,showEta:a,showMapsLink:s,routeId:p},t),t.__tvsMounted=!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",G):G();})();
//# sourceMappingURL=tvs-block-route-insights.js.map
